"use strict";(self.webpackChunkawesome_notes=self.webpackChunkawesome_notes||[]).push([[1403],{1791:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"Web/Node/NodeBasicNotes","title":"Node Basic Notes","description":"Node App Structure","source":"@site/notes/Web/Node/NodeBasicNotes.md","sourceDirName":"Web/Node","slug":"/Web/Node/NodeBasicNotes","permalink":"/awesome-notes/Web/Node/NodeBasicNotes","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/awesome-notes/edit/main/notes/Web/Node/NodeBasicNotes.md","tags":[{"inline":true,"label":"Web","permalink":"/awesome-notes/tags/web"},{"inline":true,"label":"Node","permalink":"/awesome-notes/tags/node"}],"version":"current","lastUpdatedBy":"renovate[bot]","lastUpdatedAt":1732127335000,"frontMatter":{"author":"Sabertazimi","authorTitle":"Web Developer","authorURL":"https://github.com/sabertazimi","authorImageURL":"https://github.com/sabertazimi.png","tags":["Web","Node"]},"sidebar":"tutorialSidebar","previous":{"title":"Message Queue Basic Notes","permalink":"/awesome-notes/Web/Node/MessageQueueBasicNotes"},"next":{"title":"React Advanced Notes","permalink":"/awesome-notes/Web/React/ReactAdvancedNotes"}}');var i=s(5105),l=s(842);const o={author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","Node"]},c="Node Basic Notes",t={},a=[{value:"Node App Structure",id:"node-app-structure",level:2},{value:"NPM CLI",id:"npm-cli",level:2},{value:"NPM Mirrors",id:"npm-mirrors",level:3},{value:"Node Version Manager",id:"node-version-manager",level:3},{value:"Basic Steps",id:"basic-steps",level:3},{value:"Test Steps",id:"test-steps",level:3},{value:"Publish Steps",id:"publish-steps",level:3},{value:"Semantic Version",id:"semantic-version",level:3},{value:"Tab Completion",id:"tab-completion",level:3},{value:"Basic Command",id:"basic-command",level:3},{value:"Link Command",id:"link-command",level:3},{value:"Security Command",id:"security-command",level:3},{value:"NPX Command",id:"npx-command",level:3},{value:"NPM Dependencies",id:"npm-dependencies",level:3},{value:"NPM Doppelgangers",id:"npm-doppelgangers",level:4},{value:"NPM Ghost Dependency",id:"npm-ghost-dependency",level:4},{value:"NPM Invalid Dependency",id:"npm-invalid-dependency",level:4},{value:"Package JSON",id:"package-json",level:3},{value:"Bin",id:"bin",level:4},{value:"Version",id:"version",level:4},{value:"NPM Workspaces",id:"npm-workspaces",level:4},{value:"Exports Field",id:"exports-field",level:4},{value:"Resolutions",id:"resolutions",level:4},{value:"Package Lockfile",id:"package-lockfile",level:3},{value:"CLI Environment",id:"cli-environment",level:3},{value:"Corepack",id:"corepack",level:3},{value:"Yarn",id:"yarn",level:2},{value:"Yarn Configuration",id:"yarn-configuration",level:3},{value:"Yarn Updates",id:"yarn-updates",level:3},{value:"Yarn Workspace",id:"yarn-workspace",level:3},{value:"Yarn Plugin",id:"yarn-plugin",level:3},{value:"Yarn Patch",id:"yarn-patch",level:3},{value:"Yarn Berry Read World Case",id:"yarn-berry-read-world-case",level:3},{value:"PNPM",id:"pnpm",level:2},{value:"PNPM Installation",id:"pnpm-installation",level:3},{value:"PNPM Configuration",id:"pnpm-configuration",level:3},{value:"Self-Defined Module",id:"self-defined-module",level:2},{value:"Basic Modular Pattern",id:"basic-modular-pattern",level:3},{value:"Export Module",id:"export-module",level:3},{value:"CallBack Function",id:"callback-function",level:3},{value:"Module Resolution",id:"module-resolution",level:3},{value:"Node Module",id:"node-module",level:2},{value:"CommonJS Module",id:"commonjs-module",level:3},{value:"EcmaScript Module",id:"ecmascript-module",level:3},{value:"Process Module",id:"process-module",level:2},{value:"Process Properties",id:"process-properties",level:3},{value:"Process Events",id:"process-events",level:3},{value:"Process Information",id:"process-information",level:3},{value:"Process Event Loop and Counter",id:"process-event-loop-and-counter",level:3},{value:"Child Process",id:"child-process",level:3},{value:"Worker Threads Module",id:"worker-threads-module",level:2},{value:"File Module",id:"file-module",level:2},{value:"FS API",id:"fs-api",level:3},{value:"Buffer Object",id:"buffer-object",level:3},{value:"Path API",id:"path-api",level:3},{value:"Http Module",id:"http-module",level:2},{value:"Request Object",id:"request-object",level:3},{value:"\u5c5e\u6027",id:"\u5c5e\u6027",level:4},{value:"Response Object",id:"response-object",level:3},{value:"\u7c7b\u578b",id:"\u7c7b\u578b",level:4},{value:"\u4e8b\u4ef6",id:"\u4e8b\u4ef6",level:4},{value:"\u65b9\u6cd5",id:"\u65b9\u6cd5",level:4},{value:"Http Get",id:"http-get",level:3},{value:"Http Server",id:"http-server",level:3},{value:"Sample",id:"sample",level:3},{value:"Net Module",id:"net-module",level:2},{value:"Socket Object",id:"socket-object",level:3},{value:"Socket IO",id:"socket-io",level:3},{value:"Basic Methods",id:"basic-methods",level:3},{value:"URL Module",id:"url-module",level:2},{value:"Basic Method",id:"basic-method",level:3},{value:"parse",id:"parse",level:4},{value:"dns",id:"dns",level:3},{value:"Security Module",id:"security-module",level:2},{value:"Crypto",id:"crypto",level:3},{value:"Hash API",id:"hash-api",level:4},{value:"HMAC API",id:"hmac-api",level:4},{value:"UUID Generation",id:"uuid-generation",level:3},{value:"Async Module",id:"async-module",level:2},{value:"Cluster Module",id:"cluster-module",level:3},{value:"Test Module",id:"test-module",level:2},{value:"Assert Module",id:"assert-module",level:3},{value:"Debugging",id:"debugging",level:2},{value:"Inspector CLI",id:"inspector-cli",level:3},{value:"Node Web Crawler",id:"node-web-crawler",level:2},{value:"Deno",id:"deno",level:2},{value:"Node Reference",id:"node-reference",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"node-basic-notes",children:"Node Basic Notes"})}),"\n",(0,i.jsx)(n.h2,{id:"node-app-structure",children:"Node App Structure"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Main ./index.js, ./server.js, or ./yourEntryFile.js in the root"}),"\n",(0,i.jsx)(n.li,{children:"Supporting files in ./lib/"}),"\n",(0,i.jsx)(n.li,{children:"Static HTTP files in ./public/"}),"\n",(0,i.jsx)(n.li,{children:"Views or templates in ./views/"}),"\n",(0,i.jsx)(n.li,{children:"Command-line executables in ./bin/"}),"\n",(0,i.jsx)(n.li,{children:"Tests in ./test/ (or ./spec/ if you\u2019re a Jasmine cool-aid drinker)"}),"\n",(0,i.jsx)(n.li,{children:"npm scripts in ./scripts/"}),"\n",(0,i.jsx)(n.li,{children:"Config in ./config/"}),"\n",(0,i.jsx)(n.li,{children:"Documentation in ./doc/"}),"\n",(0,i.jsx)(n.li,{children:"Examples in ./examples/"}),"\n",(0,i.jsx)(n.li,{children:"Performance analysis in ./benchmarks/"}),"\n",(0,i.jsx)(n.li,{children:"Native C/C++ source in ./source/"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"npm-cli",children:"NPM CLI"}),"\n",(0,i.jsx)(n.h3,{id:"npm-mirrors",children:"NPM Mirrors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/cnpm/binary-mirror-config",children:"NPM mirror list"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm config set disturl https://npmmirror.com/mirrors/node/\nnpm config set chromedriver_cdnurl http://npmmirror.com/mirrors/chromedriver/\nnpm config set electron_mirror https://npmmirror.com/mirrors/electron/\nnpm config set electron_builder_binaries_mirror https://npmmirror.com/mirrors/electron-builder-binaries/\nnpm config set operadriver_cdnurl http://npmmirror.com/mirrors/operadriver/\nnpm config set phantomjs_cdnurl https://npmmirror.com/mirrors/phantomjs/\nnpm config set profiler_binary_host_mirror http://npmmirror.com/mirrors/node-inspector/\nnpm config set puppeteer_download_host https://npmmirror.com/mirrors/\nnpm config set python_mirror https://npmmirror.com/mirrors/python/\nnpm config set robotjs_binary_host https://npmmirror.com/mirrors/robotjs/\nnpm config set sass_binary_site https://npmmirror.com/mirrors/node-sass/\nnpm config set saucectl_install_binary_mirror https://npmmirror.com/mirrors/saucectl/\nnpm config set sentrycli_cdnurl https://npmmirror.com/mirrors/sentry-cli/\nnpm config set sharp_binary_host https://npmmirror.com/mirrors/sharp/\nnpm config set sharp_libvips_binary_host https://npmmirror.com/mirrors/sharp-libvips/\nnpm config set sqlite3_binary_site https://npmmirror.com/mirrors/sqlite3/\nnpm config set swc_binary_site https://npmmirror.com/mirrors/node-swc/\n"})}),"\n",(0,i.jsx)(n.h3,{id:"node-version-manager",children:"Node Version Manager"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/volta-cli/volta",children:"Volta: Install and Run JS Tool Quickly and Seamlessly"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/Schniz/fnm",children:"FNM: Rust Node Manager"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/nvm-sh/nvm",children:"NVM: Node Version Manager"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl https://get.volta.sh | bash\nvolta install node\nnode -v\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash\nwget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh | bash\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install and use the latest version\nnvm install node\nnvm use node\nnvm alias default node\n\n# Install and use the latest LTS version\nnvm install --lts\nnvm use --lts\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install and use specific version\nnvm install 16\nnvm use 16\nnvm ls\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Update to latest version\nnvm install 16\nnvm install node\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Remove version\nnvm uninstall 14\nnvm uninstall 12\n"})}),"\n",(0,i.jsx)(n.h3,{id:"basic-steps",children:"Basic Steps"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm adduser\nmkdir proj/\n# \u4fee\u6539 package.json \u53ef\u518d\u6b21\u8fd0\u884c\u6b64\u547d\u4ee4\n# scope for everyone\nnpm init --scope=<username>\n\n# \u4fee\u6539 package.json \u53ef\u518d\u6b21\u8fd0\u884c\u6b64\u547d\u4ee4(\u4e0d\u63a5\u6a21\u5757\u540d\u4e3a\u81ea\u52a8\u66f4\u65b0)\nnpm install -S <package>\nnpm install -D <package>\nnpm prune      # \u6e05\u9664\u65e0\u7528\u5305\nnpm rm --save  # --save \u5220\u9664\u6587\u4ef6\u7684\u540c\u65f6\u66f4\u65b0 package.json \u6587\u4ef6\n\nnpm ls\nnpm outdated   # \u53bb\u9664\u8fc7\u671f\u5305\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-steps",children:"Test Steps"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "scripts": {\n    "test": "node test.js"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm test\n"})}),"\n",(0,i.jsx)(n.h3,{id:"publish-steps",children:"Publish Steps"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"latest"})," or ",(0,i.jsx)(n.code,{children:"alpha"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm publish\nnpm publish --tag [<tag>]\nnpm dist-tag add <pkg>@<version> [<tag>]\nnpm dist-tag rm <pkg> <tag>\nnpm dist-tag ls [<pkg>]\n"})}),"\n",(0,i.jsx)(n.p,{children:"NPM registry token configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm config set @orgName:registry https://registry.example.com\nnpm config set //registry.example.com/:_authToken XXXXXTokenXXXXX\n"})}),"\n",(0,i.jsx)(n.p,{children:"Release script from VitePress:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const fs = require('node:fs')\nconst path = require('node:path')\nconst chalk = require('chalk')\nconst { prompt } = require('enquirer')\nconst execa = require('execa')\nconst semver = require('semver')\nconst currentVersion = require('../package.json').version\n\nconst versionIncrements = ['patch', 'minor', 'major']\n\nconst inc = i => semver.inc(currentVersion, i)\nconst bin = name => path.resolve(__dirname, `../node_modules/.bin/${name}`)\nfunction run(bin, args, opts = {}) {\n  return execa(bin, args, { stdio: 'inherit', ...opts })\n}\nconst step = msg => console.log(chalk.cyan(msg))\n\nasync function main() {\n  let targetVersion\n\n  const { release } = await prompt({\n    type: 'select',\n    name: 'release',\n    message: 'Select release type',\n    choices: versionIncrements.map(i => `${i} (${inc(i)})`).concat(['custom']),\n  })\n\n  if (release === 'custom') {\n    targetVersion = (\n      await prompt({\n        type: 'input',\n        name: 'version',\n        message: 'Input custom version',\n        initial: currentVersion,\n      })\n    ).version\n  } else {\n    targetVersion = release.match(/\\((.*)\\)/)[1]\n  }\n\n  if (!semver.valid(targetVersion))\n    throw new Error(`Invalid target version: ${targetVersion}`)\n\n  const { yes: tagOk } = await prompt({\n    type: 'confirm',\n    name: 'yes',\n    message: `Releasing v${targetVersion}. Confirm?`,\n  })\n\n  if (!tagOk)\n    return\n\n  // Update the package version.\n  step('\\nUpdating the package version...')\n  updatePackage(targetVersion)\n\n  // Build the package.\n  step('\\nBuilding the package...')\n  await run('yarn', ['build'])\n\n  // Generate the changelog.\n  step('\\nGenerating the changelog...')\n  await run('yarn', ['changelog'])\n  await run('yarn', ['prettier', '--write', 'CHANGELOG.md'])\n\n  const { yes: changelogOk } = await prompt({\n    type: 'confirm',\n    name: 'yes',\n    message: `Changelog generated. Does it look good?`,\n  })\n\n  if (!changelogOk)\n    return\n\n  // Commit changes to the Git and create a tag.\n  step('\\nCommitting changes...')\n  await run('git', ['add', 'CHANGELOG.md', 'package.json'])\n  await run('git', ['commit', '-m', `release: v${targetVersion}`])\n  await run('git', ['tag', `v${targetVersion}`])\n\n  // Publish the package.\n  step('\\nPublishing the package...')\n  await run('yarn', [\n    'publish',\n    '--new-version',\n    targetVersion,\n    '--no-commit-hooks',\n    '--no-git-tag-version',\n  ])\n  await run('npm', [\n    'publish',\n    '--registry',\n    'https://registry.npmjs.org',\n    '--access',\n    'public',\n  ])\n\n  // Push to GitHub.\n  step('\\nPushing to GitHub...')\n  await run('git', ['push', 'origin', `refs/tags/v${targetVersion}`])\n  await run('git', ['push'])\n}\n\nfunction updatePackage(version) {\n  const pkgPath = path.resolve(path.resolve(__dirname, '..'), 'package.json')\n  const pkg = JSON.parse(fs.readFileSync(pkgPath, 'utf-8'))\n\n  pkg.version = version\n\n  fs.writeFileSync(pkgPath, `${JSON.stringify(pkg, null, 2)}\\n`)\n}\n\nmain().catch(err => console.error(err))\n"})}),"\n",(0,i.jsx)(n.h3,{id:"semantic-version",children:"Semantic Version"}),"\n",(0,i.jsx)(n.p,{children:"Semver:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Patch release: bugfix and other minor changes."}),"\n",(0,i.jsx)(n.li,{children:"Minor release: new features not breaking API (backward compatible)."}),"\n",(0,i.jsx)(n.li,{children:"Major release: new features breaking API (not backward compatible)."}),"\n",(0,i.jsx)(n.li,{children:"Alpha (\u03b1): \u9884\u89c8\u7248 (\u5185\u90e8\u6d4b\u8bd5\u7248), \u4f1a\u6709\u5f88\u591a Bug, \u4e00\u822c\u53ea\u6709\u6d4b\u8bd5\u4eba\u5458\u4f7f\u7528."}),"\n",(0,i.jsx)(n.li,{children:"Beta (\u03b2): \u6d4b\u8bd5\u7248 (\u6216\u8005\u53eb\u516c\u5f00\u6d4b\u8bd5\u7248), \u4f1a\u4e00\u76f4\u52a0\u5165\u65b0\u7684\u529f\u80fd."}),"\n",(0,i.jsx)(n.li,{children:"RC (Release Candidate): \u6700\u7ec8\u6d4b\u8bd5\u7248\u672c, \u53ef\u80fd\u6210\u4e3a\u6700\u7ec8\u4ea7\u54c1\u7684\u5019\u9009\u7248\u672c."}),"\n",(0,i.jsx)(n.li,{children:"\u591a\u6570\u5f00\u6e90\u8f6f\u4ef6\u4f1a\u63a8\u51fa\u4e24\u4e2a RC \u7248\u672c, \u6700\u540e\u7684 RC2 \u5219\u6210\u4e3a\u6b63\u5f0f\u7248\u672c."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm version patch\nnpm publish\n\nnpm version minor\nnpm publish\n\nnpm version major\nnpm publish\n"})}),"\n",(0,i.jsx)(n.h3,{id:"tab-completion",children:"Tab Completion"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm completion >> ~/.bashrc (or ~/.zshrc)\nsource ~/.zshrc\n"})}),"\n",(0,i.jsx)(n.h3,{id:"basic-command",children:"Basic Command"}),"\n",(0,i.jsxs)(n.p,{children:["best practice: ",(0,i.jsx)(n.code,{children:"npm ci"})," for cache install (speed up installation)"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"// With package-lock.json exists:\nnpm ci\n"})}),"\n",(0,i.jsx)(n.p,{children:"remove useless package"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm prune // uninstall node_modules not in package.json\nnpm outdated\n"})}),"\n",(0,i.jsx)(n.h3,{id:"link-command",children:"Link Command"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd path/to/my-project\nnpm link path/to/my-utils\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# in local B package, build local B binary (npm install -g B)\nnpm link\n# in local A package, set `B` link in package.json to local B binary\nnpm link B\n"})}),"\n",(0,i.jsx)(n.h3,{id:"security-command",children:"Security Command"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm audit fix\nnpm audit fix --force\n"})}),"\n",(0,i.jsx)(n.h3,{id:"npx-command",children:"NPX Command"}),"\n",(0,i.jsx)(n.p,{children:"Run local node_modules:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install eslint -D\nnpx eslint .\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run global package (not installed):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx create-react-app react-app\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run specific version:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'npx -p package1@next -p package2@next -c "command"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Run scripts with different node version:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx -p node@version -- node index.js\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run remote repo/gist code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npx user/repo#branch\nnpx gistUrl\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"NPX Cache",type:"tip",children:(0,i.jsxs)(n.p,{children:["NPX cache packages in ",(0,i.jsx)(n.code,{children:"~/.npm/_npx"}),"."]})}),"\n",(0,i.jsx)(n.p,{children:"To get latest version package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# https://github.com/return-0x0/node-clear-npx-cache.\n# https://github.com/npm/cli/issues/2329.\n# https://github.com/npm/cli/issues/2395.\n# https://github.com/npm/cli/pull/2592.\n# https://github.com/facebook/create-react-app/issues/10601.\n# https://github.com/facebook/create-react-app/issues/12022.\nnpx clear-npx-cache\nnpx create-react-app app\n"})}),"\n",(0,i.jsx)(n.h3,{id:"npm-dependencies",children:"NPM Dependencies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Dependency Nesting/Hell (NPM v1)."}),"\n",(0,i.jsx)(n.li,{children:"Dependency Flatten/Hoist (NPM v3)."}),"\n",(0,i.jsx)(n.li,{children:"Dependency Consistent Lockfile (NPM v5 and Yarn)."}),"\n",(0,i.jsxs)(n.li,{children:["Dependency Hard/Symbol Links (PNPM):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Hard links for global ",(0,i.jsx)(n.code,{children:".pnpm"})," store to save disk storage."]}),"\n",(0,i.jsxs)(n.li,{children:["Symbol links for local require short path with non-flat ",(0,i.jsx)(n.code,{children:"node_modules"}),"\nto rectify ",(0,i.jsx)(n.strong,{children:"doppelgangers"})," and ",(0,i.jsx)(n.strong,{children:"ghost/phantom dependencies"})," problem."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"peerDependencies"}),":\n\u63d0\u793a\u5bbf\u4e3b\u73af\u5883\u53bb\u5b89\u88c5\u6ee1\u8db3\u63d2\u4ef6 ",(0,i.jsx)(n.code,{children:"peerDependencies"})," \u6240\u6307\u5b9a\u4f9d\u8d56\u7684\u5305,\n\u7136\u540e\u5728\u63d2\u4ef6 ",(0,i.jsx)(n.code,{children:"import"})," \u6216\u8005 ",(0,i.jsx)(n.code,{children:"require"})," \u6240\u4f9d\u8d56\u7684\u5305\u7684\u65f6\u5019,\n\u6c38\u8fdc\u90fd\u662f\u5f15\u7528\u5bbf\u4e3b\u73af\u5883\u7edf\u4e00\u5b89\u88c5\u7684 NPM \u5305,\n\u6700\u7ec8\u89e3\u51b3\u63d2\u4ef6\u4e0e\u6240\u4f9d\u8d56\u5305\u4e0d\u4e00\u81f4\u7684\u95ee\u9898."]}),"\n",(0,i.jsxs)(n.li,{children:["\u6784\u5efa\u4f9d\u8d56\u6811\u7684\u8fc7\u7a0b\u4e2d, \u7248\u672c\u786e\u8ba4\u9700\u8981\u7ed3\u5408 ",(0,i.jsx)(n.code,{children:"package.json"})," \u548c ",(0,i.jsx)(n.code,{children:"package-lock.json"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5148\u786e\u8ba4 ",(0,i.jsx)(n.code,{children:"package-lock.json"})," \u5b89\u88c5\u7248\u672c,\n\u7b26\u5408\u89c4\u5219\u5c31\u4ee5\u6b64\u4e3a\u51c6,\n\u5426\u5219\u7531 ",(0,i.jsx)(n.code,{children:"package.json"})," \u58f0\u660e\u7684\u7248\u672c\u8303\u56f4\u91cd\u65b0\u786e\u8ba4."]}),"\n",(0,i.jsxs)(n.li,{children:["\u82e5\u662f\u5728\u5f00\u53d1\u4e2d\u624b\u52a8\u66f4\u6539\u5305\u4fe1\u606f,\n\u4f1a\u5bfc\u81f4 ",(0,i.jsx)(n.strong,{children:"lockfile"})," \u7248\u672c\u4fe1\u606f\u5f02\u5e38,\n\u4e5f\u7531 ",(0,i.jsx)(n.code,{children:"package.json"})," \u91cd\u65b0\u786e\u8ba4."]}),"\n",(0,i.jsxs)(n.li,{children:["\u786e\u8ba4\u597d\u7684\u4f9d\u8d56\u6811\u4f1a\u5b58\u5230 ",(0,i.jsx)(n.code,{children:"package-lock.json"})," \u6587\u4ef6\u4e2d."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u540c\u4e00\u4e2a\u4f9d\u8d56, \u66f4\u9ad8\u7248\u672c\u7684\u5305\u4f1a\u5b89\u88c5\u5230\u9876\u5c42 ",(0,i.jsx)(n.code,{children:"node_modules"})," \u76ee\u5f55,\n\u4f4e\u7248\u672c\u7684\u5305\u4f1a\u5206\u6563\u5728\u67d0\u4e9b\u4f9d\u8d56\u7684 ",(0,i.jsx)(n.code,{children:"node_modules"})," \u76ee\u5f55."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Lockfile"})," \u4fdd\u8bc1\u9879\u76ee\u4f9d\u8d56\u7ed3\u6784\u7684\u786e\u5b9a\u6027, \u4fdd\u969c\u9879\u76ee\u5728\u591a\u73af\u5883\u8fd0\u884c\u7684\u7a33\u5b9a\u6027."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"npm-doppelgangers",children:"NPM Doppelgangers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Singleton conflict: multiple version of same package in ",(0,i.jsx)(n.code,{children:"node_modules"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Types conflict: global ",(0,i.jsx)(n.code,{children:"types"})," naming conflict."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"npm-ghost-dependency",children:"NPM Ghost Dependency"}),"\n",(0,i.jsx)(n.p,{children:"NPM ghost (phantom) dependency:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Imported packages from ",(0,i.jsx)(n.code,{children:"dependencies of dependencies"}),":\nWhen update ",(0,i.jsx)(n.code,{children:"dependencies"})," to minor version,\n",(0,i.jsx)(n.code,{children:"dependencies of dependencies"})," may get major BREAKING version\n(It's legal for ",(0,i.jsx)(n.code,{children:"semver"}),", when ",(0,i.jsx)(n.code,{children:"dependencies"})," API don't change)."]}),"\n",(0,i.jsxs)(n.li,{children:["Imported packages from ",(0,i.jsx)(n.code,{children:"devDependencies"}),":\nWhen others install your library,\nsuch imported packages will missing,\ncause they aren't located in library ",(0,i.jsx)(n.code,{children:"package.json"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Imported packages from root ",(0,i.jsx)(n.code,{children:"node_modules"})," in monorepo.\nWhen others install your library,\nsuch imported packages will missing,\ncause they aren't located in library ",(0,i.jsx)(n.code,{children:"package.json"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"npm-invalid-dependency",children:"NPM Invalid Dependency"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ npm ls\npackage@version invalid\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Modify ",(0,i.jsx)(n.code,{children:"package-lock.json"}),"\nto remove locked invalid package version."]}),"\n",(0,i.jsx)(n.h3,{id:"package-json",children:"Package JSON"}),"\n",(0,i.jsx)(n.h4,{id:"bin",children:"Bin"}),"\n",(0,i.jsxs)(n.p,{children:["\u5f53\u8bbe\u7f6e\u4e86 ",(0,i.jsx)(n.code,{children:"bin"})," \u5b57\u6bb5\u540e,\n\u5728 ",(0,i.jsx)(n.code,{children:"package.json"})," ",(0,i.jsx)(n.code,{children:"script"})," \u5b57\u6bb5\u4e2d,\n\u53ef\u4ee5\u4f7f\u7528\u7b80\u5199\u7f16\u5199\u547d\u4ee4\n(\u4f46\u662f\u5c40\u90e8\u5b89\u88c5\u65e0\u6cd5\u5728 shell \u4e0b\u4f7f\u7528, \u9700 ",(0,i.jsx)(n.code,{children:"npx <bin-name>"}),")."]}),"\n",(0,i.jsx)(n.h4,{id:"version",children:"Version"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm version major\nnpm version minor\nnpm version patch\n"})}),"\n",(0,i.jsx)(n.h4,{id:"npm-workspaces",children:"NPM Workspaces"}),"\n",(0,i.jsxs)(n.p,{children:["In root ",(0,i.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "workspaces": [\n    "./packages/*",\n    "./css/*",\n    "./angular/*",\n    "./react/*",\n    "./vue/*"\n  ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In root ",(0,i.jsx)(n.code,{children:"cwd"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm i\nnpm run lint -ws\nnpm run test -w package-a\nnpm i lodash -w package-b\nnpm i -D eslint -w package-c\n"})}),"\n",(0,i.jsx)(n.h4,{id:"exports-field",children:"Exports Field"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exports"})," can define ",(0,i.jsx)(n.a,{href:"https://zellwk.com/blog/npm-exports",children:"public API"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "exports": {\n    ".": {\n      "types": "./dist/index.d.ts",\n      "module": "./dist/index.mjs",\n      "import": "./dist/index.mjs",\n      "require": "./dist/index.cjs",\n      "default": "./dist/index.mjs"\n    },\n    "./package.json": "./package.json"\n  },\n  "types": "./dist/index.d.ts",\n  "browser": "./dist/index.mjs",\n  "module": "./dist/index.mjs",\n  "main": "./dist/index.cjs"\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"exports"})," configures JavaScript level,\nfile ",(0,i.jsx)(n.code,{children:"packages/rest/build/gen/util/regexp-tools.js"}),"\ncan be imported via ",(0,i.jsx)(n.code,{children:"@github/rest/gen/util/regexp-tools"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Don't need to mention directory ",(0,i.jsx)(n.code,{children:"build"}),"/",(0,i.jsx)(n.code,{children:"dist"})," in module specifiers."]}),"\n",(0,i.jsxs)(n.li,{children:["Don't need to mention ",(0,i.jsx)(n.code,{children:".js"}),"/",(0,i.jsx)(n.code,{children:".ts"})," in module specifiers."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "name": "@github/rest",\n  "private": true,\n  "exports": {\n    "./": "./dist/index.js",\n    "./gen/*": "./dist/gen/*.js",\n    "./client/*": "./dist/client/*.js",\n    "./contract": "./dist/contract.js",\n    "./state": "./dist/state.js",\n    "./package.json": "./package.json"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"import octokit from '@github/rest'\nimport { Contract } from '@github/rest/contract'\nimport utils from '@github/rest/gen/utils'\nimport state from '@github/rest/state'\n"})}),"\n",(0,i.jsx)(n.h4,{id:"resolutions",children:"Resolutions"}),"\n",(0,i.jsxs)(n.p,{children:["Besides ",(0,i.jsx)(n.code,{children:"git bisect"})," for debugging broken version,\nrevert to last working version with ",(0,i.jsx)(n.code,{children:"resolutions"})," field\nwill help to ",(0,i.jsx)(n.a,{href:"https://github.com/ant-design/ant-design/pull/48829",children:"fix broken version too"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "resolutions": {\n    "rc-field-form": "1.44.0"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"package-lockfile",children:"Package Lockfile"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://docs.renovatebot.com/dependency-pinning",children:"Dependency pinning"}),":"]}),"\n",(0,i.jsxs)(n.p,{children:["When kept in sync with its associated ",(0,i.jsx)(n.code,{children:"package.json"}),",\na lockfile will further lock down the exact dependencies and sub-dependencies,\nso that everyone running ",(0,i.jsx)(n.code,{children:"npm i"})," or ",(0,i.jsx)(n.code,{children:"yarn"})," will install the exact same dependencies."]}),"\n",(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"package.json"})," contains a range,\nand a new in-range version is released that would break the build,\nthen essentially ",(0,i.jsx)(n.code,{children:"package.json"})," is in a state of ",(0,i.jsx)(n.strong,{children:"broken"}),",\neven if the lockfile is still holding things together."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Apps (web or Node.js) that aren't ",(0,i.jsx)(n.code,{children:"require()"})," by other packages\nshould pin all types of dependencies for greatest reliability/predictability."]}),"\n",(0,i.jsxs)(n.li,{children:["Libraries that are ",(0,i.jsx)(n.code,{children:"consumed"}),"/",(0,i.jsx)(n.code,{children:"required()"})," by others\nshould keep using SemVer ranges for ",(0,i.jsx)(n.strong,{children:"dependencies"})," (purge multiple version ",(0,i.jsx)(n.code,{children:"node_modules"}),")\nbut can use pinned devDependencies."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"cli-environment",children:"CLI Environment"}),"\n",(0,i.jsxs)(n.p,{children:["\u914d\u7f6e\u6587\u4ef6\u4ee5 ",(0,i.jsx)(n.code,{children:".env"}),"/",(0,i.jsx)(n.code,{children:"JS(Object)"}),"/",(0,i.jsx)(n.code,{children:"JSON"}),"/",(0,i.jsx)(n.code,{children:"JSONP"}),"/",(0,i.jsx)(n.code,{children:"XML"}),"/",(0,i.jsx)(n.code,{children:"YML"})," \u683c\u5f0f\u5355\u72ec\u5b58\u653e,\n\u65b9\u4fbf\u8bfb\u53d6."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# .env file (added to .gitignore)\nNODE_ENV=development\nPORT=8626\n# Set your database/API connection information here\nAPI_KEY=**************************\nAPI_URL=**************************\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// config.js\nconst dotenv = require('dotenv')\ndotenv.config()\n\nmodule.exports = {\n  endpoint: process.env.API_URL,\n  masterKey: process.env.API_KEY,\n  port: process.env.PORT,\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// server.js\nconst { port } = require('./config')\nconsole.log(`Your port is ${port}`) // 8626\n"})}),"\n",(0,i.jsx)(n.h3,{id:"corepack",children:"Corepack"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://github.com/nodejs/corepack",children:"Corepack"})," is a tool to help with\nmanaging versions of your package managers (package manager manager)."]}),"\n",(0,i.jsx)(n.p,{children:"It exposes binary proxies for each supported package manager.\nIt will identify whatever package manager is configured for current project,\ntransparently install it if needed,\nand finally run it without requiring explicit user interactions."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# In npm project\ncorepack yarn\n\n# In npm project\ncorepack pnpm\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"corepack enable yarn\ncorepack disable pnpm\n"})}),"\n",(0,i.jsx)(n.h2,{id:"yarn",children:"Yarn"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://yarnpkg.com/getting-started/migration",children:"Yarn Berry"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Modify `/etc/hosts`\nnpm i -g yarn\ncd project/\nyarn set version berry\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Setup basic configuration ",(0,i.jsx)(n.code,{children:".yarnrc.yml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"yarnPath: .yarn/releases/yarn-berry.cjs\nnodeLinker: node-modules\nnpmPublishAccess: public\nnpmPublishRegistry: 'https://registry.npmjs.org'\nnpmRegistryServer: 'https://registry.npmjs.org'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:".gitignore"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:".yarn/*\n!.yarn/patches\n!.yarn/releases\n!.yarn/plugins\n!.yarn/sdks\n!.yarn/versions\n.pnp/\n.pnp.js\n"})}),"\n",(0,i.jsx)(n.h3,{id:"yarn-configuration",children:"Yarn Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'yarn config set nodeLinker node-modules --home\nyarn config set npmPublishAccess public --home\nyarn config set npmRegistryServer "https://registry.npmjs.org" --home\nyarn config set yarnPath .yarn/releases/yarn-berry.cjs --home\nyarn config set unsafeHttpWhitelist --json \'["localhost", "*.example.com", "example.com"]\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"yarn-updates",children:"Yarn Updates"}),"\n",(0,i.jsx)(n.p,{children:"One line to update all deps in monorepo:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn up @types/node\nyarn up @types/react\nyarn dedupe --strategy highest\n"})}),"\n",(0,i.jsx)(n.h3,{id:"yarn-workspace",children:"Yarn Workspace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn workspace packageName build\n"})}),"\n",(0,i.jsx)(n.h3,{id:"yarn-plugin",children:"Yarn Plugin"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn plugin list\n"})}),"\n",(0,i.jsx)(n.h3,{id:"yarn-patch",children:"Yarn Patch"}),"\n",(0,i.jsxs)(n.p,{children:["Modify package in ",(0,i.jsx)(n.code,{children:"node_modules"})," conveniently:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"yarn patch <package>"})," will create copy of ",(0,i.jsx)(n.code,{children:"package"})," to ",(0,i.jsx)(n.code,{children:"tmp/xfs-xxxxxxxx/user/"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["After modify source code of ",(0,i.jsx)(n.code,{children:"package"}),",\nrun ",(0,i.jsx)(n.code,{children:"yarn patch-commit /tmp/xfs-xxxxxxxx/user --save"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"yarn-berry-read-world-case",children:"Yarn Berry Read World Case"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/gatsbyjs/gatsby",children:"Gatsby"}),":\nyarn 1 with ",(0,i.jsx)(n.code,{children:".yarn/"})," directory."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/reduxjs/redux-toolkit",children:"Redux ToolKit"}),":\nyarn 2."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/babel/babel",children:"Babel"}),":\nyarn 3."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/storybookjs/storybook",children:"StoryBook"}),":\nyarn 3."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pnpm",children:"PNPM"}),"\n",(0,i.jsx)(n.h3,{id:"pnpm-installation",children:"PNPM Installation"}),"\n",(0,i.jsx)(n.p,{children:"Using Corepack or npm (recommended installation):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Using Corepack.\ncorepack enable pnpm\n\n# Using npm.\nnpm install -g pnpm\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"alias np=pnpm\nsource ~/.zshrc\nwhich pnpm\npnpm --version\npnpm store path\n"})}),"\n",(0,i.jsx)(n.p,{children:"Using a standalone script (without Node.js installed):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# By script.\nwget -qO- https://get.pnpm.io/install.sh | sh -\n\n# By manual download.\nmv ./pnpm-linux-x64 ./pnpm\nchmod +x ./pnpm\n./pnpm setup --force\n"})}),"\n",(0,i.jsx)(n.h3,{id:"pnpm-configuration",children:"PNPM Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm config set registry https://registry.npmmirror.com/\n"})}),"\n",(0,i.jsx)(n.h2,{id:"self-defined-module",children:"Self-Defined Module"}),"\n",(0,i.jsx)(n.h3,{id:"basic-modular-pattern",children:"Basic Modular Pattern"}),"\n",(0,i.jsx)(n.p,{children:"\u7f16\u5199\u5177\u6709\u56de\u8c03\u51fd\u6570\u53c2\u6570\u7684\u6a21\u5757"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5b9a\u4e49\u6a21\u5757"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"function foo(x, y, callback) {\n  try {\n    if (paramNotValid())\n      throw new Error('Invalid parameters!')\n    else\n      callback(null, param)\n  } catch (error) {\n    callback(error, param)\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4f7f\u7528\u6a21\u5757"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"foo(a, b, (err, param) => {\n  if (err)\n    processError()\n  else\n    process()\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"export-module",children:"Export Module"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"module.exports = function (args) {\n  /* ... */\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"callback-function",children:"CallBack Function"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5411\u5b9a\u4e49\u6700\u5185\u5c42\u56de\u8c03,\u53ef\u907f\u514d\u56de\u5957\u5d4c\u5957"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"server.on('request', (req, res) => {\n  const render = function (wsData) {\n    page = pageRender(req, session, userData, wsData)\n  }\n  const getWsInfo = function (userData) {\n    ws.get(req, render)\n  }\n  const getDbInfo = function (session) {\n    db.get(session.user, getWsInfo)\n  }\n  const getMemCached = function (req, res) {\n    memcached.getSession(req, getDbInfo)\n  }\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"module-resolution",children:"Module Resolution"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"const x = require('./module')"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/root/src/module.js"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/root/src/module/package.json"})," + ",(0,i.jsx)(n.code,{children:'{ "main": "lib/mainModule.js" }'}),"\n= ",(0,i.jsx)(n.code,{children:"/root/src/module/lib/mainModule.js"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/root/src/module/index.js"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"const x = require('module')"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/root/src/node_modules/module.js"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/root/src/node_modules/module/package.json"})," (if it specifies a ",(0,i.jsx)(n.code,{children:"main"})," property)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/root/src/node_modules/module/index.js"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/root/node_modules/module.js"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/root/node_modules/module/package.json"})," (if it specifies a ",(0,i.jsx)(n.code,{children:"main"})," property)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/root/node_modules/module/index.js"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/node_modules/module.js"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/node_modules/module/package.json"})," (if it specifies a ",(0,i.jsx)(n.code,{children:"main"})," property)"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/node_modules/module/index.js"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"node-module",children:"Node Module"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CommonJS \u6a21\u5757\u5728\u6267\u884c\u9636\u6bb5\u540c\u6b65\u52a0\u8f7d\u5b50\u6a21\u5757\u6587\u4ef6,\nES6 \u6a21\u5757\u5728\u9884\u5904\u7406\u9636\u6bb5\u52a0\u8f7d\u5b50\u6a21\u5757\u6587\u4ef6, ES6 \u6a21\u5757\u5728\u6267\u884c\u9636\u6bb5\u4e5f\u4f1a\u52a0\u8f7d\u5b50\u6a21\u5757\u6587\u4ef6, \u4e0d\u8fc7\u4f1a\u4f7f\u7528\u9884\u5904\u7406\u9636\u6bb5\u7684\u7f13\u5b58."}),"\n",(0,i.jsx)(n.li,{children:"CommonJS \u6a21\u5757\u540c\u6b65\u52a0\u8f7d\u5e76\u6267\u884c\u6a21\u5757\u6587\u4ef6, ES6 \u6a21\u5757\u63d0\u524d\u52a0\u8f7d\u5e76\u6267\u884c\u6a21\u5757\u6587\u4ef6.\n\u5f02\u6b65\u901a\u5e38\u88ab\u7406\u89e3\u4e3a\u5ef6\u540e\u4e00\u4e2a\u65f6\u95f4\u8282\u70b9\u6267\u884c, \u6240\u4ee5\u8bf4\u6210\u5f02\u6b65\u52a0\u8f7d\u662f\u9519\u8bef\u7684."}),"\n",(0,i.jsx)(n.li,{children:"\u4ece\u5f62\u5f0f\u4e0a\u770b,\nCommonJS \u6a21\u5757\u6574\u4f53\u5bfc\u51fa\u4e00\u4e2a\u5305\u542b\u82e5\u5e72\u4e2a\u53d8\u91cf\u7684\u5bf9\u8c61,\nES6 \u6a21\u5757\u5206\u5f00\u5bfc\u51fa\u5355\u4e2a\u53d8\u91cf."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"commonjs-module",children:"CommonJS Module"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"CommonJS"})," \u6a21\u5757\u4e00\u822c\u7531\u5305\u7ba1\u7406\u5668\u63d0\u4f9b\u7684\u8fd0\u884c\u65f6\u5b9e\u73b0."]}),"\n",(0,i.jsxs)(n.li,{children:["\u7531\u4e8e ",(0,i.jsx)(n.code,{children:"require"})," \u8bed\u53e5\u76f4\u63a5\u5206\u5272\u4e86\u6267\u884c\u7684\u4ee3\u7801\u5757,\n",(0,i.jsx)(n.code,{children:"CommonJS"})," \u6a21\u5757\u7684\u5bfc\u5165\u5bfc\u51fa\u8bed\u53e5\u7684\u4f4d\u7f6e\u4f1a\u5f71\u54cd\u6a21\u5757\u4ee3\u7801\u8bed\u53e5\u7684\u6267\u884c\u7ed3\u679c."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const fs = require('node:fs')\nconst path = require('node:path')\nconst vm = require('node:vm')\n\nfunction Module(id) {\n  this.id = id\n  this.exports = {}\n}\n\nModule.wrapper = [\n  '(function(exports, module, Require, __dirname, __filename) {',\n  '})',\n]\n\nModule._extensions = {\n  '.js': function (module) {\n    const content = fs.readFileSync(module.id, 'utf8')\n    const fnStr = Module.wrapper[0] + content + Module.wrapper[1]\n    const fn = vm.runInThisContext(fnStr)\n    fn.call(\n      module.exports, // Bind `this` to `module.exports`\n      module.exports,\n      module,\n      Require,\n      _dirname,\n      _filename\n    )\n  },\n  '.json': function (module) {\n    const json = fs.readFileSync(module.id, 'utf8')\n    module.exports = JSON.parse(json) // \u628a\u6587\u4ef6\u7684\u7ed3\u679c\u653e\u5728exports\u5c5e\u6027\u4e0a\n  },\n}\n\nfunction Require(modulePath) {\n  const absPathname = path.resolve(__dirname, modulePath)\n  const module = new Module(absPathname)\n  tryModuleLoad(module)\n  return module.exports\n}\n\nfunction tryModuleLoad(module) {\n  const extension = path.extname(module.id)\n  Module._extensions[extension](module)\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ecmascript-module",children:"EcmaScript Module"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ES6"})," \u6a21\u5757\u501f\u52a9 ",(0,i.jsx)(n.code,{children:"JS"})," \u5f15\u64ce\u5b9e\u73b0.\n",(0,i.jsx)(n.code,{children:"JS"})," \u5f15\u64ce\u5b9e\u73b0\u4e86 ",(0,i.jsx)(n.code,{children:"ES6"})," \u6a21\u5757\u7684\u5e95\u5c42\u6838\u5fc3\u903b\u8f91."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ES6"})," \u6a21\u5757\u6709 5 \u79cd\u72b6\u6001,\n\u5206\u522b\u4e3a ",(0,i.jsx)(n.code,{children:"unlinked"}),", ",(0,i.jsx)(n.code,{children:"linking"}),", ",(0,i.jsx)(n.code,{children:"linked"}),", ",(0,i.jsx)(n.code,{children:"evaluating"})," and ",(0,i.jsx)(n.code,{children:"evaluated"}),"\n(Module Environment Records)."]}),"\n",(0,i.jsxs)(n.li,{children:["\u7531\u4e8e\u8fde\u63a5\u9636\u6bb5\u4f1a\u7ed9\u5bfc\u5165\u6a21\u5757\u53d8\u91cf\u521b\u5efa\u7ed1\u5b9a\u5e76\u521d\u59cb\u5316\u4e3a\u5b50\u6a21\u5757\u7684\u5bf9\u5e94\u53d8\u91cf,\n\u5b50\u6a21\u5757\u7684\u5bf9\u5e94\u53d8\u91cf\u5728\u8bc4\u4f30\u9636\u6bb5\u4f1a\u5148\u88ab\u8d4b\u503c,\n\u6240\u4ee5\u5bfc\u5165\u6a21\u5757\u53d8\u91cf\u83b7\u5f97\u4e86\u548c\u51fd\u6570\u58f0\u660e\u53d8\u91cf\u4e00\u6837\u7684\u63d0\u5347\u6548\u679c.\n",(0,i.jsx)(n.code,{children:"ES6"})," \u6a21\u5757\u7684 ",(0,i.jsx)(n.code,{children:"import/export"})," \u4f4d\u7f6e\u4e0d\u5f71\u54cd\u6a21\u5757\u4ee3\u7801\u8bed\u53e5\u7684\u6267\u884c\u7ed3\u679c."]}),"\n",(0,i.jsxs)(n.li,{children:["Experimental ",(0,i.jsx)(n.code,{children:".mjs"})," file."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"process-module",children:"Process Module"}),"\n",(0,i.jsx)(n.h3,{id:"process-properties",children:"Process Properties"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.pid"}),": \u5f53\u524d\u8fdb\u7a0b\u7684\u8fdb\u7a0b\u53f7."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.version"}),": Node \u7684\u7248\u672c, \u6bd4\u5982 v0.10.18."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.platform"}),": \u5f53\u524d\u7cfb\u7edf\u5e73\u53f0, \u6bd4\u5982 Linux."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.title"}),": \u9ed8\u8ba4\u503c\u4e3a\u201cnode\u201d, \u53ef\u4ee5\u81ea\u5b9a\u4e49\u8be5\u503c."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.argv"}),": \u5f53\u524d\u8fdb\u7a0b\u7684\u547d\u4ee4\u884c\u53c2\u6570\u6570\u7ec4."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.env"}),": \u6307\u5411\u5f53\u524d shell \u7684\u73af\u5883\u53d8\u91cf, \u6bd4\u5982 process.env.HOME."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.execPath"}),": \u8fd0\u884c\u5f53\u524d\u8fdb\u7a0b\u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.stdout"}),": \u6307\u5411\u6807\u51c6\u8f93\u51fa."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.stdin"}),": \u6307\u5411\u6807\u51c6\u8f93\u5165."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"process.stderr"}),": \u6307\u5411\u6807\u51c6\u9519\u8bef."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"process.stdin.resume()\nprocess.stdin.pipe(process.stdout)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"process-events",children:"Process Events"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Error events:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"uncaughtException"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"unhandledRejection"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Signal events:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SIGHUP"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SIGINT"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SIGQUIT"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SIGTERM"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Exit events:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"beforeExit"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"exit"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Node HTTP applications graceful shutdown\n",(0,i.jsx)(n.a,{href:"https://github.com/godaddy/terminus",children:"library"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"process.on('uncaughtException', (err) => {\n  console.log(`Uncaught exception: ${err.message}.`)\n  process.exit(1)\n})\nprocess.on('uncaughtException', (reason, promise) => {\n  console.log(`Unhandled rejection at ${promise}, reason: ${reason}.`)\n  process.exit(1)\n})\n\nprocess.on('SIGHUP', (signal) => {\n  console.log(`Process ${process.pid} received a SIGHUP signal.`)\n  process.exit(0)\n})\nprocess.on('SIGINT', (signal) => {\n  console.log(`Process ${process.pid} has been interrupted.`)\n  process.exit(0)\n})\nprocess.on('SIGQUIT', (signal) => {\n  console.log(`Process ${process.pid} received a SIGQUIT signal.`)\n  process.exit(0)\n})\nprocess.on('SIGTERM', (signal) => {\n  console.log(`Process ${process.pid} received a SIGTERM signal.`)\n  process.exit(0)\n})\n\nprocess.on('beforeExit', (code) => {\n  setTimeout(() => {\n    console.log(`Process will exit with code: ${code}.`)\n    process.exit(code)\n  })\n})\nprocess.on('exit', (code) => {\n  console.log(`Process exited with code: ${code}.`)\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"process-information",children:"Process Information"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"process.on()"}),"\n",(0,i.jsx)(n.li,{children:"process.uptime(): \u8fdb\u7a0b\u8fd0\u884c\u65f6\u957f"}),"\n",(0,i.jsx)(n.li,{children:"process.getgid/setgid/getuid/setuid();"}),"\n",(0,i.jsx)(n.li,{children:"process.cwd()"}),"\n",(0,i.jsx)(n.li,{children:"process.memoryUsage()"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"process-event-loop-and-counter",children:"Process Event Loop and Counter"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"process.nextTick()"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"child-process",children:"Child Process"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cp.spawn()"}),": \u521b\u5efa\u5b50\u8fdb\u7a0b, \u62e5\u6709\u72ec\u7acb\u7684 stdin/stdout/stderr \u6587\u4ef6\u63cf\u8ff0\u7b26"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cp.exec()"}),": \u521b\u5efa\u5b50\u8fdb\u7a0b, \u5e76\u4f1a\u5728\u8fdb\u7a0b\u7ed3\u675f\u65f6\u8c03\u7528\u4f20\u5165\u7684\u56de\u8c03\u51fd\u6570"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/sindresorhus/execa",children:"Exec Library"})}),"\n",(0,i.jsx)(n.li,{children:"Each spawned Node.js child process is independent\nand has its own memory, event-loop, and V8 instance."}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"process.on"})," to communicate between parent and child process."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const cp = require('node:child_process')\n\ncp.exec(\n  'ls -l',\n  {\n    encoding: 'uft-8',\n    timeout: 0,\n    maxBuffer: 200 * 1024,\n    killSignal: 'SIGTERM',\n    setsid: false,\n    cwd: null,\n    env: null,\n  },\n  (err, stdout, stderr) => {\n    if (!err) {\n      console.log(stdout)\n      console.log(stderr)\n    }\n  }\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"worker-threads-module",children:"Worker Threads Module"}),"\n",(0,i.jsx)(n.p,{children:"Worker threads use threads to execute the work\nwithin the same process of the main application:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Worker threads are lightweight compared to child processes."}),"\n",(0,i.jsxs)(n.li,{children:["Worker threads can share memory (can transfer ",(0,i.jsx)(n.code,{children:"ArrayBuffer"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Each Node.js worker thread has its own independent Node.js runtime\n(including its own V8 instance, event loop, etc.)\nwith its own isolated context,\ntherefore ",(0,i.jsx)(n.strong,{children:"no thread synchronization"})," is usually needed."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// fibonacci-worker.js\nconst {\n  Worker,\n  isMainThread,\n  parentPort,\n  workerData,\n} = require('node:worker_threads')\n\nfunction fibonacci(num) {\n  if (num <= 1)\n    return num\n  return fibonacci(num - 1) + fibonacci(num - 2)\n}\n\nif (isMainThread) {\n  module.exports = n =>\n    new Promise((resolve, reject) => {\n      const worker = new Worker(__filename, {\n        workerData: n,\n      })\n      worker.on('message', resolve)\n      worker.on('error', reject)\n      worker.on('exit', (code) => {\n        if (code !== 0)\n          reject(new Error(`Worker stopped with exit code ${code}`))\n      })\n    })\n} else {\n  const result = fibonacci(workerData)\n  parentPort.postMessage(result)\n  process.exit(0)\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const http = require('node:http')\nconst fibonacciWorker = require('./fibonacci-worker')\n\nconst port = 3000\n\nhttp\n  .createServer(async (req, res) => {\n    const url = new URL(req.url, `http://${req.headers.host}`)\n    console.log('Incoming request to:', url.pathname)\n\n    if (url.pathname === '/fibonacci') {\n      const n = Number(url.searchParams.get('n'))\n      console.log('Calculating fibonacci for', n)\n\n      const result = await fibonacciWorker(n)\n      res.writeHead(200)\n      return res.end(`Result: ${result}\\n`)\n    } else {\n      res.writeHead(200)\n      return res.end('Hello World!')\n    }\n  })\n  .listen(port, () => console.log(`Listening on port ${port}...`))\n"})}),"\n",(0,i.jsx)(n.p,{children:"Worker pool is needed:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Creating a new worker/process is expensive.\nFor best performance, they should be reused."}),"\n",(0,i.jsx)(n.li,{children:"No control over the number of workers/processes created without worker pool.\nThis leaves vulnerable to DoS attacks."}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/josdejong/workerpool",children:"Worker pool library"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"file-module",children:"File Module"}),"\n",(0,i.jsx)(n.h3,{id:"fs-api",children:"FS API"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"fs.createReadStream."}),"\n",(0,i.jsx)(n.li,{children:"fs.opendir."}),"\n",(0,i.jsx)(n.li,{children:"fs.readdir."}),"\n",(0,i.jsx)(n.li,{children:"fs.readFile."}),"\n",(0,i.jsx)(n.li,{children:"fs.readFileSync."}),"\n",(0,i.jsx)(n.li,{children:"fs.exists."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const fs = require('node:fs')\n\nfunction readFile(filename) {\n  return new Promise((resolve, reject) => {\n    fs.readFile(filename, { encoding: 'utf8' }, (err, contents) => {\n      if (err) {\n        reject(err)\n        return\n      }\n\n      resolve(contents)\n    })\n  })\n}\n\nreadFile('example.txt')\n  .then((contents) => {\n    console.log(contents)\n  })\n  .catch((err) => {\n    console.error(err.message)\n  })\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { promises as fs } from 'node:fs'\nimport { basename, dirname, join } from 'node:path'\n\nasync function* walk(dir: string): AsyncGenerator<string> {\n  for await (const d of await fs.opendir(dir)) {\n    const entry = join(dir, d.name)\n\n    if (d.isDirectory())\n      yield * walk(entry)\n    else if (d.isFile())\n      yield entry\n  }\n}\n\nasync function run(arg = '.') {\n  if ((await fs.lstat(arg)).isFile())\n    return runTestFile(arg)\n\n  for await (const file of walk(arg)) {\n    if (\n      !dirname(file).includes('node_modules')\n      && (basename(file) === 'test.js' || file.endsWith('.test.js'))\n    ) {\n      console.log(file)\n      await runTestFile(file)\n    }\n  }\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import fs from 'node:fs/promises'\nimport path from 'node:path'\n\nasync function traverse(directory) {\n  const files = await fs.readdir(directory)\n\n  files.forEach(async (file) => {\n    const filePath = path.join(directory, file)\n    const fileStat = await fs.stat(filePath)\n\n    if (fileStat.isFile()) {\n      const content = await fs.readFile(filePath, 'utf-8')\n      console.log(content)\n    } else if (fileStat.isDirectory()) {\n      await traverse(filePath)\n    }\n  })\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"module.exports = function ls(dirName, fileType, callback) {\n  const fs = require('node:fs')\n  const path = require('node:path')\n\n  fs.readdir(dirName, (err, list) => {\n    if (err)\n      return callback(err)\n\n    list = list.filter((file) => {\n      return path.extname(file) === `.${fileType}`\n    })\n\n    callback(null, list)\n  })\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"buffer-object",children:"Buffer Object"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const str = buf.toString()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"path-api",children:"Path API"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"path.resolve: \u81ea\u52a8\u6309\u7cfb\u7edf\u5904\u7406\u8def\u5f84"}),"\n",(0,i.jsx)(n.li,{children:"path.extname: \u8fd4\u56de\u6587\u4ef6\u7c7b\u578b"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const path = require('node:path')\n\nconsole.log(path.extname('index.html')) // .html\n\npath.normalize(p)\npath.join([path1], [path2], [pathN])\npath.resolve(from, to)\npath.relative(from, to)\npath.dirname(p)\npath.basename(p, [ext])\npath.extname(p)\nconst separator = path.sep\nconst delimiter = path.delimiter\n"})}),"\n",(0,i.jsx)(n.h2,{id:"http-module",children:"Http Module"}),"\n",(0,i.jsx)(n.h3,{id:"request-object",children:"Request Object"}),"\n",(0,i.jsx)(n.h4,{id:"\u5c5e\u6027",children:"\u5c5e\u6027"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const request = {\n  method: 'POST',\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"response-object",children:"Response Object"}),"\n",(0,i.jsx)(n.h4,{id:"\u7c7b\u578b",children:"\u7c7b\u578b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"typedef Stream response\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u4e8b\u4ef6",children:"\u4e8b\u4ef6"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u76d1\u542c\u4e8b\u4ef6"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"response.on('data', (data) => {\n  process(data)\n})\nresponse.on('error', (err) => {\n  console.error(err)\n})\nresponse.on('end', () => {\n  stream.end()\n})\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53d1\u51fa\u4e8b\u4ef6"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"response.end() //  \u4f20\u8f93\u7ed3\u675f\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u65b9\u6cd5",children:"\u65b9\u6cd5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"response.setEncoding('utf8') // \u81ea\u52a8\u5c06 data \u4e8b\u4ef6\u4e2d Buffer \u5bf9\u8c61\u8f6c\u6362\u6210 String\n\n//  content-type: text/plain\n//                application/json\nresponse.writeHead(200, { 'Content-Type': '' })\n"})}),"\n",(0,i.jsx)(n.h3,{id:"http-get",children:"Http Get"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"http.get(url, (response) => {})\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"http.get(url, (response) => {\n  let pipeData = ''\n\n  response.setEncoding('utf8')\n  response.on('data', (data) => {\n    pipeData += data\n  })\n  response.on('end', () => {\n    console.log(pipeData.length)\n    console.log(pipeData)\n  })\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"http-server",children:"Http Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const server = http.createServer((request, response) => {\n  // \u5904\u7406\u8bf7\u6c42\u7684\u903b\u8f91...\n})\nserver.listen(8000)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"sample",children:"Sample"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const net = require('node:net')\nconst chatServer = net.createServer()\n// \u7528\u4e8e\u68c0\u6d4b\u50f5\u5c38\u5ba2\u6237\u7aef,\u7528\u4e8e\u53ca\u65f6\u6e05\u695a\u50f5\u5c38\u5ba2\u6237\u7aef\nconst clientList = []\n\nchatServer.on('connection', (client) => {\n  client.name = `${client.remoteAddress}:${client.remotePort}`\n  client.write(`Hi ${client.name}!\\n`)\n  clientList.push(client)\n\n  client.on('data', (data) => {\n    broadcast(data, client)\n  })\n  client.on('end', () => {\n    clientList.splice(clientList.indexOf(client), 1)\n  })\n  client.on('error', (e) => {\n    console.log(e)\n  })\n})\n\nfunction broadcast(message, client) {\n  const cleanup = []\n\n  for (let i = 0; i < clientList.length; i += 1) {\n    // \u5411\u5176\u4ed6\u4eba(\u6392\u9664\u81ea\u8eab)\u53d1\u9001\u6d88\u606f\n    if (client !== clientList[i]) {\n      if (clientList[i].writable) {\n        clientList[i].write(`${client.name} says ${message}`)\n      } else {\n        cleanup.push(clientList[i])\n        clientList[i].destroy()\n      }\n    }\n  }\n\n  // \u6e05\u695a\u50f5\u5c38\u5ba2\u6237\u7aef\n  for (let i = 0; i < cleanup.length; i += 1)\n    clientList.splice(clientList.indexOf(cleanup[i]), 1)\n}\n\nchatServer.listen(9000)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"net-module",children:"Net Module"}),"\n",(0,i.jsx)(n.h3,{id:"socket-object",children:"Socket Object"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"socket.write(data)\nsocket.end(data)\nsocket.end()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"socket-io",children:"Socket IO"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const fs = require('node:fs')\nconst http = require('node:http')\nconst io = require('socket.io')\nconst sockFile = fs.readFileSync('socket.html')\n\nserver = http.createServer()\nserver.on('request', (req, res) => {\n  res.writeHead(200, { 'content-type': 'text/html' })\n  res.end(sockFile)\n})\nserver.listen(8080)\n\nconst socket = io.listen(server)\n\n// \u547d\u540d\u7a7a\u95f4\nsocket.of('/upAndRunning').on('connection', (client) => {\n  console.log('Client connected to Up and Running namespace.')\n  client.send('Welcome to \\'Up and Running\\'')\n})\nsocket.of('/weather').on('connection', (client) => {\n  console.log('Client connected to Weather namespace.')\n  client.send('Welcome to \\'Weather Updates\\'')\n})\n"})}),"\n",(0,i.jsx)(n.h3,{id:"basic-methods",children:"Basic Methods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const serverInstance = net.createServer((socket) => {})\n\nserverInstance.listen(portNumber) // \u5f00\u59cb\u76d1\u542c\u7279\u5b9a\u7aef\u53e3\n"})}),"\n",(0,i.jsx)(n.h2,{id:"url-module",children:"URL Module"}),"\n",(0,i.jsx)(n.h3,{id:"basic-method",children:"Basic Method"}),"\n",(0,i.jsx)(n.h4,{id:"parse",children:"parse"}),"\n",(0,i.jsx)(n.p,{children:"\u89e3\u6790\u5904 URL \u5404\u4e2a\u7ec4\u6210\u90e8\u5206:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"href"}),"\n",(0,i.jsx)(n.li,{children:"protocol"}),"\n",(0,i.jsx)(n.li,{children:"host"}),"\n",(0,i.jsx)(n.li,{children:"auth"}),"\n",(0,i.jsx)(n.li,{children:"hostname"}),"\n",(0,i.jsx)(n.li,{children:"port"}),"\n",(0,i.jsx)(n.li,{children:"pathname"}),"\n",(0,i.jsx)(n.li,{children:"search"}),"\n",(0,i.jsx)(n.li,{children:"query"}),"\n",(0,i.jsx)(n.li,{children:"hash"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// true \u8868\u793a\u8c03\u7528 queryString \u6a21\u5757\u67e5\u8be2\u5b57\u7b26\u4e32\nurl.parse(request.url, true)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"dns",children:"dns"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"dns.resolve"}),"\n",(0,i.jsx)(n.li,{children:"dns.reverse"}),"\n",(0,i.jsx)(n.li,{children:"dns.lookup"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const dns = require('node:dns')\n\ndns.lookup('google.com', 4, (e, a) => {\n  console.log(a)\n})\n\ndns.resolve('tazimi.tk', 'A', (e, r) => {\n  if (e)\n    console.log(e)\n\n  console.log(JSON.stringify(r, null, 2))\n})\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const dns = require('node:dns')\n\ndns.resolve('tazimi.dev', 'A', (err, res) => {\n  if (err)\n    console.log(err)\n  else\n    console.log(`A: ${JSON.stringify(res, null, 2)}`)\n})\n\ndns.resolve('github.com', 'MX', (err, res) => {\n  if (err)\n    console.log(err)\n  else\n    console.log(`MX: ${JSON.stringify(res, null, 2)}`)\n})\n"})}),"\n",(0,i.jsx)(n.h2,{id:"security-module",children:"Security Module"}),"\n",(0,i.jsx)(n.h3,{id:"crypto",children:"Crypto"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"hash algorithm"}),"\n",(0,i.jsx)(n.li,{children:"hmac algorithm"}),"\n",(0,i.jsx)(n.li,{children:"cipher/decipher algorithms"}),"\n",(0,i.jsx)(n.li,{children:"signature/validate"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"hash-api",children:"Hash API"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const crypto = require('node:crypto')\nconst md5 = crypto.createHash('md5')\n\nmd5.update('foo')\nmd5.digest('hex') // 'acbd18db4cc2f85cedef654fccc4a4d8'\n"})}),"\n",(0,i.jsx)(n.h4,{id:"hmac-api",children:"HMAC API"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"openssl genrsa -out key.pem 1024\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const crypto = require('node:crypto')\nconst fs = require('node:fs')\nconst pem = fs.readFileSync('key.pem')\nconst key = pem.toString('ascii')\nconst hmac = crypto.createHmac('sha1', key)\n\nhmac.update('bar')\nhmac.digest('hex') // '7x123'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"uuid-generation",children:"UUID Generation"}),"\n",(0,i.jsxs)(n.p,{children:["Enhance usability of unique identifiers by\n",(0,i.jsx)(n.a,{href:"https://unkey.dev/blog/uuid-ux",children:"prefixing and encoding in base58"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// src/utils/id.ts\nimport { customAlphabet } from 'nanoid'\n\nexport const nanoid = customAlphabet('123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz')\n\nconst prefixes = {\n  key: 'key',\n  api: 'api',\n  policy: 'pol',\n  request: 'req',\n  workspace: 'ws',\n  vercelBinding: 'vb',\n  keyAuth: 'key_auth', // <-- this is internal and does not need to be short or pretty\n  test: 'test', // <-- for tests only\n} as const\n\nexport function newId(\n  prefix: keyof typeof prefixes,\n  length: number = 16\n): string {\n  return [prefixes[prefix], nanoid(length)].join('_')\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// app.ts\nimport { newId } from '@utils/id'\n\nconst id = newId('workspace')\n// ws_dYuyGV3qMKvEbjML\n\nconst id = newId('keyY')\n// invalid because `keyY` is not a valid prefix name\n"})}),"\n",(0,i.jsx)(n.h2,{id:"async-module",children:"Async Module"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u56de\u8c03\u8fdb\u884c\u8ba1\u6570\u662f\u5904\u7406 Node \u4e2d\u5f02\u6b65\u7684\u57fa\u7840 - \u81ea\u5b9a\u4e49 Semaphore \u53d8\u91cf: \u6bcf\u5b8c\u6210\u4e00\u4e2a\u5f02\u6b65\u5904\u7406, Semaphore++"}),"\n",(0,i.jsx)(n.h3,{id:"cluster-module",children:"Cluster Module"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const cluster = require('node:cluster')\nconst http = require('node:http')\nconst numCPUs = require('node:os').cpus().length\nconst rssWarn = 50 * 1024 * 1024\nconst heapWarn = 50 * 1024 * 1024\nconst workers = {}\n\nif (cluster.isMaster) {\n  for (let i = 0; i < numCPUs; i++)\n    createWorker()\n\n  setInterval(() => {\n    const time = new Date().getTime()\n    for (pid in workers) {\n      if (\n        Object.prototype.hasOwnProperty.call(workers, pid)\n        && workers[pid].lastCb + 5000 < time\n      ) {\n        console.log(`Long running worker ${pid} killed`)\n        workers[pid].worker.kill()\n        delete workers[pid]\n        createWorker()\n      }\n    }\n  }, 1000)\n} else {\n  // Server\n  http\n    .Server((req, res) => {\n      // mess up 1 in 200 request\n      if (Math.floor(Math.random() * 200) === 4) {\n        console.log(`Stopped ${process.pid} from ever finishing`)\n        while (true)\n          continue\n      }\n      res.writeHead(200)\n      res.end(`hello world from ${process.pid}\\n`)\n    })\n    .listen(8000)\n  // Report stats once a second\n  setInterval(() => {\n    process.send({\n      cmd: 'reportMem',\n      memory: process.memoryUsage(),\n      process: process.pid,\n    })\n  }, 1000)\n}\n\nfunction createWorker() {\n  const worker = cluster.fork()\n  console.log(`Created worker: ${worker.pid}`)\n\n  // allow boot time\n  workers[worker.pid] = { worker, lastCb: new Date().getTime() - 1000 }\n  worker.on('message', (m) => {\n    if (m.cmd === 'reportMem') {\n      workers[m.process].lastCb = new Date().getTime()\n      if (m.memory.rss > rssWarn)\n        console.log(`Worker ${m.process} using too much memory.`)\n    }\n  })\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"test-module",children:"Test Module"}),"\n",(0,i.jsx)(n.h3,{id:"assert-module",children:"Assert Module"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.equal(expect, real, assertPrompt)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.notEqual(expect, real, assertPrompt)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.strictEqual(expect, real, assertPrompt)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.notStrictEqual(expect, real, assertPrompt)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.deepEqual(expect, real, assertPrompt)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.notDeepEqual(expect, real, assertPrompt)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.ok(var, assertPrompt): \u6d4b\u8bd5\u5bf9\u8c61\u771f\u503c(truthy/falsy)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.throws(fn)"}),": \u6d4b\u8bd5\u65b9\u6cd5\u662f\u5426\u629b\u51fa\u5f02\u5e38."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"assert.doesNotThrow(fn)"}),": \u6d4b\u8bd5\u65b9\u6cd5\u662f\u5426\u629b\u51fa\u5f02\u5e38."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const assert = require('node:assert')\n\nassert.equal(1, true, 'Truthy')\nassert.notEqual(1, true, 'Truthy')\n\nassert.ok(0, 'Zero is not truthy')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,i.jsx)(n.h3,{id:"inspector-cli",children:"Inspector CLI"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://nodejs.org/en/docs/guides/debugging-getting-started",children:"Enable inspector"}),";"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"node --inspect server.js # Start debugging.\nnode --inspect-brk server.js # Start debugging and break.\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://nodejs.dev/en/api/v18/cli/#node_debugmodule",children:"Enable core modules debug information"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"NODE_DEBUG=fs,net,stream yarn test\n"})}),"\n",(0,i.jsx)(n.h2,{id:"node-web-crawler",children:"Node Web Crawler"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://www.zenrows.com/blog/web-scraping-with-javascript-and-nodejs",children:"Simple example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const axios = require('axios')\nconst cheerio = require('cheerio')\nconst playwright = require('playwright')\n\nconst url = 'https://scrapeme.live/shop/page/1/'\nconst useHeadless = false // \"true\" to use playwright\nconst maxVisits = 30 // Arbitrary number for the maximum of links visited\nconst visited = new Set()\nconst allProducts = []\n\nconst sleep = ms => new Promise(resolve => setTimeout(resolve, ms))\n\nasync function getHtmlPlaywright(url) {\n  const browser = await playwright.firefox.launch()\n  const context = await browser.newContext()\n  const page = await context.newPage()\n  await page.goto(url)\n  const html = await page.content()\n  await browser.close()\n\n  return html\n}\n\nasync function getHtmlAxios(url) {\n  const { data } = await axios.get(url)\n\n  return data\n}\n\nasync function getHtml(url) {\n  return useHeadless ? await getHtmlPlaywright(url) : await getHtmlAxios(url)\n}\n\nfunction extractContent($) {\n  return $('.product')\n    .map((_, product) => {\n      const $product = $(product)\n\n      return {\n        id: $product.find('a[data-product_id]').attr('data-product_id'),\n        title: $product.find('h2').text(),\n        price: $product.find('.price').text(),\n      }\n    })\n    .toArray()\n}\n\nfunction extractLinks($) {\n  return [\n    ...new Set(\n      $('.page-numbers a')\n        .map((_, a) => $(a).attr('href'))\n        .toArray()\n    ),\n  ]\n}\n\nasync function crawl(url) {\n  visited.add(url)\n  console.log('Crawl: ', url)\n  const html = await getHtml(url)\n  const $ = cheerio.load(html)\n  const content = extractContent($)\n  const links = extractLinks($)\n  links\n    .filter(link => !visited.has(link))\n    .forEach((link) => {\n      q.enqueue(crawlTask, link)\n    })\n  allProducts.push(...content)\n\n  // We can see how the list grows. Gotta catch 'em all!\n  console.log(allProducts.length)\n}\n\n// Change the default concurrency or pass it as param\nfunction queue(concurrency = 4) {\n  let running = 0\n  const tasks = []\n\n  return {\n    enqueue: async (task, ...params) => {\n      tasks.push({ task, params })\n      if (running >= concurrency)\n        return\n\n      ++running\n      while (tasks.length) {\n        const { task, params } = tasks.shift()\n        await task(...params)\n      }\n      --running\n    },\n  }\n}\n\nasync function crawlTask(url) {\n  if (visited.size >= maxVisits) {\n    console.log('Over Max Visits, exiting')\n    return\n  }\n\n  if (visited.has(url))\n    return\n\n  await crawl(url)\n}\n\nconst q = queue()\nq.enqueue(crawlTask, url)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Web scraping with ",(0,i.jsx)(n.a,{href:"https://lev.engineer/blog/web-scraping-like-a-pro-unlocking-the-power-of-impersonation",children:"impersonation"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"const puppeteer = require('puppeteer-extra')\nconst StealthPlugin = require('puppeteer-extra-plugin-stealth')\n\npuppeteer.use(StealthPlugin());\n\n(async () => {\n  const browser = await puppeteer.launch()\n  const page = await browser.newPage()\n  await page.goto('https://example.com')\n\n  // Now your Puppeteer script is enhanced with advanced evasion techniques\n  // Proceed with your web scraping tasks\n\n  await browser.close()\n})()\n\nconst { chromium, devices } = require('playwright')\nconst iPhone11 = devices['iPhone 11'];\n\n(async () => {\n  const browser = await chromium.launch()\n  const context = await browser.newContext({\n    userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 '\n      + '(KHTML, like Gecko) Chrome/88.0.4324.150 Safari/537.36',\n    geolocation: { latitude: 48.8584, longitude: 2.2945 }, // Paris, France\n    permissions: ['geolocation'],\n    locale: 'fr-FR',\n    ...iPhone11,\n  })\n  const page = await context.newPage()\n  await page.goto('https://example.com')\n\n  // Your scraping logic here\n\n  await browser.close()\n})()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"deno",children:"Deno"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Node.js library to Deno ",(0,i.jsx)(n.a,{href:"https://www.edgedb.com/blog/how-we-converted-our-node-js-library-to-deno-using-deno",children:"guide"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"node-reference",children:"Node Reference"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://nodejs.dev/learn",children:"Node.js Dev"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://alexkondov.com/tao-of-node",children:"Tao of Node"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/goldbergyoni/nodebestpractices",children:"Node Best Practice"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},842:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var r=s(8101);const i={},l=r.createContext(i);function o(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);