"use strict";(self.webpackChunkawesome_notes=self.webpackChunkawesome_notes||[]).push([[9850],{6079:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Web/JavaScript/JavaScriptDevOpsNotes","title":"JavaScript DevOps Notes","description":"PWA","source":"@site/notes/Web/JavaScript/JavaScriptDevOpsNotes.md","sourceDirName":"Web/JavaScript","slug":"/Web/JavaScript/JavaScriptDevOpsNotes","permalink":"/awesome-notes/Web/JavaScript/JavaScriptDevOpsNotes","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/awesome-notes/edit/main/notes/Web/JavaScript/JavaScriptDevOpsNotes.md","tags":[{"inline":true,"label":"Web","permalink":"/awesome-notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/awesome-notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/awesome-notes/tags/ecma-script"},{"inline":true,"label":"DevOps","permalink":"/awesome-notes/tags/dev-ops"}],"version":"current","lastUpdatedBy":"renovate[bot]","lastUpdatedAt":1734246257000,"frontMatter":{"author":"Sabertazimi","authorTitle":"Web Developer","authorURL":"https://github.com/sabertazimi","authorImageURL":"https://github.com/sabertazimi.png","tags":["Web","JavaScript","ECMAScript","DevOps"]},"sidebar":"tutorialSidebar","previous":{"title":"JavaScript Basic Notes","permalink":"/awesome-notes/Web/JavaScript/JavaScriptBasicNotes"},"next":{"title":"JavaScript Performance Notes","permalink":"/awesome-notes/Web/JavaScript/JavaScriptPerformanceNotes"}}');var r=s(5105),t=s(842);const o={author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","JavaScript","ECMAScript","DevOps"]},a="JavaScript DevOps Notes",l={},c=[{value:"PWA",id:"pwa",level:2},{value:"Service Worker Pros",id:"service-worker-pros",level:3},{value:"Service Worker Costs",id:"service-worker-costs",level:3},{value:"Service Worker Caching Strategy",id:"service-worker-caching-strategy",level:3},{value:"Service Worker Usage",id:"service-worker-usage",level:3},{value:"Register Service Worker",id:"register-service-worker",level:4},{value:"Broken Images Service Worker",id:"broken-images-service-worker",level:4},{value:"Caches Version Service Worker",id:"caches-version-service-worker",level:4},{value:"PWA Reference",id:"pwa-reference",level:3},{value:"JamStack",id:"jamstack",level:2},{value:"Rendering Patterns",id:"rendering-patterns",level:3},{value:"CSR",id:"csr",level:3},{value:"SSR",id:"ssr",level:3},{value:"SSR Upside",id:"ssr-upside",level:4},{value:"SSR Usage",id:"ssr-usage",level:4},{value:"SSR Reference",id:"ssr-reference",level:4},{value:"SSG",id:"ssg",level:3},{value:"ISR",id:"isr",level:3},{value:"Islands Architecture",id:"islands-architecture",level:3},{value:"JamStack Reference",id:"jamstack-reference",level:3},{value:"SEO",id:"seo",level:2},{value:"SEO Metadata",id:"seo-metadata",level:3},{value:"SEO Best Practice",id:"seo-best-practice",level:3},{value:"SEO Reference",id:"seo-reference",level:3},{value:"Web Authentication",id:"web-authentication",level:2},{value:"Cookie",id:"cookie",level:3},{value:"HTTP Basic Authentication",id:"http-basic-authentication",level:3},{value:"Session Cookie",id:"session-cookie",level:3},{value:"Session Cookie Basis",id:"session-cookie-basis",level:4},{value:"Session Cookie Cons",id:"session-cookie-cons",level:4},{value:"Session Cookie Usage",id:"session-cookie-usage",level:4},{value:"Token Authentication",id:"token-authentication",level:3},{value:"Token Authentication Basis",id:"token-authentication-basis",level:4},{value:"Token Authentication Pros",id:"token-authentication-pros",level:4},{value:"Token Authentication Cons",id:"token-authentication-cons",level:4},{value:"JSON Web Token",id:"json-web-token",level:3},{value:"JSON Web Token Basis",id:"json-web-token-basis",level:4},{value:"JSON Web TOken Pros",id:"json-web-token-pros",level:4},{value:"JSON Web Token Cons",id:"json-web-token-cons",level:4},{value:"JWT Client",id:"jwt-client",level:4},{value:"OAuth Authentication",id:"oauth-authentication",level:3},{value:"OAuth Authentication Basis",id:"oauth-authentication-basis",level:4},{value:"OAuth 2.0",id:"oauth-20",level:4},{value:"OAuth Usage",id:"oauth-usage",level:4},{value:"Single Sign On",id:"single-sign-on",level:3},{value:"Web Operation and Deployment",id:"web-operation-and-deployment",level:2},{value:"Static Assets",id:"static-assets",level:3},{value:"CI System",id:"ci-system",level:3},{value:"Docker Deployment",id:"docker-deployment",level:3},{value:"Nginx Configuration",id:"nginx-configuration",level:3},{value:"A/B Testing",id:"ab-testing",level:3},{value:"Blue Green Deployment",id:"blue-green-deployment",level:3},{value:"Rolling Update",id:"rolling-update",level:3},{value:"Gray Release",id:"gray-release",level:3},{value:"Gray Release Introduction",id:"gray-release-introduction",level:4},{value:"Gray Release Solution",id:"gray-release-solution",level:4},{value:"Gray Release Performance",id:"gray-release-performance",level:4},{value:"DevOps Reference",id:"devops-reference",level:3},{value:"ESLint",id:"eslint",level:2},{value:"ESLint Flat Config",id:"eslint-flat-config",level:3},{value:"Babel",id:"babel",level:2},{value:"Babel Node",id:"babel-node",level:3},{value:"Babel Core",id:"babel-core",level:3},{value:"CodeMod Tool",id:"codemod-tool",level:3},{value:"Babel Transform Plugin",id:"babel-transform-plugin",level:3},{value:"Babel Preset Plugin",id:"babel-preset-plugin",level:3},{value:"Webpack",id:"webpack",level:2},{value:"Webpack Workflow",id:"webpack-workflow",level:3},{value:"Webpack Configuration Intellisense",id:"webpack-configuration-intellisense",level:3},{value:"Webpack Hot Module Replacement",id:"webpack-hot-module-replacement",level:3},{value:"Webpack Watch Options",id:"webpack-watch-options",level:3},{value:"Webpack Resolve Path Options",id:"webpack-resolve-path-options",level:3},{value:"Webpack Flag Options",id:"webpack-flag-options",level:3},{value:"Webpack Devtool Source Map Configuration",id:"webpack-devtool-source-map-configuration",level:3},{value:"Webpack Cache Configuration",id:"webpack-cache-configuration",level:3},{value:"Webpack Build Cache",id:"webpack-build-cache",level:4},{value:"Webpack Browser Cache",id:"webpack-browser-cache",level:4},{value:"Webpack Library Configuration",id:"webpack-library-configuration",level:3},{value:"Webpack Loader Configuration",id:"webpack-loader-configuration",level:3},{value:"Webpack Babel Loader",id:"webpack-babel-loader",level:4},{value:"Webpack CSS Loader",id:"webpack-css-loader",level:4},{value:"Webpack Static Assets Loader",id:"webpack-static-assets-loader",level:4},{value:"Webpack Resource Assets",id:"webpack-resource-assets",level:5},{value:"Webpack Inline Assets",id:"webpack-inline-assets",level:5},{value:"Webpack Source Assets",id:"webpack-source-assets",level:5},{value:"Webpack Thread Loader",id:"webpack-thread-loader",level:4},{value:"Webpack Web Worker Loader",id:"webpack-web-worker-loader",level:4},{value:"Webpack Optimization",id:"webpack-optimization",level:3},{value:"Common Libraries",id:"common-libraries",level:4},{value:"Common Chunks",id:"common-chunks",level:4},{value:"Code Minimization",id:"code-minimization",level:4},{value:"Code Splitting",id:"code-splitting",level:4},{value:"Tree Shaking",id:"tree-shaking",level:4},{value:"Building Caches",id:"building-caches",level:4},{value:"Webpack Perf Profiling",id:"webpack-perf-profiling",level:4},{value:"Commit Linter",id:"commit-linter",level:4},{value:"Webpack Plugins",id:"webpack-plugins",level:3},{value:"Webpack HTML Plugins",id:"webpack-html-plugins",level:4},{value:"Webpack JavaScript Plugins",id:"webpack-javascript-plugins",level:4},{value:"Webpack CSS Plugins",id:"webpack-css-plugins",level:4},{value:"Webpack Images Plugins",id:"webpack-images-plugins",level:4},{value:"Webpack Building Work Plugins",id:"webpack-building-work-plugins",level:4},{value:"Webpack Bundles UI Plugins",id:"webpack-bundles-ui-plugins",level:4},{value:"Webpack DLL Plugins",id:"webpack-dll-plugins",level:4},{value:"Webpack Misc Plugins",id:"webpack-misc-plugins",level:4},{value:"Webpack Custom Plugin",id:"webpack-custom-plugin",level:4},{value:"Webpack Migrate to 5",id:"webpack-migrate-to-5",level:3},{value:"Webpack Reference",id:"webpack-reference",level:3},{value:"Rollup",id:"rollup",level:2},{value:"Vite",id:"vite",level:2},{value:"ESBuild",id:"esbuild",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"javascript-devops-notes",children:"JavaScript DevOps Notes"})}),"\n",(0,r.jsx)(n.h2,{id:"pwa",children:"PWA"}),"\n",(0,r.jsx)(n.p,{children:"Progressive Web Apps:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Served over ",(0,r.jsx)(n.code,{children:"HTTPS"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Provide a manifest."}),"\n",(0,r.jsxs)(n.li,{children:["Register a ",(0,r.jsx)(n.code,{children:"ServiceWorker"}),"\n(web cache for offline and performance)."]}),"\n",(0,r.jsx)(n.li,{children:"Consists of website, web app manifest,\nservice worker, expanded capabilities\nand OS integration."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-worker-pros",children:"Service Worker Pros"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cache."}),"\n",(0,r.jsx)(n.li,{children:"Offline."}),"\n",(0,r.jsx)(n.li,{children:"Background."}),"\n",(0,r.jsx)(n.li,{children:"Custom request to minimize network."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration/showNotification",children:"Notification API"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-worker-costs",children:"Service Worker Costs"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Need startup time."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// 20~100 ms for desktop\n// 100 ms for mobile\nconst entry = performance.getEntriesByName(url)[0]\nconst swStartupTime = entry.requestStart - entry.workerStart\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["cache reads aren't always instant:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["cache hit time = read time (only this case better than ",(0,r.jsx)(n.code,{children:"NO SW"}),"),"]}),"\n",(0,r.jsx)(n.li,{children:"cache miss time = read time + network latency,"}),"\n",(0,r.jsx)(n.li,{children:"cache slow time = slow read time + network latency,"}),"\n",(0,r.jsx)(n.li,{children:"SW asleep = SW boot latency + read time ( + network latency),"}),"\n",(0,r.jsx)(n.li,{children:"NO SW = network latency."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const entry = performance.getEntriesByName(url)[0]\n\n// no remote request means this was handled by the cache\nif (entry.transferSize === 0) {\n  const cacheTime = entry.responseStart - entry.requestStart\n}\n\nasync function handleRequest(event) {\n  const cacheStart = performance.now()\n  const response = await caches.match(event.request)\n  const cacheEnd = performance.now()\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u4e0d\u81ea\u52a8\u7f13\u5b58\u4efb\u4f55\u8bf7\u6c42, \u6240\u6709\u7f13\u5b58\u90fd\u5fc5\u987b\u660e\u786e\u6307\u5b9a."}),"\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u6ca1\u6709\u5230\u671f\u5931\u6548\u7684\u6982\u5ff5."}),"\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u5fc5\u987b\u624b\u52a8\u66f4\u65b0\u548c\u5220\u9664."}),"\n",(0,r.jsx)(n.li,{children:"\u7f13\u5b58\u7248\u672c\u5fc5\u987b\u624b\u52a8\u7ba1\u7406:\n\u6bcf\u6b21\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u66f4\u65b0, \u65b0\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u8d1f\u8d23\u63d0\u4f9b\u65b0\u7684\u7f13\u5b58\u952e\u4ee5\u4fdd\u5b58\u65b0\u7f13\u5b58."}),"\n",(0,r.jsx)(n.li,{children:"\u552f\u4e00\u7684\u6d4f\u89c8\u5668\u5f3a\u5236\u9010\u51fa\u7b56\u7565\u57fa\u4e8e\u670d\u52a1\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7f13\u5b58\u5360\u7528\u7684\u7a7a\u95f4.\n\u7f13\u5b58\u8d85\u8fc7\u6d4f\u89c8\u5668\u9650\u5236\u65f6, \u6d4f\u89c8\u5668\u4f1a\u57fa\u4e8e LRU \u539f\u5219\u4e3a\u65b0\u7f13\u5b58\u817e\u51fa\u7a7a\u95f4."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"service-worker-caching-strategy",children:"Service Worker Caching Strategy"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Service Worker Cache",src:s(7563).A+"",title:"Service Worker Cache",width:"845",height:"545"})}),"\n",(0,r.jsxs)(n.p,{children:["5 caching strategy in ",(0,r.jsx)(n.a,{href:"https://developer.chrome.com/docs/workbox/caching-strategies-overview",children:"workbox"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Stale-While-Revalidate:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', (event) => {\n  event.respondWith(\n    caches.open(cacheName).then((cache) => {\n      cache.match(event.request).then((cacheResponse) => {\n        fetch(event.request).then((networkResponse) => {\n          cache.put(event.request, networkResponse)\n        })\n\n        return cacheResponse || networkResponse\n      })\n    })\n  )\n})\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cache first, then Network:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', (event) => {\n  event.respondWith(\n    caches.open(cacheName).then((cache) => {\n      cache.match(event.request).then((cacheResponse) => {\n        if (cacheResponse)\n          return cacheResponse\n\n        return fetch(event.request).then((networkResponse) => {\n          cache.put(event.request, networkResponse.clone())\n          return networkResponse\n        })\n      })\n    })\n  )\n})\n"})}),"\n",(0,r.jsx)(n.p,{children:"Network first, then Cache:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', (event) => {\n  event.respondWith(\n    fetch(event.request).catch(() => {\n      return caches.match(event.request)\n    })\n  )\n})\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cache only:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', (event) => {\n  event.respondWith(\n    caches.open(cacheName).then((cache) => {\n      cache.match(event.request).then((cacheResponse) => {\n        return cacheResponse\n      })\n    })\n  )\n})\n"})}),"\n",(0,r.jsx)(n.p,{children:"Network only:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', (event) => {\n  event.respondWith(\n    fetch(event.request).then((networkResponse) => {\n      return networkResponse\n    })\n  )\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"service-worker-usage",children:"Service Worker Usage"}),"\n",(0,r.jsx)(n.h4,{id:"register-service-worker",children:"Register Service Worker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// Check that service workers are registered\nif ('serviceWorker' in navigator) {\n  // Use the window load event to keep the page load performance\n  window.addEventListener('load', () => {\n    navigator.serviceWorker.register('/sw.js')\n  })\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"broken-images-service-worker",children:"Broken Images Service Worker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function isImage(fetchRequest) {\n  return fetchRequest.method === 'GET' && fetchRequest.destination === 'image'\n}\n\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('fetch', (e) => {\n  e.respondWith(\n    fetch(e.request)\n      .then((response) => {\n        if (response.ok)\n          return response\n\n        // User is online, but response was not ok\n        if (isImage(e.request)) {\n          // Get broken image placeholder from cache\n          return caches.match('/broken.png')\n        }\n      })\n      .catch((err) => {\n        // User is probably offline\n        if (isImage(e.request)) {\n          // Get broken image placeholder from cache\n          return caches.match('/broken.png')\n        }\n        process(err)\n      })\n  )\n})\n\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener('install', (e) => {\n  // eslint-disable-next-line no-restricted-globals\n  self.skipWaiting()\n  e.waitUntil(\n    caches.open('precache').then((cache) => {\n      // Add /broken.png to \"precache\"\n      cache.add('/broken.png')\n    })\n  )\n})\n"})}),"\n",(0,r.jsx)(n.h4,{id:"caches-version-service-worker",children:"Caches Version Service Worker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line no-restricted-globals\nself.addEventListener('activate', (event) => {\n  const cacheWhitelist = ['v2']\n\n  event.waitUntil(\n    caches.keys().then((keyList) => {\n      return Promise.all([\n        keyList.map((key) => {\n          return cacheWhitelist.includes(key) ? caches.delete(key) : null\n        }),\n        // eslint-disable-next-line no-restricted-globals\n        self.clients.claim(),\n      ])\n    })\n  )\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pwa-reference",children:"PWA Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Service worker ",(0,r.jsx)(n.a,{href:"https://developer.chrome.com/docs/workbox/service-worker-overview",children:"overview"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Workbox ",(0,r.jsx)(n.a,{href:"https://github.com/GoogleChrome/workbox",children:"library"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Offline cookbook ",(0,r.jsx)(n.a,{href:"https://web.dev/offline-cookbook",children:"guide"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["PWA extensive ",(0,r.jsx)(n.a,{href:"https://www.smashingmagazine.com/2018/11/guide-pwa-progressive-web-applications",children:"guide"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Network reliable web app definitive ",(0,r.jsx)(n.a,{href:"https://web.dev/reliable",children:"guide"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://web.dev/resilient-search-experiences",children:"Resilient search"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://web.dev/instant-navigation-experiences",children:"Instant navigation"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://web.dev/app-shell-ux-with-service-workers",children:"App shell"}),">"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://web.dev/adaptive-loading-with-service-workers",children:"Adaptive loading"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://web.dev/broadcast-updates-guide",children:"Broadcast updates"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"jamstack",children:"JamStack"}),"\n",(0,r.jsx)(n.p,{children:"JamStack \u6307\u7684\u662f\u4e00\u5957\u7528\u4e8e\u6784\u5efa\u73b0\u4ee3\u7f51\u7ad9\u7684\u6280\u672f\u6808:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JavaScript: enhancing with JavaScript."}),"\n",(0,r.jsx)(n.li,{children:"APIs: supercharging with services."}),"\n",(0,r.jsx)(n.li,{children:"Markup: pre-rendering."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"rendering-patterns",children:"Rendering Patterns"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CSR (Client Side Rendering): SPA."}),"\n",(0,r.jsx)(n.li,{children:"SSR (Server Side Rendering): SPA with SEO."}),"\n",(0,r.jsx)(n.li,{children:"SSG (Static Site Generation): SPA with pre-rendering."}),"\n",(0,r.jsx)(n.li,{children:"ISR (Incremental Static Regeneration): SSG + SSR."}),"\n",(0,r.jsx)(n.li,{children:"SSR + CSR: HomePage with SSR, dynamic with CSR."}),"\n",(0,r.jsx)(n.li,{children:"SSG + CSR: HomePage with SSG, dynamic with CSR."}),"\n",(0,r.jsx)(n.li,{children:"SSG + SSR: static with SSG, dynamic with SSR."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.patterns.dev/posts/rendering-patterns",children:(0,r.jsx)(n.img,{alt:"Rendering Patterns",src:s(2644).A+"",width:"1463",height:"2457"})})}),"\n",(0,r.jsx)(n.h3,{id:"csr",children:"CSR"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CSR hit API after the page loads (LOADING indicator)."}),"\n",(0,r.jsx)(n.li,{children:"Data is fetched on every page request."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { TimeSection } from '@components'\n\nexport default function CSRPage() {\n  const [dateTime, setDateTime] = React.useState<string>()\n\n  React.useEffect(() => {\n    axios\n      .get('https://worldtimeapi.org/api/ip')\n      .then((res) => {\n        setDateTime(res.data.datetime)\n      })\n      .catch(error => console.error(error))\n  }, [])\n\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  )\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"ssr",children:"SSR"}),"\n",(0,r.jsxs)(n.p,{children:["Application code is written in a way that\nit can be executed ",(0,r.jsx)(n.strong,{children:"both on the server and on the client"}),".\nThe browser displays the initial HTML (fetch from server),\nsimultaneously downloads the single-page app (SPA) in the background.\nOnce the client-side code is ready,\nthe client takes over and the website becomes a SPA."]}),"\n",(0,r.jsx)(n.p,{children:"\u524d\u540e\u7aef\u5206\u79bb\u662f\u4e00\u79cd\u8fdb\u6b65\uff0c\u4f46\u5f7b\u5e95\u7684\u5206\u79bb\uff0c\u4e5f\u4e0d\u5c3d\u5584\u5c3d\u7f8e\uff0c\n\u6bd4\u5982\u4f1a\u6709\u9996\u5c4f\u52a0\u8f7d\u901f\u5ea6\u548c SEO \u65b9\u9762\u7684\u56f0\u6270\u3002\n\u524d\u540e\u7aef\u5206\u79bb+\u670d\u52a1\u7aef\u9996\u5c4f\u6e32\u67d3\u770b\u8d77\u6765\u662f\u4e2a\u66f4\u4f18\u7684\u65b9\u6848\uff0c\n\u5b83\u7ed3\u5408\u4e86\u524d\u540e\u7aef\u5206\u79bb\u548c\u670d\u52a1\u7aef\u6e32\u67d3\u4e24\u8005\u7684\u4f18\u70b9\uff0c\n\u65e2\u505a\u5230\u4e86\u524d\u540e\u7aef\u5206\u79bb\uff0c\u53c8\u80fd\u4fdd\u8bc1\u9996\u9875\u6e32\u67d3\u901f\u5ea6\uff0c\u8fd8\u6709\u5229\u4e8e SEO\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.patterns.dev/posts/ssr",children:(0,r.jsx)(n.img,{alt:"Server Side Rendering",src:s(3477).A+"",width:"1315",height:"864"})})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"if (isBotAgent) {\n  // return pre-rendering static html to search engine crawler\n  // like Gatsby\n} else {\n  // server side rendering at runtime for real interactive users\n  // ReactDOMServer.renderToString()\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"ssr-upside",children:"SSR Upside"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Smaller first meaningful paint time."}),"\n",(0,r.jsx)(n.li,{children:"HTML's strengths: progressive rendering."}),"\n",(0,r.jsx)(n.li,{children:"Browsers are incredibly good at rendering partial content."}),"\n",(0,r.jsx)(n.li,{children:"Search engine crawlers used to not execute scripts (or initial scripts)."}),"\n",(0,r.jsx)(n.li,{children:"Search engine usually stop after a while (roughly 10 seconds)."}),"\n",(0,r.jsx)(n.li,{children:"SPAs can't set meaningful HTTP status codes."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"ssr-usage",children:"SSR Usage"}),"\n",(0,r.jsx)(n.p,{children:"Webpack configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const baseConfig = require('./baseConfig')\n\nconst webConfig = {\n  ...baseConfig,\n  target: 'web',\n}\n\nconst nodeConfig = {\n  ...baseConfig,\n  target: 'node',\n  output: {\n    ...baseConfig.output,\n    libraryTarget: 'commonjs2',\n  },\n  externals: [require('webpack-node-externals')()],\n}\n\nmodule.exports = { webConfig, nodeConfig }\n"})}),"\n",(0,r.jsxs)(n.p,{children:["React server side rendering ",(0,r.jsx)(n.code,{children:"start.server.js"}),"\n(compile to ",(0,r.jsx)(n.code,{children:"dist/server.js"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import Koa from 'koa'\nimport koaStatic from 'koa-static'\nimport { renderToString } from 'react-dom/server'\nimport { Provider } from 'react-redux'\nimport { renderRoutes } from 'react-router-config'\nimport { StaticRouter } from 'react-router-dom'\n\nconst routes = [\n  { path: '/', component: Home, exact: true },\n  {\n    path: '/about',\n    component: About,\n    exact: true,\n  },\n]\n\nfunction getStore() {\n  return createStore(reducer, applyMiddleware(thunk))\n}\n\nconst app = new Koa()\napp.use(koaStatic('public'))\n\napp.use(async (ctx) => {\n  const store = getStore()\n  const matchedRoutes = matchRoutes(routes, ctx.request.path)\n  const loaders = []\n\n  matchedRoutes.forEach((item) => {\n    if (item.route.loadData) {\n      // item.route.loadData() \u8fd4\u56de\u7684\u662f\u4e00\u4e2a promise.\n      loaders.push(item.route.loadData(store))\n    }\n  })\n\n  // \u7b49\u5f85\u5f02\u6b65\u5b8c\u6210, store \u5df2\u5b8c\u6210\u66f4\u65b0.\n  await Promise.all(loaders)\n\n  const content = renderToString(\n    <Provider store={store}>\n      <StaticRouter location={ctx.request.path}>\n        <div>{renderRoutes(routes)}</div>\n      </StaticRouter>\n    </Provider>\n  )\n\n  ctx.body = `\n  <!DOCTYPE html>\n    <head>\n    </head>\n    <body>\n      <div id=\"app\">${content}</div>\n      <script>\n        window.context = {\n          state: ${JSON.stringify(store.getState())}\n        };\n      <\/script>\n      <script src=\"/public/client.js\"><\/script>\n    </body>\n  </html>`\n})\n\napp.listen(3003, () => {\n  console.log('listen:3003')\n})\n"})}),"\n",(0,r.jsxs)(n.p,{children:["React client side hydration ",(0,r.jsx)(n.code,{children:"start.client.js"}),"\n(compile to ",(0,r.jsx)(n.code,{children:"public/client.js"}),"):"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5efa\u7acb Real DOM \u4e0e Virtual DOM \u7684\u8054\u7cfb: ",(0,r.jsx)(n.code,{children:"fiber.el = node"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"\u7ed1\u5b9a\u4e8b\u4ef6\u5904\u7406\u5668."}),"\n",(0,r.jsxs)(n.li,{children:["\u6267\u884c\u670d\u52a1\u7aef\u672a\u6267\u884c\u7684 lifecycle hooks: ",(0,r.jsx)(n.code,{children:"beforeMount()"}),"/",(0,r.jsx)(n.code,{children:"onMounted()"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import ReactDOM from 'react-dom'\nimport { Provider } from 'react-redux'\nimport { renderRoutes } from 'react-router-config'\nimport { BrowserRouter } from 'react-router-dom'\n\nconst Routes = [\n  { path: '/', component: Home, exact: true },\n  {\n    path: '/about',\n    component: About,\n    exact: true,\n  },\n]\n\nfunction getStore() {\n  const defaultState = window.context ? window.context.state : {}\n  return createStore(reducer, defaultState, applyMiddleware(thunk))\n}\n\nexport default function App() {\n  return (\n    <Provider store={getStore()}>\n      <BrowserRouter>\n        <div>{renderRoutes(Routes)}</div>\n      </BrowserRouter>\n    </Provider>\n  )\n}\n\nReactDOM.hydrateRoot(<App />, document.getElementById('app'))\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Isomorphic data fetch\n(",(0,r.jsx)(n.code,{children:"getStaticProps"}),"/",(0,r.jsx)(n.code,{children:"getServerSideProps"})," in ",(0,r.jsx)(n.code,{children:"Next.js"}),",\n",(0,r.jsx)(n.code,{children:"loader"})," in ",(0,r.jsx)(n.code,{children:"Remix"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"const data = await App.fetchData()\nconst app = <App {...data} />\n\nreturn {\n  html: ReactDOMServer.renderToString(app),\n  state: { data },\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Next.js"})," SSR:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SSR hit API before the page loads (DELAY before render, and no LOADING indicator)."}),"\n",(0,r.jsx)(n.li,{children:"Data is fetched on every page request."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { TimeSection } from '@components'\n\nexport default function SSRPage({ dateTime }: SSRPageProps) {\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  )\n}\n\nexport const getServerSideProps: GetServerSideProps = async () => {\n  const res = await axios.get('https://worldtimeapi.org/api/ip')\n\n  return {\n    props: { dateTime: res.data.datetime },\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.admonition,{title:"SSR Hydration Warning",type:"caution",children:[(0,r.jsxs)(n.p,{children:["\u670d\u52a1\u7aef\u8fd4\u56de\u7684 HTML \u4e0e\u5ba2\u6237\u7aef\u6e32\u67d3\u7ed3\u679c\u4e0d\u4e00\u81f4\u65f6\u4f1a\u4ea7\u751f\n",(0,r.jsx)(n.code,{children:"SSR Hydration Warning"}),",\n\u5fc5\u987b\u91cd\u89c6 ",(0,r.jsx)(n.code,{children:"SSR Hydration Warning"}),",\n\u8981\u5f53 ",(0,r.jsx)(n.code,{children:"Error"})," \u9010\u4e2a\u89e3\u51b3:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u51fa\u4e8e\u6027\u80fd\u8003\u8651,\n",(0,r.jsx)(n.code,{children:"hydrate"})," \u53ef\u4ee5\u5f25\u8865\u6587\u672c\u5185\u5bb9\u7684\u5dee\u5f02,\n\u4f46\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u4fee\u8865",(0,r.jsx)(n.strong,{children:"\u5c5e\u6027"}),"\u7684\u5dee\u5f02,\n\u53ea\u5728 ",(0,r.jsx)(n.code,{children:"development"})," \u6a21\u5f0f\u4e0b\u5bf9\u8fd9\u4e9b\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u62a5 ",(0,r.jsx)(n.code,{children:"Warning"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["\u524d\u540e\u7aef\u4e0d\u4e00\u81f4\u65f6, ",(0,r.jsx)(n.code,{children:"hydrate"})," \u65f6\u4f1a\u5bfc\u81f4\u9875\u9762\u6296\u52a8:\n\u540e\u7aef\u6e32\u67d3\u7684\u90e8\u5206\u8282\u70b9\u88ab\u4fee\u6539, \u7528\u6237\u4f1a\u770b\u5230\u9875\u9762\u7a81\u7136\u66f4\u6539\u7684\u73b0\u8c61,\n\u5e26\u6765\u4e0d\u597d\u7684\u7528\u6237\u4f53\u9a8c."]}),"\n"]})]}),"\n",(0,r.jsxs)(n.admonition,{title:"SSR Components",type:"caution",children:[(0,r.jsx)(n.p,{children:"\u7f16\u5199 SSR \u7ec4\u4ef6\u65f6:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u9700\u8981\u4f7f\u7528\u524d\u540e\u7aef\u540c\u6784\u7684 API:\n\u5bf9\u4e8e\u524d\u7aef\u6216\u540e\u7aef\u72ec\u6709\u7684 API (e.g BOM, DOM, Node API),\n\u9700\u8981\u8fdb\u884c\u5c01\u88c5\u4e0e\u586b\u5145 (adapter/mock/polyfill)."}),"\n",(0,r.jsx)(n.li,{children:"\u6ce8\u610f\u5e76\u53d1\u4e0e\u65f6\u5e8f:\n\u6d4f\u89c8\u5668\u73af\u5883\u4e00\u822c\u53ea\u6709\u4e00\u4e2a\u7528\u6237, \u5355\u4f8b\u6a21\u5f0f\u5bb9\u6613\u5b9e\u73b0;\n\u4f46 Node.js \u73af\u5883\u53ef\u80fd\u5b58\u5728\u591a\u6761\u8fde\u63a5, \u5bfc\u81f4\u5168\u5c40\u53d8\u91cf\u76f8\u4e92\u6c61\u67d3."}),"\n",(0,r.jsxs)(n.li,{children:["\u90e8\u5206\u4ee3\u7801\u53ea\u5728\u67d0\u4e00\u7aef\u6267\u884c:\n\u5728 ",(0,r.jsx)(n.code,{children:"onCreated()"})," \u521b\u5efa\u5b9a\u65f6\u5668, \u5728 ",(0,r.jsx)(n.code,{children:"onUnmounted()"})," \u6e05\u9664\u5b9a\u65f6\u5668,\n\u7531\u4e8e ",(0,r.jsx)(n.code,{children:"onUnmounted()"})," hooks \u53ea\u5728\u5ba2\u6237\u7aef\u6267\u884c,\n\u4f1a\u9020\u6210\u670d\u52a1\u7aef\u6e32\u67d3\u65f6\u4ea7\u751f\u5185\u5b58\u6cc4\u6f0f."]}),"\n"]})]}),"\n",(0,r.jsx)(n.h4,{id:"ssr-reference",children:"SSR Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Universal JavaScript ",(0,r.jsx)(n.a,{href:"http://peerigon.github.io/talks/2018-07-20-js-camp-barcelona-bumpy-road-universal-javascript/#1",children:"presentation"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["React SSR ",(0,r.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/j2rB8qE5OOPmLHAS7qdCrQ",children:"complete guide"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"SSR and hydration."}),"\n",(0,r.jsx)(n.li,{children:"Isomorphic router."}),"\n",(0,r.jsx)(n.li,{children:"Isomorphic store."}),"\n",(0,r.jsx)(n.li,{children:"Isomorphic CSS."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Vue SSR ",(0,r.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/QWtrUJcGEgNYKbhq2b8XLw",children:"guide"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Vite."}),"\n",(0,r.jsx)(n.li,{children:"Router."}),"\n",(0,r.jsx)(n.li,{children:"Pinia."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Next.js for ",(0,r.jsx)(n.a,{href:"https://nextjs.org",children:"isomorphic rendering"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Server side rendering with ",(0,r.jsx)(n.a,{href:"https://developer.chrome.com/docs/puppeteer/ssr",children:"Puppeteer"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Web rendering ",(0,r.jsx)(n.a,{href:"https://web.dev/rendering-on-the-web",children:"guide"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ssg",children:"SSG"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reloading did not change anything."}),"\n",(0,r.jsxs)(n.li,{children:["Hit API when running ",(0,r.jsx)(n.code,{children:"npm run build"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Data will not change because no further fetch."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { TimeSection } from '@components'\n\nexport default function SSGPage({ dateTime }: SSGPageProps) {\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  )\n}\n\nexport const getStaticProps: GetStaticProps = async () => {\n  const res = await axios.get('https://worldtimeapi.org/api/ip')\n\n  return {\n    props: { dateTime: res.data.datetime },\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"isr",children:"ISR"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Based on SSG, with ",(0,r.jsx)(n.strong,{children:"revalidate limit"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Cooldown state: reloading doesn't trigger changes and pages rebuilds."}),"\n",(0,r.jsx)(n.li,{children:"First person that visits when cooldown state is off,\nis going to trigger a rebuild.\nThat person won't be seeing changes.\nBut, the changes will be served for the next full reload."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { TimeSection } from '@components'\n\nexport default function ISR20Page({ dateTime }: ISR20PageProps) {\n  return (\n    <main>\n      <TimeSection dateTime={dateTime} />\n    </main>\n  )\n}\n\nexport const getStaticProps: GetStaticProps = async () => {\n  const res = await axios.get('https://worldtimeapi.org/api/ip')\n\n  return {\n    props: { dateTime: res.data.datetime },\n    revalidate: 20,\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"islands-architecture",children:"Islands Architecture"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://www.patterns.dev/posts/islands-architecture",children:"Islands architecture"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:['Script resources for these "islands" of interactivity\n(islands of dynamic components)\ncan be ',(0,r.jsx)(n.strong,{children:"delivered and hydrated independently"}),",\nallowing the rest of the page to be just ",(0,r.jsx)(n.strong,{children:"static HTML"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Islands architecture combines ideas from different rendering techniques:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.patterns.dev/posts/server-side-rendering",children:"Server-side rendering"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.patterns.dev/posts/static-rendering",children:"Static site generation"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.patterns.dev/posts/progressive-hydration",children:"Partial hydration"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Simple islands architecture ",(0,r.jsx)(n.a,{href:"https://juejin.cn/post/7155300194773860382",children:"implementation"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"jamstack-reference",children:"JamStack Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Build your own ",(0,r.jsx)(n.a,{href:"https://www.cmrg.me/blog/rsc-part-2-the-code",children:"RSC framework"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Build your own ",(0,r.jsx)(n.a,{href:"https://hire.jonasgalvez.com.br/2022/may/18/building-a-mini-next-js",children:"Next.js"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Build your own ",(0,r.jsx)(n.a,{href:"https://vercel.com/blog/build-your-own-web-framework",children:"web framework"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Modern websites building ",(0,r.jsx)(n.a,{href:"https://dev.to/this-is-learning/patterns-for-building-javascript-websites-in-2022-5a93",children:"patterns"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Modern rendering ",(0,r.jsx)(n.a,{href:"https://www.patterns.dev/posts/#rendering-patterns",children:"patterns"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"seo",children:"SEO"}),"\n",(0,r.jsx)(n.h3,{id:"seo-metadata",children:"SEO Metadata"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { Helmet } from 'react-helmet'\n\nexport default function App() {\n  const seo = {\n    title: 'About',\n    description:\n      'This is an awesome site that you definitely should check out.',\n    url: 'https://www.mydomain.com/about',\n    image: 'https://mydomain.com/images/home/logo.png',\n  }\n\n  return (\n    <Helmet\n      title={`${seo.title} | Code Mochi`}\n      meta={[\n        {\n          name: 'description',\n          property: 'og:description',\n          content: seo.description,\n        },\n        { property: 'og:title', content: `${seo.title} | Code Mochi` },\n        { property: 'og:url', content: seo.url },\n        { property: 'og:image', content: seo.image },\n        { property: 'og:image:type', content: 'image/jpeg' },\n        { property: 'twitter:image:src', content: seo.image },\n        { property: 'twitter:title', content: `${seo.title} | Code Mochi` },\n        { property: 'twitter:description', content: seo.description },\n      ]}\n    />\n  )\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"seo-best-practice",children:"SEO Best Practice"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://css-tricks.com/server-side-react-rendering",children:"Server side rendering"}),"\n(e.g Next.js)."]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/chrisvfritz/prerender-spa-plugin",children:"Pre-Rendering"})}),"\n",(0,r.jsx)(n.li,{children:"Mobile performance optimization\n(e.g minify resources, code splitting, CDN, lazy loading, minimize reflows)."}),"\n",(0,r.jsxs)(n.li,{children:["SEO-friendly ",(0,r.jsx)(n.a,{href:"https://reacttraining.com/react-router",children:"routing"})," and URL management."]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.google.com/webmasters",children:"Google webmaster tools"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"<title>"})," and ",(0,r.jsx)(n.code,{children:"<meta>"})," in ",(0,r.jsx)(n.code,{children:"<head>"})," (with tool like ",(0,r.jsx)(n.code,{children:"react-helmet"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Includes a ",(0,r.jsx)(n.code,{children:"robots.txt"})," file."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"seo-reference",children:"SEO Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Basic SEO ",(0,r.jsx)(n.a,{href:"https://developers.google.com/search/docs/guides/javascript-seo-basics",children:"guide"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["SPA SEO ",(0,r.jsx)(n.a,{href:"https://snipcart.com/spa-seo",children:"guide"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Google SEO ",(0,r.jsx)(n.a,{href:"https://web.dev/google-search-tools",children:"guide"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"web-authentication",children:"Web Authentication"}),"\n",(0,r.jsx)(n.h3,{id:"cookie",children:"Cookie"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"First request header -> without cookie."}),"\n",(0,r.jsxs)(n.li,{children:["First response header -> ",(0,r.jsx)(n.code,{children:"Set-Cookie: number"})," to client."]}),"\n",(0,r.jsx)(n.li,{children:"Client store identification number for specific site into cookies files."}),"\n",(0,r.jsxs)(n.li,{children:["Second request header -> ",(0,r.jsx)(n.code,{children:"Cookie: number"}),".\n(extract identification number for specific site from cookies files)."]}),"\n",(0,r.jsxs)(n.li,{children:["Function: create ",(0,r.jsx)(n.strong,{children:"User Session Layer"})," on top of stateless HTTP."]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"Cookie Security",type:"caution",children:(0,r.jsx)(n.p,{children:"\u7528\u6237\u80fd\u591f\u66f4\u6539\u81ea\u5df1\u7684 Cookie \u503c (client side),\n\u56e0\u6b64\u4e0d\u53ef\u5c06\u8d85\u8fc7\u6743\u9650\u7684\u6570\u636e\u4fdd\u5b58\u5728 Cookie \u4e2d (\u5982\u6743\u9650\u4fe1\u606f),\n\u9632\u6b62\u7528\u6237\u8d8a\u6743."})}),"\n",(0,r.jsx)(n.h3,{id:"http-basic-authentication",children:"HTTP Basic Authentication"}),"\n",(0,r.jsx)(n.p,{children:"HTTP basic authentication is 401 authentication:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u8bf7\u6c42\u6570\u636e:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"Get /index.html HTTP/1.0\nHost:www.google.com\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u9a8c\u8bc1\u8bf7\u6c42\u4ee3\u7801 ",(0,r.jsx)(n.code,{children:"401"})," ",(0,r.jsx)(n.code,{children:'WWW-Authenticate: Basic realm="google.com"'})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:'HTTP/1.0 401 Unauthorized\nServer: SokEvo/1.0\nWWW-Authenticate: Basic realm="google.com"\nContent-Type: text/html\nContent-Length: xxx\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5f53\u7b26\u5408 HTTP/1.0 \u6216 HTTP/1.1 \u7684\u5ba2\u6237\u7aef\u6536\u5230 401 \u8fd4\u56de\u503c\u65f6,\n\u5c06\u81ea\u52a8\u5f39\u51fa\u4e00\u4e2a\u767b\u5f55\u7a97\u53e3, \u8981\u6c42\u7528\u6237\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801."}),"\n",(0,r.jsx)(n.li,{children:"\u7528\u6237\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u540e, \u5c06\u7528\u6237\u540d\u53ca\u5bc6\u7801\u4ee5 BASE64 \u52a0\u5bc6\u65b9\u5f0f\u52a0\u5bc6, \u5e76\u5c06\u5bc6\u6587\u653e\u5165\u524d\u4e00\u6761\u8bf7\u6c42\u4fe1\u606f\u4e2d"}),"\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u5668\u6536\u5230\u4e0a\u8ff0\u8bf7\u6c42\u4fe1\u606f\u540e, \u5c06 Authorization \u5b57\u6bb5\u540e\u7684\u7528\u6237\u4fe1\u606f\u53d6\u51fa/\u89e3\u5bc6,\n\u5c06\u89e3\u5bc6\u540e\u7684\u7528\u6237\u540d\u53ca\u5bc6\u7801\u4e0e\u7528\u6237\u6570\u636e\u5e93\u8fdb\u884c\u6bd4\u8f83\u9a8c\u8bc1"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"Get /index.html HTTP/1.0\nHost: www.google.com\nAuthorization: Basic d2FuZzp3YW5n==\n"})}),"\n",(0,r.jsx)(n.h3,{id:"session-cookie",children:"Session Cookie"}),"\n",(0,r.jsx)(n.h4,{id:"session-cookie-basis",children:"Session Cookie Basis"}),"\n",(0,r.jsxs)(n.p,{children:["HTTP \u534f\u8bae\u662f\u4e00\u4e2a\u65e0\u72b6\u6001\u7684\u534f\u8bae,\n\u670d\u52a1\u5668\u4e0d\u4f1a\u77e5\u9053\u5230\u5e95\u662f\u54ea\u4e00\u53f0\u6d4f\u89c8\u5668\u8bbf\u95ee\u4e86\u5b83,\n\u56e0\u6b64\u9700\u8981\u4e00\u4e2a\u6807\u8bc6\u7528\u6765\u8ba9\u670d\u52a1\u5668\u533a\u5206\u4e0d\u540c\u7684\u6d4f\u89c8\u5668.\nCookie \u5c31\u662f\u8fd9\u4e2a\u7ba1\u7406\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u4e4b\u95f4\u72b6\u6001\u7684\u6807\u8bc6.\nResponse header with ",(0,r.jsx)(n.code,{children:"Set-Cookie"}),", Request header with ",(0,r.jsx)(n.code,{children:"Cookie"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"\u6d4f\u89c8\u5668\u7b2c\u4e00\u6b21\u8bbf\u95ee\u670d\u52a1\u7aef, \u670d\u52a1\u7aef\u5c31\u4f1a\u521b\u5efa\u4e00\u6b21 Session, \u5728\u4f1a\u8bdd\u4e2d\u4fdd\u5b58\u6807\u8bc6\u8be5\u6d4f\u89c8\u5668\u7684\u4fe1\u606f.\nSession \u7f13\u5b58\u5728\u670d\u52a1\u7aef, Cookie \u7f13\u5b58\u5728\u5ba2\u6237\u7aef,\n\u4ed6\u4eec\u90fd\u7531\u670d\u52a1\u7aef\u751f\u6210, \u5b9e\u73b0 HTTP \u534f\u8bae\u7684\u72b6\u6001."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5ba2\u6237\u7aef\u53d1\u9001\u767b\u5f55\u4fe1\u606f (ID, Password)."}),"\n",(0,r.jsxs)(n.li,{children:["\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u9996\u6b21\u8bf7\u6c42\u5e76\u9a8c\u8bc1\u6210\u529f\u540e,\n\u4f1a\u5728\u670d\u52a1\u5668\u7aef\u521b\u5efa Session \u5e76\u4fdd\u5b58\u552f\u4e00\u7684\u6807\u8bc6\u5b57\u7b26\u4e32 Session ID (Key-Value Store),\n\u5728 Response Header \u4e2d\u8bbe\u7f6e ",(0,r.jsx)(n.code,{children:"Set-Cookie: <Session ID>"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["\u5ba2\u6237\u7aef\u540e\u7eed\u53d1\u9001\u8bf7\u6c42\u90fd\u9700\u5728 Request Header \u4e2d\u8bbe\u7f6e: ",(0,r.jsx)(n.code,{children:"Cookie: <Session ID>"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["\u670d\u52a1\u5668\u6839\u636e ",(0,r.jsx)(n.code,{children:"<Session ID>"})," \u8fdb\u884c\u7528\u6237\u9a8c\u8bc1,\n\u5229\u7528 Session Cookie \u673a\u5236\u53ef\u4ee5\u7b80\u5355\u5730\u5b9e\u73b0",(0,r.jsx)(n.strong,{children:"\u7528\u6237\u767b\u5f55\u72b6\u6001\u9a8c\u8bc1"}),",\n\u4fdd\u62a4\u9700\u8981\u767b\u5f55\u6743\u9650\u624d\u80fd\u8bbf\u95ee\u7684\u8def\u7531\u670d\u52a1."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Max-Age"})," priority higher than ",(0,r.jsx)(n.code,{children:"Expires"}),".\nWhen both to ",(0,r.jsx)(n.code,{children:"null"}),", cookie become ",(0,r.jsx)(n.strong,{children:"session cookie"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"Set-Cookie: username=tazimi; domain=tazimi.dev; Expires=Wed, 21 Oct 2022 08:00:00\nSet-Cookie: username=tazimi; domain=tazimi.dev; path=/blog\nSet-Cookie: username=tazimi; domain=tazimi.dev; path=/blog; Secure; HttpOnly\nSet-Cookie: username=tazimi; domain=github.com\nSet-Cookie: height=100; domain=me.github.com\nSet-Cookie: weight=100; domain=me.github.com\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Cookies#define_the_lifetime_of_a_cookie",children:(0,r.jsx)(n.img,{alt:"Session Cookie",src:s(2128).A+"",width:"672",height:"512"})})}),"\n",(0,r.jsx)(n.h4,{id:"session-cookie-cons",children:"Session Cookie Cons"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u8ba4\u8bc1\u65b9\u5f0f\u5c40\u9650\u4e8e\u5728\u6d4f\u89c8\u5668 (Cookie)."}),"\n",(0,r.jsx)(n.li,{children:"\u975e HTTPS \u534f\u8bae\u4e0b\u4f7f\u7528 Cookie, \u5bb9\u6613\u53d7\u5230 CSRF \u8de8\u7ad9\u70b9\u8bf7\u6c42\u4f2a\u9020\u653b\u51fb."}),"\n",(0,r.jsxs)(n.li,{children:["Session ID \u4e0d\u5305\u542b\u5177\u4f53\u7528\u6237\u4fe1\u606f, \u9700\u8981 Key-Value Store (e.g ",(0,r.jsx)(n.strong,{children:"Redis"}),") \u6301\u4e45\u5316,\n\u5728\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\u9700\u8981\u5728\u6bcf\u4e2a\u670d\u52a1\u5668\u4e0a\u90fd\u5907\u4efd, \u5360\u7528\u4e86\u5927\u91cf\u7684\u5b58\u50a8\u7a7a\u95f4."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"session-cookie-usage",children:"Session Cookie Usage"}),"\n",(0,r.jsxs)(n.p,{children:["Session authentication with Lucia in ",(0,r.jsx)(n.a,{href:"https://www.robinwieruch.de/next-authentication",children:"Next.js"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"signUp"})," function."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"signIn"})," function."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"getAuth"})," function."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"signOut"})," function."]}),"\n",(0,r.jsxs)(n.li,{children:["Protected routes ",(0,r.jsx)(n.code,{children:"AuthenticatedLayout"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Authorization in UI ",(0,r.jsx)(n.code,{children:"RootLayout"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SingUp"})," React Server Component:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// src/features/auth/actions/sign-up.ts\n'use server'\n\nimport { lucia } from '@/lib/lucia'\nimport { prisma } from '@/lib/prisma'\nimport { generateId } from 'lucia'\nimport { cookies } from 'next/headers'\nimport { redirect } from 'next/navigation'\nimport { Argon2id } from 'oslo/password'\n\nasync function signUp(formData: FormData) {\n  const formDataRaw = {\n    firstName: formData.get('firstName') as string,\n    lastName: formData.get('lastName') as string,\n    email: formData.get('email') as string,\n    password: formData.get('password') as string,\n    confirmPassword: formData.get('confirmPassword') as string,\n  }\n\n  if (formDataRaw.password !== formDataRaw.confirmPassword)\n    throw new Error('Passwords do not match')\n\n  // TODO: add validation yourself\n  // https://www.robinwieruch.de/next-forms/\n\n  try {\n    const hashedPassword = await new Argon2id().hash(\n      formDataRaw.password\n    )\n    const userId = generateId(15)\n\n    await prisma.user.create({\n      data: {\n        id: userId,\n        firstName: formDataRaw.firstName,\n        lastName: formDataRaw.lastName,\n        email: formDataRaw.email,\n        hashedPassword,\n      },\n    })\n\n    const session = await lucia.createSession(userId, {})\n    const sessionCookie = lucia.createSessionCookie(session.id)\n\n    cookies().set(\n      sessionCookie.name,\n      sessionCookie.value,\n      sessionCookie.attributes\n    )\n  } catch (error) {\n    // TODO: add error feedback yourself\n    // https://www.robinwieruch.de/next-forms/\n    // TODO: add error handling if user email is already taken\n    // The Road to Next\n  }\n\n  redirect('/dashboard')\n}\n\nexport { signUp }\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SingIn"})," React Server Component:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// src/features/auth/actions/sign-in.ts\n'use server'\n\nimport { lucia } from '@/lib/lucia'\nimport { prisma } from '@/lib/prisma'\nimport { cookies } from 'next/headers'\nimport { redirect } from 'next/navigation'\nimport { Argon2id } from 'oslo/password'\n\nasync function signIn(formData: FormData) {\n  const formDataRaw = {\n    email: formData.get('email') as string,\n    password: formData.get('password') as string,\n  }\n\n  // TODO: add validation yourself\n  // https://www.robinwieruch.de/next-forms/\n\n  try {\n    const user = await prisma.user.findUnique({\n      where: { email: formDataRaw.email },\n    })\n\n    if (!user) {\n      // https://www.robinwieruch.de/next-forms/\n      throw new Error('Incorrect email or password')\n    }\n\n    const validPassword = await new Argon2id().verify(\n      user.hashedPassword,\n      formDataRaw.password\n    )\n\n    if (!validPassword) {\n      // https://www.robinwieruch.de/next-forms/\n      throw new Error('Incorrect email or password')\n    }\n\n    const session = await lucia.createSession(user.id, {})\n    const sessionCookie = lucia.createSessionCookie(session.id)\n\n    cookies().set(\n      sessionCookie.name,\n      sessionCookie.value,\n      sessionCookie.attributes\n    )\n  } catch (error) {\n    // TODO: add error feedback yourself\n    // https://www.robinwieruch.de/next-forms/\n  }\n\n  redirect('/dashboard')\n}\n\nexport { signIn }\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"getAuth"})," function:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import type { Session, User } from 'lucia'\nimport { lucia } from '@/lib/lucia'\n\n// src/features/auth/queries/get-auth.ts\nimport { cookies } from 'next/headers'\nimport { cache } from 'react'\n\nexport const getAuth = cache(\n  async (): Promise<\n    { user: User, session: Session } | { user: null, session: null }\n  > => {\n    const sessionId\n      = cookies().get(lucia.sessionCookieName)?.value ?? null\n\n    if (!sessionId) {\n      return {\n        user: null,\n        session: null,\n      }\n    }\n\n    const result = await lucia.validateSession(sessionId)\n\n    try {\n      if (result.session && result.session.fresh) {\n        const sessionCookie = lucia.createSessionCookie(\n          result.session.id\n        )\n        cookies().set(\n          sessionCookie.name,\n          sessionCookie.value,\n          sessionCookie.attributes\n        )\n      }\n\n      if (!result.session) {\n        const sessionCookie = lucia.createBlankSessionCookie()\n        cookies().set(\n          sessionCookie.name,\n          sessionCookie.value,\n          sessionCookie.attributes\n        )\n      }\n    } catch {}\n\n    return result\n  }\n)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SingOut"})," React Server Component:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// src/features/auth/actions/sign-out.ts\n'use server'\n\nimport { lucia } from '@/lib/lucia'\nimport { cookies } from 'next/headers'\nimport { redirect } from 'next/navigation'\nimport { getAuth } from '../queries/get-auth'\n\nexport async function signOut(_formData: FormData) {\n  const { session } = await getAuth()\n\n  if (!session)\n    redirect('/sign-in')\n\n  await lucia.invalidateSession(session.id)\n\n  const sessionCookie = lucia.createBlankSessionCookie()\n\n  cookies().set(\n    sessionCookie.name,\n    sessionCookie.value,\n    sessionCookie.attributes\n  )\n\n  redirect('/sign-in')\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Protected routes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"import { getAuth } from '@/features/auth/queries/get-auth'\n// src/app/(authenticated)/layout.tsx\n// - src/app/(authenticated)/dashboard/page.tsx\n// - src/app/(authenticated)/account/page.tsx\n// - and more ...\nimport { redirect } from 'next/navigation'\n\nexport default async function AuthenticatedLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode\n}>) {\n  const { user } = await getAuth()\n\n  if (!user)\n    redirect('/sign-in')\n\n  return <>{children}</>\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Authorization UI:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:'import { getAuth } from \'@/features/auth/queries/get-auth\'\n// src/app/layout.tsx\nimport Link from \'next/link\'\n\nexport default function RootLayout() {\n  const { user } = await getAuth()\n\n  const appNav = (\n    <>\n      <li>\n        <Link href="/">LOGO</Link>\n      </li>\n      {user && (\n        <li>\n          <Link href="/dashboard">Dashboard</Link>\n        </li>\n      )}\n    </>\n  )\n\n  const authNav = user\n    ? (\n        <li>\n          <form action={signOut}>\n            <button type="submit">Sign Out</button>\n          </form>\n        </li>\n      )\n    : (\n        <>\n          <li>\n            <Link href="/sign-up">Sign Up</Link>\n          </li>\n          <li>\n            <Link href="/sign-in">Sign In</Link>\n          </li>\n        </>\n      )\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"token-authentication",children:"Token Authentication"}),"\n",(0,r.jsx)(n.h4,{id:"token-authentication-basis",children:"Token Authentication Basis"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5ba2\u6237\u7aef\u53d1\u9001\u767b\u5f55\u4fe1\u606f (ID, Password)."}),"\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u7aef\u6536\u5230\u8bf7\u6c42\u9a8c\u8bc1\u6210\u529f\u540e, \u670d\u52a1\u7aef\u4f1a\u7b7e\u53d1\u4e00\u4e2a Token (\u5305\u542b\u7528\u6237\u4fe1\u606f) \u5e76\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef."}),"\n",(0,r.jsxs)(n.li,{children:["\u5ba2\u6237\u7aef\u6536\u5230 Token \u540e\u5b58\u50a8\u5230 Cookie \u6216 Local Storage,\n\u5ba2\u6237\u7aef\u6bcf\u6b21\u5411\u670d\u52a1\u7aef\u8bf7\u6c42\u90fd\u9700\u5728 Request Header \u4e2d\u8bbe\u7f6e: ",(0,r.jsx)(n.code,{children:"Authorization: <Token>"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u7aef\u6536\u5230\u8bf7\u6c42\u5e76\u9a8c\u8bc1 Token, \u6210\u529f\u53d1\u9001\u8d44\u6e90 (\u9274\u6743\u6210\u529f), \u4e0d\u6210\u529f\u53d1\u9001 401 \u9519\u8bef\u4ee3\u7801 (\u9274\u6743\u5931\u8d25)."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"token-authentication-pros",children:"Token Authentication Pros"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Token \u8ba4\u8bc1\u4e0d\u5c40\u9650\u4e8e\u6d4f\u89c8\u5668 (Cookie)."}),"\n",(0,r.jsx)(n.li,{children:"\u4e0d\u4f7f\u7528 Cookie \u53ef\u4ee5\u89c4\u907f CSRF \u653b\u51fb."}),"\n",(0,r.jsx)(n.li,{children:"Token \u4e2d\u5305\u542b\u4e86\u7528\u6237\u4fe1\u606f, \u4e0d\u9700\u8981 Key-Value Store \u6301\u4e45\u5316, \u5206\u5e03\u5f0f\u53cb\u597d.\n\u670d\u52a1\u5668\u7aef\u53d8\u6210\u65e0\u72b6\u6001, \u670d\u52a1\u5668\u7aef\u53ea\u9700\u8981\u6839\u636e\u5b9a\u4e49\u7684\u89c4\u5219\u6821\u9a8c Token \u5408\u6cd5\u6027.\n\u4e0a\u8ff0\u4e24\u70b9\u4f7f\u5f97 Token Authentication \u5177\u6709\u66f4\u597d\u7684\u6269\u5c55\u6027."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"token-authentication-cons",children:"Token Authentication Cons"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Token \u8ba4\u8bc1 (\u52a0\u5bc6\u89e3\u5bc6\u8fc7\u7a0b) \u6bd4 Session Cookie \u66f4\u6d88\u8017\u6027\u80fd."}),"\n",(0,r.jsx)(n.li,{children:"Token (\u5305\u542b\u7528\u6237\u4fe1\u606f) \u6bd4 Session ID \u5927, \u66f4\u5360\u5e26\u5bbd."}),"\n",(0,r.jsxs)(n.li,{children:["\u4e0d\u4fdd\u5b58 Session \u72b6\u6001, \u65e0\u6cd5\u4e2d\u6b62\u6216\u66f4\u6539 Token \u6743\u9650, Token \u5230\u671f\u524d\u4f1a\u59cb\u7ec8\u6709\u6548, \u5b58\u5728\u76d7\u7528\u98ce\u9669:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Token \u6709\u6548\u671f\u5e94\u77ed."}),"\n",(0,r.jsx)(n.li,{children:"Token \u5e94\u4f7f\u7528 HTTPS \u534f\u8bae."}),"\n",(0,r.jsx)(n.li,{children:"\u5bf9\u4e8e\u91cd\u8981\u6743\u9650, \u9700\u4f7f\u7528\u4e8c\u6b21\u9a8c\u8bc1 (Two Factor Authentication)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"json-web-token",children:"JSON Web Token"}),"\n",(0,r.jsx)(n.p,{children:"JSON Web Tokens is small, object-friendly\n(compared to SAML, Security Assertion Markup Language Tokens)\nand security for public/private key pair\n(compared to SWT, Simple Web Tokens)."}),"\n",(0,r.jsx)(n.h4,{id:"json-web-token-basis",children:"JSON Web Token Basis"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u57fa\u4e8e Token \u7684\u89e3\u51b3\u65b9\u6848\u4e2d\u6700\u5e38\u7528\u7684\u662f JWT."}),"\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u5668\u8ba4\u8bc1\u7528\u6237\u5bc6\u7801\u4ee5\u540e, \u751f\u6210\u4e00\u4e2a JSON \u5bf9\u8c61\u5e76\u7b7e\u540d\u52a0\u5bc6\u540e\u4f5c\u4e3a Token \u8fd4\u56de\u7ed9\u7528\u6237."}),"\n",(0,r.jsxs)(n.li,{children:["JSON \u5bf9\u8c61\u5305\u542b\u7528\u6237\u4fe1\u606f, \u7528\u6237\u8eab\u4efd, \u4ee4\u724c\u8fc7\u671f\u65f6\u95f4\u7b49:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Header: \u660e\u6587 Base64 \u7f16\u7801 JSON \u5bf9\u8c61, \u63cf\u8ff0 JWT \u7684\u5143\u6570\u636e.\n\u4e00\u822c\u4e3a Token \u7684\u52a0\u5bc6\u7b97\u6cd5\u548c Token \u7684\u7c7b\u578b, \u5982 ",(0,r.jsx)(n.code,{children:'{"alg": "HS256","typ": "JWT"}'}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Payload: \u660e\u6587 Base64 \u7f16\u7801 JSOn \u5bf9\u8c61, \u5b58\u653e\u5b9e\u9645\u6570\u636e.\n\u6709 7 \u4e2a\u5b98\u65b9\u5b57\u6bb5\u548c\u90e8\u5206\u5b9a\u4e49\u79c1\u6709\u5b57\u6bb5, \u4e00\u822c\u5b58\u653e\u7528\u6237\u540d, \u7528\u6237\u8eab\u4efd, JWT \u63cf\u8ff0\u5b57\u6bb5."}),"\n",(0,r.jsx)(n.li,{children:"Signature: \u5bf9 Header \u548c Payload \u7684\u7b7e\u540d, \u5229\u7528\u7b7e\u540d\u9a8c\u8bc1\u4fe1\u606f\u7684\u6b63\u786e\u6027, \u9632\u6b62\u6570\u636e\u7be1\u6539. \u7b7e\u540d\u9700\u8981\u670d\u52a1\u7aef\u4fdd\u5b58\u7684\u5bc6\u94a5."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u628a\u4e09\u4e2a\u90e8\u5206\u62fc\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32, \u6bcf\u4e2a\u90e8\u5206\u4e4b\u95f4\u7528 ",(0,r.jsx)(n.code,{children:"."})," \u5206\u9694: ",(0,r.jsx)(n.code,{children:"HeaderBase64.PayloadBase64.Signature"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4e1a\u52a1\u63a5\u53e3\u7528\u6765\u9274\u6743\u7684 token \u4e3a ",(0,r.jsx)(n.code,{children:"access token"}),".\n\u8d8a\u662f\u6743\u9650\u654f\u611f\u7684\u4e1a\u52a1, ",(0,r.jsx)(n.code,{children:"access token"})," \u6709\u6548\u671f\u8db3\u591f\u77ed, \u4ee5\u907f\u514d\u88ab\u76d7\u7528."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4e00\u4e2a\u4e13\u95e8\u751f\u6210 ",(0,r.jsx)(n.code,{children:"access token"})," \u7684 token, \u79f0\u4e3a ",(0,r.jsx)(n.code,{children:"refresh token"}),".\n",(0,r.jsx)(n.code,{children:"refresh token"})," \u7528\u6765\u83b7\u53d6 ",(0,r.jsx)(n.code,{children:"access token"}),", \u6709\u6548\u671f\u66f4\u957f,\n\u901a\u8fc7\u72ec\u7acb\u670d\u52a1\u548c\u4e25\u683c\u7684\u8bf7\u6c42\u65b9\u5f0f\u589e\u52a0\u5b89\u5168\u6027."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://jwt.io/introduction",children:(0,r.jsx)(n.img,{alt:"JSON Web Token",src:s(5958).A+"",width:"652",height:"482"})})}),"\n",(0,r.jsx)(n.h4,{id:"json-web-token-pros",children:"JSON Web TOken Pros"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JWT \u9ed8\u8ba4\u662f\u4e0d\u52a0\u5bc6."}),"\n",(0,r.jsx)(n.li,{children:"JWT \u4e0d\u52a0\u5bc6\u7684\u60c5\u51b5\u4e0b, \u4e0d\u80fd\u5c06\u79d8\u5bc6\u6570\u636e\u5199\u5165 JWT."}),"\n",(0,r.jsx)(n.li,{children:"JWT \u53ef\u4ee5\u52a0\u5bc6, \u751f\u6210\u539f\u59cb Token \u4ee5\u540e, \u53ef\u4ee5\u7528\u5bc6\u94a5\u518d\u52a0\u5bc6\u4e00\u6b21."}),"\n",(0,r.jsx)(n.li,{children:"JWT \u4e0d\u4ec5\u53ef\u7528\u4e8e\u8ba4\u8bc1, \u4e5f\u53ef\u7528\u4e8e\u4ea4\u6362\u4fe1\u606f.\n\u6709\u6548\u4f7f\u7528 JWT, \u53ef\u4ee5\u964d\u4f4e\u670d\u52a1\u5668\u67e5\u8be2\u6570\u636e\u5e93\u7684\u6b21\u6570."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"json-web-token-cons",children:"JSON Web Token Cons"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4e0d\u4fdd\u5b58 Session \u72b6\u6001, \u65e0\u6cd5\u4e2d\u6b62\u6216\u66f4\u6539 Token \u6743\u9650, Token \u5230\u671f\u524d\u4f1a\u59cb\u7ec8\u6709\u6548, \u5b58\u5728\u76d7\u7528\u98ce\u9669:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JWT \u6709\u6548\u671f\u5e94\u77ed."}),"\n",(0,r.jsx)(n.li,{children:"JWT \u5e94\u4f7f\u7528 HTTPS \u534f\u8bae."}),"\n",(0,r.jsx)(n.li,{children:"\u5bf9\u4e8e\u91cd\u8981\u6743\u9650, \u9700\u4f7f\u7528\u4e8c\u6b21\u9a8c\u8bc1 (Two Factor Authentication)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"jwt-client",children:"JWT Client"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"HTTP request with credential data (email/password) for first request,\nget token data or error code from first response."}),"\n",(0,r.jsxs)(n.li,{children:["Intercept token to ",(0,r.jsx)(n.code,{children:"fetch"}),"/",(0,r.jsx)(n.code,{children:"axios"})," request headers for rest requests","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Sent requests with token data."}),"\n",(0,r.jsx)(n.li,{children:"Logout whenever token data inspire or deleted."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Store token in ",(0,r.jsx)(n.code,{children:"Redux"}),"/",(0,r.jsx)(n.code,{children:"Vuex"})," global state."]}),"\n",(0,r.jsxs)(n.li,{children:["Store token in ",(0,r.jsx)(n.code,{children:"localStorage"}),"/",(0,r.jsx)(n.code,{children:"sessionStorage"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"oauth-authentication",children:"OAuth Authentication"}),"\n",(0,r.jsx)(n.p,{children:"OAuth (Open Authorization) \u662f\u4e00\u4e2a\u5f00\u653e\u6807\u51c6, \u4f5c\u7528\u4e8e\u7b2c\u4e09\u65b9\u6388\u6743\u548c\u7b2c\u4e09\u65b9\u8bbf\u95ee.\n\u7528\u6237\u6570\u636e\u7684\u6240\u6709\u8005\u544a\u8bc9\u7cfb\u7edf, \u540c\u610f\u6388\u6743\u7b2c\u4e09\u65b9\u5e94\u7528\u8fdb\u5165\u7cfb\u7edf, \u83b7\u53d6\u8fd9\u4e9b\u6570\u636e.\n\u7cfb\u7edf\u4ece\u800c\u4ea7\u751f\u4e00\u4e2a\u77ed\u671f\u8fdb\u5165\u4ee4\u724c (Token), \u7528\u6765\u4ee3\u66ff\u5bc6\u7801\u4f9b\u7b2c\u4e09\u65b9\u5e94\u7528\u4f7f\u7528."}),"\n",(0,r.jsx)(n.p,{children:"\u7b2c\u4e09\u65b9\u5e94\u7528\u7533\u8bf7\u4ee4\u724c\u4e4b\u524d, \u90fd\u5fc5\u987b\u5148\u5230\u7cfb\u7edf\u5907\u6848, \u8bf4\u660e\u81ea\u5df1\u7684\u8eab\u4efd, \u7136\u540e\u4f1a\u62ff\u5230\u4e24\u4e2a\u8eab\u4efd\u8bc6\u522b\u7801:\nClient ID \u548c Client Secret. \u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u4ee4\u724c\u88ab\u6ee5\u7528, \u6ca1\u6709\u5907\u6848\u8fc7\u7684\u7b2c\u4e09\u65b9\u5e94\u7528\u62ff\u4e0d\u5230\u4ee4\u724c (Token)."}),"\n",(0,r.jsx)(n.p,{children:"OAuth Token \u7279\u5f81:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u6388\u6743\u77ed (Short Expire Time)."}),"\n",(0,r.jsx)(n.li,{children:"\u53ef\u64a4\u9500 (Revoke)."}),"\n",(0,r.jsx)(n.li,{children:"\u6743\u9650\u5c0f (Scope)."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"oauth-authentication-basis",children:"OAuth Authentication Basis"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5728 GitHub Developer Settings \u4e2d\u5907\u6848\u7b2c\u4e09\u65b9\u5e94\u7528,\n\u62ff\u5230\u5c5e\u4e8e\u5b83\u7684\u5ba2\u6237\u7aef ID \u548c\u5ba2\u6237\u7aef\u5bc6\u94a5\n(3rd-Party Server vs Resource Owner)"}),"\n",(0,r.jsxs)(n.li,{children:["\u5728\u81ea\u5df1\u7684\u7b2c\u4e09\u65b9\u7f51\u7ad9\u63d0\u4f9b\u4e00\u4e2a GitHub \u767b\u5f55\u94fe\u63a5,\n\u7528\u6237\u70b9\u51fb\u8be5\u94fe\u63a5\u540e\u4f1a\u8df3\u8f6c\u5230 GitHub OAuth API\n",(0,r.jsx)(n.code,{children:"https://github.com/login/oauth/authorize/?client_id=${clientID}"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"\u7528\u6237\u8df3\u8f6c\u5230 GitHub, \u901a\u8fc7\u9a8c\u8bc1\u5e76\u540c\u610f\u4f7f\u7528 GitHub \u8eab\u4efd\u767b\u5f55\u7b2c\u4e09\u65b9\u7f51\u7ad9,\n\u6b64\u65f6\u5c31\u4f1a\u5e26\u7740\u6388\u6743\u7801 Code \u8df3\u56de\u7b2c\u4e09\u65b9\u7f51\u7ad9."}),"\n",(0,r.jsxs)(n.li,{children:["\u7b2c\u4e09\u65b9\u7f51\u7ad9\u6536\u5230\u6388\u6743\u7801, \u5229\u7528\u6388\u6743\u7801, \u5ba2\u6237\u7aef ID, \u5ba2\u6237\u7aef\u5bc6\u94a5\u5411 GitHub \u8bf7\u6c42 ",(0,r.jsx)(n.code,{children:"access_token"}),"\u4ee4\u724c\n",(0,r.jsx)(n.code,{children:"https://github.com/login/oauth/access_token?client_id=${clientID}&client_secret=${clientSecret}&code=${code}"}),"\n(3rd-Party Server vs Authorization Server)"]}),"\n",(0,r.jsxs)(n.li,{children:["\u7b2c\u4e09\u65b9\u7f51\u7ad9\u6536\u5230\u4ee4\u724c, \u53ef\u4ee5\u6682\u65f6\u62e5\u6709 GitHub \u4e00\u4e9b\u8bf7\u6c42\u7684\u6743\u9650\u6bd4\u5982\u7528\u6237\u4fe1\u606f,\n",(0,r.jsx)(n.code,{children:"https://api.github.com/user?access_token=${accessToken}"}),"\n\u6216\u8005 Request Header ",(0,r.jsx)(n.code,{children:"Authorization: token ${accessToken}"}),".\n\u53ef\u4ee5\u6784\u5efa\u7b2c\u4e09\u65b9\u7f51\u7ad9\u81ea\u5df1\u7684 Token, \u505a\u8fdb\u4e00\u6b65\u76f8\u5173\u9274\u6743\u64cd\u4f5c (\u5982 Session Cookie).\n(3rd-Party Server vs Resource Server)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"oauth-20",children:"OAuth 2.0"}),"\n",(0,r.jsx)(n.p,{children:"OAuth 2.0 \u5141\u8bb8\u81ea\u52a8\u66f4\u65b0\u4ee4\u724c.\n\u8d44\u6e90\u6240\u6709\u8005\u9881\u53d1\u4ee4\u724c\u65f6\u4e00\u6b21\u6027\u9881\u53d1\u4e24\u4e2a\u4ee4\u724c,\n\u4e00\u4e2a\u7528\u4e8e\u83b7\u53d6\u6570\u636e (Access Token),\n\u53e6\u4e00\u4e2a\u7528\u4e8e\u83b7\u53d6\u65b0\u7684\u4ee4\u724c (Refresh Token).\n\u4ee4\u724c\u5230\u671f\u524d, \u7b2c\u4e09\u65b9\u7f51\u7ad9\u4f7f\u7528 Refresh Token \u53d1\u8bf7\u6c42\u66f4\u65b0\u4ee4\u724c:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-http",children:"https://github.com/login/oauth/access_token\n?client_id=CLIENT_ID\n&client_secret=CLIENT_SECRET\n&grant_type=refresh_token\n&refresh_token=REFRESH_TOKEN\n"})}),"\n",(0,r.jsx)(n.h4,{id:"oauth-usage",children:"OAuth Usage"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Modern guide to ",(0,r.jsx)(n.a,{href:"https://fusionauth.io/learn/expert-advice/oauth/modern-guide-to-oauth",children:"OAuth"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"single-sign-on",children:"Single Sign On"}),"\n",(0,r.jsxs)(n.p,{children:["\u5355\u70b9\u767b\u5f55 (",(0,r.jsx)(n.code,{children:"SSO"}),") \u8981\u6c42\u4e0d\u540c\u57df\u4e0b\u7684\u7cfb\u7edf",(0,r.jsx)(n.strong,{children:"\u4e00\u6b21\u767b\u5f55, \u5168\u7ebf\u901a\u7528"}),",\n\u901a\u5e38\u7531\u72ec\u7acb\u7684 ",(0,r.jsx)(n.code,{children:"SSO"})," \u7cfb\u7edf\u8bb0\u5f55\u767b\u5f55\u72b6\u6001, \u4e0b\u53d1 ",(0,r.jsx)(n.code,{children:"ticket"}),",\n\u5404\u4e1a\u52a1\u7cfb\u7edf\u914d\u5408\u5b58\u50a8\u548c\u8ba4\u8bc1 ",(0,r.jsx)(n.code,{children:"ticket"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7528\u6237\u8bbf\u95ee\u7cfb\u7edf 1 \u7684\u53d7\u4fdd\u62a4\u8d44\u6e90, \u7cfb\u7edf 1 \u53d1\u73b0\u7528\u6237\u672a\u767b\u5f55, \u8df3\u8f6c\u81f3 ",(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3, \u5e76\u5c06\u81ea\u5df1\u7684\u5730\u5740\u4f5c\u4e3a\u53c2\u6570."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u53d1\u73b0\u7528\u6237\u672a\u767b\u5f55, \u5c06\u7528\u6237\u5f15\u5bfc\u81f3\u767b\u5f55\u9875\u9762."]}),"\n",(0,r.jsx)(n.li,{children:"\u7528\u6237\u8f93\u5165\u7528\u6237\u540d\u5bc6\u7801\u63d0\u4ea4\u767b\u5f55\u7533\u8bf7."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u6821\u9a8c\u7528\u6237\u4fe1\u606f, \u521b\u5efa\u7528\u6237\u4e0e ",(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u4e4b\u95f4\u7684\u4f1a\u8bdd, \u79f0\u4e3a\u5168\u5c40\u4f1a\u8bdd, \u540c\u65f6\u521b\u5efa\u6388\u6743\u4ee4\u724c."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u5e26\u7740\u4ee4\u724c\u8df3\u8f6c\u4f1a\u6700\u521d\u7684\u8bf7\u6c42\u5730\u5740 (\u7cfb\u7edf 1)."]}),"\n",(0,r.jsxs)(n.li,{children:["\u7cfb\u7edf 1 \u62ff\u5230\u4ee4\u724c, \u53bb ",(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u6821\u9a8c\u4ee4\u724c\u662f\u5426\u6709\u6548."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u6821\u9a8c\u4ee4\u724c, \u8fd4\u56de\u6709\u6548, \u6ce8\u518c\u7cfb\u7edf 1 ."]}),"\n",(0,r.jsx)(n.li,{children:"\u7cfb\u7edf 1 \u4f7f\u7528\u8be5\u4ee4\u724c\u521b\u5efa\u4e0e\u7528\u6237\u7684\u4f1a\u8bdd, \u79f0\u4e3a\u5c40\u90e8\u4f1a\u8bdd, \u8fd4\u56de\u53d7\u4fdd\u62a4\u8d44\u6e90."}),"\n",(0,r.jsx)(n.li,{children:"\u7528\u6237\u8bbf\u95ee\u7cfb\u7edf 2 \u7684\u53d7\u4fdd\u62a4\u8d44\u6e90."}),"\n",(0,r.jsxs)(n.li,{children:["\u7cfb\u7edf 2 \u53d1\u73b0\u7528\u6237\u672a\u767b\u5f55, \u8df3\u8f6c\u81f3 ",(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3, \u5e76\u5c06\u81ea\u5df1\u7684\u5730\u5740\u4f5c\u4e3a\u53c2\u6570."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u53d1\u73b0\u7528\u6237\u5df2\u767b\u5f55, \u8df3\u8f6c\u56de\u7cfb\u7edf 2 \u7684\u5730\u5740, \u5e76\u9644\u4e0a\u4ee4\u724c."]}),"\n",(0,r.jsxs)(n.li,{children:["\u7cfb\u7edf 2 \u62ff\u5230\u4ee4\u724c, \u53bb ",(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u6821\u9a8c\u4ee4\u724c\u662f\u5426\u6709\u6548."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u6821\u9a8c\u4ee4\u724c, \u8fd4\u56de\u6709\u6548, \u6ce8\u518c\u7cfb\u7edf 2 ."]}),"\n",(0,r.jsx)(n.li,{children:"\u7cfb\u7edf 2 \u4f7f\u7528\u8be5\u4ee4\u724c\u521b\u5efa\u4e0e\u7528\u6237\u7684\u5c40\u90e8\u4f1a\u8bdd, \u8fd4\u56de\u53d7\u4fdd\u62a4\u8d44\u6e90."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7528\u6237\u767b\u5f55\u6210\u529f\u4e4b\u540e,\n\u7528\u6237\u4e0e ",(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3\u5efa\u7acb\u7684\u4f1a\u8bdd\u79f0\u4e3a\u5168\u5c40\u4f1a\u8bdd,\n\u7528\u6237\u4e0e\u5404\u4e2a\u5b50\u7cfb\u7edf\u5efa\u7acb\u7684\u4f1a\u8bdd\u79f0\u4e3a\u5c40\u90e8\u4f1a\u8bdd,\n\u5c40\u90e8\u4f1a\u8bdd\u5efa\u7acb\u4e4b\u540e, \u7528\u6237\u8bbf\u95ee\u5b50\u7cfb\u7edf\u53d7\u4fdd\u62a4\u8d44\u6e90\u5c06\u4e0d\u518d\u901a\u8fc7 ",(0,r.jsx)(n.code,{children:"SSO"})," \u8ba4\u8bc1\u4e2d\u5fc3:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5c40\u90e8\u4f1a\u8bdd\u5b58\u5728, \u5168\u5c40\u4f1a\u8bdd\u4e00\u5b9a\u5b58\u5728."}),"\n",(0,r.jsx)(n.li,{children:"\u5168\u5c40\u4f1a\u8bdd\u5b58\u5728, \u5c40\u90e8\u4f1a\u8bdd\u4e0d\u4e00\u5b9a\u5b58\u5728."}),"\n",(0,r.jsx)(n.li,{children:"\u5168\u5c40\u4f1a\u8bdd\u9500\u6bc1, \u5c40\u90e8\u4f1a\u8bdd\u5fc5\u987b\u9500\u6bc1."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"web-operation-and-deployment",children:"Web Operation and Deployment"}),"\n",(0,r.jsx)(n.h3,{id:"static-assets",children:"Static Assets"}),"\n",(0,r.jsxs)(n.p,{children:["Fingerprinting is a technique that makes the name of a file,\ndependent on the ",(0,r.jsx)(n.strong,{children:"contents"})," of the file,\nnot on the ",(0,r.jsx)(n.strong,{children:"timestamp"})," differ from servers.\nWhen the file contents change,\nthe filename is also changed.\nFor content that is static or infrequently changed,\nthis provides an easy way to tell whether two versions of a file are identical,\neven across different servers or deployment dates."]}),"\n",(0,r.jsxs)(n.p,{children:["When a filename is unique and based on its content, HTTP headers\ncan be set to encourage ",(0,r.jsx)(n.strong,{children:"caches"}),"(code: ",(0,r.jsx)(n.code,{children:"200"}),") everywhere\n(whether at CDNs, at ISPs, in networking equipment, or in web browsers)\nto keep their own copy of the content.\nWhen the content is updated(),\nthe fingerprint will change.\nThis will cause the remote clients to request a new copy of the content.\nThis is generally known as cache busting."]}),"\n",(0,r.jsx)(n.h3,{id:"ci-system",children:"CI System"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Full builds upon continuous deployment."}),"\n",(0,r.jsx)(n.li,{children:"Incremental builds are a product of time."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"docker-deployment",children:"Docker Deployment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"FROM node:16-alpine as builder\n\nWORKDIR /code\n\nADD package.json package-lock.json /code/\nRUN npm install\n\nADD . /code\nRUN npm run build\n\n# \u9009\u62e9\u66f4\u5c0f\u4f53\u79ef\u7684\u57fa\u7840\u955c\u50cf\nFROM nginx:alpine\n\n# \u5c06\u6784\u5efa\u4ea7\u7269\u79fb\u81f3 Nginx\nCOPY --from=builder code/build/ /usr/share/nginx/html/\n"})}),"\n",(0,r.jsx)(n.h3,{id:"nginx-configuration",children:"Nginx Configuration"}),"\n",(0,r.jsx)(n.p,{children:"\u5b50\u57df\u540d\u8bbe\u7f6e:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo mkdir -p /var/www/blog/html\nsudo chown -R $USER:$USER /var/www/blog/html\nsudo chmod -R 755 /var/www\nsudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/blog\n# change 'root' and 'server_name' config, remove 'default_server' config\nsudo vim /etc/nginx/sites-available/blog\nsudo ln -s /etc/nginx/sites-available/blog /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\n"})}),"\n",(0,r.jsx)(n.h3,{id:"ab-testing",children:"A/B Testing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://rahulsuresh.net/blog/ab-testing-millions-of-users-using-aws-lambda-edge",children:"A/B testing"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Improves customer experience:\nby testing different options,\nbusinesses can find out what their customers prefer\nand make their websites or products more enjoyable to use."}),"\n",(0,r.jsx)(n.li,{children:"Increases sales:\nif a business knows which version of a webpage leads to more sales or sign-ups,\nthey can use that version for everyone, potentially making more money."}),"\n",(0,r.jsx)(n.li,{children:"Reduces risks:\nbefore making big changes, like redesigning a website,\nbusinesses can test small changes to see how people react.\nThis way, they avoid making big investments that might not pay off."}),"\n",(0,r.jsx)(n.li,{children:"Informs decisions:\nInstead of relying on gut feelings,\nbusinesses can make informed decisions that are backed up by actual user behavior."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// A/B test causing Flash of Unstyled Content (FoUC):\n// - SEO impact.\n// - User experience impact.\n// - Web performance impact.\nimport { useEffect, useState } from 'react'\n\nconst imageUrlA = 'https://fakeimg.pl/150x150/0000FF/808080?text=Variant+A'\nconst imageUrlB = 'https://fakeimg.pl/150x150/FF0000/FFFFFF?text=Variant+B'\n\nconst VariantA = () => <img src={imageUrlA} alt=\"Variant A\" />\nconst VariantB = () => <img src={imageUrlB} alt=\"Variant B\" />\n\nexport default function ABTestComponent() {\n  const [variant, setVariant] = useState('loading')\n\n  useEffect(() => {\n    // Simulate reading from localStorage with a delay\n    setTimeout(() => {\n      const randomVariant = Math.random() < 0.5 ? 'A' : 'B'\n      const storedVariant = localStorage.getItem('userVariant') ?? randomVariant\n      localStorage.setItem('userVariant', storedVariant)\n      setVariant(storedVariant)\n    }, 500) // 500ms second delay to simulate a flicker effect\n  }, [])\n\n  return (\n    <div>\n      {variant === 'loading' && <div>Loading variant...</div>}\n      {variant === 'A' && <VariantA />}\n      {variant === 'B' && <VariantB />}\n    </div>\n  )\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"blue-green-deployment",children:"Blue Green Deployment"}),"\n",(0,r.jsx)(n.p,{children:"\u4e24\u5957\u7cfb\u7edf, \u4e00\u5957\u7a33\u5b9a\u7684\u7eff\u8272\u7cfb\u7edf, \u4e00\u5957\u5373\u5c06\u53d1\u5e03\u7684\u84dd\u8272\u7cfb\u7edf.\n\u4e0d\u65ad\u5207\u6362\u5e76\u8fed\u4ee3\u53d1\u5e03\u5230\u751f\u4ea7\u73af\u5883\u4e2d."}),"\n",(0,r.jsx)(n.h3,{id:"rolling-update",children:"Rolling Update"}),"\n",(0,r.jsx)(n.p,{children:"\u591a\u4e2a\u96c6\u7fa4\u5b9e\u4f8b\u7684\u670d\u52a1\u4e2d, \u5728\u4e0d\u5f71\u54cd\u670d\u52a1\u7684\u60c5\u51b5\u4e0b,\n\u505c\u6b62\u4e00\u4e2a\u6216\u591a\u4e2a\u5b9e\u4f8b, \u9010\u6b65\u8fdb\u884c\u7248\u672c\u66f4\u65b0."}),"\n",(0,r.jsx)(n.h3,{id:"gray-release",children:"Gray Release"}),"\n",(0,r.jsx)(n.h4,{id:"gray-release-introduction",children:"Gray Release Introduction"}),"\n",(0,r.jsx)(n.p,{children:"Canary Release: \u5168\u91cf\u6216\u589e\u91cf\u90e8\u7f72\u65b0\u6587\u4ef6, \u5e76\u9010\u6b65\u628a\u6d41\u91cf\u5207\u6362\u81f3\u65b0 CDN URL.\n\u6839\u636e\u7070\u5ea6\u767d\u540d\u5355, \u5c06\u7070\u5ea6\u6d4b\u8bd5\u7528\u6237\u7684 CDN Assets\n\u66f4\u6362\u81f3\u4e0d\u540c Version Number \u6216\u8005 Fingerprint \u7684\u65b0\u7248\u672c\u524d\u7aef\u9875\u9762\u6587\u4ef6."}),"\n",(0,r.jsx)(n.h4,{id:"gray-release-solution",children:"Gray Release Solution"}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7\u7070\u5ea6\u53d1\u5e03\u6536\u96c6\u7528\u6237\u53cd\u9988 (\u8f6c\u5316\u7387\u7b49\u6307\u6807),\n\u51b3\u5b9a\u540e\u7eed\u662f\u5426\u5168\u9762\u5c06\u6240\u6709\u6d41\u91cf\u5207\u81f3\u65b0\u7248\u672c,\n\u6216\u8005\u5b8c\u5168\u653e\u5f03\u65b0\u7248\u672c,\n\u4ea6\u6216\u662f\u901a\u8fc7 FLAGS \u7ed3\u5408\u7528\u6237\u7279\u5f81\u56fe\u50cf,\n(\u5982\u7528\u6237\u7ea7\u522b, UA, Cookie\nLocation, IP,\nFeature List \u7b49)\n\u53ea\u5411\u90e8\u5206\u6d41\u91cf\u6295\u653e\u65b0\u7248\u672c.\n\u53ef\u4ee5\u5b9e\u73b0\u5343\u4eba\u5343\u9875,\n\u6bcf\u4e2a\u7528\u6237\u83b7\u5f97\u7531\u4e0d\u540c\u7684\u529f\u80fd (FLAGS \u5f00\u542f\u5173\u95ed) \u7ec4\u6210\u7684\u4e0d\u540c\u9875\u9762."}),"\n",(0,r.jsx)(n.p,{children:"\u4e1a\u754c\u6210\u719f\u7684\u7070\u5ea6\u65b9\u6848:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7b80\u5355\u7070\u5ea6\u903b\u8f91\u901a\u8fc7 Nginx \u914d\u7f6e\u505a\u89c4\u5219\u5224\u65ad(\u8def\u7531, \u53c2\u6570, IP, Cookie \u7b49), upstream \u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u65b0\u4ee3\u7801\u90e8\u7f72\u5230 A \u8fb9."}),"\n",(0,r.jsx)(n.li,{children:"\u7b26\u5408\u7070\u5ea6\u7b56\u7565\u7684\u5c0f\u90e8\u5206\u6d41\u91cf\u5207\u5230 A \u8fb9, \u5269\u4f59\u5927\u90e8\u5206\u6d41\u91cf\u4ecd\u53bb\u5f80 B \u8fb9"}),"\n",(0,r.jsx)(n.li,{children:"\u9a8c\u8bc1 A \u8fb9\u529f\u80fd\u662f\u5426\u6b63\u5e38\u53ef\u7528/\u597d\u7528"}),"\n",(0,r.jsx)(n.li,{children:"\u9a8c\u8bc1\u65e0\u8bef\u540e, \u5927\u90e8\u5206\u6d41\u91cf\u8f6c\u5230 A \u8fb9, \u7070\u5ea6\u6d41\u91cf\u53bb\u5f80 B \u8fb9"}),"\n",(0,r.jsx)(n.li,{children:"\u9a8c\u8bc1 B \u8fb9\u529f\u80fd\u662f\u5426\u6b63\u5e38\u53ef\u7528/\u597d\u7528"}),"\n",(0,r.jsx)(n.li,{children:"\u9a8c\u8bc1\u65e0\u8bef\u540e, \u6d41\u91cf\u50cf\u5f80\u5e38\u4e00\u6837\u5747\u5206\u5230 AB \u8fb9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Canary Deployment\nmap $COOKIE_canary $group {\n  # canary account\n  ~*devui$ server_canary;\n  default server_default;\n}\n\n# \u6d41\u91cf\u5747\u5206, \u6ce8\u91ca\u6389\u5176\u4e2d\u67d0\u4e00\u8fb9, \u53e6\u4e00\u8fb9\u4e3a\u7070\u5ea6\u6d41\u91cf\u8bbf\u95ee\u8fb9\nupstream server_canary {\n  server 11.11.11.11:8000 weight=1 max_fails=1 fail_timeout=30s;\n  server 22.22.22.22 weight=1 max_fails=1 fail_timeout=30s;\n}\n\n# \u6d41\u91cf\u5747\u5206, \u6ce8\u91ca\u6389\u5176\u4e2d\u67d0\u4e00\u8fb9, \u53e6\u4e00\u8fb9\u4e3a\u6b63\u5e38\u6d41\u91cf\u8bbf\u95ee\u8fb9\nupstream server_default {\n  server 11.11.11.11:8000 weight=2 max_fails=1 fail_timeout=30s;\n  server 22.22.22.22 weight=2 max_fails=1 fail_timeout=30s;\n}\n\n# \u914d\u7f6e 8000 \u7aef\u53e3\u7684\u8f6c\u53d1\u89c4\u5219, \u5e76\u4e14 expose port\nserver {\n  listen 8000;\n  server_name _;\n  root /var/canaryDemo;\n\n  # Load configuration files for the default server block.\n  include /etc/nginx/default.d/*.conf;\n\n  location / {\n    root /var/canaryDemo;\n    index index.html;\n    try_files $uri $uri/ /index.html;\n  }\n}\n\nserver {\n  listen 80 default_server;\n  listen [::]:80 default_server;\n  server_name _;\n  # root /usr/share/nginx/html;\n  root /var/canaryDemo;\n\n  # Load configuration files for the default server block.\n  include /etc/nginx/default.d/*.conf;\n\n  location / {\n    proxy_pass http://$group;\n    # root /var/canaryDemo;\n    # index index.html;\n  }\n\n  error_page 404 /404.html;\n    location = /40x.html {\n  }\n\n  error_page 500 502 503 504 /50x.html;\n  location = /50x.h\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u590d\u6742\u7070\u5ea6\u903b\u8f91\u901a\u8fc7 Nginx + Lua \u65b0\u589e\u4e00\u4e2a\u7070\u5ea6\u4e2d\u5fc3\u670d\u52a1,\n\u7ed3\u5408\u4e1a\u52a1\u6765\u505a\u6d41\u91cf\u7684\u7070\u5ea6\u4e0e\u5207\u6362, \u63a7\u5236 HTML \u5165\u53e3\u6587\u4ef6,\n\u4f7f\u7070\u5ea6\u89c4\u5219\u4e0e\u4e1a\u52a1\u4ee3\u7801\u89e3\u8026."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"gray-release-performance",children:"Gray Release Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u524d\u7aef\u4f18\u5316:\n\u6bcf\u4e00\u4e2a\u9875\u9762\u90fd\u9700\u8981\u53bb\u83b7\u53d6\u7070\u5ea6\u89c4\u5219, \u8fd9\u4e2a\u7070\u5ea6\u8bf7\u6c42\u5c06\u963b\u585e\u9875\u9762.\n\u53ef\u4ee5\u4f7f\u7528 localStorage \u5b58\u50a8\u8fd9\u4e2a\u7528\u6237\u662f\u5426\u4e3a\u7070\u5ea6\u7528\u6237,\n\u7136\u540e\u5b9a\u671f\u7684\u66f4\u65b0 localStorage,\n\u53d6\u4ee3\u5927\u91cf\u7684\u8bf7\u6c42\u9020\u6210\u7684\u4f53\u9a8c\u95ee\u9898."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u540e\u7aef\u4f18\u5316:\n\u5229\u7528 MemCache \u5728\u5185\u5b58\u4e2d\u7f13\u5b58\u7070\u5ea6\u89c4\u5219\u4e0e\u7070\u5ea6\u7528\u6237\u5217\u8868,\n\u63d0\u5347\u7070\u5ea6\u53d1\u5e03\u6027\u80fd."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"devops-reference",children:"DevOps Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["SaaS/PaaS/IaaS ",(0,r.jsx)(n.a,{href:"https://github.com/ripienaar/free-for-dev",children:"list"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Free budget ",(0,r.jsx)(n.a,{href:"https://github.com/255kb/stack-on-a-budget",children:"stack"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"eslint",children:"ESLint"}),"\n",(0,r.jsx)(n.h3,{id:"eslint-flat-config",children:"ESLint Flat Config"}),"\n",(0,r.jsxs)(n.p,{children:["Flat config compatibility ",(0,r.jsx)(n.a,{href:"https://github.com/vercel/next.js/discussions/49337",children:"solution"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"babel",children:"Babel"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"babel example.js -o compiled.js\nbabel src -d lib -s\n"})}),"\n",(0,r.jsx)(n.h3,{id:"babel-node",children:"Babel Node"}),"\n",(0,r.jsx)(n.p,{children:"A read-eval-print loop(REPL) can replace node REPL."}),"\n",(0,r.jsx)(n.h3,{id:"babel-core",children:"Babel Core"}),"\n",(0,r.jsx)(n.p,{children:"\u63d0\u4f9b babel \u8f6c\u7801 API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install babel-core --save\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const babel = require('babel-core')\n\n// \u5b57\u7b26\u4e32\u8f6c\u7801\nbabel.transform('code();', options)\n// => { code, map, ast }\n\n// \u6587\u4ef6\u8f6c\u7801 (\u5f02\u6b65)\nbabel.transformFile('filename.js', options, (err, result) => {\n  process(err)\n  return result // => { code, map, ast }\n})\n\n// \u6587\u4ef6\u8f6c\u7801 (\u540c\u6b65)\nbabel.transformFileSync('filename.js', options)\n// => { code, map, ast }\n\n// Babel AST\u8f6c\u7801\nbabel.transformFromAst(ast, code, options)\n// => { code, map, ast }\n"})}),"\n",(0,r.jsx)(n.h3,{id:"codemod-tool",children:"CodeMod Tool"}),"\n",(0,r.jsx)(n.p,{children:"Use Babel to refactor code:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/facebook/jscodeshift",children:"JSCodeshift"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/reactjs/react-codemod",children:"ReactCodemod"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"babel-transform-plugin",children:"Babel Transform Plugin"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Visitor pattern with Babel."}),"\n",(0,r.jsxs)(n.li,{children:["Named ",(0,r.jsx)(n.code,{children:"babel-plugin-transform-xxx"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "main": "index.js"\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// index.js\nmodule.exports = (babel) => {\n  const t = babel.types\n  let isJSXExisted = false\n  let isMeactContextEnabled = false\n\n  return {\n    visitor: {\n      Program: {\n        exit(path) {\n          if (isJSXExisted === true && isMeactContextEnabled === false)\n            throw path.buildCodeFrameError(`Meact isn't in current context!`)\n        },\n      },\n      ImportDeclaration(path, state) {\n        if (path.node.specifiers[0].local.name === 'Meact')\n          isMeactContextEnabled = true\n      },\n      MemberExpression(path, state) {\n        if (\n          path.node.object.name === 'React'\n          && path.node.property.name === 'createElement'\n        ) {\n          isJSXExisted = true\n          path.replaceWith(\n            t.MemberExpression(\n              t.identifier('Meact'),\n              t.identifier('createElement')\n            )\n          )\n        }\n      },\n    },\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Babel plugins:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Define ",(0,r.jsx)(n.a,{href:"https://github.com/FormidableLabs/babel-plugin-transform-define",children:"plugin"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"babel-preset-plugin",children:"Babel Preset Plugin"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Just like ",(0,r.jsx)(n.code,{children:".babelrc.js"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Named ",(0,r.jsx)(n.code,{children:"babel-preset-xxx"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'// package.json\n{\n  "main": "index.js",\n  "dependencies": {\n    "babel-plugin-transform-meact-jsx": "^0.1.2",\n    "@babel/plugin-proposal-object-rest-spread": "^7.0.0",\n    "@babel/plugin-transform-react-jsx": "^7.0.0",\n    "@babel/plugin-transform-runtime": "^7.0.0",\n    "@babel/preset-env": "^7.0.0"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// index.js\nconst defaultTargets = {\n  android: 30,\n  chrome: 35,\n  edge: 14,\n  explorer: 9,\n  firefox: 52,\n  safari: 8,\n  ucandroid: 1,\n}\n\nfunction buildTargets(options) {\n  return Object.assign({}, defaultTargets, options.additionalTargets)\n}\n\nmodule.exports = function buildMeactPreset(context, options) {\n  const transpileTargets\n    = (options && options.targets) || buildTargets(options || {})\n\n  return {\n    presets: [\n      require('@babel/preset-env').default(null, {\n        targets: transpileTargets,\n        modules: false,\n      }),\n    ],\n    plugins: [\n      require('@babel/plugin-proposal-object-rest-spread'),\n      require('@babel/plugin-transform-react-jsx'),\n      require('babel-plugin-transform-meact-jsx'),\n      require('@babel/plugin-transform-runtime'),\n    ].filter(Boolean),\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"webpack",children:"Webpack"}),"\n",(0,r.jsx)(n.h3,{id:"webpack-workflow",children:"Webpack Workflow"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://segmentfault.com/a/1190000039956437",children:"Webpack workflow"}),":"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Webpack Workflow",src:s(7671).A+"",title:"Webpack Workflow",width:"1156",height:"453"})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-configuration-intellisense",children:"Webpack Configuration Intellisense"}),"\n",(0,r.jsx)(n.p,{children:"Enable webpack configuration types intellisense:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm i -D webpack webpack-cli webpack-dev-server\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Enable ",(0,r.jsx)(n.code,{children:"devServer"})," type intellisense:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Add `devServer` type to `webpack.Configuration`\nnpm i -D @types/webpack-dev-server\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"/** @type {import('webpack').Configuration} */\nmodule.exports = {\n  entry: {\n    main: './src/index.ts',\n  },\n  output: {\n    filename: devMode ? '[name].js' : '[name].[contenthash].js',\n    path: path.resolve(__dirname, 'build'),\n  },\n  mode: devMode ? 'development' : 'production',\n  devServer: {\n    hot: true,\n    open: true,\n    port: 2333,\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-hot-module-replacement",children:"Webpack Hot Module Replacement"}),"\n",(0,r.jsx)(n.p,{children:"HMR:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f7f\u7528 WDS \u6258\u7ba1\u9759\u6001\u8d44\u6e90, \u540c\u65f6\u4ee5 Runtime \u65b9\u5f0f\u6ce8\u5165 HMR \u5ba2\u6237\u7aef\u4ee3\u7801 (HMR Runtime)."}),"\n",(0,r.jsx)(n.li,{children:"\u6d4f\u89c8\u5668\u52a0\u8f7d\u9875\u9762\u540e, \u4e0e WDS \u5efa\u7acb WebSocket \u8fde\u63a5."}),"\n",(0,r.jsx)(n.li,{children:"Webpack \u76d1\u542c\u5230\u6587\u4ef6\u53d8\u5316\u540e, \u589e\u91cf\u6784\u5efa\u53d1\u751f\u53d8\u66f4\u7684\u6a21\u5757, \u5e76\u901a\u8fc7 WebSocket \u53d1\u9001 hash \u4e8b\u4ef6."}),"\n",(0,r.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u63a5\u6536\u5230 hash \u4e8b\u4ef6\u540e, \u8bf7\u6c42 manifest (",(0,r.jsx)(n.code,{children:"[hash].hot-update.json"}),") \u8d44\u6e90\u6587\u4ef6, \u786e\u8ba4\u589e\u91cf\u53d8\u66f4\u8303\u56f4."]}),"\n",(0,r.jsx)(n.li,{children:"\u6d4f\u89c8\u5668\u52a0\u8f7d\u53d1\u751f\u53d8\u66f4\u7684\u589e\u91cf\u6a21\u5757."}),"\n",(0,r.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u4e2d\u6ce8\u5165\u7684 HMR Runtime \u89e6\u53d1\u53d8\u66f4\u6a21\u5757\u7684 ",(0,r.jsx)(n.code,{children:"module.hot.accept"})," \u56de\u8c03, \u6267\u884c\u4ee3\u7801\u53d8\u66f4\u903b\u8f91."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Hot Module Replacement",src:s(3574).A+"",title:"Hot Module Replacement",width:"805",height:"837"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"module.hot.accept"})," \u6709\u4e24\u79cd\u8c03\u7528\u6a21\u5f0f:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u65e0\u53c2\u8c03\u7528\u6a21\u5f0f ",(0,r.jsx)(n.code,{children:"module.hot.accept()"}),": \u5f53\u524d\u6587\u4ef6\u4fee\u6539\u540e, \u91cd\u5934\u6267\u884c\u5f53\u524d\u6587\u4ef6\u4ee3\u7801."]}),"\n",(0,r.jsxs)(n.li,{children:["\u56de\u8c03\u8c03\u7528\u6a21\u5f0f ",(0,r.jsx)(n.code,{children:"module.hot.accept(path, callback)"}),": \u5e38\u7528\u6a21\u5f0f, \u76d1\u542c\u6a21\u5757\u53d8\u66f4, \u6267\u884c\u4ee3\u7801\u53d8\u66f4\u903b\u8f91."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// \u8be5\u6a21\u5757\u4fee\u6539\u540e, `console.log('bar')` \u4f1a\u91cd\u65b0\u6267\u884c\nconsole.log('bar')\nmodule.hot.accept()\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import component from './component'\n\nlet demoComponent = component()\ndocument.body.appendChild(demoComponent)\n\nif (module.hot) {\n  module.hot.accept('./component', () => {\n    const nextComponent = component()\n    document.body.replaceChild(nextComponent, demoComponent)\n    demoComponent = nextComponent\n  })\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"react-refresh-webpack-plugin"}),"/",(0,r.jsx)(n.code,{children:"vue-loader"}),"/",(0,r.jsx)(n.code,{children:"style-loader"}),"\n\u5229\u7528 ",(0,r.jsx)(n.code,{children:"module.hot.accept"})," \u5b9e\u73b0\u4e86 HMR (forceUpdate),\n\u65e0\u9700\u5f00\u53d1\u8005\u7f16\u5199\u70ed\u6a21\u5757\u66f4\u65b0\u903b\u8f91."]}),"\n",(0,r.jsx)(n.h3,{id:"webpack-watch-options",children:"Webpack Watch Options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"echo fs.notify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf\nsudo sysctl -p\n"})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-resolve-path-options",children:"Webpack Resolve Path Options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const TsconfigPathsPlugin = require('tsconfig-paths-webpack-plugin')\n\nmodule.exports = {\n  resolve: {\n    alias: {\n      '#': path.resolve(__dirname, '/'),\n      '~': path.resolve(__dirname, 'src'),\n      '@': path.resolve(__dirname, 'src'),\n      '~@': path.resolve(__dirname, 'src'),\n      'vendor': path.resolve(__dirname, 'src/vendor'),\n      '~component': path.resolve(__dirname, 'src/components'),\n      '~config': path.resolve(__dirname, 'config'),\n    },\n    extensions: ['.tsx', '.ts', '.jsx', '.js'],\n    plugins: [new TsconfigPathsPlugin({ configFile: './tsconfig.json' })],\n  },\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["get ",(0,r.jsx)(n.code,{children:"baseUrl"}),"and ",(0,r.jsx)(n.code,{children:"paths"})," from ",(0,r.jsx)(n.code,{children:"tsconfig.json"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const TsconfigPathsPlugin = require('tsconfig-paths-webpack-plugin')\n\nmodule.exports = {\n  resolve: {\n    plugins: [new TsconfigPathsPlugin({ configFile: './tsconfig.json' })],\n  },\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"jsconfig.json"})," for vscode resolve path:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "compilerOptions": {\n    // This must be specified if "paths" is set\n    "baseUrl": ".",\n    // Relative to "baseUrl"\n    "paths": {\n      "*": ["*", "src/*"]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "compilerOptions": {\n    "target": "es2017",\n    "allowSyntheticDefaultImports": false,\n    "baseUrl": "./",\n    "paths": {\n      "Config/*": ["src/config/*"],\n      "Components/*": ["src/components/*"],\n      "Ducks/*": ["src/ducks/*"],\n      "Shared/*": ["src/shared/*"],\n      "App/*": ["src/*"]\n    }\n  },\n  "exclude": ["node_modules", "dist"]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-flag-options",children:"Webpack Flag Options"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"--progress"}),"\n",(0,r.jsx)(n.li,{children:"--colors"}),"\n",(0,r.jsx)(n.li,{children:"-p"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"webpack-devtool-source-map-configuration",children:"Webpack Devtool Source Map Configuration"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Devtool"}),(0,r.jsx)(n.th,{children:"Build"}),(0,r.jsx)(n.th,{children:"Rebuild"}),(0,r.jsx)(n.th,{children:"Production"}),(0,r.jsx)(n.th,{children:"Quality"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"(none) / false"}),(0,r.jsx)(n.td,{children:"fastest"}),(0,r.jsx)(n.td,{children:"fastest"}),(0,r.jsx)(n.td,{children:"yes"}),(0,r.jsx)(n.td,{children:"bundle"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"eval"}),(0,r.jsx)(n.td,{children:"fast"}),(0,r.jsx)(n.td,{children:"fastest"}),(0,r.jsx)(n.td,{children:"no"}),(0,r.jsx)(n.td,{children:"generated"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"eval-cheap-source-map"}),(0,r.jsx)(n.td,{children:"ok"}),(0,r.jsx)(n.td,{children:"fast"}),(0,r.jsx)(n.td,{children:"no"}),(0,r.jsx)(n.td,{children:"transformed"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"eval-cheap-module-source-map"}),(0,r.jsx)(n.td,{children:"slow"}),(0,r.jsx)(n.td,{children:"fast"}),(0,r.jsx)(n.td,{children:"no"}),(0,r.jsx)(n.td,{children:"lines only"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"eval-source-map"}),(0,r.jsx)(n.td,{children:"slowest"}),(0,r.jsx)(n.td,{children:"ok"}),(0,r.jsx)(n.td,{children:"no"}),(0,r.jsx)(n.td,{children:"lines + rows"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"webpack-cache-configuration",children:"Webpack Cache Configuration"}),"\n",(0,r.jsx)(n.h4,{id:"webpack-build-cache",children:"Webpack Build Cache"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cache"})," is set to ",(0,r.jsx)(n.code,{children:"type: 'memory'"})," in development mode\nand disabled in production mode.\n",(0,r.jsx)(n.code,{children:"cache: true"})," is an alias to ",(0,r.jsx)(n.code,{children:"cache: { type: 'memory' }"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Accelerate second build time:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"module.exports = {\n  cache: {\n    type: 'filesystem',\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"webpack-browser-cache",children:"Webpack Browser Cache"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://webpack.js.org/guides/caching",children:"Webpack caching guide"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"[contenthash]"})," and long-term browser cache to improve second access time."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"webpack-library-configuration",children:"Webpack Library Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const path = require('node:path')\n\nmodule.exports = {\n  entry: {\n    'bod-cli.min': path.join(__dirname, './src/index.js'),\n    'bod-cli': path.join(__dirname, './src/index.js'),\n  },\n  output: {\n    path: path.join(__dirname, './dist'),\n    filename: '[name].[contenthash].js',\n    library: 'bod',\n    libraryExport: 'default',\n    libraryTarget: 'esm',\n    globalObject: 'this',\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-loader-configuration",children:"Webpack Loader Configuration"}),"\n",(0,r.jsx)(n.h4,{id:"webpack-babel-loader",children:"Webpack Babel Loader"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = {\n  test: /\\.(js|mjs|jsx|ts|tsx)$/,\n  include: path.resolve('src'),\n  use: [\n    'thread-loader',\n    {\n      loader: require.resolve('babel-loader'),\n    },\n  ],\n  options: {\n    customize: require.resolve('babel-preset-react-app/webpack-overrides'),\n    plugins: [\n      [\n        require.resolve('babel-plugin-named-asset-import'),\n        {\n          loaderMap: {\n            svg: {\n              ReactComponent: '@svgr/webpack?-svgo,+titleProp,+ref![path]',\n            },\n          },\n        },\n      ],\n      ['lodash'],\n    ],\n    cacheDirectory: true,\n    cacheCompression: false,\n    compact: isEnvProduction,\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"webpack-css-loader",children:"Webpack CSS Loader"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"style-loader"})," \u5c06 CSS \u52a8\u6001\u6ce8\u5165\u5230 DOM \u4e2d (",(0,r.jsx)(n.code,{children:"document.createElement('style')"}),"), \u5bfc\u81f4 DOM \u91cd\u65b0\u6e32\u67d3."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"production"})," \u4e0b\u9700\u5229\u7528 ",(0,r.jsx)(n.code,{children:"Webpack"})," \u5c06 CSS \u63d0\u524d\u6253\u5305 (",(0,r.jsx)(n.code,{children:"mini-css-extract-plugin"}),"):","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5148\u52a0\u8f7d critical CSS in ",(0,r.jsx)(n.code,{children:"<head>"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Lazy loading non-critical CSS."}),"\n",(0,r.jsx)(n.li,{children:"Split up non-initial page CSS."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Next.js"})," \u4e0d\u5141\u8bb8 ",(0,r.jsx)(n.code,{children:":global(.global-class)"}),":\n",(0,r.jsx)(n.code,{children:"modules.mode"})," \u8bbe\u7f6e\u4e3a ",(0,r.jsx)(n.a,{href:"https://github.com/vercel/next.js/blob/v12.1.6/packages/next/build/webpack/config/blocks/css/loaders/modules.ts#L42-L44",children:(0,r.jsx)(n.code,{children:"pure"})}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const CssMinimizerPlugin = require('css-minimizer-webpack-plugin')\nconst MiniCssExtractPlugin = require('mini-css-extract-plugin')\n\nconst devMode = process.env.NODE_ENV !== 'production'\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /.s?css$/,\n        exclude: /node_modules$/,\n        use: [\n          devMode ? 'style-loader' : MiniCssExtractPlugin.loader,\n          {\n            loader: 'css-loader',\n            options: {\n              modules: {\n                compileType: 'module',\n                localIdentName: '[local]__[hash:base64:5]',\n              },\n            },\n          },\n          'sass-loader',\n          {\n            loader: 'postcss-loader',\n            options: {\n              postcssOptions: {\n                plugins: [['autoprefixer']],\n              },\n            },\n          },\n        ],\n      },\n    ],\n  },\n  optimization: {\n    minimizer: [\n      // `...`,\n      new CssMinimizerPlugin(),\n    ],\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"webpack-static-assets-loader",children:"Webpack Static Assets Loader"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/tcoopman/image-webpack-loader",children:"ImageMin Loader"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"asset/resource"})," emits separate file and exports the URL\n(",(0,r.jsx)(n.code,{children:"file-loader"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"asset/inline"})," exports data URI of the asset\n(url-loader)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"asset/source"})," exports source code of the asset\n(raw-loader)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"asset"})," automatically chooses between exporting data URI and separate file\n(",(0,r.jsx)(n.code,{children:"url-loader"})," with asset size limit, default ",(0,r.jsx)(n.code,{children:"8kb"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = {\n  rules: [\n    {\n      test: /\\.(png|jpg|gif|jpeg|webp|svg|eot|ttf|woff|woff2)$/,\n      type: 'asset',\n      parser: {\n        dataUrlCondition: {\n          maxSize: 4 * 1024, // 4kb\n        },\n      },\n    },\n  ],\n}\n"})}),"\n",(0,r.jsx)(n.h5,{id:"webpack-resource-assets",children:"Webpack Resource Assets"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const path = require('node:path')\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n    assetModuleFilename: 'images/[hash][ext][query]',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.png/,\n        type: 'asset/resource',\n      },\n      {\n        test: /\\.html/,\n        type: 'asset/resource',\n        generator: {\n          filename: 'static/[hash][ext][query]',\n        },\n      },\n    ],\n  },\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import mainImage from './images/main.png'\n\nimg.src = mainImage // '/dist/151cfcfa1bd74779aadb.png'\n"})}),"\n",(0,r.jsx)(n.h5,{id:"webpack-inline-assets",children:"Webpack Inline Assets"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const path = require('node:path')\nconst svgToMiniDataURI = require('mini-svg-data-uri')\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.svg/,\n        type: 'asset/inline',\n        generator: {\n          dataUrl: (content) => {\n            content = content.toString()\n            return svgToMiniDataURI(content)\n          },\n        },\n      },\n    ],\n  },\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import metroMap from './images/metro.svg'\n\nblock.style.background = `url(${metroMap})`\n// => url(data:image/svg+xml;base64,PHN2ZyB4bW0iaHR0cDo...vc3ZnPgo=)\n"})}),"\n",(0,r.jsx)(n.h5,{id:"webpack-source-assets",children:"Webpack Source Assets"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const path = require('node:path')\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    filename: 'main.js',\n    path: path.resolve(__dirname, 'dist'),\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.txt/,\n        type: 'asset/source',\n      },\n    ],\n  },\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import exampleText from './example.txt'\n\nblock.textContent = exampleText // 'Hello world'\n"})}),"\n",(0,r.jsx)(n.h4,{id:"webpack-thread-loader",children:"Webpack Thread Loader"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = {\n  rules: [\n    {\n      loader: 'thread-loader',\n      // loaders with equal options will share worker pools\n      options: {\n        // the number of spawned workers, defaults to (number of cpus - 1) or\n        // fallback to 1 when require('os').cpus() is undefined\n        workers: 2,\n\n        // number of jobs a worker processes in parallel\n        // defaults to 20\n        workerParallelJobs: 50,\n\n        // additional node.js arguments\n        workerNodeArgs: ['--max-old-space-size=1024'],\n\n        // Allow to respawn a dead worker pool\n        // respawning slows down the entire compilation\n        // and should be set to false for development\n        poolRespawn: false,\n\n        // timeout for killing the worker processes when idle\n        // defaults to 500 (ms)\n        // can be set to Infinity for watching builds to keep workers alive\n        poolTimeout: 2000,\n\n        // number of jobs the poll distributes to the workers\n        // defaults to 200\n        // decrease of less efficient but more fair distribution\n        poolParallelJobs: 50,\n\n        // name of the pool\n        // can be used to create different pools with elseWise identical options\n        name: 'my-pool',\n      },\n    },\n    // your expensive loader (e.g babel-loader)\n  ],\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const threadLoader = require('thread-loader')\n\nthreadLoader.warmup(\n  {\n    // pool options, like passed to loader options\n    // must match loader options to boot the correct pool\n  },\n  [\n    // modules to load\n    // can be any module, i. e.\n    'babel-loader',\n    'babel-preset-es2015',\n    'sass-loader',\n  ]\n)\n"})}),"\n",(0,r.jsx)(n.h4,{id:"webpack-web-worker-loader",children:"Webpack Web Worker Loader"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/Webpack-contrib/worker-loader",children:"Worker Loader"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm i -D worker-loader\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"module.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.worker\\.js$/,\n        use: { loader: 'worker-loader' },\n      },\n    ],\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-optimization",children:"Webpack Optimization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CDN."}),"\n",(0,r.jsx)(n.li,{children:"\u670d\u52a1\u5668\u7aef\u6e32\u67d3."}),"\n",(0,r.jsx)(n.li,{children:"\u63d0\u53d6\u516c\u5171\u5e93."}),"\n",(0,r.jsx)(n.li,{children:"\u4ee3\u7801\u538b\u7f29."}),"\n",(0,r.jsx)(n.li,{children:"\u4ee3\u7801\u5206\u5272: Chunks."}),"\n",(0,r.jsx)(n.li,{children:"\u4ee3\u7801\u5206\u5272: \u6309\u9700\u52a0\u8f7d."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://webpack.js.org/guides/build-performance",children:"\u4f18\u5316\u6784\u5efa\u901f\u5ea6"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7f29\u5c0f\u6587\u4ef6\u641c\u7d22\u8303\u56f4:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5316 ",(0,r.jsx)(n.code,{children:"loader"})," \u914d\u7f6e: ",(0,r.jsx)(n.code,{children:"include"}),"/",(0,r.jsx)(n.code,{children:"exclude"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5316 ",(0,r.jsx)(n.code,{children:"module.noParse"})," \u914d\u7f6e:\n\u5ffd\u7565\u5bf9\u90e8\u5206\u6ca1\u91c7\u7528\u6a21\u5757\u5316\u7684\u6587\u4ef6\u7684\u9012\u5f52\u89e3\u6790\u5904\u7406."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5316 ",(0,r.jsx)(n.code,{children:"resolve.modules"})," \u914d\u7f6e: \u7b2c\u4e09\u65b9\u6a21\u5757."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5316 ",(0,r.jsx)(n.code,{children:"resolve.alias"})," \u914d\u7f6e."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5316 ",(0,r.jsx)(n.code,{children:"resolve.mainFields"})," \u914d\u7f6e."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5316 ",(0,r.jsx)(n.code,{children:"resolve.extensions"})," \u914d\u7f6e: \u540e\u7f00\u5217\u8868."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u51cf\u5c11\u6253\u5305\u6587\u4ef6:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u63d0\u53d6\u516c\u5171\u4ee3\u7801."}),"\n",(0,r.jsxs)(n.li,{children:["\u52a8\u6001\u94fe\u63a5 ",(0,r.jsx)(n.code,{children:"DllPlugin"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"externals"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Tree shaking."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u7f13\u5b58:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://webpack.js.org/configuration/cache",children:"\u6301\u4e45\u5316\u7f13\u5b58"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"babel"})," \u7f13\u5b58 ",(0,r.jsx)(n.code,{children:"cacheDirectory: true"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cache-loader"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u591a\u8fdb\u7a0b:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"thread-loader"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://jelly.jd.com/article/61179aa26bea510187770aa3",children:"JD Webpack optimization guide"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"common-libraries",children:"Common Libraries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "externals": {\n    "moment": "window.moment",\n    "antd": "window.antd",\n    "lodash": "window._",\n    "react": "window.React",\n    "react-dom": "window.ReactDOM"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"common-chunks",children:"Common Chunks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = new webpack.optimize.CommonsChunkPlugin({\n  name: string, // or\n  names: [string],\n  // The chunk name of the commons chunk.\n  // An existing chunk can be selected by passing a name of an existing chunk.\n  // If an array of strings is passed this is equal to\n  // invoking the plugin multiple times for each chunk name.\n  // If omitted and `options.async` or `options.children`\n  // is set all chunks are used, otherwise `options.filename`\n  // is used as chunk name.\n  // When using `options.async` to create common chunks\n  // from other async chunks you must specify an entry-point\n  // chunk name here instead of omitting the `option.name`.\n\n  filename: string,\n  // The filename template for the commons chunk.\n  // Can contain the same placeholders as `output.filename`.\n  // If omitted the original filename is not modified\n  // (usually `output.filename` or `output.chunkFilename`).\n  // This option is not permitted if you're using `options.async` as well,\n  // see below for more details.\n\n  minChunks: number | Number.POSITIVE_INFINITY | fn,\n  // (module, count) => boolean,\n  // The minimum number of chunks which need to contain a module\n  // before it's moved into the commons chunk.\n  // The number must be greater than or equal 2\n  // and lower than or equal to the number of chunks.\n  // Passing `Infinity` creates the commons chunk, but moves no modules into it.\n  // By providing a `function` you can add custom logic.\n  // (Defaults to the number of chunks)\n\n  chunks: [string],\n  // Select the source chunks by chunk names.\n  // The chunk must be a child of the commons chunk.\n  // If omitted all entry chunks are selected.\n\n  children: boolean,\n  // If `true` all children of the commons chunk are selected\n\n  deepChildren: boolean,\n  // If `true` all descendants of the commons chunk are selected\n\n  async: boolean | string,\n  // If `true` a new async commons chunk is created\n  // as child of `options.name` and sibling of `options.chunks`.\n  // It is loaded in parallel with `options.chunks`.\n  // Instead of using `option.filename`,\n  // it is possible to change the name of the output file by providing\n  // the desired string here instead of `true`.\n\n  minSize: number,\n  // Minimum size of all common module before a commons chunk is created.\n})\n"})}),"\n",(0,r.jsx)(n.h4,{id:"code-minimization",children:"Code Minimization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const CssMinimizerPlugin = require('css-minimizer-webpack-plugin')\nconst MiniCssExtractPlugin = require('mini-css-extract-plugin')\nconst TerserPlugin = require('terser-webpack-plugin')\n\nconst isEnvProduction = process.env.NODE_ENV === 'production'\nconst isEnvProductionProfile\n  = isEnvProduction && process.argv.includes('--profile')\nconst shouldUseSourceMap = process.env.GENERATE_SOURCEMAP !== 'false'\n\nmodule.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.(js|mjs|jsx|ts|tsx)$/,\n        include: path.resolve('src'),\n        use: [\n          'thread-loader',\n          {\n            loader: require.resolve('babel-loader'),\n          },\n        ],\n      },\n      {\n        test: /.s?css$/,\n        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader'],\n      },\n    ],\n  },\n  optimization: {\n    minimize: true,\n    minimizer: [\n      new TerserPlugin({\n        parallel: true,\n        terserOptions: {\n          parse: {\n            ecma: 8,\n          },\n          compress: {\n            ecma: 5,\n            warnings: false,\n            drop_console: true,\n            comparisons: false,\n            inline: 2,\n          },\n          mangle: {\n            safari10: true,\n          },\n          keep_classnames: isEnvProductionProfile,\n          keep_fnames: isEnvProductionProfile,\n          output: {\n            ecma: 5,\n            comments: false,\n            ascii_only: true,\n          },\n        },\n      }),\n      new CssMinimizerPlugin(),\n    ],\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"code-splitting",children:"Code Splitting"}),"\n",(0,r.jsx)(n.p,{children:"Huge bundle downside:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cache invalid: one line code make whole cache invalid."}),"\n",(0,r.jsxs)(n.li,{children:["Useless code: only use ",(0,r.jsx)(n.code,{children:"1/N"})," of ",(0,r.jsx)(n.code,{children:"bundle.js"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Code splitting methods:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"require.ensure([], () => {});"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["async/await ",(0,r.jsx)(n.code,{children:"import"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"React.Suspense"})," and ",(0,r.jsx)(n.code,{children:"React.lazy"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Route-based ",(0,r.jsx)(n.a,{href:"https://reactjs.org/docs/code-splitting.html#route-based-code-splitting",children:"code splitting"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"vendor.[hash].chunk.js"})," (",(0,r.jsx)(n.code,{children:"document.createElement('script')"})," promise):\nsplitting vendor and application code\nis to enable long term caching techniques\nSince vendor code tends to change less often than the actual application code,\nbrowser will be able to cache them separately,\nand won't re-download them each time the app code changes."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Split chunks configuration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["chunks:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"async: \u53ea\u63d0\u53d6\u5f02\u6b65\u52a0\u8f7d\u7684\u6a21\u5757\u51fa\u6765\u6253\u5305\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d."}),"\n",(0,r.jsx)(n.li,{children:"initial: \u63d0\u53d6\u540c\u6b65\u52a0\u8f7d\u548c\u5f02\u6b65\u52a0\u8f7d\u6a21\u5757, \u5206\u522b\u6253\u5305\u5230\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d."}),"\n",(0,r.jsx)(n.li,{children:"all: \u4e0d\u7ba1\u5f02\u6b65\u52a0\u8f7d\u8fd8\u662f\u540c\u6b65\u52a0\u8f7d\u7684\u6a21\u5757\u90fd\u63d0\u53d6\u51fa\u6765, \u6253\u5305\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"minSize: \u8d85\u8fc7 minSize \u624d\u4f1a\u88ab\u63d0\u53d6."}),"\n",(0,r.jsx)(n.li,{children:"maxSize: \u8d85\u8fc7 maxSize \u4f1a\u88ab\u8fdb\u4e00\u6b65\u5206\u5272."}),"\n",(0,r.jsx)(n.li,{children:"minChunks: \u5f15\u7528\u6b21\u6570 >= minChunks \u503c\u624d\u88ab\u63d0\u53d6."}),"\n",(0,r.jsx)(n.li,{children:"maxAsyncRequests: \u6700\u5927\u7684\u6309\u9700 (\u5f02\u6b65) \u52a0\u8f7d\u6b21\u6570 (default: 6)."}),"\n",(0,r.jsx)(n.li,{children:"maxInitialRequests: \u5165\u53e3\u6587\u4ef6\u52a0\u8f7d\u6700\u5927\u6570 (default: 4)."}),"\n",(0,r.jsx)(n.li,{children:"automaticNameDelimiter: \u6587\u4ef6\u540d\u5206\u5272\u7b26."}),"\n",(0,r.jsx)(n.li,{children:"name: chunk \u6587\u4ef6\u540d."}),"\n",(0,r.jsxs)(n.li,{children:["cacheGroups: \u914d\u7f6e\u63d0\u53d6\u6a21\u5757\u7684\u65b9\u6848, \u91cc\u9762\u6bcf\u4e00\u9879\u4ee3\u8868\u4e00\u4e2a\u63d0\u53d6\u6a21\u5757\u7684\u65b9\u6848.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"priority: \u503c\u8d8a\u5927\u4f18\u5148\u7ea7\u8d8a\u5927."}),"\n",(0,r.jsx)(n.li,{children:"test: \u5339\u914d\u6a21\u5757\u8def\u5f84\u6216\u540d\u79f0."}),"\n",(0,r.jsxs)(n.li,{children:["reuseExistingChunk: ",(0,r.jsx)(n.code,{children:"true"})," / ",(0,r.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["enforce: ",(0,r.jsx)(n.code,{children:"true"})," / ",(0,r.jsx)(n.code,{children:"false"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"module.exports = {\n  optimization: {\n    runtimeChunk: true,\n    splitChunks: {\n      chunks: 'async',\n      minSize: 30000,\n      maxSize: 200000,\n      minChunks: 1,\n      maxAsyncRequests: 6,\n      maxInitialRequests: 4,\n      automaticNameDelimiter: '-',\n      cacheGroups: {\n        vendors: {\n          name: 'chunk-vendors',\n          priority: -10,\n          chunks: 'initial',\n          test: /[\\\\/]node_modules[\\\\/]/,\n        },\n        common: {\n          name: 'chunk-common',\n          priority: -20,\n          chunks: 'initial',\n          minChunks: 2,\n          reuseExistingChunk: true,\n        },\n        element: {\n          name: 'element-ui',\n          priority: 0,\n          chunks: 'all',\n          test: /[\\\\/]element-ui[\\\\/]/,\n        },\n        api: {\n          name: 'api',\n          priority: 0,\n          test: /[\\\\/]api[\\\\/]/,\n        },\n        subApi: {\n          name: 'subApi',\n          priority: 10,\n          minChunks: 2,\n          test: /[\\\\/]api[\\\\/]subApi[\\\\/]/,\n        },\n        mixin: {\n          name: 'mixin',\n          priority: 0,\n          test: /[\\\\/]mixin[\\\\/]/,\n        },\n      },\n    },\n  },\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://web.dev/granular-chunking-nextjs",children:"Next.js granular chunking configuration"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"module.exports = {\n  optimization: {\n    splitChunks: {\n      chunks: chunk => !/^polyfills|main|pages\\/_app$/.test(chunk.name),\n      cacheGroups: {\n        framework: {\n          chunks: 'all',\n          name: 'framework',\n          test(module) {\n            const resource = module.nameForCondition?.()\n            return resource\n              ? topLevelFrameworkPaths.some(pkgPath =>\n                  resource.startsWith(pkgPath)\n                )\n              : false\n          },\n          priority: 40,\n          enforce: true,\n        },\n        lib: {\n          test(module: {\n            size: Function\n            nameForCondition: Function\n          }): boolean {\n            return (\n              module.size() > 160000\n              && /node_modules[/\\\\]/.test(module.nameForCondition() || '')\n            )\n          },\n          name(module: {\n            type: string\n            libIdent?: Function\n            updateHash: (hash: crypto.Hash) => void\n          }): string {\n            const hash = crypto.createHash('sha1')\n            if (isModuleCSS(module)) {\n              module.updateHash(hash)\n            } else {\n              if (!module.libIdent) {\n                throw new Error(\n                  `Encountered unknown module type: ${module.type}.`\n                )\n              }\n              hash.update(module.libIdent({ context: dir }))\n            }\n\n            return hash.digest('hex').substring(0, 8)\n          },\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true,\n        },\n      },\n      maxInitialRequests: 25,\n      minSize: 20000,\n    },\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"tree-shaking",children:"Tree Shaking"}),"\n",(0,r.jsxs)(n.p,{children:["Webpack tree shaking ",(0,r.jsx)(n.a,{href:"https://github.com/orgs/web-infra-dev/discussions/17",children:"includes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"usedExports"})," Optimization:\nRemove unused export variables from modules,\nthereby further eliminating related side-effect-free statements.\nIn ",(0,r.jsx)(n.code,{children:"lib.js"}),", variable ",(0,r.jsx)(n.code,{children:"b"})," is unused,\nso related code is removed from the final output."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sideEffects"})," Optimization:\nRemove modules from the module graph where export variables are not used.\nIn ",(0,r.jsx)(n.code,{children:"util.js"}),", no export variables are used and entire module are side-effect-free.\nso ",(0,r.jsx)(n.code,{children:"util.js"})," module is removed from the final output."]}),"\n",(0,r.jsxs)(n.li,{children:["DCE (Dead Code Elimination) Optimization:\nRemove dead code by by general minification tools.\nIn ",(0,r.jsx)(n.code,{children:"bootstrap.js"}),", the ",(0,r.jsx)(n.code,{children:"console.log('bad')"})," statement will not execute,\nso related code is removed from the final output."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// index.js\nimport { a } from './lib'\nimport { c } from './util'\nimport './bootstrap'\n\nconsole.log(a)\n\n// lib.js\nexport const a = 1\nexport const b = 2\n\n// util.js\nexport const c = 3\nexport const d = 4\n\n// bootstrap.js\nconsole.log('bootstrap')\n\nif (false)\n  console.log('bad')\nelse\n  console.log('good')\n"})}),"\n",(0,r.jsx)(n.p,{children:"Write tree-shakable code:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u907f\u514d\u65e0\u610f\u4e49\u7684\u8d4b\u503c."}),"\n",(0,r.jsx)(n.li,{children:"\u5c3d\u91cf\u4e0d\u5199\u5e26\u6709\u526f\u4f5c\u7528\u7684\u4ee3\u7801: \u8bf8\u5982\u7f16\u5199\u4e86\u7acb\u5373\u6267\u884c\u51fd\u6570, \u5728\u51fd\u6570\u91cc\u53c8\u4f7f\u7528\u4e86\u5916\u90e8\u53d8\u91cf\u7b49."}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679c\u5bf9 ES6 \u8bed\u4e49\u7279\u6027\u8981\u6c42\u4e0d\u662f\u7279\u522b\u4e25\u683c, \u53ef\u4ee5\u5f00\u542f babel \u7684 loose \u6a21\u5f0f etc. \u662f\u5426\u771f\u7684\u8981\u4e0d\u53ef\u679a\u4e3e class \u7684\u5c5e\u6027\n(babel \u5c06 Class \u8f6c\u5316\u4e3a ES5 \u8fc7\u7a0b\u4e2d\u4f1a\u4ea7\u751f Side Effect, \u5bfc\u81f4 Tree Shaking \u5931\u6548)."}),"\n",(0,r.jsxs)(n.li,{children:["\u7981\u6b62 Babel \u5c06\u6a21\u5757\u5bfc\u5165\u5bfc\u51fa\u8bed\u53e5\u8f6c\u8bd1\u6210 ",(0,r.jsx)(n.code,{children:"CommonJS"})," \u5f62\u5f0f.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"@babel/preset-env"}),": always ",(0,r.jsx)(n.code,{children:'{ "modules": false }'}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Babel \u4f5c\u4e3a\u7f16\u8bd1\u5668\u4e0d\u5e94\u8be5\u5904\u7406 ",(0,r.jsx)(n.code,{children:"modules"})," \u7c7b\u578b\u7684\u8f6c\u6362."]}),"\n",(0,r.jsxs)(n.li,{children:["Webpack \u8981\u4f9d\u8d56 ",(0,r.jsx)(n.code,{children:"esm"})," \u6a21\u5757\u8fdb\u884c tree shaking."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5982\u679c\u662f\u5f00\u53d1 JavaScript \u5e93, \u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"rollup"})," (ES6 module export + code flow static analysis),\n\u5e76\u4e14\u63d0\u4f9b ES6 module \u7684\u7248\u672c, \u5165\u53e3\u6587\u4ef6\u5730\u5740\u8bbe\u7f6e\u5230 ",(0,r.jsx)(n.code,{children:"package.json"})," \u7684 module \u5b57\u6bb5."]}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679c JavaScript \u5e93\u5f00\u53d1\u4e2d, \u96be\u4ee5\u907f\u514d\u7684\u4ea7\u751f\u5404\u79cd\u526f\u4f5c\u7528\u4ee3\u7801,\n\u53ef\u4ee5\u5c06\u529f\u80fd\u51fd\u6570\u6216\u8005\u7ec4\u4ef6, \u6253\u5305\u6210\u5355\u72ec\u7684\u6587\u4ef6\u6216\u76ee\u5f55, \u4ee5\u4fbf\u4e8e\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55\u53bb\u52a0\u8f7d.\n\u5982\u6709\u6761\u4ef6, \u4e5f\u53ef\u4e3a\u81ea\u5df1\u7684\u5e93\u5f00\u53d1\u5355\u72ec\u7684 webpack-loader, \u4fbf\u4e8e\u7528\u6237\u6309\u9700\u52a0\u8f7d."}),"\n",(0,r.jsxs)(n.li,{children:["\u4f18\u5316\u5bfc\u51fa\u7c92\u5ea6, \u4fdd\u6301\u5bfc\u51fa\u503c\u9897\u7c92\u5ea6\u548c\u539f\u5b50\u6027:\n",(0,r.jsx)(n.code,{children:"export { foo, bar }"})," better than ",(0,r.jsx)(n.code,{children:"export default alls"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["\u4f7f\u7528\u652f\u6301 ",(0,r.jsx)(n.code,{children:"Tree Shaking"})," \u7684\u5305: ",(0,r.jsx)(n.code,{children:"lodash-es"})," or ",(0,r.jsx)(n.code,{children:"babel-plugin-lodash"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"building-caches",children:"Building Caches"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = new HardSourceWebpackPlugin({\n  // Either an absolute path or relative to webpack options.context.\n  cacheDirectory: 'node_modules/.cache/hard-source/[confighash]',\n  // Either a string of object hash function given a webpack config.\n  configHash: (webpackConfig) => {\n    // node-object-hash on npm can be used to build this.\n    return require('node-object-hash')({ sort: false }).hash(webpackConfig)\n  },\n  // Either false, a string, an object, or a project hashing function.\n  environmentHash: {\n    root: process.cwd(),\n    directories: [],\n    files: ['package-lock.json', 'yarn.lock'],\n  },\n  // An object.\n  info: {\n    // 'none' or 'test'.\n    mode: 'none',\n    // 'debug', 'log', 'info', 'warn', or 'error'.\n    level: 'debug',\n  },\n  // Clean up large, old caches automatically.\n  cachePrune: {\n    // Caches younger than `maxAge` are not considered for deletion. They must\n    // be at least this (default: 2 days) old in milliseconds.\n    maxAge: 2 * 24 * 60 * 60 * 1000,\n    // All caches together must be larger than `sizeThreshold` before any\n    // caches will be deleted. Together they must be at least this\n    // (default: 50 MB) big in bytes.\n    sizeThreshold: 50 * 1024 * 1024,\n  },\n})\n"})}),"\n",(0,r.jsx)(n.p,{children:"Webpack 5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = {\n  cache: {\n    type: 'memory',\n  },\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const config = {\n  cache: {\n    type: 'filesystem',\n    buildDependencies: {\n      config: [__filename],\n    },\n  },\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"webpack-perf-profiling",children:"Webpack Perf Profiling"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const SpeedMeasurePlugin = require('speed-measure-webpack-plugin')\n\nconst smp = new SpeedMeasurePlugin()\n\nconst webpackConfig = smp.wrap({\n  plugins: [new MyPlugin(), new MyOtherPlugin()],\n})\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npx webpack --mode production --profile --json > stats.json\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/jakoblind/webpack-optimize-helper",children:"Optimize Helper"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/alexkuz/webpack-chart",children:"Statics Chart"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"commit-linter",children:"Commit Linter"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "husky": {\n    "hooks": {\n      "commit-msg": "commitlint -e -V",\n      "pre-commit": "lint-staged"\n    }\n  },\n  "lint-staged": {\n    "src/**/*.{js,jsx, ts, tsx}": ["eslint --fix", "git add"],\n    "src/**/*.{css, scss}": ["stylelint --fix", "git add"]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-plugins",children:"Webpack Plugins"}),"\n",(0,r.jsx)(n.h4,{id:"webpack-html-plugins",children:"Webpack HTML Plugins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/jantimon/html-webpack-plugin",children:"HTML Plugin"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"webpack-javascript-plugins",children:"Webpack JavaScript Plugins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpack-contrib/terser-webpack-plugin",children:"UglifyJS Terser Plugin"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/javascript-obfuscator/webpack-obfuscator",children:"JavaScript Obfuscator"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/aackerman/circular-dependency-plugin",children:"Circular Dependency Plugin"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/hipstersmoothie/react-docgen-typescript-plugin",children:"TypeScript React Components Properties Parser"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"webpack-css-plugins",children:"Webpack CSS Plugins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpack-contrib/mini-css-extract-plugin",children:"Mini CSS Extract Plugin"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpack-contrib/css-minimizer-webpack-plugin",children:"CSS Minimizer Plugin"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/FullHuman/purgecss",children:"CSS Tree Shaking"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"webpack-images-plugins",children:"Webpack Images Plugins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/Klathmon/imagemin-webpack-plugin",children:"ImageMin Plugin"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"webpack-building-work-plugins",children:"Webpack Building Work Plugins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpack-contrib/thread-loader",children:"Thread Loader"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/mzgoddard/hard-source-webpack-plugin",children:"Hard Source Plugin"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/stephencookdev/speed-measure-webpack-plugin",children:"Speed Measure Plugin"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpack-contrib/compression-webpack-plugin",children:"Compression Plugin"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"webpack-bundles-ui-plugins",children:"Webpack Bundles UI Plugins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpack-contrib/webpack-bundle-analyzer",children:"Bundle Analyzer"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/unjs/webpackbar",children:"WebpackBar: elegant progressbar and profiler"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/webpackmonitor/webpackmonitor",children:"Monitor"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/zouhir/jarvis",children:"Browser UI"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/FormidableLabs/webpack-dashboard",children:"CLI UI"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"webpack-dll-plugins",children:"Webpack DLL Plugins"}),"\n",(0,r.jsx)(n.p,{children:"Webpack 5 support out of box cache."}),"\n",(0,r.jsx)(n.h4,{id:"webpack-misc-plugins",children:"Webpack Misc Plugins"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"PreLoad plugin"}),"\n",(0,r.jsx)(n.li,{children:"PreFetch plugin"}),"\n",(0,r.jsx)(n.li,{children:"Define Plugin"}),"\n",(0,r.jsx)(n.li,{children:"Provide Plugin"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/survivejs/webpack-merge",children:"Webpack Merge"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"webpack-custom-plugin",children:"Webpack Custom Plugin"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"module.exports = {\n  plugins: [\n    function () {\n      this.hooks.done.tap('done', (stats) => {\n        if (\n          stats.compilation.errors\n          && stats.compilation.errors.length\n          && !process.argv.includes('--watch')\n        ) {\n          // Process build errors.\n          process.exit(1)\n        }\n      })\n    },\n  ],\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const childProcess = require('node:child_process')\nconst HtmlWebpackPlugin = require('html-webpack-plugin')\nconst branch = childProcess\n  .execSync('git rev-parse --abbrev-ref HEAD')\n  .toString()\n  .replace(/\\s+/, '')\nconst version = branch.split('/')[1]\nconst scripts = [\n  'https://cdn.bootcss.com/react-dom/16.9.0-rc.0/umd/react-dom.production.min.js',\n  'https://cdn.bootcss.com/react/16.9.0/umd/react.production.min.js',\n]\n\nclass HotLoad {\n  apply(compiler) {\n    compiler.hooks.beforeRun.tap('UpdateVersion', (compilation) => {\n      compilation.options.output.publicPath = `./${version}/`\n    })\n\n    compiler.hooks.compilation.tap('HotLoadPlugin', (compilation) => {\n      HtmlWebpackPlugin.getHooks(compilation).alterAssetTags.tapAsync(\n        'HotLoadPlugin',\n        (data, cb) => {\n          scripts.forEach(src => [\n            data.assetTags.scripts.unshift({\n              tagName: 'script',\n              voidTag: false,\n              attributes: { src },\n            }),\n          ])\n          cb(null, data)\n        }\n      )\n    })\n  }\n}\n\nmodule.exports = HotLoad\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Typed webpack plugin from ",(0,r.jsx)(n.code,{children:"laravel-mix/"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const readline = require('node:readline')\nconst chalk = require('chalk')\nconst Table = require('cli-table3')\nconst _ = require('lodash')\nconst stripAnsi = require('strip-ansi')\nconst { formatSize } = require('webpack/lib/SizeFormatHelpers')\nconst { version } = require('../../package.json')\n\n/**\n * @typedef {object} BuildOutputOptions\n * @property {boolean} clearConsole console cleared\n * @property {boolean} showRelated show related\n */\n\n/**\n * @typedef {object} StatsAsset\n * @property {string} name name\n * @property {number} size size\n * @property {StatsAsset[]|{}} related related\n */\n\n/**\n * @typedef {object} StatsData\n * @property {StatsAsset[]} assets assets\n */\n\nclass BuildOutputPlugin {\n  /**\n   *\n   * @param {BuildOutputOptions} options\n   */\n  constructor(options) {\n    this.options = options\n    this.patched = false\n  }\n\n  /**\n   * Apply the plugin.\n   *\n   * @param {import('webpack').Compiler} compiler\n   */\n  apply(compiler) {\n    if (process.env.NODE_ENV === 'test')\n      return\n\n    compiler.hooks.done.tap('BuildOutputPlugin', (stats) => {\n      if (stats.hasErrors())\n        return false\n\n      if (this.options.clearConsole)\n        this.clearConsole()\n\n      const data = stats.toJson({\n        assets: true,\n        builtAt: true,\n        hash: true,\n        performance: true,\n        relatedAssets: this.options.showRelated,\n      })\n\n      this.heading(`Laravel Mix v${version}`)\n\n      console.log(\n        chalk.green.bold(`\u2714 Compiled Successfully in ${data.time}ms`)\n      )\n\n      if (data.assets.length)\n        console.log(this.statsTable(data))\n    })\n  }\n\n  /**\n   * Print a block section heading.\n   *\n   * @param {string} text\n   */\n  heading(text) {\n    console.log()\n\n    console.log(chalk.bgBlue.white.bold(this.section(text)))\n\n    console.log()\n  }\n\n  /**\n   * Create a block section.\n   *\n   * @param {string} text\n   */\n  section(text) {\n    const padLength = 3\n    const padding = ' '.repeat(padLength)\n\n    text = `${padding}${text}${padding}`\n\n    const line = ' '.repeat(text.length)\n\n    return `${line}\\n${text}\\n${line}`\n  }\n\n  /**\n   * Generate the stats table.\n   *\n   * @param {StatsData} data\n   * @returns {string} return\n   */\n  statsTable(data) {\n    const assets = this.sortAssets(data)\n\n    const table = new Table({\n      head: [chalk.bold('File'), chalk.bold('Size')],\n      colWidths: [35],\n      colAligns: ['right'],\n      style: {\n        head: [],\n        compact: true,\n      },\n    })\n\n    for (const asset of assets)\n      table.push([chalk.green(asset.name), formatSize(asset.size)])\n\n    this.extendTableWidth(table)\n    this.monkeyPatchTruncate()\n\n    return table.toString()\n  }\n\n  /**\n   *\n   * @param {StatsData} data\n   */\n  sortAssets(data) {\n    let assets = data.assets\n\n    assets = _.flatMap(assets, asset => [\n      asset,\n      ...(Array.isArray(asset.related) ? asset.related : []),\n    ])\n\n    assets = _.orderBy(assets, ['name', 'size'], ['asc', 'asc'])\n\n    return assets\n  }\n\n  /**\n   * Clear the entire screen.\n   */\n  clearConsole() {\n    const blank = '\\n'.repeat(process.stdout.rows)\n    console.log(blank)\n\n    readline.cursorTo(process.stdout, 0, 0)\n    readline.clearScreenDown(process.stdout)\n  }\n\n  /**\n   * Extend the width of the table\n   *\n   * Currently only increases the file column size\n   *\n   * @param {import('cli-table3').Table} table\n   * @param {number|null} targetWidth\n   * @param {number} maxWidth\n   */\n  extendTableWidth(\n    table,\n    targetWidth = null,\n    maxWidth = Number.POSITIVE_INFINITY\n  ) {\n    targetWidth = targetWidth === null ? process.stdout.columns : targetWidth\n\n    if (!targetWidth)\n      return\n\n    const tableWidth = this.calculateTableWidth(table)\n    const fileColIncrease = Math.min(\n      targetWidth - tableWidth,\n      maxWidth - tableWidth\n    )\n\n    if (fileColIncrease <= 0)\n      return\n\n    // @ts-expect-error Should error\n    table.options.colWidths[0] += fileColIncrease\n  }\n\n  monkeyPatchTruncate() {\n    if (this.patched)\n      return\n\n    this.patched = true\n\n    // @ts-expect-error Should error\n    const utils = require('cli-table3/src/utils')\n    const oldTruncate = utils.truncate\n\n    /**\n     *\n     * @param {string} str\n     * @param {number} desiredLength\n     * @param {string} truncateChar\n     */\n    utils.truncate = (str, desiredLength, truncateChar) => {\n      if (stripAnsi(str).length > desiredLength)\n        str = `\u2026${str.substr(-desiredLength + 2)}`\n\n      return oldTruncate(str, desiredLength, truncateChar)\n    }\n  }\n\n  /**\n   * Calculate the width of the CLI Table\n   *\n   * `table.width` does not report the correct width\n   * because it includes ANSI control characters\n   *\n   * @internal\n   * @param {import('cli-table3').Table} table\n   */\n  calculateTableWidth(table) {\n    const firstRow = table.toString().split('\\n')[0]\n\n    return stripAnsi(firstRow).length\n  }\n}\n\nmodule.exports = BuildOutputPlugin\n"})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-migrate-to-5",children:"Webpack Migrate to 5"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://webpack.js.org/migrate/5",children:"Migrate 5 Guide"}),":"]}),"\n",(0,r.jsx)(n.p,{children:"Make sure there's no webpack deprecation warnings."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"node --trace-deprecation node_modules/webpack/bin/webpack.js\n"})}),"\n",(0,r.jsx)(n.h3,{id:"webpack-reference",children:"Webpack Reference"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://nystudio107.com/blog/an-annotated-webpack-4-config-for-frontend-web-development",children:"Webpack 4 Tutorial"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://juejin.cn/post/6870055445034172424",children:"Custom Plugin"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"rollup",children:"Rollup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import commonjs from '@rollup/plugin-commonjs'\nimport resolve from '@rollup/plugin-node-resolve'\nimport typescript from '@rollup/plugin-typescript'\nimport { defineConfig } from 'rollup'\nimport dts from 'rollup-plugin-dts'\nimport external from 'rollup-plugin-peer-deps-external'\nimport postcss from 'rollup-plugin-postcss'\nimport { terser } from 'rollup-plugin-terser'\nimport pkg from './package.json'\n\nexport default defineConfig([\n  {\n    input: 'src/index.ts',\n    output: [\n      {\n        file: pkg.main,\n        format: 'cjs',\n        sourcemap: true,\n        name: 'react-lib',\n      },\n      {\n        file: pkg.module,\n        format: 'esm',\n        sourcemap: true,\n      },\n    ],\n    plugins: [\n      external(),\n      resolve(),\n      commonjs(),\n      typescript({ tsconfig: './tsconfig.json' }),\n      postcss(),\n      terser(),\n    ],\n  },\n  {\n    input: 'dist/esm/types/index.d.ts',\n    output: [{ file: 'dist/index.d.ts', format: 'esm' }],\n    external: [/\\.css$/],\n    plugins: [dts()],\n  },\n])\n"})}),"\n",(0,r.jsx)(n.h2,{id:"vite",children:"Vite"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://vitejs.dev/guide/why.html",children:"Unbundled development"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"import path from 'node:path'\nimport react from '@vitejs/plugin-react'\nimport { defineConfig } from 'vite'\nimport dts from 'vite-plugin-dts'\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    dts({\n      insertTypesEntry: true,\n    }),\n  ],\n  build: {\n    lib: {\n      entry: path.resolve(__dirname, 'src/lib/index.ts'),\n      name: 'SafeView',\n      formats: ['es', 'umd'],\n      fileName: format => `SafeView.${format}.js`,\n    },\n    rollupOptions: {\n      external: ['react', 'react-dom'],\n      output: {\n        globals: {\n          'react': 'React',\n          'react-dom': 'ReactDOM',\n        },\n      },\n    },\n    minify: true,\n    sourcemap: true,\n  },\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"esbuild",children:"ESBuild"}),"\n",(0,r.jsx)(n.p,{children:"ESBuild build configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// build.js\nconst esbuild = require('esbuild')\nconst inlineImage = require('esbuild-plugin-inline-image')\n\nesbuild\n  .build({\n    entryPoints: ['./src/index.js'],\n    outfile: './public/js/app.js',\n    minify: true,\n    bundle: true,\n    loader: {\n      '.js': 'jsx',\n    },\n    plugins: [inlineImage()],\n  })\n  .catch(() => process.exit(1))\n"})}),"\n",(0,r.jsx)(n.p,{children:"ESBuild serve configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// serve.js\nconst esbuild = require('esbuild')\nconst inlineImage = require('esbuild-plugin-inline-image')\n\nesbuild\n  .serve(\n    {\n      servedir: 'public',\n      port: 8000,\n    },\n    {\n      entryPoints: ['./src/index.js'],\n      outfile: './public/js/app.js',\n      bundle: true,\n      loader: {\n        '.js': 'jsx',\n      },\n      plugins: [inlineImage()],\n    }\n  )\n  .catch(() => process.exit())\n"})}),"\n",(0,r.jsx)(n.p,{children:"ESBuild webpack configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const { ESBuildMinifyPlugin } = require('esbuild-loader')\n\nmodule.exports = {\n  rules: [\n    {\n      test: /.js$/,\n      loader: 'esbuild-loader',\n      options: {\n        loader: 'jsx',\n        target: 'es2015',\n      },\n    },\n  ],\n  optimization: {\n    minimizer: [\n      new ESBuildMinifyPlugin({\n        target: 'es2015',\n      }),\n    ],\n  },\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},3574:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/HotModuleReplacement-82f47dbe6965841b8749d4bd4e96c869.jpg"},5958:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/JSONWebToken-d1234ab99ba4c5daa5bb1c2b06aa77d5.jpg"},2644:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/RenderingPatterns-ab7b4fd4c4291369b4701b45e19516bd.png"},3477:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ServerSideRendering-fc978d9129203d94372e9f0895fd33a7.png"},7563:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/ServiceWorkerCache-1a97150573c7890e205fa561615e88b1.webp"},2128:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/SessionCookie-abfd9ea3ff9c710885509477f678b504.jpg"},7671:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/WebpackWorkflow-ee67ac3ad9501be2751c5a180b3ee80b.png"},842:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(8101);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);