"use strict";(self.webpackChunkawesome_notes=self.webpackChunkawesome_notes||[]).push([[2295],{5760:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Web/JavaScript/JavaScriptAdvancedNotes","title":"JavaScript Advanced Notes","description":"Iterator","source":"@site/notes/Web/JavaScript/JavaScriptAdvancedNotes.md","sourceDirName":"Web/JavaScript","slug":"/Web/JavaScript/JavaScriptAdvancedNotes","permalink":"/awesome-notes/Web/JavaScript/JavaScriptAdvancedNotes","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/awesome-notes/edit/main/notes/Web/JavaScript/JavaScriptAdvancedNotes.md","tags":[{"inline":true,"label":"Web","permalink":"/awesome-notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/awesome-notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/awesome-notes/tags/ecma-script"}],"version":"current","lastUpdatedBy":"renovate[bot]","lastUpdatedAt":1732127335000,"frontMatter":{"author":"Sabertazimi","authorTitle":"Web Developer","authorURL":"https://github.com/sabertazimi","authorImageURL":"https://github.com/sabertazimi.png","tags":["Web","JavaScript","ECMAScript"]},"sidebar":"tutorialSidebar","previous":{"title":"JavaScript API Notes","permalink":"/awesome-notes/Web/JavaScript/JavaScriptAPINotes"},"next":{"title":"JavaScript Basic Notes","permalink":"/awesome-notes/Web/JavaScript/JavaScriptBasicNotes"}}');var t=r(5105),l=r(842);const i={author:"Sabertazimi",authorTitle:"Web Developer",authorURL:"https://github.com/sabertazimi",authorImageURL:"https://github.com/sabertazimi.png",tags:["Web","JavaScript","ECMAScript"]},o="JavaScript Advanced Notes",c={},a=[{value:"Iterator",id:"iterator",level:2},{value:"Iteration Protocol",id:"iteration-protocol",level:3},{value:"Synchronous Iterator",id:"synchronous-iterator",level:3},{value:"Iterable Object",id:"iterable-object",level:4},{value:"Iterable Class",id:"iterable-class",level:4},{value:"Class Iterator",id:"class-iterator",level:4},{value:"Asynchronous Iterator",id:"asynchronous-iterator",level:3},{value:"Closable Iterator",id:"closable-iterator",level:3},{value:"Generator",id:"generator",level:2},{value:"Generator Definition",id:"generator-definition",level:3},{value:"Generator Roles",id:"generator-roles",level:3},{value:"Generator Basic Usage",id:"generator-basic-usage",level:3},{value:"Default Iterator Generator",id:"default-iterator-generator",level:4},{value:"Early Return Generator",id:"early-return-generator",level:4},{value:"Error Handling Generator",id:"error-handling-generator",level:4},{value:"Generator Advanced Usage",id:"generator-advanced-usage",level:3},{value:"Next Value Generator",id:"next-value-generator",level:4},{value:"Default Asynchronous Iterator Generator",id:"default-asynchronous-iterator-generator",level:4},{value:"Asynchronous Generator",id:"asynchronous-generator",level:4},{value:"Asynchronous Events Stream",id:"asynchronous-events-stream",level:4},{value:"Delegating Generator",id:"delegating-generator",level:4},{value:"Recursive Generator",id:"recursive-generator",level:4},{value:"Promise",id:"promise",level:2},{value:"Promise Resolve",id:"promise-resolve",level:3},{value:"Promise Reject",id:"promise-reject",level:3},{value:"Promise Catch",id:"promise-catch",level:3},{value:"Promise Finally",id:"promise-finally",level:3},{value:"Promise Thenable and Catch",id:"promise-thenable-and-catch",level:3},{value:"Promise Chain",id:"promise-chain",level:3},{value:"Promise Combinator Array Functions",id:"promise-combinator-array-functions",level:3},{value:"Promise Polyfill",id:"promise-polyfill",level:3},{value:"Memorize Async Function",id:"memorize-async-function",level:3},{value:"Async and Await",id:"async-and-await",level:2},{value:"Await Features",id:"await-features",level:3},{value:"Await Arrays",id:"await-arrays",level:3},{value:"Asynchronous JavaScript",id:"asynchronous-javascript",level:2},{value:"Sleep Function",id:"sleep-function",level:3},{value:"Race Condition",id:"race-condition",level:3},{value:"Web Worker",id:"web-worker",level:3},{value:"Web Worker Runtime",id:"web-worker-runtime",level:4},{value:"Web Worker Basic Usage",id:"web-worker-basic-usage",level:4},{value:"Web Worker Pool",id:"web-worker-pool",level:4},{value:"Web Worker Performance",id:"web-worker-performance",level:4},{value:"Abort Controller",id:"abort-controller",level:3},{value:"Abort Fetching",id:"abort-fetching",level:4},{value:"Abort Promise",id:"abort-promise",level:4},{value:"Abort Controller Helpers",id:"abort-controller-helpers",level:4},{value:"Asynchronous API Comparison",id:"asynchronous-api-comparison",level:3},{value:"Module",id:"module",level:2},{value:"CRUST Principles",id:"crust-principles",level:3},{value:"Namespace Module Pattern",id:"namespace-module-pattern",level:3},{value:"Namespace Module Constructor",id:"namespace-module-constructor",level:4},{value:"Namespace Module Usage",id:"namespace-module-usage",level:4},{value:"Sandbox Module Pattern",id:"sandbox-module-pattern",level:3},{value:"Sandbox Module Constructor",id:"sandbox-module-constructor",level:4},{value:"Sandbox Module Usage",id:"sandbox-module-usage",level:4},{value:"CommonJS Pattern",id:"commonjs-pattern",level:3},{value:"AMD Pattern",id:"amd-pattern",level:3},{value:"UMD Pattern",id:"umd-pattern",level:3},{value:"ES6 Module",id:"es6-module",level:3},{value:"ES6 Module Features",id:"es6-module-features",level:4},{value:"ES6 Module Syntax",id:"es6-module-syntax",level:4},{value:"ES6 Module Imports",id:"es6-module-imports",level:4},{value:"ES6 Module Exports",id:"es6-module-exports",level:4},{value:"Proxy and Reflect",id:"proxy-and-reflect",level:2},{value:"Proxy",id:"proxy",level:3},{value:"Reflect",id:"reflect",level:3},{value:"Proxy Usage",id:"proxy-usage",level:3},{value:"Default Zero Value Protection",id:"default-zero-value-protection",level:4},{value:"Hiding Properties Protection",id:"hiding-properties-protection",level:4},{value:"Read Only Object Protection",id:"read-only-object-protection",level:4},{value:"Range Validation",id:"range-validation",level:4},{value:"Property Validation",id:"property-validation",level:4},{value:"Function Parameter Validation",id:"function-parameter-validation",level:4},{value:"Constructor Parameter Validation",id:"constructor-parameter-validation",level:4},{value:"Negative Array Indices Protection",id:"negative-array-indices-protection",level:4},{value:"Array Manipulation Protection",id:"array-manipulation-protection",level:4},{value:"Exception Protection",id:"exception-protection",level:4},{value:"Proxy Pattern Implementation",id:"proxy-pattern-implementation",level:4},{value:"Proxy and DefineProperty",id:"proxy-and-defineproperty",level:3},{value:"Error and Exception",id:"error-and-exception",level:2},{value:"Error",id:"error",level:3},{value:"Error Type",id:"error-type",level:4},{value:"Error Object",id:"error-object",level:4},{value:"Exception",id:"exception",level:3},{value:"Call Stack Overflow",id:"call-stack-overflow",level:4},{value:"Exception Handling",id:"exception-handling",level:4},{value:"Regular Expression",id:"regular-expression",level:2},{value:"RegExp Flags",id:"regexp-flags",level:3},{value:"RegExp Character Classes",id:"regexp-character-classes",level:3},{value:"RegExp Quantifiers",id:"regexp-quantifiers",level:3},{value:"RegExp Group and Ranges",id:"regexp-group-and-ranges",level:3},{value:"RegExp Back Reference",id:"regexp-back-reference",level:3},{value:"RegExp Functions",id:"regexp-functions",level:3},{value:"RegExp Test",id:"regexp-test",level:4},{value:"RexExp Exec",id:"rexexp-exec",level:4},{value:"RegExp Replace",id:"regexp-replace",level:4},{value:"RegExp Replace Arguments",id:"regexp-replace-arguments",level:5},{value:"RegExp Replace Performance",id:"regexp-replace-performance",level:5},{value:"RegExp Best Practice",id:"regexp-best-practice",level:3},{value:"RegExp Use Case",id:"regexp-use-case",level:3},{value:"Common Pattern",id:"common-pattern",level:4},{value:"\u4e2d\u82f1\u6587",id:"\u4e2d\u82f1\u6587",level:4},{value:"\u6570\u5b57",id:"\u6570\u5b57",level:4},{value:"\u7a7a\u5b57\u7b26\u4e0e\u7a7a\u683c\u5b57\u7b26",id:"\u7a7a\u5b57\u7b26\u4e0e\u7a7a\u683c\u5b57\u7b26",level:4},{value:"Markdown Table",id:"markdown-table",level:4},{value:"Strict Mode",id:"strict-mode",level:2},{value:"Timer",id:"timer",level:2},{value:"Math",id:"math",level:2},{value:"Atomics",id:"atomics",level:2},{value:"Signals",id:"signals",level:2},{value:"URI and URL",id:"uri-and-url",level:2},{value:"Encoding and Decoding",id:"encoding-and-decoding",level:2},{value:"Web Stream",id:"web-stream",level:2},{value:"Internationalization",id:"internationalization",level:2},{value:"Number i18n",id:"number-i18n",level:3},{value:"String i18n",id:"string-i18n",level:3},{value:"Time i18n",id:"time-i18n",level:3},{value:"Functional JavaScript",id:"functional-javascript",level:2},{value:"Functional JavaScript Pros",id:"functional-javascript-pros",level:3},{value:"Functional JavaScript Cons",id:"functional-javascript-cons",level:3},{value:"Partial Application",id:"partial-application",level:3},{value:"Currying",id:"currying",level:3},{value:"Compose",id:"compose",level:3},{value:"Flow",id:"flow",level:3},{value:"Pipe",id:"pipe",level:3},{value:"Immutable",id:"immutable",level:3},{value:"Immutable Array",id:"immutable-array",level:4},{value:"Immutable Map",id:"immutable-map",level:4},{value:"Immutable Class",id:"immutable-class",level:4},{value:"Lodash",id:"lodash",level:3},{value:"RxJS",id:"rxjs",level:3},{value:"Stream",id:"stream",level:4},{value:"Observable",id:"observable",level:4},{value:"JavaScript Style Guide",id:"javascript-style-guide",level:2},{value:"ESLint",id:"eslint",level:3},{value:"Naming Style",id:"naming-style",level:3},{value:"Variable Style",id:"variable-style",level:3},{value:"Object Style",id:"object-style",level:3},{value:"Array Style",id:"array-style",level:3},{value:"Destruct Style",id:"destruct-style",level:3},{value:"String Style",id:"string-style",level:3},{value:"Function Style",id:"function-style",level:3},{value:"Arrow Function Style",id:"arrow-function-style",level:3},{value:"Module Style",id:"module-style",level:3},{value:"Iterator and Generator Style",id:"iterator-and-generator-style",level:3},{value:"Expression Style",id:"expression-style",level:3},{value:"Space Style",id:"space-style",level:3},{value:"Comments Style",id:"comments-style",level:3},{value:"JavaScript Engine",id:"javascript-engine",level:2},{value:"Variables Lifecycle",id:"variables-lifecycle",level:3},{value:"Execution Context",id:"execution-context",level:3},{value:"Global Execution Context",id:"global-execution-context",level:4},{value:"Function Execution Context",id:"function-execution-context",level:4},{value:"Event Loop",id:"event-loop",level:3},{value:"Browser Event Loop",id:"browser-event-loop",level:4},{value:"Node Event Loop",id:"node-event-loop",level:4},{value:"V8",id:"v8",level:3},{value:"V8 Object Shape",id:"v8-object-shape",level:4},{value:"V8 Inline Cache",id:"v8-inline-cache",level:4},{value:"V8 Object Structure",id:"v8-object-structure",level:4},{value:"V8 Garbage Collection",id:"v8-garbage-collection",level:4},{value:"V8 Scavenge GC Algorithm",id:"v8-scavenge-gc-algorithm",level:4},{value:"V8 Mark-Sweep-Compact GC Algorithm",id:"v8-mark-sweep-compact-gc-algorithm",level:4},{value:"V8 GC Stop-The-World",id:"v8-gc-stop-the-world",level:4},{value:"V8 Performance Tools",id:"v8-performance-tools",level:4},{value:"Browser Engine",id:"browser-engine",level:2},{value:"Browser Process Architecture",id:"browser-process-architecture",level:3},{value:"Chromium Rendering Engine",id:"chromium-rendering-engine",level:3},{value:"RenderingNG Architecture",id:"renderingng-architecture",level:4},{value:"RenderingNG Pipeline",id:"renderingng-pipeline",level:4},{value:"RenderingNG Render Process",id:"renderingng-render-process",level:4},{value:"RenderingNG HTML Parser",id:"renderingng-html-parser",level:4},{value:"RenderingNG CSS Parser",id:"renderingng-css-parser",level:4},{value:"RenderingNG Layout Engine",id:"renderingng-layout-engine",level:4},{value:"RenderingNG Paint Engine",id:"renderingng-paint-engine",level:4},{value:"RenderingNG Video Engine",id:"renderingng-video-engine",level:4},{value:"RenderingNG Scrolling Performance",id:"renderingng-scrolling-performance",level:4},{value:"RenderingNG Animation Performance",id:"renderingng-animation-performance",level:4},{value:"Browser Engine Reference",id:"browser-engine-reference",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"javascript-advanced-notes",children:"JavaScript Advanced Notes"})}),"\n",(0,t.jsx)(n.h2,{id:"iterator",children:"Iterator"}),"\n",(0,t.jsx)(n.h3,{id:"iteration-protocol",children:"Iteration Protocol"}),"\n",(0,t.jsxs)(n.p,{children:["Iteration ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Iteration_protocols",children:"protocol"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u53ea\u8981\u5b9e\u73b0\u4e86 ",(0,t.jsx)(n.code,{children:"[Symbol.iterator]()"})," \u63a5\u53e3, \u4fbf\u53ef\u6210\u4e3a\u53ef\u8fed\u4ee3\u6570\u636e\u7ed3\u6784 (",(0,t.jsx)(n.code,{children:"Iterable"}),"):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["String: ",(0,t.jsx)(n.code,{children:"StringIterator"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Array: ",(0,t.jsx)(n.code,{children:"ArrayIterator"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Map: ",(0,t.jsx)(n.code,{children:"MapIterator"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Set: ",(0,t.jsx)(n.code,{children:"SetIterator"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"arguments"})," \u5bf9\u8c61."]}),"\n",(0,t.jsxs)(n.li,{children:["DOM collection (",(0,t.jsx)(n.code,{children:"NodeList"}),"): ",(0,t.jsx)(n.code,{children:"ArrayIterator"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u63a5\u6536\u53ef\u8fed\u4ee3\u5bf9\u8c61\u7684\u539f\u751f\u8bed\u8a00\u7279\u6027:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"for...in"}),"/",(0,t.jsx)(n.code,{children:"for...of"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Destructing: \u6570\u7ec4\u89e3\u6784."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"..."}),": \u6269\u5c55\u64cd\u4f5c\u7b26 (",(0,t.jsx)(n.code,{children:"Spread Operator"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Array.from()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"new Map()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"new Set()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.all()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.race()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"yield *"})," \u64cd\u4f5c\u7b26."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"for...in"}),"/",(0,t.jsx)(n.code,{children:"for...of"})," \u9690\u5f62\u8c03\u7528\u8fed\u4ee3\u5668\u7684\u65b9\u5f0f, \u79f0\u4e3a\u5185\u90e8\u8fed\u4ee3\u5668, \u4f7f\u7528\u65b9\u4fbf, \u4e0d\u53ef\u81ea\u5b9a\u4e49\u8fed\u4ee3\u8fc7\u7a0b."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"{ next, done, value }"})," \u663e\u5f0f\u8c03\u7528\u8fed\u4ee3\u5668\u7684\u65b9\u5f0f, \u79f0\u4e3a\u5916\u90e8\u8fed\u4ee3\u5668, \u4f7f\u7528\u590d\u6742, \u53ef\u4ee5\u81ea\u5b9a\u4e49\u8fed\u4ee3\u8fc7\u7a0b."]}),"\n",(0,t.jsxs)(n.li,{children:["All built-in ES6 iterators are ",(0,t.jsx)(n.code,{children:"Self Iterable Iterator"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface Iterable<T> {\n  [Symbol.iterator]: () => Iterator<T>\n}\n\ninterface Iterator<T> {\n  next: (...args: []) => IteratorResult<T>\n  return?: (value?: T) => IteratorResult<T> // Closable iterator\n  throw?: (e?: any) => IteratorResult<T>\n}\n\ninterface IterableIterator<T> extends Iterator<T> {\n  [Symbol.iterator]: () => IterableIterator<T>\n}\n\ninterface AsyncIterable<T> {\n  [Symbol.asyncIterator]: () => AsyncIterator<T>\n}\n\ninterface AsyncIterator<T> {\n  next: (...args: []) => Promise<IteratorResult<T>>\n  throw?: (e?: any) => Promise<IteratorResult<T>>\n  // Closable iterator\n  return?: (value?: T | PromiseLike<T>) => Promise<IteratorResult<T>>\n}\n\ninterface AsyncIterableIterator<T> extends AsyncIterator<T> {\n  [Symbol.asyncIterator]: () => AsyncIterableIterator<T>\n}\n\ninterface IteratorResult<T> {\n  done: boolean\n  value: T\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"synchronous-iterator",children:"Synchronous Iterator"}),"\n",(0,t.jsx)(n.h4,{id:"iterable-object",children:"Iterable Object"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function methodsIterator() {\n  let index = 0\n  const methods = Object.keys(this)\n    .filter((key) => {\n      return typeof this[key] === 'function'\n    })\n    .map(key => this[key])\n\n  // iterator object\n  return {\n    next: () => ({\n      // Conform to Iterator protocol\n      done: index >= methods.length,\n      value: methods[index++],\n    }),\n  }\n}\n\nconst myMethods = {\n  toString() {\n    return '[object myMethods]'\n  },\n  sumNumbers(a, b) {\n    return a + b\n  },\n  numbers: [1, 5, 6],\n  [Symbol.iterator]: methodsIterator, // Conform to Iterable Protocol\n}\n\nfor (const method of myMethods)\n  console.log(method) // logs methods `toString` and `sumNumbers`\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function zip(...iterables) {\n  const iterators = iterables.map(i => i[Symbol.iterator]())\n  let done = false\n\n  return {\n    [Symbol.iterator]() {\n      return this\n    },\n    next() {\n      if (!done) {\n        const items = iterators.map(i => i.next())\n        done = items.some(item => item.done)\n\n        if (!done)\n          return { value: items.map(i => i.value) }\n\n        // Done for the first time: close all iterators\n        for (const iterator of iterators) {\n          if (typeof iterator.return === 'function')\n            iterator.return()\n        }\n      }\n\n      // We are done\n      return { done: true }\n    },\n  }\n}\n\nconst zipped = zip(['a', 'b', 'c'], ['d', 'e', 'f', 'g'])\n\nfor (const x of zipped)\n  console.log(x)\n\n// Output:\n// ['a', 'd']\n// ['b', 'e']\n// ['c', 'f']\n"})}),"\n",(0,t.jsx)(n.h4,{id:"iterable-class",children:"Iterable Class"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class Counter {\n  constructor(limit) {\n    this.limit = limit\n  }\n\n  [Symbol.iterator]() {\n    let count = 1\n    const limit = this.limit\n\n    return {\n      next() {\n        if (count <= limit)\n          return { done: false, value: count++ }\n        else\n          return { done: true }\n      },\n      return() {\n        console.log('Exiting early')\n        return { done: true }\n      },\n    }\n  }\n}\n\nconst counter1 = new Counter(5)\nfor (const i of counter1) {\n  if (i > 2)\n    break\n\n  console.log(i)\n}\n// 1\n// 2\n// Exiting early\n\nconst counter2 = new Counter(5)\ntry {\n  for (const i of counter2) {\n    if (i > 2)\n      throw new Error('err')\n\n    console.log(i)\n  }\n} catch (e) {}\n// 1\n// 2\n// Exiting early\n\nconst counter3 = new Counter(5)\nconst [a, b] = counter3\n// Exiting early\n"})}),"\n",(0,t.jsx)(n.h4,{id:"class-iterator",children:"Class Iterator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Class Iterator:\nclass MatrixIterator {\n  constructor(matrix) {\n    this.x = 0\n    this.y = 0\n    this.matrix = matrix\n  }\n\n  next() {\n    if (this.y === this.matrix.height)\n      return { done: true }\n\n    const value = {\n      x: this.x,\n      y: this.y,\n      value: this.matrix.get(this.x, this.y),\n    }\n\n    this.x++\n\n    if (this.x === this.matrix.width) {\n      this.x = 0\n      this.y++\n    }\n\n    return { value, done: false }\n  }\n}\n\n// Iterable Class:\nclass Matrix {\n  constructor(width, height, element = (x, y) => undefined) {\n    this.width = width\n    this.height = height\n    this.content = []\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++)\n        this.content[y * width + x] = element(x, y)\n    }\n  }\n\n  get(x, y) {\n    return this.content[y * this.width + x]\n  }\n\n  set(x, y, value) {\n    this.content[y * this.width + x] = value\n  }\n\n  [Symbol.iterator]() {\n    return new MatrixIterator(this)\n  }\n}\n\nconst matrix = new Matrix(2, 2, (x, y) => `value ${x},${y}`)\n\nfor (const { x, y, value } of matrix)\n  console.log(x, y, value)\n\n// \u2192 0 0 value 0, 0\n// \u2192 1 0 value 1, 0\n// \u2192 0 1 value 0, 1\n// \u2192 1 1 value 1, 1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"asynchronous-iterator",children:"Asynchronous Iterator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const AsyncIterable = {\n  [Symbol.asyncIterator]() {\n    return AsyncIterator\n  },\n}\n\nconst AsyncIterator = {\n  next() {\n    return Promise.resolve(IteratorResult)\n  },\n  return() {\n    return Promise.resolve(IteratorResult)\n  },\n  throw(e) {\n    return Promise.reject(e)\n  },\n}\n\nconst IteratorResult = {\n  value: any,\n  done: boolean,\n}\n\n// Tasks will chained:\nait\n  .next()\n  .then(({ value, done }) => ait.next())\n  .then(({ value, done }) => ait.next())\n  .then(({ done }) => done)\n\n// Tasks will run in parallel:\nait.next().then()\nait.next().then()\nait.next().then()\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function remotePostsAsyncIteratorsFactory() {\n  let i = 1\n  let done = false\n\n  const asyncIterableIterator = {\n    // the next method will always return a Promise\n    async next() {\n      // do nothing if we went out-of-bounds\n      if (done) {\n        return Promise.resolve({\n          done: true,\n          value: undefined,\n        })\n      }\n\n      const res = await fetch(\n        `https://jsonplaceholder.typicode.com/posts/${i++}`\n      ).then(r => r.json())\n\n      // the posts source is ended\n      if (Object.keys(res).length === 0) {\n        done = true\n        return Promise.resolve({\n          done: true,\n          value: undefined,\n        })\n      } else {\n        return Promise.resolve({\n          done: false,\n          value: res,\n        })\n      }\n    },\n    [Symbol.asyncIterator]() {\n      return this\n    },\n  }\n\n  return asyncIterableIterator\n}\n\n;(async () => {\n  const ait = remotePostsAsyncIteratorsFactory()\n\n  await ait.next() // { done:false, value:{id: 1, ...} }\n  await ait.next() // { done:false, value:{id: 2, ...} }\n  await ait.next() // { done:false, value:{id: 3, ...} }\n  // ...\n  await ait.next() // { done:false, value:{id: 100, ...} }\n  await ait.next() // { done:true, value:undefined }\n})()\n"})}),"\n",(0,t.jsx)(n.h3,{id:"closable-iterator",children:"Closable Iterator"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["An iterator is closable if it has a method ",(0,t.jsx)(n.code,{children:"return()"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface ClosableIterator {\n  next: () => IteratorResult\n  return: (value?: any) => IteratorResult\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Not all iterators are closable: e.g ",(0,t.jsx)(n.code,{children:"Array Iterator"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const iterable = ['a', 'b', 'c']\nconst iterator = iterable[Symbol.iterator]()\nconsole.log('return' in iterator)\n// => false\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If an iterator is not closable,\nyou can continue iterating over it after an abrupt exit."}),"\n",(0,t.jsx)(n.li,{children:"If an iterator is closable,\nyou can't continue iterating over it after an abrupt exit."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* elements() {\n  yield 'a'\n  yield 'b'\n  yield 'c'\n}\n\nfunction twoLoops(iterator) {\n  // eslint-disable-next-line no-unreachable-loop\n  for (const x of iterator) {\n    console.log(x)\n    break\n  }\n\n  for (const x of iterator)\n    console.log(x)\n}\n\nclass PreventReturn {\n  constructor(iterator) {\n    this.iterator = iterator\n  }\n\n  [Symbol.iterator]() {\n    return this\n  }\n\n  next() {\n    return this.iterator.next()\n  }\n\n  return(value = undefined) {\n    return { done: false, value }\n  }\n}\n\ntwoLoops(elements())\n// Output:\n// a\n\ntwoLoops(new PreventReturn(elements()))\n// Output:\n// a\n// b\n// c\n\ntwoLoops(['a', 'b', 'c'][Symbol.iterator]())\n// Output:\n// a\n// b\n// c\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Manually call ",(0,t.jsx)(n.code,{children:"iterator.return()"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function take(n, iterable) {\n  const iter = iterable[Symbol.iterator]()\n\n  return {\n    [Symbol.iterator]() {\n      return this\n    },\n    next() {\n      if (n > 0) {\n        n--\n        return iter.next()\n      } else {\n        iter?.return()\n        return { done: true }\n      }\n    },\n    return() {\n      n = 0\n      iter?.return()\n    },\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"generator",children:"Generator"}),"\n",(0,t.jsx)(n.h3,{id:"generator-definition",children:"Generator Definition"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u51fd\u6570\u540d\u79f0\u524d\u9762\u52a0\u4e00\u4e2a\u661f\u53f7 (",(0,t.jsx)(n.code,{children:"*"}),") \u8868\u793a\u5b83\u662f\u4e00\u4e2a\u751f\u6210\u5668\u51fd\u6570."]}),"\n",(0,t.jsx)(n.li,{children:"\u7bad\u5934\u51fd\u6570\u4e0d\u80fd\u7528\u6765\u5b9a\u4e49\u751f\u6210\u5668\u51fd\u6570."}),"\n",(0,t.jsxs)(n.li,{children:["\u8c03\u7528\u751f\u6210\u5668\u51fd\u6570\u4f1a\u4ea7\u751f\u4e00\u4e2a\u751f\u6210\u5668\u5bf9\u8c61, \u5176\u662f\u4e00\u4e2a",(0,t.jsx)(n.strong,{children:"\u81ea\u5f15\u7528\u53ef\u8fed\u4ee3\u5bf9\u8c61"}),":\n\u5176\u672c\u8eab\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668, \u540c\u65f6\u5b9e\u73b0\u4e86 ",(0,t.jsx)(n.code,{children:"Iterable"})," \u63a5\u53e3 (\u8fd4\u56de ",(0,t.jsx)(n.code,{children:"this"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface GeneratorFunction {\n  (...args: any[]): Generator\n  readonly length: number\n  readonly name: string\n  readonly prototype: Generator\n}\n\ninterface Generator<T> extends Iterator<T> {\n  next: (...args: []) => IteratorResult<T>\n  return: (value: T) => IteratorResult<T> // Required\n  throw: (e: any) => IteratorResult<T> // Required\n  [Symbol.iterator]: () => Generator<T>\n}\n\ninterface AsyncGeneratorFunction {\n  (...args: any[]): AsyncGenerator\n  readonly length: number\n  readonly name: string\n  readonly prototype: AsyncGenerator\n}\n\ninterface AsyncGenerator<T> extends AsyncIterator<T> {\n  next: (...args: []) => Promise<IteratorResult<T>>\n  return: (value: T | PromiseLike<T>) => Promise<IteratorResult<T>> // Required\n  throw: (e: any) => Promise<IteratorResult<T>> // Required\n  [Symbol.asyncIterator]: () => AsyncGenerator<T>\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* generatorFn() {}\nconsole.log(generatorFn)\n// f* generatorFn() {}\n\nconsole.log(generatorFn()[Symbol.iterator])\n// f [Symbol.iterator]() {native code}\n\nconsole.log(generatorFn())\n// generatorFn {<suspended>}\n\nconsole.log(generatorFn()[Symbol.iterator]())\n// generatorFn {<suspended>}\n\nconst g = generatorFn() // IterableIterator\nconsole.log(g === g[Symbol.iterator]())\n// true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"generator-roles",children:"Generator Roles"}),"\n",(0,t.jsx)(n.p,{children:"Generators can play 3 roles:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Iterators (data producers):\ngenerators can produce sequences of values via loops and recursion."}),"\n",(0,t.jsxs)(n.li,{children:["Observers (data consumers):\ngenerators become data consumers that pause\nuntil a new value is pushed into them via ",(0,t.jsx)(n.code,{children:"next(value)"}),"\n(",(0,t.jsx)(n.code,{children:"yield"})," can receive a value from ",(0,t.jsx)(n.code,{children:"next(value)"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"Coroutines (data producers and consumers):\ngenerators are pauseable and can be both data producers and data consumers,\ngenerators can be coroutines (cooperatively multi-tasked tasks)."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"generator-basic-usage",children:"Generator Basic Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* gen() {\n  yield 1\n  yield 2\n  yield 3\n}\n\nconst g = gen()\n\ng.next() // { value: 1, done: false }\ng.next() // { value: 2, done: false }\ng.next() // { value: 3, done: false }\ng.next() // { value: undefined, done: true }\ng.return() // { value: undefined, done: true }\ng.return(1) // { value: 1, done: true }\n"})}),"\n",(0,t.jsx)(n.h4,{id:"default-iterator-generator",children:"Default Iterator Generator"}),"\n",(0,t.jsxs)(n.p,{children:["\u751f\u6210\u5668\u51fd\u6570\u548c\u9ed8\u8ba4\u8fed\u4ee3\u5668",(0,t.jsx)(n.strong,{children:"\u88ab\u8c03\u7528"}),"\u4e4b\u540e\u90fd\u4ea7\u751f\u8fed\u4ee3\u5668\n(\u751f\u6210\u5668\u5bf9\u8c61\u662f",(0,t.jsx)(n.strong,{children:"\u81ea\u5f15\u7528\u53ef\u8fed\u4ee3\u5bf9\u8c61"}),", \u81ea\u8eab\u662f\u4e00\u4e2a\u8fed\u4ee3\u5668),\n\u6240\u4ee5\u751f\u6210\u5668\u9002\u5408\u4f5c\u4e3a\u9ed8\u8ba4\u8fed\u4ee3\u5668:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const users = {\n  james: false,\n  andrew: true,\n  alexander: false,\n  daisy: false,\n  luke: false,\n  clare: true,\n\n  *[Symbol.iterator]() {\n    // this === 'users'\n    for (const key in this) {\n      if (this[key])\n        yield key\n    }\n  },\n}\n\nfor (const key of users)\n  console.log(key)\n\n// andrew\n// clare\n\nclass Foo {\n  constructor() {\n    this.values = [1, 2, 3]\n  }\n\n  *[Symbol.iterator]() {\n    yield * this.values\n  }\n}\n\nconst f = new Foo()\n\nfor (const x of f)\n  console.log(x)\n\n// 1\n// 2\n// 3\n"})}),"\n",(0,t.jsx)(n.h4,{id:"early-return-generator",children:"Early Return Generator"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"return()"})," \u65b9\u6cd5\u4f1a\u5f3a\u5236\u751f\u6210\u5668\u8fdb\u5165\u5173\u95ed\u72b6\u6001."]}),"\n",(0,t.jsxs)(n.li,{children:["\u63d0\u4f9b\u7ed9 ",(0,t.jsx)(n.code,{children:"return()"})," \u7684\u503c, \u5c31\u662f\u7ec8\u6b62\u8fed\u4ee3\u5668\u5bf9\u8c61\u7684\u503c."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* gen() {\n  yield 1\n  yield 2\n  yield 3\n}\n\nconst g = gen()\n\ng.next() // { value: 1, done: false }\ng.return('foo') // { value: \"foo\", done: true }\ng.next() // { value: undefined, done: true }\n"})}),"\n",(0,t.jsx)(n.h4,{id:"error-handling-generator",children:"Error Handling Generator"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"throw()"})," \u65b9\u6cd5\u4f1a\u5728\u6682\u505c\u7684\u65f6\u5019\u5c06\u4e00\u4e2a\u63d0\u4f9b\u7684\u9519\u8bef\u6ce8\u5165\u5230\u751f\u6210\u5668\u5bf9\u8c61\u4e2d.\n\u5982\u679c\u9519\u8bef\u672a\u88ab\u5904\u7406, \u751f\u6210\u5668\u5c31\u4f1a\u5173\u95ed."]}),"\n",(0,t.jsx)(n.li,{children:"\u5047\u5982\u751f\u6210\u5668\u51fd\u6570\u5185\u90e8\u5904\u7406\u4e86\u8fd9\u4e2a\u9519\u8bef, \u90a3\u4e48\u751f\u6210\u5668\u5c31\u4e0d\u4f1a\u5173\u95ed, \u53ef\u4ee5\u6062\u590d\u6267\u884c.\n\u9519\u8bef\u5904\u7406\u4f1a\u8df3\u8fc7\u5bf9\u5e94\u7684 yield (\u8df3\u8fc7\u4e00\u4e2a\u503c)."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* generator() {\n  try {\n    yield 1\n  } catch (e) {\n    console.log(e)\n  }\n\n  yield 2\n  yield 3\n  yield 4\n  yield 5\n}\n\nconst it = generator()\n\nit.next() // {value: 1, done: false}\n\n// the error will be handled and printed (\"Error: Handled!\"),\n// then the flow will continue, so we will get the\n// next yielded value as result.\nit.throw(new Error('Handled!')) // {value: 2, done: false}\n\nit.next() // {value: 3, done: false}\n\n// now the generator instance is paused on the\n// third yield that is not inside a try-catch.\n// the error will be re-thrown out\nit.throw(new Error('Not handled!')) // !!! Uncaught Error: Not handled! !!!\n\n// now the iterator is exhausted\nit.next() // {value: undefined, done: true}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"generator-advanced-usage",children:"Generator Advanced Usage"}),"\n",(0,t.jsx)(n.h4,{id:"next-value-generator",children:"Next Value Generator"}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u4e3a ",(0,t.jsx)(n.code,{children:"next"})," \u4f20\u9012\u503c\u8fdb\u884c\u8c03\u7528\u65f6,\n\u4f20\u5165\u7684\u503c\u4f1a\u88ab\u5f53\u4f5c\u4e0a\u4e00\u6b21\u751f\u6210\u5668\u51fd\u6570\u6682\u505c\u65f6 ",(0,t.jsx)(n.code,{children:"yield"})," \u5173\u952e\u5b57\u7684\u8fd4\u56de\u503c\u5904\u7406.\n\u7b2c\u4e00\u6b21\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"g.next()"})," \u4f20\u5165\u53c2\u6570\u662f\u6beb\u65e0\u610f\u4e49,\n\u56e0\u4e3a\u9996\u6b21\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"next"})," \u51fd\u6570\u65f6,\n\u751f\u6210\u5668\u51fd\u6570\u5e76\u6ca1\u6709\u5728 ",(0,t.jsx)(n.code,{children:"yield"})," \u5173\u952e\u5b57\u5904\u6682\u505c:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* lazyCalculator(operator) {\n  const firstOperand = yield\n  const secondOperand = yield\n\n  switch (operator) {\n    case '+':\n      yield firstOperand + secondOperand\n      return\n    case '-':\n      yield firstOperand - secondOperand\n      return\n    case '*':\n      yield firstOperand * secondOperand\n      return\n    case '/':\n      yield firstOperand / secondOperand\n      return\n    default:\n      throw new Error('Unsupported operation!')\n  }\n}\n\nconst g = gen('*')\ng.next() // { value: undefined, done: false }\ng.next(10) // { value: undefined, done: false }\ng.next(2) // { value: 20, done: false }\ng.next() // { value: undefined, done: true }\n"})}),"\n",(0,t.jsx)(n.h4,{id:"default-asynchronous-iterator-generator",children:"Default Asynchronous Iterator Generator"}),"\n",(0,t.jsx)(n.p,{children:"Default asynchronous iterator:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const asyncSource = {\n  async *[Symbol.asyncIterator]() {\n    yield await new Promise(resolve => setTimeout(resolve, 1000, 1))\n  },\n}\n\nfor await (const chunk of asyncSource)\n  console.log(chunk)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"asynchronous-generator",children:"Asynchronous Generator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function* remotePostsAsyncGenerator() {\n  let i = 1\n\n  while (true) {\n    const res = await fetch(\n      `https://jsonplaceholder.typicode.com/posts/${i++}`\n    ).then(r => r.json())\n\n    // when no more remote posts will be available,\n    // it will break the infinite loop.\n    // the async iteration will end\n    if (Object.keys(res).length === 0)\n      break\n\n    yield res\n  }\n}\n\nfor await (const chunk of remotePostsAsyncGenerator())\n  console.log(chunk)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"asynchronous-events-stream",children:"Asynchronous Events Stream"}),"\n",(0,t.jsx)(n.p,{children:"Asynchronous UI events stream (RxJS):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class Observable {\n  constructor() {\n    this.promiseQueue = []\n    // \u4fdd\u5b58\u7528\u4e8e\u961f\u5217\u4e0b\u4e00\u4e2a promise \u7684 resolve \u65b9\u6cd5\n    this.resolve = null\n    // \u628a\u6700\u521d\u7684 promise \u63a8\u5230\u961f\u5217, \u8be5 promise \u4f1a resolve \u4e3a\u7b2c\u4e00\u4e2a\u89c2\u5bdf\u5230\u7684\u4e8b\u4ef6\n    this.enqueue()\n  }\n\n  // \u521b\u5efa\u65b0 promise, \u4fdd\u5b58\u5176 resolve \u65b9\u6cd5, \u5e76\u628a\u5b83\u4fdd\u5b58\u5230\u961f\u5217\u4e2d\n  enqueue() {\n    this.promiseQueue.push(new Promise(resolve => (this.resolve = resolve)))\n  }\n\n  // \u4ece\u961f\u5217\u524d\u7aef\u79fb\u9664 promise, \u5e76\u8fd4\u56de\u5b83\n  dequeue() {\n    return this.promiseQueue.shift()\n  }\n\n  async *fromEvent(element, eventType) {\n    // \u5728\u6709\u4e8b\u4ef6\u751f\u6210\u65f6, \u7528\u4e8b\u4ef6\u5bf9\u8c61\u6765 resolve \u961f\u5217\u5934\u90e8\u7684 promise\n    // \u540c\u65f6\u628a\u53e6\u4e00\u4e2a promise \u52a0\u5165\u961f\u5217\n    element.addEventListener(eventType, (event) => {\n      this.resolve(event)\n      this.enqueue()\n    })\n\n    // \u6bcf\u6b21 resolve \u961f\u5217\u5934\u90e8\u7684 promise \u540e, \u90fd\u4f1a\u5411\u5f02\u6b65\u8fed\u4ee3\u5668\u8fd4\u56de\u76f8\u5e94\u7684\u4e8b\u4ef6\u5bf9\u8c61\n    while (true)\n      yield await this.dequeue()\n  }\n}\n\nconst observable = new Observable()\nconst button = document.querySelector('button')\nconst mouseClickIterator = observable.fromEvent(button, 'click')\n\nfor await (const clickEvent of mouseClickIterator)\n  console.log(clickEvent)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Generator based asynchronous control flow goodness for nodejs and the browser,\nusing promises, letting you write non-blocking code in a nice-ish way\n(just like ",(0,t.jsx)(n.a,{href:"https://github.com/tj/co",children:"tj/co"}),")."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function coroutine(generatorFunc) {\n  const generator = generatorFunc()\n\n  function nextResponse(value) {\n    const response = generator.next(value)\n\n    if (response.done)\n      return\n\n    if (value instanceof Promise)\n      value.then(nextResponse)\n    else\n      nextResponse(response.value)\n  }\n\n  nextResponse()\n}\n\ncoroutine(function* bounce() {\n  yield bounceUp\n  yield bounceDown\n})\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u5229\u7528 ",(0,t.jsx)(n.code,{children:"async"}),"/",(0,t.jsx)(n.code,{children:"await"})," \u53ef\u4ee5\u5b9e\u73b0\u76f8\u540c\u6548\u679c:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function co(gen) {\n  return new Promise((resolve, reject) => {\n    const g = gen()\n\n    function next(param) {\n      const { done, value } = g.next(param)\n\n      if (!done) {\n        // Resolve chain.\n        Promise.resolve(value).then(res => next(res))\n      } else {\n        resolve(value)\n      }\n    }\n\n    // First invoke g.next() without params.\n    next()\n  })\n}\n\nfunction promise1() {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve('1')\n    }, 1000)\n  })\n}\n\nfunction promise2(value) {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(`value:${value}`)\n    }, 1000)\n  })\n}\n\nfunction* readFileGenerator() {\n  const value = yield promise1()\n  const result = yield promise2(value)\n  return result\n}\n\nasync function readFile() {\n  const value = await promise1()\n  const result = await promise2(value)\n  return result\n}\n\nco(readFileGenerator).then(res => console.log(res))\n// const g = readFileGenerator();\n// const value = g.next();\n// const result = g.next(value);\n// resolve(result);\n\nreadFile().then(res => console.log(res))\n"})}),"\n",(0,t.jsx)(n.h4,{id:"delegating-generator",children:"Delegating Generator"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"yield *"})," \u80fd\u591f\u8fed\u4ee3\u4e00\u4e2a\u53ef\u8fed\u4ee3\u5bf9\u8c61 (",(0,t.jsx)(n.code,{children:"yield* iterable"}),"):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u53ef\u4ee5\u8fed\u4ee3\u6807\u51c6\u5e93\u63d0\u4f9b\u7684 ",(0,t.jsx)(n.code,{children:"Iterable"})," \u96c6\u5408."]}),"\n",(0,t.jsxs)(n.li,{children:["\u751f\u6210\u5668\u51fd\u6570\u4ea7\u751f\u7684\u751f\u6210\u5668\u5bf9\u8c61\u662f\u4e00\u4e2a",(0,t.jsx)(n.strong,{children:"\u81ea\u5f15\u7528\u53ef\u8fed\u4ee3\u5bf9\u8c61"}),",\n\u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"yield *"})," \u805a\u5408\u751f\u6210\u5668 (",(0,t.jsx)(n.code,{children:"Delegating Generator"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* generatorFn() {\n  console.log('iter value:', yield * [1, 2, 3])\n}\n\nfor (const x of generatorFn())\n  console.log('value:', x)\n\n// value: 1\n// value: 2\n// value: 3\n// iter value: undefined\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* innerGeneratorFn() {\n  yield 'foo'\n  return 'bar'\n}\n\nfunction* outerGeneratorFn(genObj) {\n  console.log('iter value:', yield * innerGeneratorFn())\n}\n\nfor (const x of outerGeneratorFn())\n  console.log('value:', x)\n\n// value: foo\n// iter value: bar\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* chunkify(array, n) {\n  yield array.slice(0, n)\n  array.length > n && (yield * chunkify(array.slice(n), n))\n}\n\nasync function* getRemoteData() {\n  let hasMore = true\n  let page\n\n  while (hasMore) {\n    const { next_page, results } = await fetch(URL, { params: { page } }).then(\n      r => r.json()\n    )\n\n    // Return 5 elements with each iteration.\n    yield * chunkify(results, 5)\n\n    hasMore = next_page !== null\n    page = next_page\n  }\n}\n\nfor await (const chunk of getRemoteData())\n  console.log(chunk)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"recursive-generator",children:"Recursive Generator"}),"\n",(0,t.jsxs)(n.p,{children:["\u5728\u751f\u6210\u5668\u51fd\u6570\u5185\u90e8,\n\u7528 ",(0,t.jsx)(n.code,{children:"yield *"})," \u53bb\u8fed\u4ee3\u81ea\u8eab\u4ea7\u751f\u7684\u751f\u6210\u5668\u5bf9\u8c61,\n\u5b9e\u73b0\u9012\u5f52\u7b97\u6cd5."]}),"\n",(0,t.jsx)(n.p,{children:"Tree traversal:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Tree traversal\nclass BinaryTree {\n  constructor(value, left = null, right = null) {\n    this.value = value\n    this.left = left\n    this.right = right\n  }\n\n  *[Symbol.iterator]() {\n    yield this.value\n\n    if (this.left) {\n      // Short for: yield* this.left[Symbol.iterator]()\n      yield * this.left\n    }\n\n    if (this.right) {\n      // Short for: yield* this.right[Symbol.iterator]()\n      yield * this.right\n    }\n  }\n}\n\nconst tree = new BinaryTree(\n  'a',\n  new BinaryTree('b', new BinaryTree('c'), new BinaryTree('d')),\n  new BinaryTree('e')\n)\n\nfor (const x of tree)\n  console.log(x)\n\n// Output:\n// a\n// b\n// c\n// d\n// e\n"})}),"\n",(0,t.jsx)(n.p,{children:"Graph traversal:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Graph traversal\nfunction* graphTraversal(nodes) {\n  for (const node of nodes) {\n    if (!visitedNodes.has(node)) {\n      yield node\n      yield * graphTraversal(node.neighbors)\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"DOM traversal:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function* domTraversal(element) {\n  yield element\n  element = element.firstElementChild\n\n  while (element) {\n    yield * domTraversal(element)\n    element = element.nextElementSibling\n  }\n}\n\nfor (const element of domTraversal(document.getElementById('subTree')))\n  console.log(element.nodeName)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u7ed3\u5408 ",(0,t.jsx)(n.code,{children:"Promise"}),"/",(0,t.jsx)(n.code,{children:"async"}),"/",(0,t.jsx)(n.code,{children:"await"})," \u53ef\u4ee5\u5b9e\u73b0\u5f02\u6b65\u9012\u5f52\u7b97\u6cd5:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { promises as fs } from 'node:fs'\nimport { basename, dirname, join } from 'node:path'\n\nasync function* walk(dir: string): AsyncGenerator<string> {\n  for await (const d of await fs.opendir(dir)) {\n    const entry = join(dir, d.name)\n\n    if (d.isDirectory())\n      yield * walk(entry)\n    else if (d.isFile())\n      yield entry\n  }\n}\n\nasync function run(arg = '.') {\n  if ((await fs.lstat(arg)).isFile())\n    return runTestFile(arg)\n\n  for await (const file of walk(arg)) {\n    if (\n      !dirname(file).includes('node_modules')\n      && (basename(file) === 'test.js' || file.endsWith('.test.js'))\n    ) {\n      console.log(file)\n      await runTestFile(file)\n    }\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"promise",children:"Promise"}),"\n",(0,t.jsx)(n.p,{children:"Callback style asynchronous programming:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Callback hell."}),"\n",(0,t.jsx)(n.li,{children:"Complicated error handling."}),"\n",(0,t.jsx)(n.li,{children:"Complicated composition."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Promise style asynchronous programming:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Avoid callback hell:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Return ",(0,t.jsx)(n.code,{children:"new Promise()"}),"/",(0,t.jsx)(n.code,{children:"Promise.resolve()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Return ",(0,t.jsx)(n.code,{children:"promise.then((value) => {})"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Simple error handling:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Catch error: ",(0,t.jsx)(n.code,{children:"promise.catch((err) => {})"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Cleanup: ",(0,t.jsx)(n.code,{children:"promise.finally(() => {})"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Simple composition:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.all"}),": Converts an ",(0,t.jsx)(n.code,{children:"Array"})," of ",(0,t.jsx)(n.code,{children:"Promises"})," to a ",(0,t.jsx)(n.code,{children:"Promise"})," for an ",(0,t.jsx)(n.code,{children:"Array"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.race"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"promise-resolve",children:"Promise Resolve"}),"\n",(0,t.jsxs)(n.p,{children:["Resolve only accept ",(0,t.jsx)(n.strong,{children:"one"})," value:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"return new Promise(resolve => resolve([a, b]))\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const thenable = {\n  then(resolve, reject) {\n    resolve(42)\n  },\n}\nconst promise = Promise.resolve(thenable)\npromise.then((value) => {\n  console.log(value) // 42\n})\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Promise.resolve"})," \u662f\u4e00\u4e2a\u5e42\u7b49\u65b9\u6cd5 (\u72b6\u6001\u673a\u5e42\u7b49):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const p = Promise.resolve(7)\nsetTimeout(console.log, 0, p === Promise.resolve(p))\n// true\nsetTimeout(console.log, 0, p === Promise.resolve(Promise.resolve(p)))\n// true\n\nconst p = new Promise(() => {})\nsetTimeout(console.log, 0, p)\n// Promise <pending>\nsetTimeout(console.log, 0, Promise.resolve(p))\n// Promise <pending>\nsetTimeout(console.log, 0, p === Promise.resolve(p))\n// true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"promise-reject",children:"Promise Reject"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"let p1 = Promise.resolve('foo')\nlet p2 = p1.then()\nstetTimeout(console.log, 0, p2) // Promise <resolved>: foo\n\n// eslint-disable-next-line prefer-promise-reject-errors\np1 = Promise.reject('foo')\np2 = p1.then()\n// Uncaught (in promise) foo\nsetTimeout(console.log, 0, p2) // Promise <rejected>: foo\n\nconst p3 = p1.then(null, () => undefined)\nconst p4 = p1.then(null, () => {})\nconst p5 = p1.then(null, () => Promise.resolve())\nsetTimeout(console.log, 0, p3) // Promise <resolved>: undefined\nsetTimeout(console.log, 0, p4) // Promise <resolved>: undefined\nsetTimeout(console.log, 0, p5) // Promise <resolved>: undefined\n\nconst p6 = p1.then(null, () => 'bar')\nconst p7 = p1.then(null, () => Promise.resolve('bar'))\nsetTimeout(console.log, 0, p6) // Promise <resolved>: bar\nsetTimeout(console.log, 0, p7) // Promise <resolved>: bar\n\nconst p8 = p1.then(null, () => new Promise(() => {}))\n// eslint-disable-next-line prefer-promise-reject-errors\nconst p9 = p1.then(null, () => Promise.reject())\n// Uncaught (in promise): undefined\nsetTimeout(console.log, 0, p8) // Promise <pending>\nsetTimeout(console.log, 0, p9) // Promise <rejected>: undefined\n\nconst p10 = p1.then(null, () => {\n  throw new Error('bar')\n})\n// Uncaught (in promise) bar\nsetTimeout(console.log, 0, p10) // Promise <rejected>: bar\n\nconst p11 = p1.then(null, () => new Error('bar'))\nsetTimeout(console.log, 0, p11) // Promise <resolved>: Error: bar\n"})}),"\n",(0,t.jsx)(n.h3,{id:"promise-catch",children:"Promise Catch"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line prefer-promise-reject-errors\nconst p = Promise.reject()\nconst onRejected = function (e) {\n  setTimeout(console.log, 0, 'rejected')\n}\n// \u8bed\u6cd5\u7cd6:\np.then(null, onRejected) // rejected\np.catch(onRejected) // rejected\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const p1 = new Promise(() => {})\nconst p2 = p1.catch()\nsetTimeout(console.log, 0, p1) // Promise <pending>\nsetTimeout(console.log, 0, p2) // Promise <pending>\nsetTimeout(console.log, 0, p1 === p2) // false\n"})}),"\n",(0,t.jsx)(n.h3,{id:"promise-finally",children:"Promise Finally"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const p1 = new Promise(() => {})\nconst p2 = p1.finally()\nsetTimeout(console.log, 0, p1) // Promise <pending>\nsetTimeout(console.log, 0, p2) // Promise <pending>\nsetTimeout(console.log, 0, p1 === p2) // false\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const p1 = Promise.resolve('foo')\n\n// \u539f\u6837\u540e\u4f20:\nconst p2 = p1.finally()\nconst p3 = p1.finally(() => undefined)\nconst p4 = p1.finally(() => {})\nconst p5 = p1.finally(() => Promise.resolve())\nconst p6 = p1.finally(() => 'bar')\nconst p7 = p1.finally(() => Promise.resolve('bar'))\nconst p8 = p1.finally(() => new Error('bar'))\nsetTimeout(console.log, 0, p2) // Promise <resolved>: foo\nsetTimeout(console.log, 0, p3) // Promise <resolved>: foo\nsetTimeout(console.log, 0, p4) // Promise <resolved>: foo\nsetTimeout(console.log, 0, p5) // Promise <resolved>: foo\nsetTimeout(console.log, 0, p6) // Promise <resolved>: foo\nsetTimeout(console.log, 0, p7) // Promise <resolved>: foo\nsetTimeout(console.log, 0, p8) // Promise <resolved>: foo\n\n// \u7279\u6b8a\u5904\u7406:\nconst p9 = p1.finally(() => new Promise(() => {}))\nsetTimeout(console.log, 0, p9) // Promise <pending>\n// eslint-disable-next-line prefer-promise-reject-errors\nconst p10 = p1.finally(() => Promise.reject())\n// Uncaught (in promise): undefined\nsetTimeout(console.log, 0, p10) // Promise <rejected>: undefined\nconst p11 = p1.finally(() => {\n  throw new Error('bar')\n})\n// Uncaught (in promise) baz\nsetTimeout(console.log, 0, p11) // Promise <rejected>: bar\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Any value or resolved promises returned\nfrom ",(0,t.jsx)(n.code,{children:"finally()"})," is ignored:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const promise = Promise.resolve(42)\n\npromise\n  .finally(() => {\n    // Settlement handler\n    return 43 // Ignored!\n  })\n  .then((value) => {\n    // Fulfillment handler\n    console.log(value) // 42\n  })\n\npromise\n  .finally(() => {\n    // Settlement handler\n    return Promise.resolve(44) // Ignored!\n  })\n  .then((value) => {\n    // Fulfillment handler\n    console.log(value) // 42\n  })\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Returning rejected promise from ",(0,t.jsx)(n.code,{children:"finally()"}),"\nequivalent to throwing an error:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const promise = Promise.resolve(42)\n\npromise\n  .finally(() => {\n    // eslint-disable-next-line prefer-promise-reject-errors\n    return Promise.reject(43)\n  })\n  .catch((reason) => {\n    console.error(reason) // 43\n  })\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// eslint-disable-next-line prefer-promise-reject-errors\nconst promise = Promise.reject(43)\n\npromise\n  .finally(() => {\n    // eslint-disable-next-line prefer-promise-reject-errors\n    return Promise.reject(45)\n  })\n  .catch((reason) => {\n    console.log(reason) // 45\n  })\n"})}),"\n",(0,t.jsx)(n.h3,{id:"promise-thenable-and-catch",children:"Promise Thenable and Catch"}),"\n",(0,t.jsxs)(n.p,{children:["The main difference between the forms\n",(0,t.jsx)(n.code,{children:"promise.then(success, error)"})," and\n",(0,t.jsx)(n.code,{children:"promise.then(success).catch(error)"}),":\nin case if success callback returns a rejected promise,\nthen only the second form is going to catch that rejection."]}),"\n",(0,t.jsxs)(n.p,{children:["\u6b63\u5e38\u60c5\u51b5\u4e0b, \u5728\u901a\u8fc7 ",(0,t.jsx)(n.code,{children:"throw()"})," \u5173\u952e\u5b57\u629b\u51fa\u9519\u8bef\u65f6,\nJavaScript \u8fd0\u884c\u65f6\u7684\u9519\u8bef\u5904\u7406\u673a\u5236\u4f1a\u505c\u6b62\u6267\u884c\u629b\u51fa\u9519\u8bef\u4e4b\u540e\u7684\u4efb\u4f55\u6307\u4ee4.\n\u4f46\u5728 ",(0,t.jsx)(n.code,{children:"Promise"})," \u4e2d\u629b\u51fa\u9519\u8bef\u65f6, \u56e0\u4e3a\u9519\u8bef\u5b9e\u9645\u4e0a\u662f\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u5f02\u6b65\u629b\u51fa\u7684,\n\u6240\u4ee5\u5e76\u4e0d\u4f1a\u963b\u6b62\u8fd0\u884c\u65f6\u7ee7\u7eed\u6267\u884c\u540c\u6b65\u6307\u4ee4 (",(0,t.jsx)(n.code,{children:"Node.js"})," \u4e2d\u4ecd\u7136\u4f1a\u505c\u6b62\u6267\u884c\u4efb\u4f55\u6307\u4ee4)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"throw new Error('foo')\nconsole.log('bar') // \u8fd9\u4e00\u884c\u4e0d\u4f1a\u6267\u884c\n// Uncaught Error: foo\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Promise.reject(new Error('foo'))\nconsole.log('bar')\n// bar\n// Uncaught (in promise) Error: foo\n\nconst p1 = new Promise((resolve, reject) => reject(new Error('foo'))) // 1.\nconst p2 = new Promise((resolve, reject) => {\n  throw new Error('foo') // 2.\n})\nconst p3 = Promise.resolve().then(() => {\n  throw new Error('foo') // 4.\n})\nconst p4 = Promise.reject(new Error('foo')) // 3.\n// Uncaught (in promise) Error: foo\n//   at Promise (test.html:1)\n//   at new Promise (<anonymous>)\n//   at test.html:1\n// Uncaught (in promise) Error: foo\n//   at Promise (test.html:2)\n//   at new Promise (<anonymous>)\n//   at test.html:2\n// Uncaught (in promise) Error: foo\n//   at test.html:4\n// Uncaught (in promise) Error: foo\n//   at Promise.resolve.then (test.html:3)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"promise-chain",children:"Promise Chain"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Promises on the same chain execute orderly."}),"\n",(0,t.jsx)(n.li,{children:"Promises on two separate chains execute in random order."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const users = ['User1', 'User2', 'User3', 'User4']\n\nconst response = []\n\nfunction getUser(user) {\n  return () => {\n    return axios.get(`/users/userId=${user}`).then(res => response.push(res))\n  }\n}\n\nfunction getUsers(users) {\n  const [getFirstUser, getSecondUser, getThirdUser, getFourthUser]\n    = users.map(getUser)\n\n  getFirstUser()\n    .then(getSecondUser)\n    .then(getThirdUser)\n    .then(getFourthUser)\n    .catch(console.log)\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const users = ['User1', 'User2', 'User3', 'User4']\n\nlet response = []\n\nfunction getUsers(users) {\n  const promises = []\n  promises[0] = axios.get(`/users/userId=${users[0]}`)\n  promises[1] = axios.get(`/users/userId=${users[1]}`)\n  promises[2] = axios.get(`/users/userId=${users[2]}`)\n  promises[3] = axios.get(`/users/userId=${users[3]}`)\n\n  Promise.all(promises)\n    .then(userDataArr => (response = userDataArr))\n    .catch(err => console.log(err))\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"promise-combinator-array-functions",children:"Promise Combinator Array Functions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.all(iterable)"})," fail-fast:\nIf at least one promise in the promises array rejects,\nthen the promise returned rejects too.\nShort-circuits when an input value is rejected."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.any(iterable)"}),":\nResolves if any of the given promises are resolved.\nShort-circuits when an input value is fulfilled."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.race(iterable)"}),":\nShort-circuits when an input value is settled\n(fulfilled or rejected)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.allSettled(iterable)"}),":\nReturns when all given promises are settled\n(fulfilled or rejected)."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Promise.all(urls.map(fetch))\n  .then(responses => Promise.all(responses.map(res => res.text())))\n  .then((texts) => {\n    //\n  })\n\nasync function loadData() {\n  try {\n    const urls = ['...', '...']\n\n    const results = await Promise.all(urls.map(fetch))\n    const dataPromises = await results.map(result => result.json())\n    const finalData = Promise.all(dataPromises)\n\n    return finalData\n  } catch (err) {\n    console.log(err)\n  }\n}\n\nconst data = loadData().then(data => console.log(data))\n"})}),"\n",(0,t.jsx)(n.h3,{id:"promise-polyfill",children:"Promise Polyfill"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class Promise {\n  // `executor` takes 2 parameters, `resolve()` and `reject()`. The executor\n  // function is responsible for calling `resolve()` or `reject()` to say that\n  // the async operation succeeded (resolved) or failed (rejected).\n  constructor(executor) {\n    if (typeof executor !== 'function')\n      throw new TypeError('Executor must be a function')\n\n    // Internal state. `$state` is the state of the promise, and `$chained` is\n    // an array of the functions we need to call once this promise is settled.\n    this.$state = 'PENDING'\n    this.$chained = []\n\n    // Implement `resolve()` and `reject()` for the executor function to use\n    const resolve = (res) => {\n      // A promise is considered \"settled\" when it is no longer\n      // pending, that is, when either `resolve()` or `reject()`\n      // was called once. Calling `resolve()` or `reject()` twice\n      // or calling `reject()` after `resolve()` was already called\n      // are no-ops.\n      if (this.$state !== 'PENDING')\n        return\n\n      // If `res` is a \"thenable\", lock in this promise to match the\n      // resolved or rejected state of the thenable.\n      const then = res !== null ? res.then : null\n      if (typeof then === 'function') {\n        // In this case, the promise is \"resolved\", but still in the 'PENDING'\n        // state. This is what the ES6 spec means when it says \"A resolved promise\n        // may be pending, fulfilled or rejected\" in\n        // http://www.ecma-international.org/ecma-262/6.0/#sec-promise-objects\n        return then(resolve, reject)\n      }\n\n      this.$state = 'FULFILLED'\n      this.$internalValue = res\n\n      // If somebody called `.then()` while this promise was pending, need\n      // to call their `onFulfilled()` function\n      for (const { onFulfilled } of this.$chained)\n        onFulfilled(res)\n\n      return res\n    }\n\n    const reject = (err) => {\n      if (this.$state !== 'PENDING')\n        return\n\n      this.$state = 'REJECTED'\n      this.$internalValue = err\n\n      for (const { onRejected } of this.$chained)\n        onRejected(err)\n    }\n\n    // Call the executor function with `resolve()` and `reject()` as in the spec.\n    try {\n      // If the executor function throws a sync exception, we consider that\n      // a rejection. Keep in mind that, since `resolve()` or `reject()` can\n      // only be called once, a function that synchronously calls `resolve()`\n      // and then throws will lead to a fulfilled promise and a swallowed error\n      executor(resolve, reject)\n    } catch (err) {\n      reject(err)\n    }\n  }\n\n  // `onFulfilled` is called if the promise is fulfilled, and `onRejected`\n  // if the promise is rejected. For now, you can think of 'fulfilled' and\n  // 'resolved' as the same thing.\n  then(onFulfilled, onRejected) {\n    return new Promise((resolve, reject) => {\n      // Ensure that errors in `onFulfilled()` and `onRejected()` reject the\n      // returned promise, otherwise they'll crash the process. Also, ensure\n      // that the promise\n      const _onFulfilled = (res) => {\n        try {\n          // If `onFulfilled()` returns a promise, trust `resolve()` to handle\n          // it correctly.\n          // store new value to new Promise\n          resolve(onFulfilled(res))\n        } catch (err) {\n          reject(err)\n        }\n      }\n\n      const _onRejected = (err) => {\n        try {\n          // store new value to new Promise\n          reject(onRejected(err))\n        } catch (_err) {\n          reject(_err)\n        }\n      }\n\n      switch (this.$state) {\n        case 'FULFILLED':\n          _onFulfilled(this.$internalValue)\n          break\n        case 'REJECTED':\n          _onRejected(this.$internalValue)\n          break\n        default:\n          this.$chained.push({\n            onFulfilled: _onFulfilled,\n            onRejected: _onRejected,\n          })\n      }\n    })\n  }\n\n  catch(onRejected) {\n    return this.then(null, onRejected)\n  }\n\n  finally(callback) {\n    return this.then(\n      (value) => {\n        return Promise.resolve(callBack()).then(() => value)\n      },\n      (reason) => {\n        return Promise.resolve(callBack()).then(() => {\n          throw reason\n        })\n      }\n    )\n  }\n\n  static all(iterable) {\n    return new Promise((resolve, reject) => {\n      let index = 0\n      let pendingCount = 0\n      const result = Array.from({ length: iterable.length })\n\n      for (const promise of iterable) {\n        const currentIndex = index\n        promise.then(\n\n          (value) => {\n            result[currentIndex] = value\n            pendingCount++\n\n            if (pendingCount === iterable.length)\n              resolve(result)\n          },\n          (err) => {\n            reject(err)\n          }\n        )\n        index++\n      }\n\n      if (index === 0)\n        resolve([])\n    })\n  }\n\n  static any(iterable) {\n    return new Promise((resolve, reject) => {\n      let index = 0\n      let pendingCount = 0\n      const error = new Error('All promise were rejected')\n      error.errors = Array.from({ length: iterable.length })\n\n      for (const promise of iterable) {\n        const currentIndex = index\n        promise.then(\n          (value) => {\n            resolve(value)\n          },\n\n          (err) => {\n            error.errors[currentIndex] = err\n            pendingCount++\n\n            if (pendingCount === iterable.length)\n              reject(error)\n          }\n        )\n        index++\n      }\n\n      if (index === 0)\n        resolve([])\n    })\n  }\n\n  static race(iterable) {\n    return new Promise((resolve, reject) => {\n      for (const promise of iterable) {\n        promise.then(\n          (value) => {\n            resolve(value)\n          },\n          (err) => {\n            reject(err)\n          }\n        )\n      }\n    })\n  }\n\n  static allSettled(iterable) {\n    return new Promise((resolve, reject) => {\n      let index = 0\n      let pendingCount = 0\n      let result\n\n      function addElementToResult(i, elem) {\n        result[i] = elem\n        pendingCount++\n\n        if (pendingCount === result.length)\n          resolve(result)\n      }\n\n      for (const promise of iterable) {\n        const currentIndex = index\n        promise.then(\n          value =>\n            addElementToResult(currentIndex, {\n              status: 'fulfilled',\n              value,\n            }),\n          reason =>\n            addElementToResult(currentIndex, {\n              status: 'rejected',\n              reason,\n            })\n        )\n        index++\n      }\n\n      if (index === 0) {\n        resolve([])\n        return\n      }\n\n      result = Array.from({ length: index })\n    })\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"memorize-async-function",children:"Memorize Async Function"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const memo = {}\nconst progressQueues = {}\n\nfunction memoProcessData(key) {\n  return new Promise((resolve, reject) => {\n    if (Object.prototype.hasOwnProperty.call(memo, key)) {\n      resolve(memo[key])\n      return\n    }\n\n    if (!Object.prototype.hasOwnProperty.call(progressQueues, key)) {\n      // Called for a new key\n      // Create an entry for it in progressQueues\n      progressQueues[key] = [[resolve, reject]]\n    } else {\n      // Called for a key that's still being processed\n      // Enqueue it's handlers and exit.\n      progressQueues[key].push([resolve, reject])\n      return\n    }\n\n    processData(key)\n      .then((data) => {\n        memo[key] = data\n        for (const [resolver] of progressQueues[key]) resolver(data)\n      })\n      .catch((error) => {\n        for (const [, rejector] of progressQueues[key]) rejector(error)\n      })\n      .finally(() => {\n        delete progressQueues[key]\n      })\n  })\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"async-and-await",children:"Async and Await"}),"\n",(0,t.jsx)(n.h3,{id:"await-features",children:"Await Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"async"})," \u5f02\u6b65\u51fd\u6570\u5982\u679c\u4e0d\u5305\u542b ",(0,t.jsx)(n.code,{children:"await"})," \u5173\u952e\u5b57, \u5176\u6267\u884c (\u9664\u8fd4\u56de\u503c\u5916) \u57fa\u672c\u4e0a\u8ddf\u666e\u901a\u51fd\u6570\u6ca1\u6709\u4ec0\u4e48\u533a\u522b."]}),"\n",(0,t.jsxs)(n.li,{children:["JavaScript \u8fd0\u884c\u65f6\u5728\u78b0\u5230 ",(0,t.jsx)(n.code,{children:"await"})," \u5173\u952e\u5b57\u65f6, \u4f1a\u8bb0\u5f55\u5728\u54ea\u91cc\u6682\u505c\u6267\u884c."]}),"\n",(0,t.jsxs)(n.li,{children:["\u7b49\u5230 ",(0,t.jsx)(n.code,{children:"await"})," \u53f3\u8fb9\u7684\u503c\u53ef\u7528\u4e86, JavaScript \u8fd0\u884c\u65f6\u4f1a\u5411\u6d88\u606f\u961f\u5217\u4e2d\u63a8\u9001\u4e00\u4e2a\u4efb\u52a1, \u8fd9\u4e2a\u4efb\u52a1\u4f1a\u6062\u590d\u5f02\u6b65\u51fd\u6570\u7684\u6267\u884c."]}),"\n",(0,t.jsxs)(n.li,{children:["\u5373\u4f7f ",(0,t.jsx)(n.code,{children:"await"})," \u540e\u9762\u8ddf\u7740\u4e00\u4e2a\u7acb\u5373\u53ef\u7528\u7684\u503c, \u51fd\u6570\u7684\u5176\u4f59\u90e8\u5206\u4e5f\u4f1a\u88ab\u5f02\u6b65\u6c42\u503c."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function foo() {\n  console.log(2)\n}\n\nconsole.log(1)\nfoo()\nconsole.log(3)\n// 1\n// 2\n// 3\n\nasync function bar() {\n  console.log(2)\n  await null\n  console.log(4)\n}\n\nconsole.log(1)\nbar()\nconsole.log(3)\n// 1\n// 2\n// 3\n// 4\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Await ",(0,t.jsx)(n.code,{children:"thenable"})," object (implements ",(0,t.jsx)(n.code,{children:"then"})," interface):"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function bar() {\n  const thenable = {\n    then(callback) {\n      callback('bar')\n    },\n  }\n  return thenable\n}\n\nbar().then(console.log)\n// bar\n\nasync function baz() {\n  const thenable = {\n    then(callback) {\n      callback('baz')\n    },\n  }\n  console.log(await thenable)\n}\n\nbaz()\n// baz\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"async"}),"/",(0,t.jsx)(n.code,{children:"await"})," implement generator based asynchronous control flow:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const fetchJson = co.wrap(function* (url) {\n  try {\n    const response = yield fetch(url)\n    const text = yield response.text()\n    return JSON.parse(text)\n  } catch (error) {\n    console.log(`ERROR: ${error.stack}`)\n  }\n})\n\nasync function fetchJson(url) {\n  try {\n    const response = await fetch(url)\n    const text = await response.text()\n    return JSON.parse(text)\n  } catch (error) {\n    console.log(`ERROR: ${error.stack}`)\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"async"})," \u51fd\u6570\u81ea\u52a8\u5c06\u8fd4\u56de\u503c\u5305\u88c5\u4e3a ",(0,t.jsx)(n.code,{children:"Promise"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// BAD.\nasync function downloadContent(urls) {\n  const promiseArray = urls.map(fetch)\n  return await Promise.all(promiseArray)\n}\n\n// GOOD.\nasync function downloadContent(urls) {\n  const promiseArray = urls.map(fetch)\n  return Promise.all(promiseArray)\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"await-arrays",children:"Await Arrays"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you want to execute await calls in series,\nuse a for-loop (or any loop without a callback)."}),"\n",(0,t.jsxs)(n.li,{children:["Don't ever use await with ",(0,t.jsx)(n.code,{children:"forEach"})," (",(0,t.jsx)(n.code,{children:"forEach"})," is not promise-aware),\nuse a for-loop (or any loop without a callback) instead."]}),"\n",(0,t.jsx)(n.li,{children:"Don't await inside filter and reduce,\nalways await an array of promises with map, then filter or reduce accordingly."}),"\n",(0,t.jsx)(n.li,{children:"Avoid wrong parallel logic (too sequential):"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Wrong:\nconst books = await bookModel.fetchAll()\nconst author = await authorModel.fetch(authorId)\n\n// Correct:\nconst bookPromise = bookModel.fetchAll()\nconst authorPromise = authorModel.fetch(authorId)\nconst book = await bookPromise\nconst author = await authorPromise\n\nasync function getAuthors(authorIds) {\n  // WRONG, this will cause sequential calls\n  // const authors = authorIds.map(id => await authorModel.fetch(id));\n  // CORRECT:\n  const promises = authorIds.map(id => authorModel.fetch(id))\n  const authors = await Promise.all(promises)\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function randomDelay(id) {\n  const delay = Math.random() * 1000\n  return new Promise(resolve =>\n    setTimeout(() => {\n      console.log(`${id} finished`)\n      resolve(id)\n    }, delay)\n  )\n}\n\nasync function sequential() {\n  const t0 = Date.now()\n\n  for (let i = 0; i < 5; ++i)\n    await randomDelay(i)\n\n  console.log(`${Date.now() - t0}ms elapsed`)\n}\n\nsequential()\n// 0 finished\n// 1 finished\n// 2 finished\n// 3 finished\n// 4 finished\n// 2877ms elapsed\n\nasync function parallel() {\n  const t0 = Date.now()\n  const promises = Array.from({ length: 5 })\n    .fill(null)\n    .map((_, i) => randomDelay(i))\n\n  for (const p of promises)\n    console.log(`awaited ${await p}`)\n\n  console.log(`${Date.now() - t0}ms elapsed`)\n}\n\nparallel()\n// 4 finished\n// 2 finished\n// 1 finished\n// 0 finished\n// 3 finished\n// awaited 0\n// awaited 1\n// awaited 2\n// awaited 3\n// awaited 4\n// 645ms elapsed\n"})}),"\n",(0,t.jsx)(n.h2,{id:"asynchronous-javascript",children:"Asynchronous JavaScript"}),"\n",(0,t.jsx)(n.h3,{id:"sleep-function",children:"Sleep Function"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function sleep(time) {\n  return new Promise(resolve => setTimeout(resolve, time))\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"sleep(2000).then(() => {\n  // do something after 2000 milliseconds\n  console.log('resolved')\n})\n\nasync function add(n1, n2) {\n  await sleep(2222)\n  console.log(n1 + n2)\n}\n\nadd(1, 2)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"race-condition",children:"Race Condition"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Keep latest updates."}),"\n",(0,t.jsx)(n.li,{children:"Recover from failures."}),"\n",(0,t.jsxs)(n.li,{children:["Online and offline sync (",(0,t.jsx)(n.a,{href:"https://github.com/pouchdb/pouchdb",children:"PouchDB"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Tools: ",(0,t.jsx)(n.a,{href:"https://github.com/redux-saga/redux-saga",children:"redux-saga"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"export default {\n  data() {\n    return {\n      text: '',\n      results: [],\n      nextRequestId: 1,\n      displayedRequestId: 0,\n    }\n  },\n  watch: {\n    async text(value) {\n      const requestId = this.nextRequestId++\n      const results = await search(value)\n\n      // guarantee display latest search results (when input keep changing)\n      if (requestId < this.displayedRequestId)\n        return\n\n      this.displayedRequestId = requestId\n      this.results = results\n    },\n  },\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"web-worker",children:"Web Worker"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u591a\u7ebf\u7a0b\u5e76\u884c\u6267\u884c."}),"\n",(0,t.jsxs)(n.li,{children:["\u5229\u7528 ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/BroadcastChannel",children:"BroadcastChannel API"}),"\n\u53ef\u4ee5\u521b\u5efa Shared Worker, \u5373\u5171\u4eab Workers \u5728\u540c\u4e00\u6e90 (origin) \u4e0b\u9762\u7684\u5404\u79cd\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5b83,\n\u5305\u62ec: ",(0,t.jsx)(n.code,{children:"iframe"}),"/\u6d4f\u89c8\u5668\u4e2d\u7684\u4e0d\u540c Tab \u9875 (",(0,t.jsx)(n.code,{children:"Browsing Context"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Use Case:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Graphic App (Ray Tracing)."}),"\n",(0,t.jsx)(n.li,{children:"Encryption."}),"\n",(0,t.jsx)(n.li,{children:"Prefetching Data."}),"\n",(0,t.jsx)(n.li,{children:"PWA (Service Worker)."}),"\n",(0,t.jsx)(n.li,{children:"Spell Checking."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:"<button onclick=\"startComputation()\">Start computation</button>\n\n<script>\n  const worker = new Worker('worker.js')\n\n  worker.addEventListener(\n    'message',\n    function (e) {\n      console.log(e.data)\n    },\n    false,\n  )\n\n  function startComputation() {\n    worker.postMessage({ cmd: 'average', data: [1, 2, 3, 4] })\n  }\n<\/script>\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// worker.js\n// eslint-disable-next-line no-restricted-globals\nself.addEventListener(\n  'message',\n  (e) => {\n    const data = e.data\n    switch (data.cmd) {\n      case 'average': {\n        const result = calculateAverage(data)\n        // eslint-disable-next-line no-restricted-globals\n        self.postMessage(result)\n        break\n      }\n      default:\n        // eslint-disable-next-line no-restricted-globals\n        self.postMessage('Unknown command')\n    }\n  },\n  false\n)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"web-worker-runtime",children:"Web Worker Runtime"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Web Worker \u65e0\u6cd5\u8bbf\u95ee\u4e00\u4e9b\u975e\u5e38\u5173\u952e\u7684 JavaScript \u7279\u6027:\nDOM (\u7ebf\u7a0b\u4e0d\u5b89\u5168), ",(0,t.jsx)(n.code,{children:"window"})," \u5bf9\u8c61, ",(0,t.jsx)(n.code,{children:"document"})," \u5bf9\u8c61, ",(0,t.jsx)(n.code,{children:"parent"})," \u5bf9\u8c61."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"self"})," \u4e0a\u53ef\u7528\u7684\u5c5e\u6027\u662f ",(0,t.jsx)(n.code,{children:"window"})," \u5bf9\u8c61\u4e0a\u5c5e\u6027\u7684\u4e25\u683c\u5b50\u96c6,\n",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope",children:(0,t.jsx)(n.code,{children:"WorkerGlobalScope"})}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"navigation"})," \u5bf9\u8c61: ",(0,t.jsx)(n.code,{children:"appName"}),", ",(0,t.jsx)(n.code,{children:"appVersion"}),", ",(0,t.jsx)(n.code,{children:"userAgent"}),", ",(0,t.jsx)(n.code,{children:"platform"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"location"})," \u5bf9\u8c61: \u6240\u6709\u5c5e\u6027\u53ea\u8bfb."]}),"\n",(0,t.jsxs)(n.li,{children:["ECMAScript \u5bf9\u8c61: ",(0,t.jsx)(n.code,{children:"Object"}),"/",(0,t.jsx)(n.code,{children:"Array"}),"/",(0,t.jsx)(n.code,{children:"Date"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"console"})," \u5bf9\u8c61."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"setTimeout"}),"/",(0,t.jsx)(n.code,{children:"setInterval"})," \u65b9\u6cd5."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"XMLHttpRequest"})," \u65b9\u6cd5."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"fetch"})," \u65b9\u6cd5."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"caches"})," \u5bf9\u8c61: ",(0,t.jsx)(n.code,{children:"ServicerWorker"})," ",(0,t.jsx)(n.code,{children:"CacheStorage"})," \u5bf9\u8c61."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"self"})," \u5bf9\u8c61: \u6307\u5411\u5168\u5c40 worker \u5bf9\u8c61."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"close"})," \u65b9\u6cd5: \u505c\u6b62 worker."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"importScripts"})," \u65b9\u6cd5: \u52a0\u8f7d\u5916\u90e8\u4f9d\u8d56."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/MessagePort",children:(0,t.jsx)(n.code,{children:"MessagePort"})}),"\n\u65b9\u6cd5: ",(0,t.jsx)(n.code,{children:"postMessage"}),"/",(0,t.jsx)(n.code,{children:"onmessage"}),"/",(0,t.jsx)(n.code,{children:"onmessageerror"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7684\u811a\u672c\u6587\u4ef6\u53ea\u80fd\u4ece\u4e0e\u7236\u9875\u9762\u76f8\u540c\u7684\u6e90\u52a0\u8f7d,\n\u4ece\u5176\u4ed6\u6e90\u52a0\u8f7d\u5de5\u4f5c\u8005\u7ebf\u7a0b\u7684\u811a\u672c\u6587\u4ef6\u4f1a\u5bfc\u81f4\u9519\u8bef.\n\u5728\u5de5\u4f5c\u8005\u7ebf\u7a0b\u5185\u90e8\u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"importScripts()"})," \u53ef\u4ee5\u52a0\u8f7d\u5176\u4ed6\u6e90\u7684\u811a\u672c."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"web-worker-basic-usage",children:"Web Worker Basic Usage"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5148 ",(0,t.jsx)(n.code,{children:"on"}),", \u540e ",(0,t.jsx)(n.code,{children:"post"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"main.js"}),"/",(0,t.jsx)(n.code,{children:"worker.js"})," \u7684 ",(0,t.jsx)(n.code,{children:"onmessage"})," \u4e0e ",(0,t.jsx)(n.code,{children:"postMessage"})," \u76f8\u4e92\u89e6\u53d1."]}),"\n",(0,t.jsxs)(n.li,{children:["\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u505c\u6b62 Worker:\n\u4ece\u4e3b\u9875\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"worker.terminate()"})," \u6216\u5728 worker \u5185\u90e8\u8c03\u7528 ",(0,t.jsx)(n.code,{children:"self.close()"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"/*\n * JSONParser.js\n */\n// eslint-disable-next-line no-restricted-globals\nself.onmessage = function (event) {\n  const jsonText = event.data\n  const jsonData = JSON.parse(jsonText)\n\n  // eslint-disable-next-line no-restricted-globals\n  self.postMessage(jsonData)\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"/*\n * main.js\n */\nconst worker = new Worker('JSONParser.js')\n\nworker.onmessage = function (event) {\n  const jsonData = event.data\n  evaluateData(jsonData)\n}\n\nworker.postMessage(jsonText)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// main.js\nfunction work() {\n  onmessage = ({ data: { jobId, message } }) => {\n    console.log(`I am worker, I receive:-----${message}`)\n    postMessage({ jobId, result: 'message from worker' })\n  }\n}\n\nfunction makeWorker(f) {\n  const pendingJobs = {}\n  const workerScriptBlobUrl = URL.createObjectURL(\n    new Blob([`(${f.toString()})()`])\n  )\n  const worker = new Worker(workerScriptBlobUrl)\n\n  worker.onmessage = ({ data: { result, jobId } }) => {\n    // \u8c03\u7528 resolve, \u6539\u53d8 Promise \u72b6\u6001\n    pendingJobs[jobId](result)\n    delete pendingJobs[jobId]\n  }\n\n  return (...message) =>\n    new Promise((resolve) => {\n      const jobId = String(Math.random())\n      pendingJobs[jobId] = resolve\n      worker.postMessage({ jobId, message })\n    })\n}\n\nconst testWorker = makeWorker(work)\n\ntestWorker('message from main thread').then((message) => {\n  console.log(`I am main thread, I receive:-----${message}`)\n})\n"})}),"\n",(0,t.jsx)(n.h4,{id:"web-worker-pool",children:"Web Worker Pool"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'class TaskWorker extends Worker {\n  constructor(notifyAvailable, ...workerArgs) {\n    super(...workerArgs)\n\n    // \u521d\u59cb\u5316\u4e3a\u4e0d\u53ef\u7528\u72b6\u6001\n    this.available = false\n    this.resolve = null\n    this.reject = null\n\n    // \u7ebf\u7a0b\u6c60\u4f1a\u4f20\u9012\u56de\u8c03\n    // \u4ee5\u4fbf\u5de5\u4f5c\u8005\u7ebf\u7a0b\u53d1\u51fa\u5b83\u9700\u8981\u65b0\u4efb\u52a1\u7684\u4fe1\u53f7\n    this.notifyAvailable = notifyAvailable\n\n    // \u7ebf\u7a0b\u811a\u672c\u5728\u5b8c\u5168\u521d\u59cb\u5316\u4e4b\u540e\n    // \u4f1a\u53d1\u9001\u4e00\u6761"ready"\u6d88\u606f\n    this.onmessage = () => this.setAvailable()\n  }\n\n  // \u7531\u7ebf\u7a0b\u6c60\u8c03\u7528, \u4ee5\u5206\u6d3e\u65b0\u4efb\u52a1\n  dispatch({ resolve, reject, postMessageArgs }) {\n    this.available = false\n    this.onmessage = ({ data }) => {\n      resolve(data)\n      this.setAvailable()\n    }\n    this.onerror = (e) => {\n      reject(e)\n      this.setAvailable()\n    }\n    this.postMessage(...postMessageArgs)\n  }\n\n  setAvailable() {\n    this.available = true\n    this.resolve = null\n    this.reject = null\n    this.notifyAvailable()\n  }\n}\n\nclass WorkerPool {\n  constructor(poolSize, ...workerArgs) {\n    this.taskQueue = []\n    this.workers = []\n\n    // \u521d\u59cb\u5316\u7ebf\u7a0b\u6c60\n    for (let i = 0; i < poolSize; ++i) {\n      this.workers.push(\n        new TaskWorker(() => this.dispatchIfAvailable(), ...workerArgs)\n      )\n    }\n  }\n\n  // \u628a\u4efb\u52a1\u63a8\u5165\u961f\u5217\n  enqueue(...postMessageArgs) {\n    return new Promise((resolve, reject) => {\n      this.taskQueue.push({ resolve, reject, postMessageArgs })\n      this.dispatchIfAvailable()\n    })\n  }\n\n  // \u628a\u4efb\u52a1\u53d1\u9001\u7ed9\u4e0b\u4e00\u4e2a\u7a7a\u95f2\u7684\u7ebf\u7a0b\n  dispatchIfAvailable() {\n    if (!this.taskQueue.length)\n      return\n\n    for (const worker of this.workers) {\n      if (worker.available) {\n        const a = this.taskQueue.shift()\n        worker.dispatch(a)\n        break\n      }\n    }\n  }\n\n  // \u7ec8\u6b62\u6240\u6709\u5de5\u4f5c\u8005\u7ebf\u7a0b\n  close() {\n    for (const worker of this.workers)\n      worker.terminate()\n  }\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// worker.js\nself.onmessage = ({ data }) => {\n  const view = new Float32Array(data.arrayBuffer)\n  let sum = 0\n  // \u6c42\u548c\n  for (let i = data.startIdx; i < data.endIdx; ++i) {\n    // \u4e0d\u9700\u8981\u539f\u5b50\u64cd\u4f5c, \u56e0\u4e3a\u53ea\u9700\u8981\u8bfb\n    sum += view[i]\n  }\n  // \u628a\u7ed3\u679c\u53d1\u9001\u7ed9\u5de5\u4f5c\u8005\u7ebf\u7a0b\n  self.postMessage(sum)\n}\n// \u53d1\u9001\u6d88\u606f\u7ed9 TaskWorker\n// \u901a\u77e5\u5de5\u4f5c\u8005\u7ebf\u7a0b\u51c6\u5907\u597d\u63a5\u6536\u4efb\u52a1\u4e86\nself.postMessage('ready')\n\n// main.js\nconst totalFloats = 1e8\nconst numTasks = 20\nconst floatsPerTask = totalFloats / numTasks\nconst numWorkers = 4\n\n// \u521b\u5efa\u7ebf\u7a0b\u6c60\nconst pool = new WorkerPool(numWorkers, './worker.js')\n\n// \u586b\u5145\u6d6e\u70b9\u503c\u6570\u7ec4\nconst arrayBuffer = new SharedArrayBuffer(4 * totalFloats)\nconst view = new Float32Array(arrayBuffer)\n\nfor (let i = 0; i < totalFloats; ++i)\n  view[i] = Math.random()\n\nconst partialSumPromises = []\n\nfor (let i = 0; i < totalFloats; i += floatsPerTask) {\n  partialSumPromises.push(\n    pool.enqueue({\n      startIdx: i,\n      endIdx: i + floatsPerTask,\n      arrayBuffer,\n    })\n  )\n}\n\n// \u6c42\u548c\nPromise.all(partialSumPromises)\n  .then(partialSums => partialSums.reduce((x, y) => x + y))\n  .then(console.log)\n// (\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d, \u548c\u5e94\u8be5\u7ea6\u7b49\u4e8e 1E8/2)\n// 49997075.47203197\n"})}),"\n",(0,t.jsx)(n.h4,{id:"web-worker-performance",children:"Web Worker Performance"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Web Worker performance ",(0,t.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/IJHI9JB3nMQPi46b6yGVWw",children:"guide"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"abort-controller",children:"Abort Controller"}),"\n",(0,t.jsx)(n.h4,{id:"abort-fetching",children:"Abort Fetching"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { useEffect, useState } from 'react'\nimport { useParams } from 'react-router-dom'\n\ninterface Post {\n  id: number\n  title: string\n  body: string\n}\n\nfunction usePostLoading() {\n  const { postId } = useParams<{ postId: string }>()\n  const [isLoading, setIsLoading] = useState(false)\n  const [post, setPost] = useState<Post | null>(null)\n\n  useEffect(() => {\n    const abortController = new AbortController()\n\n    setIsLoading(true)\n    fetch(`https://jsonplaceholder.typicode.com/posts/${postId}`, {\n      signal: abortController.signal,\n    })\n      .then((response) => {\n        if (response.ok)\n          return response.json()\n\n        return Promise.reject(new Error('The request failed.'))\n      })\n      .then((fetchedPost: Post) => {\n        setPost(fetchedPost)\n      })\n      .catch((err) => {\n        if (abortController.signal.aborted)\n          console.log('The user aborted the request')\n        else\n          console.error(err.message)\n      })\n      .finally(() => {\n        setIsLoading(false)\n      })\n\n    return () => {\n      abortController.abort()\n    }\n  }, [postId])\n\n  return {\n    post,\n    isLoading,\n  }\n}\n\nexport default usePostLoading\n"})}),"\n",(0,t.jsx)(n.h4,{id:"abort-promise",children:"Abort Promise"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function wait(time: number, signal?: AbortSignal) {\n  return new Promise<void>((resolve, reject) => {\n    const timeoutId = setTimeout(() => {\n      resolve()\n    }, time)\n    signal?.addEventListener('abort', () => {\n      clearTimeout(timeoutId)\n      reject(new Error('Aborted.'))\n    })\n  })\n}\n\nconst abortController = new AbortController()\n\nsetTimeout(() => {\n  abortController.abort()\n}, 1000)\n\nwait(5000, abortController.signal)\n  .then(() => {\n    console.log('5 seconds passed')\n  })\n  .catch(() => {\n    console.log('Waiting was interrupted')\n  })\n"})}),"\n",(0,t.jsx)(n.h4,{id:"abort-controller-helpers",children:"Abort Controller Helpers"}),"\n",(0,t.jsxs)(n.p,{children:["Abort controller ",(0,t.jsx)(n.a,{href:"https://whistlr.info/2022/abortcontroller-is-your-friend",children:"helpers polyfill"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"if ((!timeout) in AbortSignal) {\n  AbortSignal.timeout = function abortTimeout(ms) {\n    const controller = new AbortController()\n    setTimeout(() => controller.abort(), ms)\n    return controller.signal\n  }\n}\n\nif ((!any) in AbortSignal) {\n  AbortSignal.any = function abortAny(signals) {\n    const controller = new AbortController()\n    signals.forEach((signal) => {\n      if (signal.aborted)\n        controller.abort()\n      else\n        signal.addEventListener('abort', () => controller.abort())\n    })\n    return controller.signal\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"asynchronous-api-comparison",children:"Asynchronous API Comparison"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"promise"})," \u548c ",(0,t.jsx)(n.code,{children:"async/await"})," \u4e13\u95e8\u7528\u4e8e\u5904\u7406\u5f02\u6b65\u64cd\u4f5c."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"generator"})," \u5e76\u4e0d\u662f\u4e13\u95e8\u4e3a\u5f02\u6b65\u8bbe\u8ba1, \u5b83\u8fd8\u6709\u5176\u4ed6\u529f\u80fd (\u5bf9\u8c61\u8fed\u4ee3/\u63a7\u5236\u8f93\u51fa/Iterator Interface/etc)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"promise"})," \u7f16\u5199\u4ee3\u7801\u76f8\u6bd4 ",(0,t.jsx)(n.code,{children:"generator/async/await"})," \u66f4\u4e3a\u590d\u6742\u5316, \u4e14\u53ef\u8bfb\u6027\u4e5f\u7a0d\u5dee."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"generator/async/await"})," \u9700\u8981\u4e0e ",(0,t.jsx)(n.code,{children:"promise"})," \u5bf9\u8c61\u642d\u914d\u5904\u7406\u5f02\u6b65\u60c5\u51b5."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"async/await"})," \u4f7f\u7528\u4e0a\u66f4\u4e3a\u7b80\u6d01, \u5c06\u5f02\u6b65\u4ee3\u7801\u4ee5\u540c\u6b65\u7684\u5f62\u5f0f\u8fdb\u884c\u7f16\u5199, \u662f\u5904\u7406\u5f02\u6b65\u7f16\u7a0b\u7684\u6700\u7ec8\u65b9\u6848."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"module",children:"Module"}),"\n",(0,t.jsx)(n.h3,{id:"crust-principles",children:"CRUST Principles"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Consistent: ES6 API design ",(0,t.jsx)(n.code,{children:"Array.XXX(fn)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Resilient: jQuery sizzle API design ",(0,t.jsx)(n.code,{children:"$(element)"}),"/",(0,t.jsx)(n.code,{children:"$(selector)"}),"/",(0,t.jsx)(n.code,{children:"$(selector, context)"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Unambiguous."}),"\n",(0,t.jsxs)(n.li,{children:["Simple: Simple ",(0,t.jsx)(n.code,{children:"fetch"})," API design."]}),"\n",(0,t.jsx)(n.li,{children:"Tiny: Tiny surface areas."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"namespace-module-pattern",children:"Namespace Module Pattern"}),"\n",(0,t.jsx)(n.h4,{id:"namespace-module-constructor",children:"Namespace Module Constructor"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u547d\u540d\u7a7a\u95f4."}),"\n",(0,t.jsx)(n.li,{children:"\u4f9d\u8d56\u6a21\u5f0f."}),"\n",(0,t.jsx)(n.li,{children:"\u79c1\u6709\u5c5e\u6027/\u7279\u6743\u65b9\u6cd5."}),"\n",(0,t.jsx)(n.li,{children:"\u521d\u59cb\u5316\u6a21\u5f0f."}),"\n",(0,t.jsx)(n.li,{children:"\u63ed\u793a\u6a21\u5f0f: \u516c\u5171\u63a5\u53e3."}),"\n",(0,t.jsx)(n.li,{children:"\u5373\u65f6\u51fd\u6570\u6a21\u5f0f."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"APP.namespace = function (namespaceString) {\n  let parts = namespaceString.split('.')\n  let parent = APP\n  let i\n  // strip redundant leading global\n  if (parts[0] === 'APP') {\n    // remove leading global\n    parts = parts.slice(1)\n  }\n  for (i = 0; i < parts.length; i += 1) {\n    // create a property if it doesn't exist\n    if (typeof parent[parts[i]] === 'undefined')\n      parent[parts[i]] = {}\n\n    // \u5173\u952e: \u5411\u5185\u5d4c\u5957\n    parent = parent[parts[i]]\n  }\n  // \u8fd4\u56de\u6700\u5185\u5c42\u6a21\u5757\u540d\n  return parent\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// assign returned value to a local var\nconst module2 = APP.namespace('APP.modules.module2')\nconst truthy = module2 === APP.modules.module2 // true\n// skip initial `APP`\nAPP.namespace('modules.module51')\n// long namespace\nAPP.namespace('once.upon.a.time.there.was.this.long.nested.property')\n"})}),"\n",(0,t.jsx)(n.h4,{id:"namespace-module-usage",children:"Namespace Module Usage"}),"\n",(0,t.jsx)(n.p,{children:"\u901a\u8fc7\u4f20\u53c2\u533f\u540d\u51fd\u6570, \u521b\u5efa\u547d\u540d\u7a7a\u95f4, \u8fdb\u884c\u6a21\u5757\u5305\u88f9:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const app = {}\n\n;(function (exports) {\n  ;(function (exports) {\n    const api = {\n      moduleExists: function test() {\n        return true\n      },\n    }\n    // \u95ed\u5305\u5f0f\u7ee7\u627f,\u6269\u5c55exports\u5bf9\u8c61\u4e3aapi\u5bf9\u8c61\n    $.extend(exports, api)\n  })(typeof exports === 'undefined' ? window : exports)\n  // \u5c06api\u5bf9\u8c61\u7ed1\u5b9a\u81f3app\u5bf9\u8c61\u4e0a\n})(app)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// global object\nconst APP = {}\n// constructors\nAPP.Parent = function () {}\nAPP.Child = function () {}\n// a variable\nAPP.some_var = 1\n// an object container\nAPP.modules = {}\n// nested objects\nAPP.modules.module1 = {}\nAPP.modules.module1.data = { a: 1, b: 2 }\nAPP.modules.module2 = {}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// \u547d\u540d\u7a7a\u95f4\u6a21\u5f0f\nAPP.namespace('APP.utilities.array')\n\n// \u5f62\u53c2: \u5bfc\u5165\u5168\u5c40\u53d8\u91cf\nAPP.utilities.array = (function (app, global) {\n  // \u4f9d\u8d56\u6a21\u5f0f\n  const uObj = app.utilities.object\n  const uLang = app.utilities.lang\n\n  // \u79c1\u6709\u5c5e\u6027\n  const arrStr = '[object Array]'\n  const toStr = Object.prototype.toString\n\n  // \u79c1\u6709\u65b9\u6cd5\n  const inArray = function (haystack, needle) {\n    for (let i = 0, max = haystack.length; i < max; i += 1) {\n      if (haystack[i] === needle)\n        return i\n    }\n\n    return -1\n  }\n  const isArray = function (a) {\n    return toStr.call(a) === arrayString\n  }\n\n  // \u521d\u59cb\u5316\u6a21\u5f0f:\n  // \u521d\u59cb\u5316\u4ee3\u7801, \u53ea\u6267\u884c\u4e00\u6b21.\n\n  // \u63ed\u793a\u516c\u5171\u63a5\u53e3.\n  return {\n    isArray,\n    indexOf: inArray,\n  }\n})(APP, this)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"sandbox-module-pattern",children:"Sandbox Module Pattern"}),"\n",(0,t.jsx)(n.h4,{id:"sandbox-module-constructor",children:"Sandbox Module Constructor"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u79c1\u6709\u5c5e\u6027\u7ed1\u5b9a\u81f3 this/prototype."}),"\n",(0,t.jsx)(n.li,{children:"\u7279\u6743\u65b9\u6cd5\u7ed1\u5b9a\u81f3 modules/prototype."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function Sandbox(...args) {\n  // the last argument is the callback\n  const callback = args.pop()\n  // modules can be passed as an array or as individual parameters\n  let modules = args[0] && typeof args[0] === 'string' ? args : args[0]\n\n  // make sure the function is called\n  // as a constructor\n  if (!(this instanceof Sandbox))\n    return new Sandbox(modules, callback)\n\n  // add properties to `this` as needed:\n  this.a = 1\n  this.b = 2\n\n  // now add modules to the core `this` object\n  // no modules or \"*\" both mean \"use all modules\"\n  if (!modules || modules === '*') {\n    modules = []\n    for (const i in Sandbox.modules) {\n      if (Object.prototype.hasOwnProperty.call(Sandbox.modules, i))\n        modules.push(i)\n    }\n  }\n\n  // initialize the required modules\n  for (let i = 0; i < modules.length; i += 1)\n    Sandbox.modules[modules[i]](this)\n\n  // call the callback\n  callback(this)\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// any prototype properties as needed\nSandbox.prototype = {\n  name: 'My Application',\n  version: '1.0',\n  getName() {\n    return this.name\n  },\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u9759\u6001\u5c5e\u6027: \u4f7f\u7528\u6dfb\u52a0\u7684\u65b9\u6cd5/\u6a21\u5757:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Sandbox.modules = {}\nSandbox.modules.dom = function (box) {\n  box.getElement = function () {}\n  box.getStyle = function () {}\n  box.foo = 'bar'\n}\nSandbox.modules.event = function (box) {\n  // access to the Sandbox prototype if needed:\n  // box.constructor.prototype.m = \"mmm\";\n  box.attachEvent = function () {}\n  box.detachEvent = function () {}\n}\nSandbox.modules.ajax = function (box) {\n  box.makeRequest = function () {}\n  box.getResponse = function () {}\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"sandbox-module-usage",children:"Sandbox Module Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Sandbox(['ajax', 'event'], (box) => {\n  // console.log(box);\n})\n\nSandbox('*', (box) => {\n  // console.log(box);\n})\nSandbox((box) => {\n  // console.log(box);\n})\n\nSandbox('dom', 'event', (box) => {\n  // work with dom and event\n  Sandbox('ajax', (box) => {\n    // another \"box\" object\n    // this \"box\" is not the same as\n    // the \"box\" outside this function\n    // ...\n    // done with Ajax\n  })\n  // no trace of Ajax module here\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"commonjs-pattern",children:"CommonJS Pattern"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u65e0\u8bba\u4e00\u4e2a\u6a21\u5757\u5728 ",(0,t.jsx)(n.code,{children:"require()"})," \u4e2d\u88ab\u5f15\u7528\u591a\u5c11\u6b21, \u6a21\u5757\u6c38\u8fdc\u662f\u5355\u4f8b, \u53ea\u4f1a\u88ab\u52a0\u8f7d\u4e00\u6b21."]}),"\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u7b2c\u4e00\u6b21\u52a0\u8f7d\u540e\u4f1a\u88ab\u7f13\u5b58, \u540e\u7eed\u52a0\u8f7d\u4f1a\u53d6\u5f97\u7f13\u5b58\u7684\u6a21\u5757."}),"\n",(0,t.jsxs)(n.li,{children:["\u6a21\u5757\u52a0\u8f7d\u662f\u6a21\u5757\u7cfb\u7edf\u6267\u884c\u7684\u540c\u6b65\u64cd\u4f5c, ",(0,t.jsx)(n.code,{children:"require()"})," \u53ef\u4ee5\u4f4d\u4e8e\u6761\u4ef6\u8bed\u53e5\u4e2d."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/sabertazimi/hust-web/blob/v2.7.0/js/bundler/index.js",children:"Minimal CJS bundler"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"require.cache = Object.create(null)\n\n// Construct 'require', 'module' and 'exports':\nfunction require(moduleId) {\n  if (!(moduleId in require.cache)) {\n    const code = readFile(moduleId)\n    const module = { exports: {} }\n    require.cache[moduleId] = module\n    // eslint-disable-next-line no-new-func\n    const wrapper = new Function('require, exports, module', code)\n    // Bind code to module.exports:\n    wrapper(require, module.exports, module)\n  }\n  return require.cache[moduleId].exports\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"amd-pattern",children:"AMD Pattern"}),"\n",(0,t.jsx)(n.p,{children:"Asynchronous module definition:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// ID \u4e3a 'moduleA' \u7684\u6a21\u5757\u5b9a\u4e49:\n// moduleA \u4f9d\u8d56 moduleB.\n// moduleB \u4f1a\u5f02\u6b65\u52a0\u8f7d.\ndefine('moduleA', ['moduleB'], (moduleB) => {\n  return {\n    stuff: moduleB.doStuff(),\n  }\n})\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"define('moduleA', ['require', 'exports'], (require, exports) => {\n  const moduleB = require('moduleB')\n\n  if (condition) {\n    const moduleC = require('moduleC')\n  }\n\n  exports.stuff = moduleB.doStuff()\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"umd-pattern",children:"UMD Pattern"}),"\n",(0,t.jsx)(n.p,{children:"Universal module definition:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5224\u65ad\u662f\u5426\u652f\u6301 AMD (define), \u5b58\u5728\u5219\u4f7f\u7528 AMD \u65b9\u5f0f\u52a0\u8f7d\u6a21\u5757."}),"\n",(0,t.jsx)(n.li,{children:"\u5224\u65ad\u662f\u5426\u652f\u6301 Node.js \u7684\u6a21\u5757 (exports), \u5b58\u5728\u5219\u4f7f\u7528 Node.js \u6a21\u5757\u6a21\u5f0f."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"/**\n * UMD Boilerplate.\n */\n;(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], () => {\n      return factory(root)\n    })\n  } else if (typeof exports === 'object') {\n    module.exports = factory(root)\n  } else {\n    root.myPlugin = factory(root)\n  }\n})(\n  typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof window !== 'undefined'\n      ? window\n      : this,\n  (window) => {\n    'use strict'\n\n    // Module code goes here...\n    return {}\n  }\n)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"es6-module",children:"ES6 Module"}),"\n",(0,t.jsx)(n.h4,{id:"es6-module-features",children:"ES6 Module Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Singleton:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u662f\u5355\u4f8b."}),"\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u53ea\u80fd\u52a0\u8f7d\u4e00\u6b21:\n\u540c\u4e00\u4e2a\u6a21\u5757\u65e0\u8bba\u5728\u4e00\u4e2a\u9875\u9762\u4e2d\u88ab\u52a0\u8f7d\u591a\u5c11\u6b21,\n\u4e5f\u4e0d\u7ba1\u5b83\u662f\u5982\u4f55\u52a0\u8f7d\u7684, \u5b9e\u9645\u4e0a\u90fd\u53ea\u4f1a\u52a0\u8f7d\u4e00\u6b21."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Imports:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u53ef\u4ee5\u8bf7\u6c42\u52a0\u8f7d\u5176\u4ed6\u6a21\u5757."}),"\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u652f\u6301\u5faa\u73af\u4f9d\u8d56."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Static"})," and ",(0,t.jsx)(n.code,{children:"Read-only"})," imports."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Exports:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u53ef\u4ee5\u5b9a\u4e49\u516c\u5171\u63a5\u53e3."}),"\n",(0,t.jsx)(n.li,{children:"\u5176\u4ed6\u6a21\u5757\u53ef\u4ee5\u57fa\u4e8e\u8fd9\u4e2a\u516c\u5171\u63a5\u53e3\u89c2\u5bdf\u548c\u4ea4\u4e92."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Local Scope:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u4e0d\u5171\u4eab\u5168\u5c40\u547d\u540d\u7a7a\u95f4."}),"\n",(0,t.jsxs)(n.li,{children:["\u6a21\u5757\u9876\u7ea7 ",(0,t.jsx)(n.code,{children:"this"})," \u7684\u503c\u662f ",(0,t.jsx)(n.code,{children:"undefined"})," (\u4f20\u7edf\u811a\u672c\u4e2d\u662f ",(0,t.jsx)(n.code,{children:"window"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["\u6a21\u5757\u4e2d\u7684 ",(0,t.jsx)(n.code,{children:"var"})," \u58f0\u660e\u4e0d\u4f1a\u6dfb\u52a0\u5230 ",(0,t.jsx)(n.code,{children:"window"})," \u5bf9\u8c61."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Async:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u5728\u6d4f\u89c8\u5668\u4e2d\u662f\u5f02\u6b65\u52a0\u8f7d\u548c\u6267\u884c\u7684."}),"\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u4ee3\u7801\u53ea\u5728\u52a0\u8f7d\u540e\u6267\u884c."}),"\n",(0,t.jsxs)(n.li,{children:["\u89e3\u6790\u5230 ",(0,t.jsx)(n.code,{children:'<script type="module">'})," \u6807\u7b7e\u540e\u4f1a\u7acb\u5373\u4e0b\u8f7d\u6a21\u5757\u6587\u4ef6,\n\u4f46",(0,t.jsx)(n.strong,{children:"\u6267\u884c\u4f1a\u5ef6\u8fdf"}),"\u5230 HTML \u6587\u6863\u89e3\u6790\u5b8c\u6210 (",(0,t.jsx)(n.code,{children:"<script defer>"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Strict:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6a21\u5757\u4ee3\u7801\u9ed8\u8ba4\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\u6267\u884c."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Static:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Static"})," and ",(0,t.jsx)(n.code,{children:"Read-only"})," imports: \u6a21\u5757\u662f\u9759\u6001\u7ed3\u6784.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Imported module is ",(0,t.jsx)(n.code,{children:"Pre-parsed"}),":\nimported modules get run first,\ncode which imports module gets executed after."]}),"\n",(0,t.jsxs)(n.li,{children:["Imported module is ",(0,t.jsx)(n.code,{children:"Read-only"}),":\ncode which imports module cannot modify imported module,\nonly module which exports them can change its value."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Static analysis."}),"\n",(0,t.jsx)(n.li,{children:"Tree shaking."}),"\n",(0,t.jsx)(n.li,{children:"Compact bundling."}),"\n",(0,t.jsx)(n.li,{children:"Faster imports lookup."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'\x3c!-- \u652f\u6301\u6a21\u5757\u7684\u6d4f\u89c8\u5668\u4f1a\u6267\u884c\u8fd9\u6bb5\u811a\u672c --\x3e\n\x3c!-- \u4e0d\u652f\u6301\u6a21\u5757\u7684\u6d4f\u89c8\u5668\u4e0d\u4f1a\u6267\u884c\u8fd9\u6bb5\u811a\u672c --\x3e\n<script type="module" src="module.js"><\/script>\n\n\x3c!-- \u652f\u6301\u6a21\u5757\u7684\u6d4f\u89c8\u5668\u4e0d\u4f1a\u6267\u884c\u8fd9\u6bb5\u811a\u672c --\x3e\n\x3c!-- \u4e0d\u652f\u6301\u6a21\u5757\u7684\u6d4f\u89c8\u5668\u4f1a\u6267\u884c\u8fd9\u6bb5\u811a\u672c --\x3e\n<script nomodule src="script.js"><\/script>\n'})}),"\n",(0,t.jsx)(n.h4,{id:"es6-module-syntax",children:"ES6 Module Syntax"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import * as Bar from './bar.js' // Object.freeze(Bar)\nimport module from './module.js'\nimport { lastName as surname } from './profile.js'\nimport './foo.js' // Load effects\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"export const firstName = 'Michael'\nexport const lastName = 'Jackson'\nexport const year = 1958\nexport function foo() {}\nexport function* bar() {}\nexport class Foo {}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// profile.js\nconst firstName = 'Michael'\nconst lastName = 'Jackson'\nconst year = 1958\n\nexport { firstName, lastName, year }\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"export { default as Article } from './Article'\n// \u63a5\u53e3\u6539\u540d\nexport { foo as myFoo } from 'node:module'\n\n// \u6574\u4f53\u8f93\u51fa\nexport * from 'utils'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"es6-module-imports",children:"ES6 Module Imports"}),"\n",(0,t.jsxs)(n.p,{children:["Import meta ",(0,t.jsx)(n.code,{children:"import.meta"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// index.mjs\nimport './index2.mjs?someURLInfo=5'\n\n// index2.mjs\nnew URL(import.meta.url).searchParams.get('someURLInfo') // 5\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const urlOfData = new URL('data.txt', import.meta.url)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Import assertion:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import data from './data.json' assert { type: 'json' }\n\nconsole.log(data)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Import map ",(0,t.jsx)(n.code,{children:"importmap"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<script type="importmap">\n  {\n    "imports": {\n      "ms": "https://cdn.skypack.dev/ms"\n      "lodash": "https://cdn.skypack.dev/lodash",\n      "lodash": "https://cdn.skypack.dev/lodash/",\n    }\n  }\n<\/script>\n<script type="module">\n  import get from \'lodash/get.js\'\n  import lodash from \'lodash\'\n  import(\'lodash\').then((_) => {})\n<\/script>\n'})}),"\n",(0,t.jsx)(n.admonition,{title:"Imports Order",type:"tip",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Polyfills: ",(0,t.jsx)(n.code,{children:"import 'reflect-metadata';"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Node builtin modules: ",(0,t.jsx)(n.code,{children:"import fs from 'node:fs';"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["External modules: ",(0,t.jsx)(n.code,{children:"import { motion } from 'framer-motion';"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Internal modules: ",(0,t.jsx)(n.code,{children:"import { UserService } from 'src/services/userService';"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Parent directory modules: ",(0,t.jsx)(n.code,{children:"import foo from '../foo'; import qux from '../../foo/qux';"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Same/Sibling directory modules: ",(0,t.jsx)(n.code,{children:"import bar from './bar'; import baz from './bar/baz';"}),"."]}),"\n"]})}),"\n",(0,t.jsx)(n.h4,{id:"es6-module-exports",children:"ES6 Module Exports"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"CommonJS \u6a21\u5757\u662f\u8fd0\u884c\u65f6\u52a0\u8f7d, ES6 \u6a21\u5757\u662f\u7f16\u8bd1\u65f6\u8f93\u51fa\u63a5\u53e3."}),"\n",(0,t.jsx)(n.li,{children:"CommonJS \u662f\u5355\u4e2a\u503c\u5bfc\u51fa, ES6 Module \u53ef\u4ee5\u5bfc\u51fa\u591a\u4e2a."}),"\n",(0,t.jsx)(n.li,{children:"CommonJS \u662f\u52a8\u6001\u8bed\u6cd5\u53ef\u4ee5\u5199\u5728\u5224\u65ad\u91cc, ES6 Module \u662f\u9759\u6001\u8bed\u6cd5\u53ea\u80fd\u5199\u5728\u9876\u5c42."}),"\n",(0,t.jsxs)(n.li,{children:["CommonJS \u7684 ",(0,t.jsx)(n.code,{children:"this"})," \u662f\u5f53\u524d\u6a21\u5757, ES6 Module \u7684 ",(0,t.jsx)(n.code,{children:"this"})," \u662f ",(0,t.jsx)(n.code,{children:"undefined"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["CommonJS \u6a21\u5757\u8f93\u51fa\u7684\u662f\u4e00\u4e2a\u503c\u7684\u62f7\u8d1d,\nES6 \u6a21\u5757 ",(0,t.jsx)(n.code,{children:"export"})," \u5206\u591a\u79cd\u60c5\u51b5:","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"export default xxx"})," \u8f93\u51fa ",(0,t.jsx)(n.code,{children:"value"}),":\n",(0,t.jsx)(n.code,{children:"defaultThing"})," and ",(0,t.jsx)(n.code,{children:"anotherDefaultThing"})," shows ES6 export default value,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"export xxx"})," \u8f93\u51fa ",(0,t.jsx)(n.code,{children:"reference"}),":\n",(0,t.jsx)(n.code,{children:"importedThing"})," and ",(0,t.jsx)(n.code,{children:"module.thing"})," shows ES6 export live reference,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"Destructuring"})})," behavior create a brand new value."]}),"\n",(0,t.jsxs)(n.li,{children:["function/class special case:\n",(0,t.jsx)(n.code,{children:"export default function/class thing() {}; // function/class expressions"}),"\nexport live reference,\n",(0,t.jsx)(n.code,{children:"function/class thing() {}; export default thing; // function/class statements"}),"\nexport default value."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Export default value:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// module.js\nlet thing = 'initial'\n\nexport { thing }\nexport default thing\n\nsetTimeout(() => {\n  thing = 'changed'\n}, 500)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// main.js\nimport { default as defaultThing, thing } from \'./module.js\'\nimport anotherDefaultThing from \'./module.js\'\n\nsetTimeout(() => {\n  console.log(thing) // "changed"\n  console.log(defaultThing) // "initial"\n  console.log(anotherDefaultThing) // "initial"\n}, 1000)\n'})}),"\n",(0,t.jsx)(n.p,{children:"Export live reference:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// module.js\nexport let thing = 'initial'\n\nsetTimeout(() => {\n  thing = 'changed'\n}, 500)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// main.js\nimport { thing as importedThing } from './module.js'\nconst module = await import('./module.js')\nlet { thing } = await import('./module.js') // Destructuring behavior\n\nsetTimeout(() => {\n  console.log(importedThing) // \"changed\"\n  console.log(module.thing) // \"changed\"\n  console.log(thing) // \"initial\"\n}, 1000)\n"})}),"\n",(0,t.jsx)(n.p,{children:"To sum up:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Live reference:\nimport { thing } from './module.js'\nimport { thing as otherName } from './module.js'\n\n// Current value:\nconst { thing } = await import('./module.js')\n\n// Live reference:\nexport { thing }\nexport { thing as otherName }\nexport { thing as default }\nexport default function thing() {}\n\n// Current value:\nexport default thing\nexport default 'hello!'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"proxy-and-reflect",children:"Proxy and Reflect"}),"\n",(0,t.jsxs)(n.p,{children:["Modify default object behavior with ",(0,t.jsx)(n.code,{children:"Proxy"})," and ",(0,t.jsx)(n.code,{children:"Reflect"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"new Proxy(target, handler)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Proxy.revocable(target, handler)"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const proxy = new Proxy(target, {\n  set(target, name, value, receiver) {\n    const success = Reflect.set(target, name, value, receiver)\n    if (success)\n      log(`property ${name} on ${target} set to ${value}`)\n\n    return success\n  },\n})\n"})}),"\n",(0,t.jsx)(n.h3,{id:"proxy",children:"Proxy"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Change original object will change proxy object."}),"\n",(0,t.jsxs)(n.li,{children:["change proxy object will change original object via ",(0,t.jsx)(n.code,{children:"set"})," related API."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Proxy.prototype"})," \u4e3a ",(0,t.jsx)(n.code,{children:"undefined"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"target !== proxy"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const target = {\n  id: 'target',\n}\nconst handler = {}\nconst proxy = new Proxy(target, handler)\n\n// Proxy.prototype \u662f undefined\nconsole.log(target instanceof Proxy) // TypeError\nconsole.log(proxy instanceof Proxy) // TypeError\n// \u4e25\u683c\u76f8\u7b49\u53ef\u4ee5\u7528\u6765\u533a\u5206\u4ee3\u7406\u548c\u76ee\u6807\nconsole.log(target === proxy) // false\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"this"})," binding should process carefully:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const proxy = new Proxy(new Date(), {})\nproxy.getDate() // `getDate` rely on internal slots\n// TypeError: `this` is not a Date object.\n\nconst handler = {\n  get(target, propKey, receiver) {\n    if (propKey === 'getDate')\n      return target.getDate.bind(target)\n\n    return Reflect.get(target, propKey, receiver)\n  },\n}\nconst proxy = new Proxy(new Date('2020-12-24'), handler)\nproxy.getDate() // 24\n"})}),"\n",(0,t.jsx)(n.h3,{id:"reflect",children:"Reflect"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.get(target, propKey)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.set(target, propKey, value)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.has(target, propKey)"}),":\n",(0,t.jsx)(n.code,{children:"in"})," operator."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.defineProperty(target, propKey, attributes)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.getOwnPropertyDescriptor(target, propKey)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.deleteProperty(target, propKey)"}),":\n",(0,t.jsx)(n.code,{children:"delete"})," operator."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.ownKeys(target)"}),":\n",(0,t.jsx)(n.code,{children:"Object.keys()"})," + ",(0,t.jsx)(n.code,{children:"Object.getOwnPropertyNames()"})," + ",(0,t.jsx)(n.code,{children:"Object.getOwnPropertySymbols()"}),",\nall keys."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.getPrototypeOf(target)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.setPrototypeOf(target, prototype)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.isExtensible(target)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.preventExtensions(target)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.apply(target, thisArgument, argumentsList)"}),":\nfunction call."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Reflect.construct(target, argumentsList)"}),":\n",(0,t.jsx)(n.code,{children:"new target(...argumentsList)"})," operator."]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Proxy Behavior"}),(0,t.jsx)(n.th,{children:"Overrides Behavior"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.get()"})}),(0,t.jsx)(n.td,{children:"Reading a property value"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.set()"})}),(0,t.jsx)(n.td,{children:"Writing to a property"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.has()"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"in"})," operator"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.deleteProperty()"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"delete"})," operator"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.getPrototypeOf()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Object.getPrototypeOf()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.setPrototypeOf()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Object.setPrototypeOf()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.isExtensible()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Object.isExtensible()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.preventExtensions()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Object.preventExtensions()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.getOwnPropertyDescriptor()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Object.getOwnPropertyDescriptor()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.defineProperty()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Object.defineProperty()"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.ownKeys()"})}),(0,t.jsxs)(n.td,{children:["All ",(0,t.jsx)(n.code,{children:"Object"})," keys methods"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.apply()"})}),(0,t.jsx)(n.td,{children:"Calling a function"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Reflect.construct()"})}),(0,t.jsxs)(n.td,{children:["Calling a function with ",(0,t.jsx)(n.code,{children:"new"})]})]})]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const target = {\n  foo: 'bar',\n}\nconst proxy = new Proxy(target, Reflect)\nconsole.log(proxy.foo) // bar\nconsole.log(target.foo) // bar\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'Reflect.ownKeys({ z: 3, y: 2, x: 1 }) // [ "z", "y", "x" ]\nReflect.ownKeys([]) // ["length"]\n\nconst sym = Symbol.for(\'comet\')\nconst sym2 = Symbol.for(\'meteor\')\nconst obj = {\n  [sym]: 0,\n  \'str\': 0,\n  \'773\': 0,\n  \'0\': 0,\n  [sym2]: 0,\n  \'-1\': 0,\n  \'8\': 0,\n  \'second str\': 0,\n}\n\nReflect.ownKeys(obj)\n// [ "0", "8", "773", "str", "-1", "second str", Symbol(comet), Symbol(meteor) ]\n// Indexes in numeric order,\n// strings in insertion order,\n// symbols in insertion order.\n'})}),"\n",(0,t.jsxs)(n.p,{children:["CommonJS (",(0,t.jsx)(n.code,{children:"CJS"}),") to ES Module (",(0,t.jsx)(n.code,{children:"ESM"}),") exports:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const esm$1 = { exports: {} }\n\n;(function (module, exports) {\n  module.exports = () => {}\n  exports.a = 3\n  exports.b = 4\n})(esm$1, esm$1.exports)\n\nconst esm = esm$1.exports\n\nexport { esm as default }\n"})}),"\n",(0,t.jsx)(n.h3,{id:"proxy-usage",children:"Proxy Usage"}),"\n",(0,t.jsx)(n.h4,{id:"default-zero-value-protection",children:"Default Zero Value Protection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function withZeroValue(target, zeroValue = 0) {\n  return new Proxy(target, {\n    get: (obj, prop) => (prop in obj ? obj[prop] : zeroValue),\n  })\n}\n\nlet pos = { x: 4, y: 19 }\nconsole.log(pos.z) // => undefined\npos = withZeroValue(pos)\nconsole.log(pos.z) // => 0\n"})}),"\n",(0,t.jsx)(n.h4,{id:"hiding-properties-protection",children:"Hiding Properties Protection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function hide(target, prefix = '_') {\n  return new Proxy(target, {\n    has: (obj, prop) => !prop.startsWith(prefix) && prop in obj,\n    ownKeys: obj =>\n      Reflect.ownKeys(obj).filter(\n        prop => typeof prop !== 'string' || !prop.startsWith(prefix)\n      ),\n    get: (obj, prop, rec) => (prop in rec ? obj[prop] : undefined),\n  })\n}\n\nconst userData = hide({\n  firstName: 'Tom',\n  mediumHandle: '@bar',\n  _favoriteRapper: 'Drake',\n})\n\nconst falsy = '_favoriteRapper' in userData // has: false\nconst keys = Object.keys(userData) // ownKeys: ['firstName', 'mediumHandle']\nconsole.log(userData._favoriteRapper) // get: undefined\n"})}),"\n",(0,t.jsx)(n.h4,{id:"read-only-object-protection",children:"Read Only Object Protection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function NOPE() {\n  throw new Error('Can\\'t modify read-only object')\n}\n\nconst NOPE_HANDLER = {\n  set: NOPE,\n  defineProperty: NOPE,\n  deleteProperty: NOPE,\n  preventExtensions: NOPE,\n  setPrototypeOf: NOPE,\n  get: (obj, prop) => {\n    if (prop in obj)\n      return Reflect.get(obj, prop)\n\n    throw new ReferenceError(`Unknown prop \"${prop}\"`)\n  },\n}\n\nconst readOnly = target => new Proxy(target, NODE_HANDLER)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"range-validation",children:"Range Validation"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"in"})," operator capture:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function range(min, max) {\n  return new Proxy(Object.create(null), {\n    has: (_, prop) => +prop >= min && +prop <= max,\n  })\n}\n\nconst X = 10.5\nconst nums = [1, 5, X, 50, 100]\n\nif (X in range(1, 100)) {\n  // => true\n}\n\nnums.filter(n => n in range(1, 10))\n// => [1, 5]\n"})}),"\n",(0,t.jsx)(n.h4,{id:"property-validation",children:"Property Validation"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"set"})," operator capture:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const target = {\n  onlyNumbersGoHere: 0,\n}\n\nconst proxy = new Proxy(target, {\n  set(target, property, value) {\n    if (typeof value !== 'number')\n      return false\n    else\n      return Reflect.set(target, property, value)\n  },\n})\n\nproxy.onlyNumbersGoHere = 1\nconsole.log(proxy.onlyNumbersGoHere) // 1\nproxy.onlyNumbersGoHere = '2'\nconsole.log(proxy.onlyNumbersGoHere) // 1\n"})}),"\n",(0,t.jsx)(n.h4,{id:"function-parameter-validation",children:"Function Parameter Validation"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"apply"})," operator capture:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function median(...nums) {\n  return nums.sort()[Math.floor(nums.length / 2)]\n}\n\nconst proxy = new Proxy(median, {\n  apply(target, thisArg, argumentsList) {\n    for (const arg of argumentsList) {\n      if (typeof arg !== 'number')\n        throw new TypeError('Non-number argument provided')\n    }\n\n    return Reflect.apply(target, thisArg, argumentsList)\n  },\n})\n\nconsole.log(proxy(4, 7, 1)) // 4\nconsole.log(proxy(4, '7', 1))\n// TypeError: Non-number argument provided\n\nclass Person {\n  constructor(name) {\n    this.name = name\n  }\n}\n\nconst PersonProxy = new Proxy(Person, {\n  apply(TrapTarget, thisArg, argumentList) {\n    return new TrapTarget(...argumentList)\n  },\n})\n\nconst me = PersonProxy('Nicholas')\nconsole.log(me.name) // \"Nicholas\"\nconsole.log(me instanceof Person) // true\nconsole.log(me instanceof PersonProxy) // true\n"})}),"\n",(0,t.jsx)(n.h4,{id:"constructor-parameter-validation",children:"Constructor Parameter Validation"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"new"})," operator capture:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class User {\n  constructor(id) {\n    this.id_ = id\n  }\n}\n\nconst ProxyUser = new Proxy(User, {\n  construct(target, argumentsList, newTarget) {\n    if (argumentsList[0] === undefined)\n      throw new Error('User cannot be instantiated without id')\n    else\n      return Reflect.construct(target, argumentsList, newTarget)\n  },\n})\n\nconst obj = new ProxyUser(1)\nconst throwError = new ProxyUser()\n// Error: User cannot be instantiated without id\n"})}),"\n",(0,t.jsx)(n.h4,{id:"negative-array-indices-protection",children:"Negative Array Indices Protection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function negativeArray(els) {\n  return new Proxy(target, {\n    get: (target, propKey, receiver) =>\n      Reflect.get(\n        target,\n        +propKey < 0 ? String(target.length + +propKey) : propKey,\n        receiver\n      ),\n  })\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"array-manipulation-protection",children:"Array Manipulation Protection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function toUint32(value) {\n  return Math.floor(Math.abs(Number(value))) % 2 ** 32\n}\n\nfunction isArrayIndex(key) {\n  const numericKey = toUint32(key)\n  return String(numericKey) === key && numericKey < 2 ** 32 - 1\n}\n\nclass MyArray {\n  constructor(length = 0) {\n    this.length = length\n\n    return new Proxy(this, {\n      set(trapTarget, key, value) {\n        const currentLength = Reflect.get(trapTarget, 'length')\n\n        // the special case\n        if (isArrayIndex(key)) {\n          const numericKey = Number(key)\n\n          if (numericKey >= currentLength)\n            Reflect.set(trapTarget, 'length', numericKey + 1)\n        } else if (key === 'length') {\n          if (value < currentLength) {\n            for (let index = currentLength - 1; index >= value; index--)\n              Reflect.deleteProperty(trapTarget, index)\n          }\n        }\n\n        // always do this regardless of key type\n        return Reflect.set(trapTarget, key, value)\n      },\n    })\n  }\n}\n\nconst colors = new MyArray(3)\nconsole.log(colors instanceof MyArray) // true\nconsole.log(colors.length) // 3\n\ncolors[0] = 'red'\ncolors[1] = 'green'\ncolors[2] = 'blue'\ncolors[3] = 'black'\nconsole.log(colors.length) // 4\n\ncolors.length = 2\nconsole.log(colors.length) // 2\nconsole.log(colors[3]) // undefined\nconsole.log(colors[2]) // undefined\nconsole.log(colors[1]) // \"green\"\nconsole.log(colors[0]) // \"red\"\n"})}),"\n",(0,t.jsx)(n.h4,{id:"exception-protection",children:"Exception Protection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function createExceptionProxy(target) {\n  return new Proxy(target, {\n    get: (target, prop) => {\n      if (!(prop in target))\n        return\n\n      if (typeof target[prop] === 'function')\n        return createExceptionZone(target, prop)\n\n      return target[prop]\n    },\n  })\n}\n\nfunction createExceptionZone(target, prop) {\n  return (...args) => {\n    let result\n    ExceptionsZone.run(() => {\n      result = target[prop](...args)\n    })\n    return result\n  }\n}\n\nclass ExceptionsZone {\n  static exceptionHandler = new ExceptionHandler()\n\n  static run(callback) {\n    try {\n      callback()\n    } catch (e) {\n      this.exceptionHandler.handle(e)\n    }\n  }\n}\n\nclass ExceptionHandler {\n  handle(exception) {\n    console.log('\u8bb0\u5f55\u9519\u8bef: ', exception.message, exception.stack)\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const obj = {\n  name: 'obj',\n  say() {\n    console.log(`Hi, I'm ${this.name}`)\n  },\n  coding() {\n    // xxx.\n    throw new Error('bug')\n  },\n  coding2() {\n    // xxx.\n    throw new Error('bug2')\n  },\n}\n\nconst proxy = createProxy(obj)\n\nproxy.say()\nproxy.coding()\n"})}),"\n",(0,t.jsx)(n.h4,{id:"proxy-pattern-implementation",children:"Proxy Pattern Implementation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Remote mock and placeholder:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Data mock."}),"\n",(0,t.jsx)(n.li,{children:"Image placeholder."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Cache:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Database objects access caching."}),"\n",(0,t.jsx)(n.li,{children:"Memoized functions."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Profiling."}),"\n",(0,t.jsx)(n.li,{children:"Observer and watcher: Vue 3 reactivity, ImmerJS draft state."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"proxy-and-defineproperty",children:"Proxy and DefineProperty"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Simple: ",(0,t.jsx)(n.code,{children:"Proxy"})," \u4f7f\u7528\u4e0a\u6bd4 ",(0,t.jsx)(n.code,{children:"Object.defineProperty"})," \u65b9\u4fbf.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Object.defineProperty"})," \u53ea\u80fd\u76d1\u542c\u5bf9\u8c61, \u5bfc\u81f4 ",(0,t.jsx)(n.code,{children:"Vue 2"})," ",(0,t.jsx)(n.code,{children:"data"})," \u5c5e\u6027\u5fc5\u987b\u901a\u8fc7\u4e00\u4e2a\u8fd4\u56de\u5bf9\u8c61\u7684\u51fd\u6570\u65b9\u5f0f\u521d\u59cb\u5316,"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Vue 3"})," \u66f4\u52a0\u591a\u5143\u5316, \u53ef\u4ee5\u76d1\u542c\u4efb\u610f\u6570\u636e."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Performant: ",(0,t.jsx)(n.code,{children:"Proxy"})," \u4ee3\u7406\u6574\u4e2a\u5bf9\u8c61, ",(0,t.jsx)(n.code,{children:"Object.defineProperty"})," \u53ea\u4ee3\u7406\u5bf9\u8c61\u4e0a\u7684\u67d0\u4e2a\u5c5e\u6027.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Object.defineProperty"})," \u7531\u4e8e\u6bcf\u6b21\u53ea\u80fd\u76d1\u542c\u5bf9\u8c61\u4e00\u4e2a\u952e\u7684 ",(0,t.jsx)(n.code,{children:"get"}),"/",(0,t.jsx)(n.code,{children:"set"}),", \u5bfc\u81f4\u9700\u8981\u5faa\u73af\u76d1\u542c\u6d6a\u8d39\u6027\u80fd."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Proxy"})," \u53ef\u4ee5\u4e00\u6b21\u6027\u76d1\u542c\u5230\u6240\u6709\u5c5e\u6027."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Lazy: ",(0,t.jsx)(n.code,{children:"Proxy"})," \u6027\u80fd\u4f18\u4e8e ",(0,t.jsx)(n.code,{children:"Object.defineProperty"}),".","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5982\u679c\u5bf9\u8c61\u5185\u90e8\u8981\u5168\u90e8\u9012\u5f52\u4ee3\u7406, \u5219 ",(0,t.jsx)(n.code,{children:"Proxy"})," \u53ef\u4ee5\u53ea\u5728\u8c03\u7528\u65f6\u9012\u5f52."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Object.defineProperty"})," \u9700\u8981\u5728\u4e00\u5f00\u59cb\u5c31\u5168\u90e8\u9012\u5f52."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Feature:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5bf9\u8c61\u4e0a\u5b9a\u4e49\u65b0\u5c5e\u6027\u65f6, \u53ea\u6709 ",(0,t.jsx)(n.code,{children:"Proxy"})," \u53ef\u4ee5\u76d1\u542c\u5230:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Vue2: \u63d0\u4f9b ",(0,t.jsx)(n.code,{children:"Vue.set"}),"/",(0,t.jsx)(n.code,{children:"Vue.delete"})," \u7b49\u8f85\u52a9\u65b9\u6cd5."]}),"\n",(0,t.jsxs)(n.li,{children:["Vue3: ",(0,t.jsx)(n.code,{children:"Proxy"})," \u76d1\u542c\u65b0\u5c5e\u6027."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u6570\u7ec4\u65b0\u589e\u5220\u9664\u4fee\u6539\u65f6, \u53ea\u6709 ",(0,t.jsx)(n.code,{children:"Proxy"})," \u53ef\u4ee5\u76d1\u542c\u5230:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Object.defineProperty"})," \u65e0\u6cd5\u76d1\u542c\u6570\u7ec4, ",(0,t.jsx)(n.code,{children:"Proxy"})," \u5219\u53ef\u4ee5\u76f4\u63a5\u76d1\u542c\u6570\u7ec4\u53d8\u5316."]}),"\n",(0,t.jsx)(n.li,{children:"Vue2: \u91cd\u5199\u6570\u7ec4\u65b9\u6cd5\u76d1\u542c\u6570\u7ec4\u53d8\u5316."}),"\n",(0,t.jsxs)(n.li,{children:["Vue3: ",(0,t.jsx)(n.code,{children:"Proxy"})," \u76d1\u542c\u6570\u7ec4\u53d8\u5316."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Proxy"})," \u4e0d\u517c\u5bb9 IE, ",(0,t.jsx)(n.code,{children:"Object.defineProperty"})," \u4e0d\u517c\u5bb9 IE8 \u53ca\u4ee5\u4e0b."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"error-and-exception",children:"Error and Exception"}),"\n",(0,t.jsx)(n.h3,{id:"error",children:"Error"}),"\n",(0,t.jsx)(n.h4,{id:"error-type",children:"Error Type"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Error."}),"\n",(0,t.jsx)(n.li,{children:"EvalError."}),"\n",(0,t.jsx)(n.li,{children:"RangeError."}),"\n",(0,t.jsx)(n.li,{children:"ReferenceError."}),"\n",(0,t.jsx)(n.li,{children:"SyntaxError."}),"\n",(0,t.jsx)(n.li,{children:"TypeError."}),"\n",(0,t.jsx)(n.li,{children:"URIError."}),"\n",(0,t.jsx)(n.li,{children:"AggregateError."}),"\n",(0,t.jsx)(n.li,{children:"\u81ea\u5b9a\u4e49\u9519\u8bef."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class Error {\n  // Instance properties\n  message: string\n  cause?: any // ES2022\n  stack: string // non-standard but widely supported\n\n  constructor(message = '', options?: ErrorOptions) {\n    this.name = 'Error'\n    this.message = message\n    this.cause = options?.cause // ES2022: error chain.\n  }\n}\n\ninterface ErrorOptions {\n  cause?: string | Error // ES2022\n}\n\nclass CustomError extends Error {\n  constructor(message, options) {\n    super(message, options)\n    this.name = 'CustomError'\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"error-object",children:"Error Object"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const err = {\n  name: 'XXError',\n  message: 'something wrong',\n  extra: 'This was rather embarrassing',\n  remedy: genericErrorHandler, // \u5904\u7406\u9519\u8bef\u7684\u51fd\u6570\u540d.\n}\n\ntry {\n  throwError()\n} catch (e) {\n  console.log(e.message)\n  e.remedy() // genericErrorHandler.\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"exception",children:"Exception"}),"\n",(0,t.jsx)(n.h4,{id:"call-stack-overflow",children:"Call Stack Overflow"}),"\n",(0,t.jsx)(n.p,{children:"\u8c03\u7528\u6808\u5c3a\u5bf8\u9650\u5236\u5f02\u5e38, \u5e94\u7acb\u5373\u5b9a\u4f4d\u5728\u4ee3\u7801\u4e2d\u7684\u9012\u5f52\u5b9e\u4f8b\u4e0a:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"try {\n  recursion()\n} catch (ex) {\n  console.error('error info')\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"exception-handling",children:"Exception Handling"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"try catch"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promise.catch"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"window.addEventListener('error', handler, true)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"window.addEventListener('unhandledrejection', handler, true)"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Web Worker heartbeat monitoring."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"process.on('uncaughtException', handleError)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"process.on('SIGHUP', handleExit)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"process.on('SIGINT', handleExit)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"process.on('SIGQUIT', handleExit)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"process.on('SIGTERM', handleExit)"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"AOP (Aspect Oriented Programming): Middleware/Interceptor/Monkey Patch."}),"\n",(0,t.jsxs)(n.li,{children:["\u5728\u53ef\u80fd\u5931\u8d25\u7684\u5730\u65b9\u629b\u51fa\u5f02\u5e38, \u5bf9\u5931\u8d25\u5904\u505a\u6807\u7b7e, \u6613\u4e8e",(0,t.jsx)(n.strong,{children:"\u8c03\u8bd5\u4e0e\u6d4b\u8bd5"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"\u4fee\u590d bug \u540e, \u53ef\u8003\u8651\u662f\u5426\u5728\u6b64\u5904\u629b\u51fa\u5f02\u5e38."}),"\n",(0,t.jsx)(n.li,{children:"Avoid using try-catch inside a loop:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const object = ['foo', 'bar']\n\ntry {\n  for (let i = 0; i < object.length; i++) {\n    // do something that throws an exception\n  }\n} catch (e) {\n  // handle exception\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// \u76d1\u542c\u6355\u83b7\u9636\u6bb5\u7684\u5f02\u5e38\u4e8b\u4ef6\nwindow.addEventListener(\n  'error',\n  (error) => {\n    handleError(error)\n    error.preventDefault()\n  },\n  true\n)\n\n// Un-catch `Promise` handler\nwindow.addEventListener(\n  'unhandledrejection',\n  (error) => {\n    handleError(error)\n    error.preventDefault()\n  },\n  true\n)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const instance = axios.create({\n  baseURL: 'https://api.test.com',\n  timeout: 15000,\n  headers: {\n    'Content-Type': 'application/json',\n  },\n})\n\ninstance.interceptors.response.use(\n  (response) => {\n    return response.data\n  },\n  (error) => {\n    // \u53d1\u751f\u5f02\u5e38\u4f1a\u8d70\u5230\u8fd9\u91cc\n    if (error.response) {\n      const response = error.response\n\n      if (response.status >= 400)\n        handleError(response)\n    } else {\n      handleError(null)\n    }\n\n    return Promise.reject(error)\n  }\n)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"globalThis.onunhandledrejection = (event) => {\n  console.log(event.type)\n  // \"unhandledrejection\"\n  console.log(event.reason.message)\n  // \"Oops!\"\n  console.log(rejected === event.promise)\n  // true\n}\n\nglobalThis.onrejectionhandled = (event) => {\n  console.log(event.type)\n  // \"rejectionhandled\"\n  console.log(event.reason.message)\n  // \"Oops!\"\n  console.log(rejected === event.promise)\n  // true\n}\n\nconst possiblyUnhandledRejections = new Map()\n\n// when a rejection is unhandled, add it to the map\nglobalThis.onunhandledrejection = (event) => {\n  // prevents the console warning\n  event.preventDefault()\n  possiblyUnhandledRejections.set(event.promise, event.reason)\n}\n\n// when a rejection is handled, remove it from the map\nglobalThis.onrejectionhandled = (event) => {\n  possiblyUnhandledRejections.delete(event.promise)\n}\n\nsetInterval(() => {\n  possiblyUnhandledRejections.forEach((reason, promise) => {\n    console.error('Unhandled rejection')\n    console.error(promise)\n    console.error(reason.message ? reason.message : reason)\n    // do something to handle these rejections\n  })\n  possiblyUnhandledRejections.clear()\n}, 60000)\n\nconst rejected = Promise.reject(new Error('Oops!'))\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.log(reason.message)\n  // \"Oops!\"\n  console.log(rejected === promise)\n  // true\n})\n\nconst rejected = Promise.reject(new Error('Oops!'))\n\nsetTimeout(() => {\n  // \"rejectionhandled\" triggered here\n  rejected.catch(\n    reason => console.error(reason.message) // \"Oops!\"\n  )\n}, 500)\n\nprocess.on('rejectionHandled', (promise) => {\n  console.log(rejected === promise) // true\n})\n\nconst possiblyUnhandledRejections = new Map()\n\n// when a rejection is unhandled, add it to the map\nprocess.on('unhandledRejection', (reason, promise) => {\n  possiblyUnhandledRejections.set(promise, reason)\n})\n\nprocess.on('rejectionHandled', (promise) => {\n  possiblyUnhandledRejections.delete(promise)\n})\n\nsetInterval(() => {\n  possiblyUnhandledRejections.forEach((reason, promise) => {\n    console.error('Unhandled rejection')\n    console.error(promise)\n    console.error(reason.message ? reason.message : reason)\n    // do something to handle these rejections\n  })\n  possiblyUnhandledRejections.clear()\n}, 60000)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"regular-expression",children:"Regular Expression"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const re = /pattern/gi\n"})}),"\n",(0,t.jsx)(n.h3,{id:"regexp-flags",children:"RegExp Flags"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Guide/Regular_Expressions#advanced_searching_with_flags",children:"Flags"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"g"})," (global): \u5168\u5c40\u5339\u914d."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"i"})," (ignoreCase): \u5927\u5c0f\u5199\u4e0d\u654f\u611f\u5339\u914d."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"m"})," (multiline): \u591a\u884c\u5339\u914d."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"y"})," (sticky): \u7c98\u9644\u6a21\u5f0f, \u4fee\u9970\u7b26\u53f7\u9690\u542b\u4e86\u5934\u90e8\u5339\u914d\u7684\u6807\u5fd7."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"u"})," (unicode): Unicode \u6a21\u5f0f."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"s"})," (dotAll): Allows ",(0,t.jsx)(n.code,{children:"."})," to match ",(0,t.jsx)(n.code,{children:"newline"})," characters."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function codePointLength(text) {\n  const result = text.match(/[\\s\\S]/gu)\n  return result ? result.length : 0\n}\n\nconst s = '\ud842\udfb7\ud842\udfb7'\nconst length = s.length // 4\ncodePointLength(s) // 2\n"})}),"\n",(0,t.jsx)(n.h3,{id:"regexp-character-classes",children:"RegExp Character Classes"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Guide/Regular_Expressions/Character_Classes",children:"Character classes"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Characters"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Meaning"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"."})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"[^\\n\\r\\u2020\\u2029]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\d"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"[0-9]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\D"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"[^0-9]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\w"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"[0-9a-zA-Z_]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\W"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"[^0-9a-zA-Z_]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\s"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"[\\r\\n\\f\\t\\v]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\S"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"[^\\r\\n\\f\\t\\v]"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\b"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"start/end of word"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\B"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"not start/end of word"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\p{UnicodeProperty}"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"match unicode"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"\\P{UnicodeProperty}"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"not match unicode"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"^"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"start of string"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"$"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"end of string"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"regexp-quantifiers",children:"RegExp Quantifiers"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Guide/Regular_Expressions/Quantifiers",children:"Quantifiers"}),":"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Quantifiers"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Repeat Times"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"*"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"0+"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"+"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"1+"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"?"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"0 ~ 1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"{n}"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"n"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"{n,}"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"n+"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"{n,m}"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"n ~ m"})]})]})]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Lazy Quantifiers"}),(0,t.jsxs)(n.th,{style:{textAlign:"left"},children:["Repeat Times (As ",(0,t.jsx)(n.strong,{children:"Less"})," As Possible)"]})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"*?"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"0+"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"+?"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"1+"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"??"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"0 ~ 1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"{n,}?"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"n+"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"{n,m}?"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"n ~ m"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"regexp-group-and-ranges",children:"RegExp Group and Ranges"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Guide/Regular_Expressions/Groups_and_Ranges",children:"Groups"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["\u96f6\u5bbd\u65ad\u8a00: lookahead ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Guide/Regular_Expressions/Assertions",children:"assertion"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u5206\u7c7b"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u4ee3\u7801/\u8bed\u6cd5"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"\u8bf4\u660e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u6355\u83b7"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(exp)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5339\u914d exp,\u5e76\u6355\u83b7\u6587\u672c\u5230\u81ea\u52a8\u547d\u540d\u7684\u7ec4\u91cc"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"}}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(?<name>exp)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5339\u914d exp,\u5e76\u6355\u83b7\u6587\u672c\u5230\u540d\u79f0\u4e3a name \u7684\u7ec4\u91cc"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"}}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(?:exp)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5339\u914d exp,\u4e0d\u6355\u83b7\u5339\u914d\u7684\u6587\u672c, \u4e5f\u4e0d\u7ed9\u6b64\u5206\u7ec4\u5206\u914d\u7ec4\u53f7"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u96f6\u5bbd\u65ad\u8a00"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(?<=exp)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5339\u914d\u5de6\u4fa7\u662f exp \u7684\u4f4d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"}}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(?<!exp)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5339\u914d\u5de6\u4fa7\u4e0d\u662f exp \u7684\u4f4d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"}}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(?=exp)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5339\u914d\u53f3\u4fa7\u662f exp \u7684\u4f4d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"}}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(?!exp)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u5339\u914d\u53f3\u4fa7\u4e0d\u662f exp \u7684\u4f4d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u6ce8\u91ca"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:(0,t.jsx)(n.code,{children:"(?#comment)"})}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"\u7528\u4e8e\u63d0\u4f9b\u6ce8\u91ca\u8ba9\u4eba\u9605\u8bfb"})]})]})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"(?<=\\d)th"})," -> ",(0,t.jsx)(n.code,{children:"9th"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"(?<!\\d)th"})," -> ",(0,t.jsx)(n.code,{children:"health"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"six(?=\\d)"})," -> ",(0,t.jsx)(n.code,{children:"six6"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"hi(?!\\d)"})," -> ",(0,t.jsx)(n.code,{children:"high"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const string = 'Favorite GitHub Repos: tc39/ecma262 v8/v8.dev'\nconst regex = /\\b(?<owner>[a-z0-9]+)\\/(?<repo>[a-z0-9.]+)\\b/g\n\nfor (const match of string.matchAll(regex)) {\n  console.log(`${match[0]} at ${match.index} with '${match.input}'`)\n  console.log(`owner: ${match.groups.owner}`)\n  console.log(`repo: ${match.groups.repo}`)\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"regexp-back-reference",children:"RegExp Back Reference"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"$1 $2 $3"}),": \u7b2c n \u4e2a\u5b50\u8868\u8fbe\u5f0f\u5339\u914d\u7684\u7ed3\u679c\u5b57\u7b26."]}),"\n",(0,t.jsxs)(n.li,{children:["\u4f4d\u7f6e\u7f16\u53f7 (\u5de6\u62ec\u53f7\u7684\u987a\u5e8f): ",(0,t.jsx)(n.code,{children:"\\1 \\2 \\3"}),": \u7b2c n \u4e2a\u5b50\u8868\u8fbe\u5f0f\u5339\u914d\u7684\u7ed3\u679c\u5b57\u7b26."]}),"\n",(0,t.jsxs)(n.li,{children:["Named capture group back reference: ",(0,t.jsx)(n.code,{children:"\\k<Name>"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"\u53cd\u5411\u5f15\u7528\u53ef\u4ee5\u89e3\u51b3\u6b63\u5219\u8868\u8fbe\u5f0f\u56de\u6eaf\u5931\u63a7\u7684\u95ee\u9898 (ReDoS)."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const regExp = /((<\\/?\\w+>.*)\\2)/g\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const text = 'ooo111ooo222ooo333ooo123'\nconst regExp = /(\\d)\\1\\1/g\nconst result = text.match(regExp)\nconsole.log(result) // [111, 222, 333]\n"})}),"\n",(0,t.jsxs)(n.admonition,{title:"RegExp Static Property",type:"danger",children:[(0,t.jsxs)(n.p,{children:["Most ",(0,t.jsx)(n.code,{children:"RegExp.XXX"}),"/",(0,t.jsx)(n.code,{children:"RegExp.$X"})," static property aren't standard.\nAvoid use them in production:"]}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RegExp.input ($_)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RegExp.lastMatch ($&)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RegExp.lastParen ($+)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RegExp.leftContext"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RegExp.rightContext ($')"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"RegExp.$1-$9"}),"."]}),"\n"]})]}),"\n",(0,t.jsx)(n.h3,{id:"regexp-functions",children:"RegExp Functions"}),"\n",(0,t.jsxs)(n.p,{children:["RegExp ",(0,t.jsx)(n.a,{href:"https://exploringjs.com/impatient-js/ch_regexps.html#methods-for-working-with-regular-expressions",children:"functions"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["String:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"split"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"match"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"search"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"replace"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["RegExp:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"test"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"exec"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"regexp-test",children:"RegExp Test"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:";/[a-z|0-9]/i.test(str)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const ignoreList = [\n  // # All\n  '^npm-debug\\\\.log$', // Error log for npm\n  '^\\\\..*\\\\.swp$', // Swap file for vim state\n\n  // # macOS\n  '^\\\\.DS_Store$', // Stores custom folder attributes\n  '^\\\\.AppleDouble$', // Stores additional file resources\n  '^\\\\.LSOverride$', // Contains the absolute path to the app to be used\n  '^Icon\\\\r$', // Custom Finder icon: http://superuser.com/questions/298785/icon-file-on-os-x-desktop\n  '^\\\\._.*', // Thumbnail\n  '^\\\\.Spotlight-V100(?:$|\\\\/)', // Directory that might appear on external disk\n  '\\\\.Trashes', // File that might appear on external disk\n  '^__MACOSX$', // Resource fork\n\n  // # Linux\n  '~$', // Backup file\n\n  // # Windows\n  '^Thumbs\\\\.db$', // Image file cache\n  '^ehthumbs\\\\.db$', // Folder config file\n  '^Desktop\\\\.ini$', // Stores custom folder attributes\n  '@eaDir$', // \"hidden\" folder where the server stores thumbnails\n]\n\nexport const junkRegex = new RegExp(ignoreList.join('|'))\n\nexport function isJunk(filename) {\n  return junkRegex.test(filename)\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"rexexp-exec",children:"RexExp Exec"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec",children:(0,t.jsx)(n.code,{children:"exec()"})}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Search starts at substring specified by ",(0,t.jsx)(n.code,{children:"lastIndex"})," property."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const input = 'A string with 3 numbers in it... 42 and 88.'\nconst number = /\\b\\d+\\b/g\n\nfor (\n  let match = number.exec(input);\n  match !== null;\n  match = number.exec(input)\n)\n  console.log('Found', match[0], 'at', match.index)\n\n// Found 3 at 14\n// Found 42 at 33\n// Found 88 at 40\n"})}),"\n",(0,t.jsx)(n.h4,{id:"regexp-replace",children:"RegExp Replace"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"str.replace(regExp, str / func)\n"})}),"\n",(0,t.jsx)(n.h5,{id:"regexp-replace-arguments",children:"RegExp Replace Arguments"}),"\n",(0,t.jsxs)(n.p,{children:["\u7b2c\u4e8c\u4e2a\u53c2\u6570\u82e5\u4e3a\u51fd\u6570\u5f0f\u53c2\u6570, ",(0,t.jsx)(n.code,{children:"replace"})," \u65b9\u6cd5\u4f1a\u5411\u5b83\u4f20\u9012\u4e00\u7cfb\u5217\u53c2\u6570:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7b2c\u4e00\u4e2a\u53c2\u6570: \u5339\u914d\u7ed3\u679c\u5b57\u7b26\u4e32."}),"\n",(0,t.jsx)(n.li,{children:"\u7b2c n \u4e2a\u53c2\u6570: \u5b50\u8868\u8fbe\u5f0f\u5339\u914d\u7ed3\u679c\u5b57\u7b26\u4e32."}),"\n",(0,t.jsx)(n.li,{children:"\u5012\u6570\u7b2c\u4e8c\u4e2a\u53c2\u6570: \u5339\u914d\u6587\u672c\u5728\u6e90\u5b57\u7b26\u4e32\u4e2d\u7684\u4e0b\u6807\u4f4d\u7f6e."}),"\n",(0,t.jsx)(n.li,{children:"\u6700\u540e\u4e00\u4e2a\u53c2\u6570: \u6e90\u5b57\u7b26\u4e32\u81ea\u8eab."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function upper(all, letter) {\n  return letter.toUpperCase()\n}\n\nassert(\n  'border-bottom-width'.replace(/-(\\w)/g, upper) === 'borderBottomWidth',\n  'Camel cased a hyphenated string.'\n)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const RE_DATE = /(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})/\nconsole.log('1999-12-31'.replace(RE_DATE, '$<month>/$<day>/$<year>'))\n// 12/31/1999\n\nconst RE_DATE = /(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})/\nconsole.log(\n  '1999-12-31'.replace(\n    RE_DATE,\n    (g0, y, m, d, offset, input, { year, month, day }) =>\n      `${month}/${day}/${year}`\n  )\n)\n// 12/31/1999\n"})}),"\n",(0,t.jsx)(n.h5,{id:"regexp-replace-performance",children:"RegExp Replace Performance"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4f7f\u7528 2 \u4e2a\u5b50\u8868\u8fbe\u5f0f\u4fee\u526a\u5b57\u7b26\u4e32, \u5b57\u7b26\u4e32\u603b\u957f\u5ea6\u5f71\u54cd\u6027\u80fd."}),"\n",(0,t.jsx)(n.li,{children:"\u4f7f\u7528\u5faa\u73af\u4fee\u526a\u5b57\u7b26\u4e32 (\u5206\u522b\u7528 \u6b63/\u8d1f\u5faa\u73af \u4fee\u526a \u9996/\u5c3e\u7a7a\u767d\u7b26), \u7a7a\u767d\u5b57\u7b26\u957f\u5ea6\u5f71\u54cd\u6027\u80fd."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"if (!String.prototype.trim) {\n  // eslint-disable-next-line no-extend-native\n  String.prototype.trim = function () {\n    return this.replace(/^\\s+/, '').replace(/\\s+$/, '')\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"if (!String.prototype.trim) {\n  // eslint-disable-next-line no-extend-native\n  String.prototype.trim = function () {\n    const str = this.replace(/^\\s+/, '')\n    let end = str.length - 1\n    const ws = /\\s/\n\n    while (ws.test(str.charAt(end)))\n      end--\n\n    return str.slice(0, end + 1)\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"regexp-best-practice",children:"RegExp Best Practice"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u4e0d\u4f7f\u7528 new RegExp(),\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u9762\u91cf"}),"\n",(0,t.jsx)(n.li,{children:"\u5c06\u6b63\u5219\u8868\u8fbe\u5f0f\u8d4b\u503c\u7ed9\u53d8\u91cf, \u9632\u6b62\u6b63\u5219\u8868\u8fbe\u5f0f\u91cd\u590d\u521b\u5efa"}),"\n",(0,t.jsxs)(n.li,{children:["\u4ee5\u7b80\u5355(\u552f\u4e00\u6027)\u5b57\u5143\u5f00\u59cb, \u5982 ",(0,t.jsx)(n.code,{children:"^/$ x \\u363A [a-z] \\b"}),", \u907f\u514d\u4ee5\u5206\u7ec4\u8868\u8fbe\u5f0f\u5f00\u59cb:\ne.g ",(0,t.jsx)(n.code,{children:"\\s\\s*"})," \u4f18\u4e8e ",(0,t.jsx)(n.code,{children:"\\s{1,}"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"\u51cf\u5c11\u8868\u8fbe\u5f0f\u7684\u91cd\u53e0\u5339\u914d."}),"\n",(0,t.jsx)(n.li,{children:"\u51cf\u5c11\u5206\u652f\u8868\u8fbe\u5f0f,\u5e76\u5c06\u6700\u5e38\u7528\u7684\u5206\u652f\u653e\u5728\u6700\u524d\u9762."}),"\n",(0,t.jsxs)(n.li,{children:["\u65e0\u9700\u53cd\u5411\u5f15\u7528\u65f6, \u4f7f\u7528\u975e\u6355\u83b7\u7ec4:\ne.g ",(0,t.jsx)(n.code,{children:"(?:...)"})," \u4f18\u4e8e ",(0,t.jsx)(n.code,{children:"(...)"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"regexp-use-case",children:"RegExp Use Case"}),"\n",(0,t.jsx)(n.h4,{id:"common-pattern",children:"Common Pattern"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/abc/"}),": Characters sequence."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/[abc]/"}),": Characters set."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/[^abc]/"}),": Non characters set."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/[0-9]/"}),": Characters range."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/x+/"}),": 1+ (Greedy)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/x+?/"}),": 1+ (Lazy)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/x*/"}),": 0+."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/x?/"}),": 0/1."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/x{2,4}/"}),": 2 ~ 4."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/(abc)/"}),": Captured group."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/a|b|c/"}),": Or patterns."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/\\d/"}),": Digit character."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/\\w/"}),': Alphanumeric character ("word character").']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/\\s/"}),": Whitespace character."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/./"}),": Character except ",(0,t.jsx)(n.code,{children:"newlines"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/\\b/"}),": Word boundary."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/^/"}),": Start of input."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/$/"}),": End of input."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"\u975eX\u6355\u83b7\u7ec4"})," + ",(0,t.jsx)(n.code,{children:"\u7279\u5f81\u5b57\u7b26"})," + ",(0,t.jsx)(n.code,{children:"\u975eY\u6355\u83b7\u7ec4"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// URLSearchParams [key, value]\nconst pattern = /([^&=]+)=([^&]*)/g\n"})}),"\n",(0,t.jsx)(n.h4,{id:"\u4e2d\u82f1\u6587",children:"\u4e2d\u82f1\u6587"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"/^[\\u4e00-\\u9fa5a-zA-Z]+$/i"})}),"\n",(0,t.jsx)(n.h4,{id:"\u6570\u5b57",children:"\u6570\u5b57"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"/^[1-9]*$/i"})}),"\n",(0,t.jsx)(n.h4,{id:"\u7a7a\u5b57\u7b26\u4e0e\u7a7a\u683c\u5b57\u7b26",children:"\u7a7a\u5b57\u7b26\u4e0e\u7a7a\u683c\u5b57\u7b26"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"/[(^\\s+)(\\s+$)]/g"})}),"\n",(0,t.jsx)(n.h4,{id:"markdown-table",children:"Markdown Table"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"/(?<=\\|\\w+) /g"}),": second place to insert ",(0,t.jsx)(n.code,{children:"|"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"strict-mode",children:"Strict Mode"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Strict_mode",children:"Strict Mode"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"this"})," is ",(0,t.jsx)(n.code,{children:"null"})," in non-method functions."]}),"\n",(0,t.jsxs)(n.li,{children:["Variables must be declared (",(0,t.jsx)(n.code,{children:"Reference Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Functions must be declared at the top level of a scope (",(0,t.jsx)(n.code,{children:"Syntax Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Forbidden unqualified identifiers deletion (",(0,t.jsx)(n.code,{children:"Type Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Forbidden setting and deleting immutable properties (",(0,t.jsx)(n.code,{children:"Type Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Forbidden access ",(0,t.jsx)(n.code,{children:"arguments.callee"}),"/",(0,t.jsx)(n.code,{children:"arguments.caller"})," (",(0,t.jsx)(n.code,{children:"Type Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Forbidden variables escaped from ",(0,t.jsx)(n.code,{children:"eval()"})," (",(0,t.jsx)(n.code,{children:"Reference Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Forbidden set ",(0,t.jsx)(n.code,{children:"eval"}),"/",(0,t.jsx)(n.code,{children:"arguments"})," to variable identifiers (",(0,t.jsx)(n.code,{children:"Syntax Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Forbidden ",(0,t.jsx)(n.code,{children:"with"})," statement (",(0,t.jsx)(n.code,{children:"Syntax Error"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Forbidden octal numbers (",(0,t.jsx)(n.code,{children:"Syntax Error"}),")."]}),"\n",(0,t.jsx)(n.li,{children:"ES6 classes are automatically in strict mode."}),"\n",(0,t.jsx)(n.li,{children:"ES6 modules are automatically in strict mode."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"timer",children:"Timer"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"setTimeout."}),"\n",(0,t.jsx)(n.li,{children:"setImmediate."}),"\n",(0,t.jsx)(n.li,{children:"setInterval: \u5b8c\u5168\u65e0\u6cd5\u4fdd\u8bc1\u4e24\u4e2a timer \u6267\u884c\u65f6\u95f4\u95f4\u9694 (\u53ef\u80fd\u8fde\u7eed\u6267\u884c, \u4e5f\u53ef\u80fd\u95f4\u9694\u8fc7\u957f)."}),"\n",(0,t.jsx)(n.li,{children:"requestAnimationFrame."}),"\n",(0,t.jsx)(n.li,{children:"requestIdleCallback."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Combine ",(0,t.jsx)(n.code,{children:"setInterval"}),"/",(0,t.jsx)(n.code,{children:"setTimeout"})," function with closure function,\nimplement ",(0,t.jsx)(n.strong,{children:"time slicing scheduler"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function processArray(items, process, done) {\n  const todo = items.slice()\n\n  setTimeout(function task() {\n    process(todo.shift())\n\n    if (todo.length > 0)\n      setTimeout(task, 25)\n    else\n      done(items)\n  }, 25)\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[":::tips ",(0,t.jsx)(n.code,{children:"this"})," Binding in Timer Function"]}),"\n",(0,t.jsxs)(n.p,{children:["\u6240\u6709\u8d85\u65f6\u6267\u884c\u7684\u4ee3\u7801 (\u51fd\u6570) \u90fd\u4f1a\u5728\u5168\u5c40\u4f5c\u7528\u57df\u4e2d\u7684\u4e00\u4e2a\u533f\u540d\u51fd\u6570\u4e2d\u8fd0\u884c,\n\u56e0\u6b64\u51fd\u6570\u4e2d\u7684 ",(0,t.jsx)(n.code,{children:"this"})," \u503c\u5728\u975e\u4e25\u683c\u6a21\u5f0f\u4e0b\u59cb\u7ec8\u6307\u5411 ",(0,t.jsx)(n.code,{children:"window"}),", \u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\u662f ",(0,t.jsx)(n.code,{children:"undefined"}),".\n\u82e5\u7ed9 ",(0,t.jsx)(n.code,{children:"setTimeout()"})," \u63d0\u4f9b\u4e86\u4e00\u4e2a\u7bad\u5934\u51fd\u6570, \u5219 ",(0,t.jsx)(n.code,{children:"this"})," \u4f1a\u4fdd\u7559\u4e3a\u5b9a\u4e49\u5b83\u65f6\u6240\u5728\u7684\u8bcd\u6c47\u4f5c\u7528\u57df."]}),"\n",(0,t.jsx)(n.p,{children:":::"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"requestAnimationFrame"})," game loop:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function runAnimation(frameFunc) {\n  let lastTime = null\n\n  function frame(time) {\n    if (lastTime !== null) {\n      const timeStep = Math.min(time - lastTime, 100) / 1000\n      if (frameFunc(timeStep) === false)\n        return\n    }\n\n    lastTime = time\n    requestAnimationFrame(frame)\n  }\n\n  requestAnimationFrame(frame)\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"math",children:"Math"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.max"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.min()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.ceil()"}),": \u5411\u4e0a\u820d\u5165\u4e3a\u6700\u63a5\u8fd1\u7684\u6574\u6570."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.floor()"}),": \u5411\u4e0b\u820d\u5165\u4e3a\u6700\u63a5\u8fd1\u7684\u6574\u6570."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.round()"}),": \u56db\u820d\u4e94\u5165."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.fround()"}),": \u8fd4\u56de\u6570\u503c\u6700\u63a5\u8fd1\u7684\u5355\u7cbe\u5ea6 (32 \u4f4d) \u6d6e\u70b9\u503c\u8868\u793a."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.abs(x)"}),": \u8fd4\u56de x \u7684\u7edd\u5bf9\u503c."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.exp(x)"}),": \u8fd4\u56de ",(0,t.jsx)(n.code,{children:"Math.E"})," \u7684 x \u6b21\u5e42."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.expm1(x)"}),": \u7b49\u4e8e ",(0,t.jsx)(n.code,{children:"Math.exp(x) - 1"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.log(x)"}),": \u8fd4\u56de x \u7684\u81ea\u7136\u5bf9\u6570."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.log1p(x)"}),": \u7b49\u4e8e ",(0,t.jsx)(n.code,{children:"1 + Math.log(x)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.pow(x, power)"}),": \u8fd4\u56de x \u7684 power \u6b21\u5e42."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.hypot(...nums)"}),": \u8fd4\u56de nums \u4e2d\u6bcf\u4e2a\u6570\u5e73\u65b9\u548c\u7684\u5e73\u65b9\u6839."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.clz32(x)"}),": \u8fd4\u56de 32 \u4f4d\u6574\u6570 x \u7684\u524d\u7f6e\u96f6\u7684\u6570\u91cf."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.sign(x)"}),": \u8fd4\u56de\u8868\u793a x \u7b26\u53f7\u7684 ",(0,t.jsx)(n.code,{children:"1"}),"/",(0,t.jsx)(n.code,{children:"0"}),"/",(0,t.jsx)(n.code,{children:"-0"}),"/",(0,t.jsx)(n.code,{children:"-1"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.trunc(x)"}),": \u8fd4\u56de x \u7684\u6574\u6570\u90e8\u5206, \u5220\u9664\u6240\u6709\u5c0f\u6570."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.sqrt(x)"}),": \u8fd4\u56de x \u7684\u5e73\u65b9\u6839."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.cbrt(x)"}),": \u8fd4\u56de x \u7684\u7acb\u65b9\u6839."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.acos(x)"}),": \u8fd4\u56de x \u7684\u53cd\u4f59\u5f26."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.acosh(x)"}),": \u8fd4\u56de x \u7684\u53cd\u53cc\u66f2\u4f59\u5f26."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.asin(x)"}),": \u8fd4\u56de x \u7684\u53cd\u6b63\u5f26."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.asinh(x)"}),": \u8fd4\u56de x \u7684\u53cd\u53cc\u66f2\u6b63\u5f26."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.atan(x)"}),": \u8fd4\u56de x \u7684\u53cd\u6b63\u5207."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.atanh(x)"}),": \u8fd4\u56de x \u7684\u53cd\u53cc\u66f2\u6b63\u5207."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.atan2(y, x)"}),": \u8fd4\u56de ",(0,t.jsx)(n.code,{children:"y/x"})," \u7684\u53cd\u6b63\u5207."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.cos(x)"}),": \u8fd4\u56de x \u7684\u4f59\u5f26."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.sin(x)"}),": \u8fd4\u56de x \u7684\u6b63\u5f26."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Math.tan(x)"}),": \u8fd4\u56de x \u7684\u6b63\u5207."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const epsilon = Math.E\nconst log10 = Math.LN10\nconst log2 = Math.LN2\nconst log2e = Math.LOG2E\nconst log10e = Math.LOG10E\nconst pi = Math.PI\nconst squareRoot = Math.SQRT1_2\nconst squareRoot2 = Math.SQRT2\n\nMath.abs(num)\nMath.exp(num)\nMath.log(num)\nMath.sqrt(num)\nMath.acos(x)\nMath.asin(x)\nMath.atan(x)\nMath.atan2(y, x)\nMath.cos(x)\nMath.sin(x)\nMath.tan(x)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"console.log(Math.max(3, 54, 32, 16)) // 54\nconsole.log(Math.min(3, 54, 32, 16)) // 3\nconsole.log(Math.ceil(25.9)) // 26\nconsole.log(Math.ceil(25.5)) // 26\nconsole.log(Math.ceil(25.1)) // 26\nconsole.log(Math.round(25.9)) // 26\nconsole.log(Math.round(25.5)) // 26\nconsole.log(Math.round(25.1)) // 25\nconsole.log(Math.fround(0.4)) // 0.4000000059604645\nconsole.log(Math.fround(0.5)) // 0.5\nconsole.log(Math.fround(25.9)) // 25.899999618530273\nconsole.log(Math.floor(25.9)) // 25\nconsole.log(Math.floor(25.5)) // 25\nconsole.log(Math.floor(25.1)) // 25\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function random(a = 1, b = 0) {\n  const lower = Math.min(a, b)\n  const upper = Math.max(a, b)\n  return lower + Math.random() * (upper - lower)\n}\n\nfunction randomInt(a = 1, b = 0) {\n  const lower = Math.ceil(Math.min(a, b))\n  const upper = Math.floor(Math.max(a, b))\n  return Math.floor(lower + Math.random() * (upper - lower + 1))\n}\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{}),(0,t.jsx)(n.th,{children:"-2.9"}),(0,t.jsx)(n.th,{children:"-2.5"}),(0,t.jsx)(n.th,{children:"-2.1"}),(0,t.jsx)(n.th,{children:"2.1"}),(0,t.jsx)(n.th,{children:"2.5"}),(0,t.jsx)(n.th,{children:"2.9"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Math.floor"})}),(0,t.jsx)(n.td,{children:"-3"}),(0,t.jsx)(n.td,{children:"-3"}),(0,t.jsx)(n.td,{children:"-3"}),(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"2"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Math.ceil"})}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"3"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Math.round"})}),(0,t.jsx)(n.td,{children:"-3"}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"3"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Math.trunc"})}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"-2"}),(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"2"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"atomics",children:"Atomics"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Atomics",children:"Atomics API"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const sharedArrayBuffer = new SharedArrayBuffer(4)\nconst dataView = new Uint32Array(sharedArrayBuffer)\n\nconst index = 0\nconst increment = 5\n\nAtomics.add(dataView, index, increment)\nAtomics.sub(dataView, index, increment)\nAtomics.or(dataView, index, 0b1111)\nAtomics.and(dataView, index, 0b1100)\nAtomics.xor(dataView, index, 0b1111)\nAtomics.load(dataView, index)\nAtomics.store(dataView, index, 3)\nAtomics.exchange(dataView, index, 4)\nAtomics.compareExchange(dataView, index, expect, 6)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"signals",children:"Signals"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/tc39/proposal-signals",children:"Signals"}),"\ncreate a universal standard for state management across frameworks.\nIt use the so-called ",(0,t.jsx)(n.code,{children:"pull-push"})," model:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"push"})," phase:\nWhen Signal becomes ",(0,t.jsx)(n.code,{children:"dirty"})," (its value has changed),\nit recursively passes ",(0,t.jsx)(n.code,{children:"dirty"})," state to all dependent Signals."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pull"})," phase:\nAll potential recalculations are deferred until value of Signal is explicitly requested."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Lazy evaluation brings:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Automated tracking:\nEliminates complexity of manual updates and enhances reactive programming capabilities."}),"\n",(0,t.jsx)(n.li,{children:"Performance optimization:\nCalculated only when necessary avoiding unnecessary computations and updates."}),"\n",(0,t.jsx)(n.li,{children:"Consistency:\nState is updated synchronously in corresponding UI render or any dependency evaluation."}),"\n",(0,t.jsx)(n.li,{children:"Easy integration:\nSignals can be easily integrated into various JavaScript libraries and frameworks."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const counter = new Signal.State(0)\nconst isEven = new Signal.Computed(() => (counter.get() & 1) === 0)\nconst parity = new Signal.Computed(() => isEven.get() ? 'even' : 'odd')\n\neffect(() => element.textContent = parity.get())\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"/**\n * Class auto-accessor decorator\n * @see https://github.com/tc39/proposal-decorators?tab=readme-ov-file#class-auto-accessors\n */\nfunction signal(target) {\n  const { get } = target\n\n  return {\n    init(value) {\n      return new Signal.State(value)\n    },\n    get() {\n      return get.call(this).get()\n    },\n    set(value) {\n      get.call(this).set(value)\n    },\n  }\n}\n\nclass Counter {\n  @signal\n  count = 0 // This will be automatically turned into a Signal state.\n\n  increment() {\n    this.count++ // Behind the scenes, this updates the Signal's value.\n  }\n\n  decrement() {\n    this.count-- // Similarly, this updates the Signal's value.\n  }\n\n  @signal\n  get isEven() {\n    return this.count % 2 === 0\n  }\n\n  @signal\n  get parity() {\n    return this.isEven ? 'even' : 'odd'\n  }\n}\n\n// Usage\nconst myCounter = new Counter()\nconsole.log(myCounter.count) // Outputs: 0\n\nmyCounter.increment()\nconsole.log(myCounter.count) // Outputs: 1\nconsole.log(myCounter.parity) // Outputs: \"odd\"\n\nmyCounter.increment()\nconsole.log(myCounter.count) // Outputs: 2\nconsole.log(myCounter.isEven) // Outputs: true\n"})}),"\n",(0,t.jsx)(n.h2,{id:"uri-and-url",children:"URI and URL"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"encodeURI()"}),": \u4e0d\u4f1a\u7f16\u7801\u5c5e\u4e8e URL \u7ec4\u4ef6\u7684\u7279\u6b8a\u5b57\u7b26, \u6bd4\u5982\u5192\u53f7/\u659c\u6760/\u95ee\u53f7."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"encodeURIComponent()"}),": \u7f16\u7801\u5b83\u53d1\u73b0\u7684\u6240\u6709\u975e\u6807\u51c6\u5b57\u7b26."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'const uri = \'http://www.foo.com/illegal value.js#start\'\n// "http://www.foo.com/illegal%20value.js#start"\nconsole.log(encodeURI(uri))\n// "http%3A%2F%2Fwww.foo.com%2Fillegal%20value.js%23start"\nconsole.log(encodeURIComponent(uri))\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const uri = 'http%3A%2F%2Fwww.foo.com%2Fillegal%20value.js%23start'\n// http%3A%2F%2Fwww.foo.com%2Fillegal value.js%23start\nconsole.log(decodeURI(uri))\n// http:// www.foo.com/illegal value.js#start\nconsole.log(decodeURIComponent(uri))\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/URL",children:"URL"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"hash"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"host"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"hostname"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"href"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"pathname"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"port"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"protocol"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"search"}),": ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/USVString",children:"USVString"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"searchParams"}),": URL search map."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"username"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"password"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"origin"}),": read only."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const href = new URL('other.mjs', 'https://example.com/code/main.mjs').href\n// 'https://example.com/code/other.mjs'\nconst href = new URL('../other.mjs', 'https://example.com/code/main.mjs').href\n// 'https://example.com/other.mjs'\n\nconst blob = new Blob(['export const itsAModule = true'], {\n  type: 'text/javascript',\n})\n\nconst blobUrl = URL.createObjectURL(blob)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.amitmerchant.com/create-and-download-text-files-using-javascript",children:"Download files"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function saveTextAsFile(textToWrite, fileNameToSaveAs, fileType) {\n  const textFileAsBlob = new Blob([textToWrite], { type: fileType })\n  const downloadLink = document.createElement('a')\n  downloadLink.innerHTML = 'Download File'\n  downloadLink.download = fileNameToSaveAs\n\n  if (window.webkitURL != null) {\n    downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob)\n  } else {\n    downloadLink.href = window.URL.createObjectURL(textFileAsBlob)\n    downloadLink.onclick = destroyClickedElement // document.body.removeChild(downloadLink);\n    downloadLink.style.display = 'none'\n    document.body.appendChild(downloadLink)\n  }\n\n  downloadLink.click()\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/URLSearchParams",children:"URLSearchParams"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// window.location.search\nconst qs = \'?q=javascript&num=10\'\nconst searchParams = new URLSearchParams(qs)\n\nfor (const param of searchParams)\n  console.log(param)\n\n// ["q", "javascript"]\n// ["num", "10"]\n\nalert(searchParams.toString()) // " q=javascript&num=10"\nsearchParams.has(\'num\') // true\nsearchParams.get(\'num\') // 10\nsearchParams.set(\'page\', \'3\')\nalert(searchParams.toString()) // " q=javascript&num=10&page=3"\nsearchParams.delete(\'q\')\nalert(searchParams.toString()) // " num=10&page=3"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"encoding-and-decoding",children:"Encoding and Decoding"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/TextEncoder",children:"TextEncoder API"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const textEncoder = new TextEncoder()\nconst decodedText = 'foo'\nconst encodedText = textEncoder.encode(decodedText)\n// f \u7684 UTF-8 \u7f16\u7801\u662f 0x66 (\u5373\u5341\u8fdb\u5236 102)\n// o \u7684 UTF-8 \u7f16\u7801\u662f 0x6F (\u5373\u4e8c\u8fdb\u5236 111)\nconsole.log(encodedText) // Uint8Array(3) [102, 111, 111]\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const textEncoder = new TextEncoder()\nconst fooArr = new Uint8Array(3)\nconst fooResult = textEncoder.encodeInto('foo', fooArr)\nconsole.log(fooArr) // Uint8Array(3) [102, 111, 111]\nconsole.log(fooResult) // { read: 3, written: 3 }\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function* chars() {\n  const decodedText = 'foo'\n  for (const char of decodedText)\n    yield await new Promise(resolve => setTimeout(resolve, 1000, char))\n}\n\nconst decodedTextStream = new ReadableStream({\n  async start(controller) {\n    for await (const chunk of chars())\n      controller.enqueue(chunk)\n\n    controller.close()\n  },\n})\n\nconst encodedTextStream = decodedTextStream.pipeThrough(new TextEncoderStream())\n\nconst readableStreamDefaultReader = encodedTextStream.getReader()\n\nwhile (true) {\n  const { done, value } = await readableStreamDefaultReader.read()\n\n  if (done)\n    break\n  else\n    console.log(value)\n}\n// Uint8Array[102]\n// Uint8Array[111]\n// Uint8Array[111]\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/TextDecoder",children:"TextDecoder API"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const textDecoder = new TextDecoder()\n// f \u7684 UTF-8 \u7f16\u7801\u662f 0x66 (\u5373\u5341\u8fdb\u5236 102)\n// o \u7684 UTF-8 \u7f16\u7801\u662f 0x6F (\u5373\u4e8c\u8fdb\u5236 111)\nconst encodedText = Uint8Array.of(102, 111, 111)\nconst decodedText = textDecoder.decode(encodedText)\nconsole.log(decodedText) // foo\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const response = await fetch(url)\nconst stream = response.body.pipeThrough(new TextDecoderStream())\nconst decodedStream = stream.getReader()\n\nfor await (const decodedChunk of decodedStream)\n  console.log(decodedChunk)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"web-stream",children:"Web Stream"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Web streams complete ",(0,t.jsx)(n.a,{href:"https://2ality.com/2022/06/web-streams-nodejs.html",children:"guide"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"internationalization",children:"Internationalization"}),"\n",(0,t.jsx)(n.h3,{id:"number-i18n",children:"Number i18n"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const nfFrench = new Intl.NumberFormat('fr')\nnf.format(12345678901234567890n)\n// => 12 345 678 901 234 567 890\n"})}),"\n",(0,t.jsx)(n.h3,{id:"string-i18n",children:"String i18n"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const lfEnglish = new Intl.ListFormat('en')\n// const lfEnglish = new Intl.ListFormat('en', { type: 'disjunction' }); => 'or'\n\nlfEnglish.format(['Ada', 'Grace', 'Ida'])\n// => 'Ada, Grace and Ida'\n\nconst formatter = new Intl.ListFormat('en', {\n  style: 'long',\n  type: 'conjunction',\n})\nconsole.log(formatter.format(vehicles))\n// expected output: \"Motorcycle, Bus, and Car\"\n\nconst formatter2 = new Intl.ListFormat('de', {\n  style: 'short',\n  type: 'disjunction',\n})\nconsole.log(formatter2.format(vehicles))\n// expected output: \"Motorcycle, Bus oder Car\"\n\nconst formatter3 = new Intl.ListFormat('en', { style: 'narrow', type: 'unit' })\nconsole.log(formatter3.format(vehicles))\n// expected output: \"Motorcycle Bus Car\"\n"})}),"\n",(0,t.jsx)(n.h3,{id:"time-i18n",children:"Time i18n"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const rtfEnglish = new Intl.RelativeTimeFormat('en', { numeric: 'auto' })\n\nrtf.format(-1, 'day') // 'yesterday'\nrtf.format(0, 'day') // 'today'\nrtf.format(1, 'day') // 'tomorrow'\nrtf.format(-1, 'week') // 'last week'\nrtf.format(0, 'week') // 'this week'\nrtf.format(1, 'week') // 'next week'\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const dtfEnglish = new Intl.DateTimeFormat('en', {\n  year: 'numeric',\n  month: 'long',\n  day: 'numeric',\n})\n\ndtfEnglish.format(new Date()) // => 'May 7, 2019'\ndtfEnglish.formatRange(start, end) // => 'May 7 - 9, 2019'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"functional-javascript",children:"Functional JavaScript"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Predictable: pure and immutable."}),"\n",(0,t.jsx)(n.li,{children:"Safe: pure and immutable."}),"\n",(0,t.jsx)(n.li,{children:"Transparent: pure and immutable."}),"\n",(0,t.jsx)(n.li,{children:"Modular: composite with currying and monads."}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{title:"Functional JavaScript",type:"tip",children:[(0,t.jsx)(n.p,{children:"Functional programming is the art of composing higher-order functions\nto advance the state of a program in a pure manner:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Pure Functions and Immutability:\nPure functions ensure that functions have no side effects\nand return the same output for the same inputs,\nwhich is complemented by immutability that prevents data from being changed unexpectedly.\nTogether, they ensure a predictable and stable code base."}),"\n",(0,t.jsx)(n.li,{children:"Currying and Memoization:\nCurrying allows functions to be broken down into simpler, single-argument functions\nthat are easier to manage and memoize.\nMemoization can then be applied to these curried functions to cache their results,\noptimizing the application's performance by avoiding repeated calculations."}),"\n",(0,t.jsx)(n.li,{children:"Monads and Pure Functions:\nMonads help manage side effects in a controlled manner,\nwhich allows pure functions to remain pure\neven when dealing with operations like I/O or state transitions.\nThis encapsulation of side effects preserves the integrity of the functional architecture."}),"\n"]})]}),"\n",(0,t.jsx)(n.h3,{id:"functional-javascript-pros",children:"Functional JavaScript Pros"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Type safe and state safe."}),"\n",(0,t.jsx)(n.li,{children:"Explicit flow of data."}),"\n",(0,t.jsx)(n.li,{children:"Concurrency safety."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"functional-javascript-cons",children:"Functional JavaScript Cons"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verbose."}),"\n",(0,t.jsx)(n.li,{children:"More object creation."}),"\n",(0,t.jsx)(n.li,{children:"More garbage collection."}),"\n",(0,t.jsx)(n.li,{children:"More memory usage."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["With help of ",(0,t.jsx)(n.code,{children:"immutable.js"}),"/",(0,t.jsx)(n.code,{children:"immer.js"}),",\nobject creation/garbage collection/memory usage can be alleviated."]}),"\n",(0,t.jsxs)(n.p,{children:["For example, in vanilla.js, ",(0,t.jsx)(n.code,{children:"map2 === map1"})," become ",(0,t.jsx)(n.code,{children:"false"}),",\nbut in immutable.js ",(0,t.jsx)(n.code,{children:"map2 === map1"})," become ",(0,t.jsx)(n.code,{children:"true"}),"\n(copy free due to immutable data)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const map1 = { b: 2 }\nconst map2 = map1.set('b', 2)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"partial-application",children:"Partial Application"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function partialFromBind(fn, ...args) {\n  return fn.bind(null, ...args)\n}\n\nfunction partial(fn, ...args) {\n  return (...rest) => {\n    return fn(...args, ...rest)\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"currying",children:"Currying"}),"\n",(0,t.jsx)(n.p,{children:"Chain of multiple single argument functions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function curry(fn, ...stored_args) {\n  return function (...new_args) {\n    const args = stored_args.concat(new_args)\n    return fn(...args)\n  }\n}\n\nconst add = x => y => x + y\n\nconst addOne = curry(add, 1)\n// addOne(3) === 4;\nconst addFive = curry(addOne, 1, 3)\n// addFive(4) === 9;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"compose",children:"Compose"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function compose(...fns) {\n  return x =>\n    fns.reduceRight((promise, fn) => promise.then(fn), Promise.resolve(x))\n}\n\nconst addTwo = x => x + 2\nconst addThree = x => x + 3\nconst addFive = x => x + 5\nconst addTen = compose(addTwo, addThree, addFive)\n\naddTen(8).then(console.log) // 18\n"})}),"\n",(0,t.jsx)(n.h3,{id:"flow",children:"Flow"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function flow(...fns) {\n  return x =>\n    fns.reduce((promise, fn) => promise.then(fn), Promise.resolve(x))\n}\n\nconst addTwo = x => x + 2\nconst addThree = x => x + 3\nconst addFive = x => x + 5\nconst addTen = flow(addTwo, addThree, addFive)\n\naddTen(8).then(console.log) // 18\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pipe",children:"Pipe"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function pipe(x, ...fns) {\n  return fns.reduce((promise, fn) => promise.then(fn), Promise.resolve(x))\n}\n\nconst addTwo = x => x + 2\nconst addThree = x => x + 3\nconst addFive = x => x + 5\nconst addTen = pipe(8, addTwo, addThree, addFive)\n\naddTen.then(console.log) // 18\n"})}),"\n",(0,t.jsx)(n.h3,{id:"immutable",children:"Immutable"}),"\n",(0,t.jsx)(n.p,{children:"Immutable data structure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Reused reference: one address represent one data."}),"\n",(0,t.jsx)(n.li,{children:"Quick comparison: different address represent different data."}),"\n",(0,t.jsx)(n.li,{children:"Fast recovery and snapshot: reuse previous data."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"immutable-array",children:"Immutable Array"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const RE_INDEX_PROP_KEY = /^\\d+$/\nconst ALLOWED_PROPERTIES = new Set(['length', 'constructor', 'slice', 'concat'])\n\nfunction createImmutableArray(arrayLike, mapFn) {\n  const arr = Array.from(arrayLike, mapFn)\n\n  const handler = {\n    get(target, propKey, receiver) {\n      if (RE_INDEX_PROP_KEY.test(propKey) || ALLOWED_PROPERTIES.has(propKey))\n        return Reflect.get(target, propKey, receiver)\n\n      throw new TypeError(`Property \"${propKey}\" can\u2019t be accessed`)\n    },\n    set(target, propKey, value, receiver) {\n      throw new TypeError('Setting is not allowed')\n    },\n    deleteProperty(target, propKey) {\n      throw new TypeError('Deleting is not allowed')\n    },\n  }\n\n  return new Proxy(arr, handler)\n}\n\nconst array = createImmutableArray(['a', 'b', 'c'])\n\n// Non-destructive operations are allowed:\nassert.deepEqual(array.slice(1), ['b', 'c'])\nassert.equal(array[1], 'b')\n\n// Destructive operations are not allowed:\nassert.throws(() => (array[1] = 'x'), /^TypeError: Setting is not allowed$/)\nassert.throws(\n  () => array.shift(),\n  /^TypeError: Property \"shift\" can\u2019t be accessed$/\n)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"immutable-map",children:"Immutable Map"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class ImmutableMap {\n  #map\n\n  constructor(iterable) {\n    this.#map = new Map(iterable)\n  }\n\n  static _setUpPrototype() {\n    // Only forward non-destructive methods to the map:\n    for (const methodName of ['get', 'has', 'keys', 'size']) {\n      ImmutableMap.prototype[methodName] = function (...args) {\n        return this.#map[methodName](...args)\n      }\n    }\n  }\n}\n\nImmutableMap._setUpPrototype()\n\nconst map = new ImmutableMap([\n  [false, 'no'],\n  [true, 'yes'],\n])\n\n// Non-destructive operations work as usual:\nassert.equal(map.get(true), 'yes')\nassert.equal(map.has(false), true)\nassert.deepEqual([...map.keys()], [false, true])\n\n// Destructive operations are not available:\nassert.throws(\n  () => map.set(false, 'never!'),\n  /^TypeError: map.set is not a function$/\n)\nassert.throws(() => map.clear(), /^TypeError: map.clear is not a function$/)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"immutable-class",children:"Immutable Class"}),"\n",(0,t.jsx)(n.p,{children:"Copying class instances without side effects:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class Point {\n  constructor(x, y) {\n    this.x = x\n    this.y = y\n  }\n\n  clone() {\n    return new Point(this.x, this.y)\n  }\n\n  static from(other) {\n    return new Point(other.x, other.y)\n  }\n}\n\nclass Color {\n  constructor(name) {\n    this.name = name\n  }\n\n  clone() {\n    return new Color(this.name)\n  }\n\n  static from(other) {\n    return new Color(other.name)\n  }\n}\n\nclass ColorPoint extends Point {\n  constructor(x, y, color) {\n    super(x, y)\n    this.color = color\n  }\n\n  clone() {\n    return new ColorPoint(this.x, this.y, this.color.clone())\n  }\n\n  static from(other) {\n    return new ColorPoint(other.x, other.y, Color.from(other.color))\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"lodash",children:"Lodash"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"chunk."}),"\n",(0,t.jsx)(n.li,{children:"shuffle."}),"\n",(0,t.jsx)(n.li,{children:"take."}),"\n",(0,t.jsx)(n.li,{children:"difference."}),"\n",(0,t.jsx)(n.li,{children:"intersection."}),"\n",(0,t.jsx)(n.li,{children:"isEmpty."}),"\n",(0,t.jsx)(n.li,{children:"orderBy."}),"\n",(0,t.jsx)(n.li,{children:"merge."}),"\n",(0,t.jsx)(n.li,{children:"cloneDeep."}),"\n",(0,t.jsx)(n.li,{children:"debounce."}),"\n",(0,t.jsx)(n.li,{children:"throttle."}),"\n",(0,t.jsx)(n.li,{children:"startCase."}),"\n",(0,t.jsx)(n.li,{children:"kebabCase."}),"\n",(0,t.jsx)(n.li,{children:"snakeCase."}),"\n",(0,t.jsx)(n.li,{children:"camelCase."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"rxjs",children:"RxJS"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Async iteration: pull streams and single consumers."}),"\n",(0,t.jsx)(n.li,{children:"Reactive programming: push streams and potentially multiple consumers."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Data Stream",src:r(7697).A+"",title:"Data Stream",width:"1566",height:"766"})}),"\n",(0,t.jsx)(n.h4,{id:"stream",children:"Stream"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"class PushArray extends Array {\n  static EVENT_NAME = 'new_value'\n  #eventEmitter = new EventEmitter()\n\n  push(value) {\n    this.#eventEmitter.emit(PushArray.EVENT_NAME, value)\n    return super.push(value)\n  }\n\n  subscribe({ next }) {\n    this.#eventEmitter.on(PushArray.EVENT_NAME, (value) => {\n      next(value)\n    })\n  }\n\n  unsubscribe() {\n    this.#eventEmitter.removeAllListeners(PushArray.EVENT_NAME)\n  }\n}\n\n// Source\nconst pushArray = new PushArray(1, 2, 3)\n\n// Consumer\npushArray.subscribe({\n  next(value) {\n    console.log('New value:', value)\n  },\n})\n\n// Producer\npushArray.push(4)\npushArray.push(5)\npushArray.unsubscribe()\npushArray.push(6)\n"})}),"\n",(0,t.jsx)(n.h4,{id:"observable",children:"Observable"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"interface Observer<T> {\n  next: (value: T) => void\n  error?: (error: Error) => void\n  complete?: () => void\n}\n\ninterface Subscription {\n  unsubscribe: () => void\n}\n\ninterface Observable<T> {\n  // eslint-disable-next-line ts/no-misused-new\n  new (subscriber: (observer: Observer<T>) => Subscription): Observable<T>\n  observable: () => this\n  readonly species: this\n\n  of: (...items: Array<mixed>) => Observable<T>\n  from: (x: Observable<T> | Iterable<T>) => Observable<T>\n\n  map: <Z>(fn: (value: T) => Z) => Observable<Z>\n  reduce: <Z>(\n    acc: (accumulator: Z, value: T, index?: number, array?: Array<T>) => Z,\n    startsWith?: T\n  ) => Observable<T>\n  filter: (predicate: (value: T) => boolean) => Observable<T>\n  skip: (count: number) => Observable<T>\n\n  subscribe: (observer: Function | Observer<T>) => Subscription\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const map = curry(\n  (fn, stream) =>\n    new Observable((observer) => {\n      const subs = stream.subscribe({\n        next(value) {\n          try {\n            observer.next(fn(value))\n          } catch (err) {\n            observer.error(err)\n          }\n        },\n        error(e) {\n          observer.error(e)\n        },\n        complete() {\n          observer.complete()\n        },\n      })\n\n      return () => subs.unsubscribe()\n    })\n)\n\nconst reduce = curry((accumulator, initialValue, stream) => {\n  let result = initialValue ?? {}\n\n  return new Observable((observer) => {\n    const subs = stream.subscribe({\n      next(value) {\n        result = accumulator(result, value)\n      },\n      error(e) {\n        observer.error(e)\n      },\n      complete() {\n        observer.next(result)\n        observer.complete()\n      },\n    })\n\n    return () => subs.unsubscribe()\n  })\n})\n\nconst filter = curry(\n  (predicate, stream) =>\n    new Observable((observer) => {\n      const subs = stream.subscribe({\n        next(value) {\n          if (predicate(value))\n            observer.next(value)\n        },\n        error(e) {\n          observer.error(e)\n        },\n        complete() {\n          observer.complete()\n        },\n      })\n\n      return () => subs.unsubscribe()\n    })\n)\n\nconst skip = curry((count, stream) => {\n  let skipped = 0\n\n  return new Observable((observer) => {\n    const subs = stream.subscribe({\n      next(value) {\n        if (skipped++ >= count)\n          observer.next(value)\n      },\n      error(e) {\n        observer.error(e)\n      },\n      complete() {\n        observer.complete()\n      },\n    })\n\n    return () => subs.unsubscribe()\n  })\n})\n\nclass Observable {\n  map(fn) {\n    return map(fn, this)\n  }\n\n  reduce(accumulator, initialValue = {}) {\n    return reduce(accumulator, initialValue, this)\n  }\n\n  filter(predicate) {\n    return filter(predicate, this)\n  }\n\n  skip(count) {\n    return skip(count, this)\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Observable.of(1, 2, 3, 4)\n  .skip(1)\n  .filter(isEven)\n  .map(square)\n  .reduce(add, 0)\n  .subscribe({\n    next: console.log,\n  })\n"})}),"\n",(0,t.jsx)(n.h2,{id:"javascript-style-guide",children:"JavaScript Style Guide"}),"\n",(0,t.jsx)(n.h3,{id:"eslint",children:"ESLint"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/xjamundx/eslint-plugin-promise",children:"Promise"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/import-js/eslint-plugin-import",children:"Import"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/sindresorhus/eslint-plugin-unicorn",children:"Unicorn"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/SonarSource/eslint-plugin-sonarjs",children:"SonarJS: Bug and Code Smell Detection"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/jonaskello/eslint-plugin-functional",children:"Functional"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/jsx-eslint/eslint-plugin-jsx-a11y",children:"JSX A11Y"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/amilajack/eslint-plugin-compat",children:"Browser Compatibility"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/gajus/eslint-plugin-jsdoc",children:"JSDoc"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/microsoft/tsdoc",children:"TSDoc"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/weiran-zsd/eslint-plugin-node",children:"Node"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/nodesecurity/eslint-plugin-security",children:"Node Security"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/alexgorbatchev/eslint-import-resolver-typescript",children:"TypeScript Import Resolver"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "env": {\n    "browser": true,\n    "es2021": true,\n    "node": true,\n    "jest": true\n  },\n  "extends": [\n    "eslint:recommended",\n    "plugin:import/recommended",\n    "plugin:jsx-a11y/recommended",\n    "plugin:react/recommended",\n    "plugin:react-hooks/recommended",\n    "plugin:unicorn/recommended",\n    "plugin:promise/recommended",\n    "plugin:@typescript-eslint/recommended",\n    "plugin:prettier/recommended"\n  ],\n  "parser": "@typescript-eslint/parser",\n  "parserOptions": {\n    "ecmaFeatures": {\n      "jsx": true\n    },\n    "ecmaVersion": 12,\n    "sourceType": "module"\n  },\n  "plugins": [\n    "import",\n    "jsx-a11y",\n    "react",\n    "react-hooks",\n    "@typescript-eslint"\n  ],\n  "settings": {\n    "react": {\n      "version": "detect"\n    },\n    "import/parsers": {\n      "@typescript-eslint/parser": [".ts", ".tsx"]\n    },\n    "import/resolver": {\n      "typescript": {\n        "alwaysTryTypes": true,\n        "project": "./"\n      }\n    }\n  },\n  "rules": {\n    "react/prop-types": 0,\n    "react/jsx-props-no-spreading": 0\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"naming-style",children:"Naming Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u53d8\u91cf: \u540d\u8bcd\u524d\u7f00."}),"\n",(0,t.jsx)(n.li,{children:"\u65b9\u6cd5 / \u51fd\u6570: \u52a8\u8bcd\u524d\u7f00."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"_method"}),": \u8868\u793a\u79c1\u6709\u5316\u65b9\u6cd5."]}),"\n",(0,t.jsx)(n.li,{children:"\u666e\u901a\u51fd\u6570: \u9a7c\u5cf0\u547d\u540d\u6cd5 (camelCase)."}),"\n",(0,t.jsx)(n.li,{children:"\u6784\u9020\u51fd\u6570: \u5e15\u65af\u5361\u547d\u540d\u6cd5 (PascalCase)."}),"\n",(0,t.jsx)(n.li,{children:"\u7f29\u7565\u8bcd\u548c\u7f29\u5199\u90fd\u5fc5\u987b\u662f\u5168\u90e8\u5927\u5199 / \u5c0f\u5199."}),"\n",(0,t.jsxs)(n.li,{children:["\u5bf9\u4e8e ",(0,t.jsx)(n.code,{children:"jQuery"})," \u5bf9\u8c61\u7684\u53d8\u91cf\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"$"})," \u4f5c\u4e3a\u524d\u7f00."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"variable-style",children:"Variable Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["No single ",(0,t.jsx)(n.code,{children:"let/const"})," for multiple variables."]}),"\n",(0,t.jsxs)(n.li,{children:["Sort ",(0,t.jsx)(n.code,{children:"let/const"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"No chains assignment (create implicit global variable)."}),"\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"()"})," wrap multiple line."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"object-style",children:"Object Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Prefer literal not ",(0,t.jsx)(n.code,{children:"Object()"})," constructor."]}),"\n",(0,t.jsx)(n.li,{children:"Prefer object-shorthand."}),"\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"Object.prototype.XX"})," not ",(0,t.jsx)(n.code,{children:"object.xx"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Prefer object spread (",(0,t.jsx)(n.code,{children:"..."}),") not ",(0,t.jsx)(n.code,{children:"object.assign"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// very bad\nconst original = { a: 1, b: 2 }\nconst copy = Object.assign(original, { c: 3 }) // \u53d8\u5f02\u7684 `original` \u0ca0_\u0ca0\ndelete copy.a // \u8fd9....\n\n// bad\nconst original = { a: 1, b: 2 }\nconst copy = Object.assign({}, original, { c: 3 })\n\n// good\nconst original = { a: 1, b: 2 }\nconst copy = { ...original, c: 3 } // copy => { a: 1, b: 2, c: 3 }\n\nconst { a, ...noA } = copy // noA => { b: 2, c: 3 }\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"."})," for static name, prefer ",(0,t.jsx)(n.code,{children:"[]"})," for variable name:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// good\nconst isJedi = luke.jedi\n\nfunction getProp(prop) {\n  return luke[prop]\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"array-style",children:"Array Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Prefer literal."}),"\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"push"})," not ",(0,t.jsx)(n.code,{children:"[]"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Prefer array spread (",(0,t.jsx)(n.code,{children:"..."}),") (best) or ",(0,t.jsx)(n.code,{children:"Array.from"})," (good):"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const foo = document.querySelectorAll('.foo')\n\n// good\nconst nodes = Array.from(foo)\n\n// best\nconst nodes = [...foo]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"destruct-style",children:"Destruct Style"}),"\n",(0,t.jsx)(n.p,{children:"\u5bf9\u4e8e\u591a\u4e2a\u8fd4\u56de\u503c\u4f7f\u7528\u5bf9\u8c61\u89e3\u6784, \u800c\u4e0d\u662f\u6570\u7ec4\u89e3\u6784:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// bad\nfunction processInputBad(input) {\n  // \u5904\u7406\u4ee3\u7801...\n  return [left, right, top, bottom]\n}\n\n// \u8c03\u7528\u8005\u9700\u8981\u8003\u8651\u8fd4\u56de\u6570\u636e\u7684\u987a\u5e8f.\nconst [left, __, top] = processInputBad(input)\n\n// good\nfunction processInput(input) {\n  // \u5904\u7406\u4ee3\u7801 ...\n  process()\n\n  return { left, right, top, bottom }\n}\n\n// \u8c03\u7528\u8005\u53ea\u9009\u62e9\u4ed6\u4eec\u9700\u8981\u7684\u6570\u636e.\nconst { left, top } = processInput(input)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"string-style",children:"String Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"'"})," not ",(0,t.jsx)(n.code,{children:'"'}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Prefer template literals not ",(0,t.jsx)(n.code,{children:"'str1' + 'str2'"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"function-style",children:"Function Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"No reassign parameters (implicit side effect and bad performance)."}),"\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"...args"})," not ",(0,t.jsx)(n.code,{children:"arguments"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Prefer ES6 default parameters not default expression pattern."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"arrow-function-style",children:"Arrow Function Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"()"})," wrap multiple line return value."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"module-style",children:"Module Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"No duplicated export path:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// bad\n// import foo from 'foo';\n// import { named1, named2 } from 'foo';\n\n// good\nimport foo, { named1, named2 } from 'foo'\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["No export ",(0,t.jsx)(n.code,{children:"let"}),":"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// bad\n// let foo = 3;\n// export { foo };\n\n// good\nconst foo = 3\nexport { foo }\n"})}),"\n",(0,t.jsx)(n.h3,{id:"iterator-and-generator-style",children:"Iterator and Generator Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"Object.keys() / Object.values() / Object.entries()"})," \u8fed\u4ee3\u5bf9\u8c61\u751f\u6210\u6570\u7ec4."]}),"\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"map/reduce/filter/any/every/some/find/findIndex/ ..."})," \u904d\u5386\u6570\u7ec4."]}),"\n",(0,t.jsx)(n.li,{children:"Prefer functional style iterator:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const numbers = [1, 2, 3, 4, 5]\n\n// bad\nlet sum = 0\nfor (const num of numbers)\n  sum += num\n\nconsole.log(sum === 15)\n\n// good\nlet sum = 0\nnumbers.forEach((num) => {\n  sum += num\n})\nconsole.log(sum === 15)\n\n// best (use the functional force)\nconst sum = numbers.reduce((total, num) => total + num, 0)\nconsole.log(sum === 15)\n\n// bad\nconst increasedByOne = []\nfor (let i = 0; i < numbers.length; i++)\n  increasedByOne.push(numbers[i] + 1)\n\n// good\nconst increasedByOne = []\nnumbers.forEach((num) => {\n  increasedByOne.push(num + 1)\n})\n\n// best (keeping it functional)\nconst increasedByOne = numbers.map(num => num + 1)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"expression-style",children:"Expression Style"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"if"})," \u8bed\u53e5\u4f7f\u7528 ToBoolean \u7684\u62bd\u8c61\u65b9\u6cd5\u6765\u8ba1\u7b97\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Object"}),": ",(0,t.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"undefined"}),": ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"null"}),": ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"boolean"}),": \u5e03\u5c14\u503c\u7684\u53d6\u503c."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"number"}),": \u5982\u679c\u4e3a ",(0,t.jsx)(n.code,{children:"+0"}),"/",(0,t.jsx)(n.code,{children:"-0"}),"/",(0,t.jsx)(n.code,{children:"NaN"})," \u503c\u4e3a ",(0,t.jsx)(n.code,{children:"false"}),", \u5426\u5219\u4e3a ",(0,t.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"string"}),": \u5982\u679c\u662f\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32 ",(0,t.jsx)(n.code,{children:"''"})," \u503c\u4e3a ",(0,t.jsx)(n.code,{children:"false"}),", \u5426\u5219\u4e3a ",(0,t.jsx)(n.code,{children:"true"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u5bf9\u4e8e\u5e03\u5c14\u503c\u4f7f\u7528\u7b80\u5199, \u4f46\u662f\u5bf9\u4e8e\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u8fdb\u884c\u663e\u5f0f\u6bd4\u8f83:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// bad\nif (isValid === true) {\n  // ...\n}\n\n// good\nif (isValid) {\n  // ...\n}\n\n// bad\nif (someName) {\n  // ...\n}\n\n// good\nif (someName !== '') {\n  // ...\n}\n\n// bad\nif (collection.length) {\n  // ...\n}\n\n// good\nif (collection.length > 0) {\n  // ...\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Prefer ",(0,t.jsx)(n.code,{children:"{}"})," warp ",(0,t.jsx)(n.code,{children:"case"})," when exists ",(0,t.jsx)(n.code,{children:"const"}),"/",(0,t.jsx)(n.code,{children:"let"}),"/",(0,t.jsx)(n.code,{children:"function"}),"/",(0,t.jsx)(n.code,{children:"class"})," declaration:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// good\nswitch (foo) {\n  case 1: {\n    const x = 1\n    break\n  }\n  case 2: {\n    const y = 2\n    break\n  }\n  case 3: {\n    function f() {\n      // ...\n    }\n    break\n  }\n  case 4:\n    bar()\n    break\n  default: {\n    class C {}\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"space-style",children:"Space Style"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u952e\u5165\u6700\u540e\u4e00\u4e2a\u8fd0\u7b97\u7b26\u540e\u518d\u6362\u884c, \u8fd0\u7b97\u7b26\u7f6e\u4e8e\u884c\u5c3e\u53ef\u4f7f ",(0,t.jsx)(n.code,{children:"Automatic Semicolon Insertion"})," \u673a\u5236\u5931\u6548."]}),"\n",(0,t.jsx)(n.li,{children:"\u6362\u884c\u540e\u4fdd\u6301 2 \u4e2a\u7f29\u8fdb\u5c42\u6b21."}),"\n",(0,t.jsxs)(n.li,{children:["Good places to use a white space include:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:","}),"/",(0,t.jsx)(n.code,{children:";"})," \u540e."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"+"}),",",(0,t.jsx)(n.code,{children:"-"}),",",(0,t.jsx)(n.code,{children:"*"}),",",(0,t.jsx)(n.code,{children:"/"}),",",(0,t.jsx)(n.code,{children:"<"}),",",(0,t.jsx)(n.code,{children:">"}),",",(0,t.jsx)(n.code,{children:"="})," \u524d\u540e."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"function () {}"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"function foo() {}"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"} if/for/while () {}"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"} else {}"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["inner ",(0,t.jsx)(n.code,{children:"{}"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["No space inner ",(0,t.jsx)(n.code,{children:"()"})," ",(0,t.jsx)(n.code,{children:"[]"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"let d = 0\nlet a = b + 1\n\nif (a && b && c) {\n  d = a % c\n  a += d\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"comments-style",children:"Comments Style"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"JSDoc"})," ",(0,t.jsx)(n.a,{href:"https://deno.com/blog/document-javascript-package",children:"best practice"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u63d2\u5165\u7a7a\u884c\u4e0e\u7edf\u4e00\u7f29\u8fdb."}),"\n",(0,t.jsx)(n.li,{children:"Write a concise summary:\nFirst paragraph comment should be concise description helping quick understanding."}),"\n",(0,t.jsx)(n.li,{children:"Provide good type information."}),"\n",(0,t.jsxs)(n.li,{children:["Use tags:\nTags like ",(0,t.jsx)(n.code,{children:"@param"}),", ",(0,t.jsx)(n.code,{children:"@returns"}),", and ",(0,t.jsx)(n.code,{children:"@typeParam"})," provide more information."]}),"\n",(0,t.jsxs)(n.li,{children:["Add examples:\nExamples ",(0,t.jsx)(n.code,{children:"@example"})," help users quickly understand how to use your library."]}),"\n",(0,t.jsx)(n.li,{children:"Document everything:\nDocument every symbol exposing to users."}),"\n",(0,t.jsxs)(n.li,{children:["Link internally:\nUse ",(0,t.jsx)(n.code,{children:"@link"}),", ",(0,t.jsx)(n.code,{children:"@linkcode"}),", and ",(0,t.jsx)(n.code,{children:"@linkplain"})," to link to other parts of documentation."]}),"\n",(0,t.jsxs)(n.li,{children:["Test documentation:\nUse ",(0,t.jsx)(n.code,{children:"deno test --doc"})," to type check,\nand ",(0,t.jsx)(n.code,{children:"deno doc --lint"})," to check for rest issues."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"/**\n * comments\n * comments\n */\n\n/**\n * @module app\n * @namespace APP\n */\n\n/**\n * @class mathStuff\n */\n\n/**\n * @property propertyName description.\n * @type {import('@jest/types').Config}\n */\n\n/**\n * @constructor\n * @method sum\n * @param {number} id\n * @param {string} instructions\n * @returns {number} result\n */\n"})}),"\n",(0,t.jsx)(n.h2,{id:"javascript-engine",children:"JavaScript Engine"}),"\n",(0,t.jsx)(n.h3,{id:"variables-lifecycle",children:"Variables Lifecycle"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Creation phase (",(0,t.jsx)(n.strong,{children:"Hoisting"}),")","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Declaration phase: \u5728\u4f5c\u7528\u57df\u4e2d\u6ce8\u518c\u53d8\u91cf"}),"\n",(0,t.jsxs)(n.li,{children:["Initialization phase: \u5206\u914d\u5185\u5b58, \u5728\u4f5c\u7528\u57df\u4e2d\u7ed1\u5b9a\u53d8\u91cf (",(0,t.jsx)(n.code,{children:"undefined"}),")"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Execution phase/Assignment phase"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"execution-context",children:"Execution Context"}),"\n",(0,t.jsx)(n.h4,{id:"global-execution-context",children:"Global Execution Context"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Create global object (",(0,t.jsx)(n.code,{children:"window"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Create ",(0,t.jsx)(n.code,{children:"this"})," object (refer to ",(0,t.jsx)(n.code,{children:"window"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Declare and initialize variable/function (",(0,t.jsx)(n.code,{children:"undefined"}),"),\nsetup memory space for them."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"function-execution-context",children:"Function Execution Context"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Create arguments object."}),"\n",(0,t.jsxs)(n.li,{children:["Create ",(0,t.jsx)(n.code,{children:"this"})," object."]}),"\n",(0,t.jsxs)(n.li,{children:["Declare and initialize variable(",(0,t.jsx)(n.code,{children:"undefined"}),")/function, store them into memory."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5982\u679c JavaScript \u5f15\u64ce\u5728\u51fd\u6570\u6267\u884c\u4e0a\u4e0b\u6587\u4e2d\u627e\u4e0d\u5230\u53d8\u91cf,\n\u5b83\u4f1a\u5728\u6700\u8fd1\u7684\u7236\u7ea7\u6267\u884c\u4e0a\u4e0b\u6587\u4e2d\u67e5\u627e\u8be5\u53d8\u91cf.\n\u8fd9\u4e2a\u67e5\u627e\u94fe\u5c06\u4f1a\u4e00\u76f4\u6301\u7eed, \u76f4\u5230\u5f15\u64ce\u67e5\u627e\u5230\u5168\u5c40\u6267\u884c\u4e0a\u4e0b\u6587.\n\u8fd9\u79cd\u60c5\u51b5\u4e0b, \u5982\u679c\u5168\u5c40\u6267\u884c\u4e0a\u4e0b\u6587\u4e5f\u6ca1\u6709\u8be5\u53d8\u91cf, \u90a3\u4e48\u5c06\u4f1a\u629b\u51fa\u5f15\u7528\u9519\u8bef (Reference Error).\n\u5b50\u51fd\u6570",(0,t.jsx)(n.strong,{children:"\u5305\u542b"}),"\u5b83\u7236\u7ea7\u51fd\u6570\u7684\u53d8\u91cf\u73af\u5883, \u628a\u8fd9\u4e2a\u6982\u5ff5\u79f0\u4e3a",(0,t.jsx)(n.strong,{children:"\u95ed\u5305(Closure)"}),",\n\u5373\u4f7f\u7236\u7ea7\u51fd\u6570\u6267\u884c\u73af\u5883\u5df2\u7ecf\u4ece\u6267\u884c\u6808\u5f39\u51fa\u4e86, \u5b50\u51fd\u6570\u8fd8\u662f\u53ef\u4ee5\u8bbf\u95ee\u7236\u7ea7\u51fd\u6570\u53d8\u91cf x (\u901a\u8fc7\u4f5c\u7528\u57df\u94fe)."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Scope Chain",src:r(1640).A+"",title:"Scope Chain",width:"1383",height:"865"})}),"\n",(0,t.jsx)(n.h3,{id:"event-loop",children:"Event Loop"}),"\n",(0,t.jsx)(n.h4,{id:"browser-event-loop",children:"Browser Event Loop"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Event Loop",src:r(4971).A+"",title:"Event Loop",width:"392",height:"740"})}),"\n",(0,t.jsxs)(n.p,{children:["The job of the ",(0,t.jsx)(n.strong,{children:"event loop"})," is to look into the call stack\nand determine if the call stack is empty or not.\nIf the ",(0,t.jsx)(n.strong,{children:"call stack"})," is empty,\nit looks into the ",(0,t.jsx)(n.strong,{children:"ES6 job queue"})," and ",(0,t.jsx)(n.strong,{children:"message queue"})," to see\nif there\u2019s any pending call back waiting to be executed:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["ES6 job queue: used by ",(0,t.jsx)(n.code,{children:"Promises"})," (higher priority)."]}),"\n",(0,t.jsxs)(n.li,{children:["Message queue: used by ",(0,t.jsx)(n.code,{children:"setTimeout"}),", ",(0,t.jsx)(n.code,{children:"DOM events"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["\u5fae\u4efb\u52a1 MicroTask (Jobs), \u6709\u7279\u6743, \u53ef\u4ee5\u63d2\u961f:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"process.nextTick"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Promises.then"})," (",(0,t.jsx)(n.strong,{children:"Promise \u6784\u9020\u51fd\u6570\u662f\u540c\u6b65\u51fd\u6570"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Object.observer"}),", ",(0,t.jsx)(n.code,{children:"MutationObserver"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"catch finally"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5b8f\u4efb\u52a1 MacroTask (Tasks), \u6ca1\u6709\u7279\u6743:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"scripts"}),": \u6574\u4f53\u811a\u672c\u89c6\u4f5c\u4e00\u4e2a\u5b8f\u4efb\u52a1."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"MessageChannel"}),", ",(0,t.jsx)(n.code,{children:"postMessage"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"setImmediate"}),", ",(0,t.jsx)(n.code,{children:"I/O"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"setTimeout"}),", ",(0,t.jsx)(n.code,{children:"setInterval"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"XHR"})," callback function."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"requestAnimationFrame"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["UI interaction ",(0,t.jsx)(n.code,{children:"events"})," callback function."]}),"\n",(0,t.jsx)(n.li,{children:"UI rendering."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"MicroTask \u4f18\u5148\u4e8e MacroTask."}),"\n",(0,t.jsx)(n.li,{children:"\u6d4f\u89c8\u5668\u4e3a\u4e86\u80fd\u591f\u4f7f\u5f97 JS \u5185\u90e8 (macro)task \u4e0e DOM \u4efb\u52a1\u80fd\u591f\u6709\u5e8f\u7684\u6267\u884c,\n\u4f1a\u5728\u4e00\u4e2a (macro)task \u6267\u884c\u7ed3\u675f\u540e, \u5728\u4e0b\u4e00\u4e2a (macro)task \u6267\u884c\u5f00\u59cb\u524d, \u5bf9\u9875\u9762\u8fdb\u884c\u91cd\u65b0\u6e32\u67d3.\n\u5f53 JS \u5f15\u64ce\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u53d6\u51fa\u4e00\u4e2a\u5b8f\u4efb\u52a1\u6765\u6267\u884c, \u5982\u679c\u6267\u884c\u8fc7\u7a0b\u4e2d\u6709\u9047\u5230\u5fae\u4efb\u52a1,\n\u90a3\u4e48\u6267\u884c\u5b8c\u8be5\u5b8f\u4efb\u52a1\u5c31\u4f1a\u53bb\u6267\u884c\u5b8f\u4efb\u52a1\u5185\u7684\u6240\u6709\u5fae\u4efb\u52a1, \u7136\u540e\u66f4\u65b0 UI.\n\u540e\u9762\u5c31\u662f\u518d\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u53d6\u51fa\u4e0b\u4e00\u4e2a\u5b8f\u4efb\u52a1\u6765\u7ee7\u7eed\u6267\u884c, \u4ee5\u6b64\u7c7b\u63a8."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Event Loop"})," \u4e0e ",(0,t.jsx)(n.code,{children:"Call Stack"})," \u6709\u4e14\u4ec5\u6709\u4e00\u4e2a, ",(0,t.jsx)(n.code,{children:"Task/Job/Message Queue"})," \u53ef\u4ee5\u6709\u591a\u4e2a."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Event Loop",type:"tip",children:(0,t.jsx)(n.p,{children:"\u5b8f\u4efb\u52a1\u961f\u5217\u53d6\u5b8f\u4efb\u52a1 -> \u6267\u884c 1 \u4e2a\u5b8f\u4efb\u52a1 -> \u68c0\u67e5\u5fae\u4efb\u52a1\u961f\u5217\u5e76\u6267\u884c\u6240\u6709\u5fae\u4efb\u52a1\n-> requestAnimationFrame -> \u6d4f\u89c8\u5668\u91cd\u6392/\u91cd\u7ed8 -> requestIdleCallback\n-> \u5b8f\u4efb\u52a1\u961f\u5217\u53d6\u5b8f\u4efb\u52a1"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Event Loop"})," simple model:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"for (const macroTask of macroTaskQueue) {\n  // 1. Handle current MacroTask.\n  runTask(macroTask)\n\n  // 2. Handle all MicroTasks.\n  for (const microTask of microTaskQueue)\n    runTask(microTask)\n\n  // 3. Handle Animation Frame.\n  if (shouldRepaint()) {\n    if (!animationFrameCallbackQueue.isEmpty()) {\n      const animationTasks = animationFrameCallbackQueue.copyTasks()\n\n      for (const animationTask of animationTasks)\n        runTask(animationTask)\n    }\n\n    repaint()\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:"setTimeout"})," with ",(0,t.jsx)(n.code,{children:"0"})," seconds timer\nhelps to defer execution of ",(0,t.jsx)(n.code,{children:"Promise"})," and ",(0,t.jsx)(n.code,{children:"bar"})," until the ",(0,t.jsx)(n.strong,{children:"stack"})," is ",(0,t.jsx)(n.strong,{children:"empty"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function bar() {\n  console.log('bar')\n}\n\nfunction baz() {\n  console.log('baz')\n}\n\nfunction foo() {\n  console.log('foo')\n  setTimeout(bar, 0)\n  new Promise((resolve, reject) => {\n    resolve('Promise resolved')\n  })\n    .then(res => console.log(res))\n    .catch(err => console.log(err))\n  baz()\n}\n\nfoo()\n\n// foo\n// baz\n// Promised resolved\n// bar\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"process.nextTick()"})," run before ",(0,t.jsx)(n.code,{children:"Promise.then()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"console.log('1')\n\nsetTimeout(() => {\n  console.log(2)\n  Promise.resolve().then(() => {\n    console.log(3)\n    process.nextTick(() => {\n      console.log(4)\n    })\n  })\n})\n\nPromise.resolve().then(() => {\n  console.log(5)\n  setTimeout(() => {\n    console.log(6)\n  })\n  Promise.resolve().then(() => {\n    console.log(7)\n  })\n})\n\nprocess.nextTick(() => {\n  console.log(8)\n  process.nextTick(() => {\n    console.log(9)\n  })\n})\n\nconsole.log('10')\n// 1 10 8 9 5 7 2 3 4 6\n"})}),"\n",(0,t.jsx)(n.p,{children:"Promise \u6784\u9020\u51fd\u6570\u672c\u8eab\u662f\u540c\u6b65\u51fd\u6570:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"console.log('script start')\n\nconst promise1 = new Promise((resolve) => {\n  console.log('promise1')\n  resolve()\n  console.log('promise1 end')\n}).then(() => {\n  console.log('promise2')\n})\n\nsetTimeout(() => {\n  console.log('setTimeout')\n})\n\nconsole.log('script end')\n\n// \u8f93\u51fa\u987a\u5e8f:\n// script start\n// promise1\n// promise1 end\n// script end\n// promise2\n// setTimeout.\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"await a(); b()"})," \u7b49\u4ef7\u4e8e ",(0,t.jsx)(n.code,{children:"Promise(a()).then(b())"}),",\n",(0,t.jsx)(n.code,{children:"a"})," \u662f\u540c\u6b65\u6267\u884c, ",(0,t.jsx)(n.code,{children:"b"})," \u662f MicroTask:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"async function async1() {\n  console.log('async1 start')\n  await async2()\n  console.log('async1 end')\n}\n\nasync function async2() {\n  console.log('async2')\n}\n\nconsole.log('script start')\n\nsetTimeout(() => {\n  console.log('setTimeout')\n}, 0)\n\nasync1()\n\nnew Promise((resolve) => {\n  console.log('promise1')\n  resolve()\n}).then(() => {\n  console.log('promise2')\n})\n\nconsole.log('script end')\n\n// script start\n// async1 start\n// async2\n// promise1\n// script end\n// async1 end\n// promise2\n// setTimeout\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5f53\u8c03\u7528\u6808\u6ca1\u6709\u540c\u6b65\u51fd\u6570\u65f6, \u6e05\u7a7a MicroTask \u4efb\u52a1\u961f\u5217\u91cc\u7684\u51fd\u6570,\n\u518d\u4ece MacroTask \u4efb\u52a1\u961f\u5217\u91cc\u53d6\u51fa\u4e00\u4e2a\u51fd\u6570\u6267\u884c (\u7b2c\u4e8c\u6b21 Event Loop):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"function test() {\n  console.log('start')\n\n  setTimeout(() => {\n    console.log('children2')\n    Promise.resolve().then(() => {\n      console.log('children2-1')\n    })\n  }, 0)\n\n  setTimeout(() => {\n    console.log('children3')\n    Promise.resolve().then(() => {\n      console.log('children3-1')\n    })\n  }, 0)\n\n  Promise.resolve().then(() => {\n    console.log('children1')\n  })\n\n  console.log('end')\n}\n\ntest()\n\n// start\n// end\n// children1\n// children2\n// children2-1\n// children3\n// children3-1\n"})}),"\n",(0,t.jsx)(n.h4,{id:"node-event-loop",children:"Node Event Loop"}),"\n",(0,t.jsx)(n.p,{children:"Node.js can run I/O operations in a non-blocking way,\nmeaning other code (and even other I/O operations) can be executed\nwhile an I/O operation is in progress."}),"\n",(0,t.jsxs)(n.p,{children:["Instead of having to ",(0,t.jsx)(n.strong,{children:"wait"})," for an I/O operation to complete\n(and essentially waste CPU cycles sitting idle),\nNode.js can use the time to execute other tasks."]}),"\n",(0,t.jsxs)(n.p,{children:["When the I/O operation completes,\n",(0,t.jsx)(n.strong,{children:"event loop"})," give back control to the piece of code\nthat is waiting for the result of that I/O operation."]}),"\n",(0,t.jsxs)(n.p,{children:["The Node.js execution model was designed to cater to the needs of most web servers,\nwhich tend to be ",(0,t.jsx)(n.strong,{children:"I/O-intensive"})," (due to non-blocking I/O)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"console.log('glob1')\n\nsetTimeout(() => {\n  console.log('timeout1')\n  process.nextTick(() => {\n    console.log('timeout1_nextTick')\n  })\n  new Promise((resolve) => {\n    console.log('timeout1_promise')\n    resolve()\n  }).then(() => {\n    console.log('timeout1_then')\n  })\n})\n\nsetImmediate(() => {\n  console.log('immediate1')\n  process.nextTick(() => {\n    console.log('immediate1_nextTick')\n  })\n  new Promise((resolve) => {\n    console.log('immediate1_promise')\n    resolve()\n  }).then(() => {\n    console.log('immediate1_then')\n  })\n})\n\nprocess.nextTick(() => {\n  console.log('glob1_nextTick')\n})\nnew Promise((resolve) => {\n  console.log('glob1_promise')\n  resolve()\n}).then(() => {\n  console.log('glob1_then')\n})\n\nsetTimeout(() => {\n  console.log('timeout2')\n  process.nextTick(() => {\n    console.log('timeout2_nextTick')\n  })\n  new Promise((resolve) => {\n    console.log('timeout2_promise')\n    resolve()\n  }).then(() => {\n    console.log('timeout2_then')\n  })\n})\n\nprocess.nextTick(() => {\n  console.log('glob2_nextTick')\n})\nnew Promise((resolve) => {\n  console.log('glob2_promise')\n  resolve()\n}).then(() => {\n  console.log('glob2_then')\n})\n\nsetImmediate(() => {\n  console.log('immediate2')\n  process.nextTick(() => {\n    console.log('immediate2_nextTick')\n  })\n  new Promise((resolve) => {\n    console.log('immediate2_promise')\n    resolve()\n  }).then(() => {\n    console.log('immediate2_then')\n  })\n})\n\nconsole.log('glob2')\n\n// glob1\n// glob1_promise\n// glob2_promise\n// glob2\n// glob1_nextTick\n// glob2_nextTick\n// glob1_then\n// glob2_then\n// timeout1\n// timeout1_promise\n// timeout1_nextTick\n// timeout1_then\n// timeout2\n// timeout2_promise\n// timeout2_nextTick\n// timeout2_then\n// immediate1\n// immediate1_promise\n// immediate1_nextTick\n// immediate1_then\n// immediate2\n// immediate2_promise\n// immediate2_nextTick\n// immediate2_then\n"})}),"\n",(0,t.jsx)(n.h3,{id:"v8",children:"V8"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"source code (parser) AST (interpreter) bytecode"}),"\n",(0,t.jsx)(n.li,{children:"send profiling data from bytecode to optimizing compiler, generate optimized code"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Ignition"})," interpreter"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"TurboFan"})," optimizing compiler (2 for SpiderMonkey/Edge, 3 for Safari)"]}),"\n",(0,t.jsxs)(n.li,{children:["JavaScript implementation ",(0,t.jsx)(n.a,{href:"https://notes.eatonphil.com/javascript-implementations.html",children:"list"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"v8-object-shape",children:"V8 Object Shape"}),"\n",(0,t.jsxs)(n.p,{children:["V8 object ",(0,t.jsx)(n.a,{href:"https://mathiasbynens.be/notes/shapes-ics",children:"shapes"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// o1 and o2 have the same shape\n// JSObject(1, 2) => Shape('x', 'y')\n// JSObject(3, 4) => Shape('x', 'y')\n// 'x' => 0 Offset, Writable, Enumerable, Configurable\n// 'y' => 1 Offset, Writable, Enumerable, Configurable\nconst o1 = { x: 1, y: 2 }\nconst o2 = { x: 3, y: 4 }\n"})}),"\n",(0,t.jsx)(n.p,{children:"Shape transform:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Shape chain: Shape(empty) => Shape(x) => Shape(x, y)\nconst o = {}\no.x = 1\no.y = 2\n\n// Shape chain: Shape(empty) => Shape(y) => Shape(y, x)\nconst o = {}\no.y = 2\no.x = 1\n\n// Shape chain: Shape(x)\nconst o = { x: 1 }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Array shape: ",(0,t.jsx)(n.code,{children:"Shape('length'), 'length' => 0 Offset, Writable"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"v8-inline-cache",children:"V8 Inline Cache"}),"\n",(0,t.jsxs)(n.p,{children:["V8 use ",(0,t.jsx)(n.a,{href:"https://blog.frontend-almanac.com/js-optimisation-ic",children:"ICs"}),"\nto memorize information (same shape) where to find properties on objects:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"always initialize objects in the same way (generate the same shape)"}),"\n",(0,t.jsx)(n.li,{children:"don't add property to objects dynamically (invalid inline cache)"}),"\n",(0,t.jsx)(n.li,{children:"don't mess with property attributes of array elements"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["V8 \u4e3a\u4e86\u63d0\u9ad8\u5bf9\u8c61\u5c5e\u6027\u7684\u8bbf\u95ee\u6548\u7387, \u5c06\u5c5e\u6027\u5206\u4e3a",(0,t.jsx)(n.a,{href:"https://v8.dev/blog/fast-properties",children:"\u591a\u79cd\u7c7b\u578b"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6392\u5e8f\u5c5e\u6027 (elements): \u7b26\u5408\u6570\u7ec4\u7d22\u5f15\u7c7b\u578b\u7684\u5c5e\u6027 (\u6b63\u6574\u6570), \u5b58\u50a8\u4e3a\u7ebf\u6027\u7ed3\u6784, \u53ef\u5feb\u901f\u8bbf\u95ee."}),"\n",(0,t.jsx)(n.li,{children:"\u5e38\u89c4\u5c5e\u6027 (properties): \u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u5c5e\u6027 (\u5305\u62ec\u8d1f\u6570/\u6d6e\u70b9\u6570/Symbol), \u5b58\u50a8\u4e3a\u7ebf\u6027\u7ed3\u6784, \u53ef\u5feb\u901f\u8bbf\u95ee."}),"\n",(0,t.jsx)(n.li,{children:"\u6162\u5c5e\u6027: \u5c5e\u6027\u9700\u8981\u53cd\u590d\u589e\u5220\u65f6, \u4f1a\u5c06\u5c5e\u6027\u5b58\u50a8\u7c7b\u578b\u4ece\u7ebf\u6027\u7ed3\u6784 (\u5feb\u5c5e\u6027) \u6539\u4e3a\u5b57\u5178\u7ed3\u6784 (\u6162\u5c5e\u6027)."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"v8-object-structure",children:"V8 Object Structure"}),"\n",(0,t.jsxs)(n.p,{children:["Basic ",(0,t.jsx)(n.a,{href:"https://blog.frontend-almanac.com/js-object-structure",children:"object structure"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Every object in JavaScript has its main internal class\nand a ",(0,t.jsx)(n.a,{href:"https://v8.dev/docs/hidden-classes",children:"hidden class"})," that describes its shape."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://v8.dev/docs/hidden-classes",children:"Hidden classes"}),"\ninherit from each other and are organized into class trees.\nThe shape of an object ",(0,t.jsx)(n.code,{children:"{ a: 1 }"})," will be the parent\nfor the shape of an object ",(0,t.jsx)(n.code,{children:"{ a: 1, b: 2 }"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The order of properties matters.\nObjects ",(0,t.jsx)(n.code,{children:"{ a: 1, b: 2 }"})," and ",(0,t.jsx)(n.code,{children:"{ b: 2, a: 1 }"})," will have two different shapes."]}),"\n",(0,t.jsx)(n.li,{children:"A subclass holds a reference to the superclass\nand information about what has changed (transition)."}),"\n",(0,t.jsx)(n.li,{children:"In the class tree of each object,\nthe number of levels is not less than the number of properties in the object."}),"\n",(0,t.jsx)(n.li,{children:"The fastest properties of an object will be those declared at initialization,\nin-object property faster than external property."}),"\n",(0,t.jsxs)(n.li,{children:["Atypical changes in the object's structure, such as property removal (",(0,t.jsx)(n.code,{children:"delete"}),"),\ncan lead to a change in the storage type of properties to a slower one."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'const obj1 = { a: undefined }\nobj1.a = 1 // <- "a" - in-object property.\n\nconst obj2 = {}\nobj2.a = 1 // <- "a" - external property.\n\n// Change storage type to NameDictionary.\nconst obj1 = { a: 1, b: 2 }\ndelete obj1.a\n\n// Storage type is not changed.\nconst obj2 = { a: 1, b: 2 }\nobj2.a = undefined\n'})}),"\n",(0,t.jsxs)(n.p,{children:["An array is a regular class whose structure looks like ",(0,t.jsx)(n.code,{children:"{ length: [W__] }"}),".\nThe elements of the array are stored in special structures,\nand references to these structures are placed inside the object:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Adding or removing elements from the array\n",(0,t.jsx)(n.strong,{children:"does not"})," lead to an increase in the class tree."]}),"\n",(0,t.jsxs)(n.li,{children:["The use of atypical keys in an array,\nsuch as non-numeric keys or keys outside the range ",(0,t.jsx)(n.code,{children:"[0 .. 2**32 - 2]"}),",\nleads to the creation of new shapes in the class tree."]}),"\n",(0,t.jsx)(n.li,{children:"Attempting to modify an array element's attribute\nwill result in a switch to a slower storage type."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// 1. New element of the array doesn't extends the shapes tree.\nconst arr = []\narr[0] = 1\n\n// 2. Leads to the shapes tree generation:\n// { length } => { length, [-1] } => { length, [-1], [2**32 - 1] }.\nconst arr = []\narr[-1] = 1\narr[2 ** 32 - 1] = 2\n\n// 3. Modify element's attribute result in switch to slower storage type.\nconst arr = [1, 2, 3]\n// { elements: {\n//   #0: 1,\n//   #1: 2,\n//   #2: 3\n// }}\n\nObject.defineProperty(arr, '0', { writable: false })\n// { elements: {\n//   #0: { value: 1, attrs: [_EC] },\n//   #1: { value: 2, attrs: [WEC] },\n//   #2: { value: 3, attrs: [WEC] }\n// }}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"v8-garbage-collection",children:"V8 Garbage Collection"}),"\n",(0,t.jsxs)(n.p,{children:["V8 ",(0,t.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/VbAUPGt3sUVzEQHxWYmlBw",children:"garbage collection"}),"\n\u5206\u4ee3\u5783\u573e\u56de\u6536\u7b97\u6cd5, \u5c06\u5806\u5206\u4e3a\u4e24\u4e2a\u7a7a\u95f4:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u65b0\u751f\u4ee3: \u5b58\u653e\u77ed\u5468\u671f\u5bf9\u8c61, \u7a7a\u95f4\u5c0f, \u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"Scavenge"})," \u56de\u6536\u7b97\u6cd5, \u526f\u5783\u573e\u56de\u6536\u5668."]}),"\n",(0,t.jsxs)(n.li,{children:["\u8001\u751f\u4ee3: \u5b58\u653e\u957f\u5468\u671f\u5bf9\u8c61, \u7a7a\u95f4\u5927, \u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"Mark-Sweep-Compact"})," \u56de\u6536\u7b97\u6cd5, \u4e3b\u5783\u573e\u56de\u6536\u5668."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"v8-scavenge-gc-algorithm",children:"V8 Scavenge GC Algorithm"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7a7a\u95f4\u6362\u65f6\u95f4\u7b97\u6cd5 (\u590d\u5236\u7b97\u6cd5)."}),"\n",(0,t.jsx)(n.li,{children:"\u6807\u8bb0\u6d3b\u52a8\u5bf9\u8c61\u548c\u975e\u6d3b\u52a8\u5bf9\u8c61."}),"\n",(0,t.jsx)(n.li,{children:"\u590d\u5236 from-space \u4e2d\u7684\u6d3b\u52a8\u5bf9\u8c61\u5230 to-space \u4e2d\u5e76\u8fdb\u884c\u6392\u5e8f."}),"\n",(0,t.jsx)(n.li,{children:"\u6e05\u9664 from-space \u4e2d\u7684\u6240\u6709\u5bf9\u8c61."}),"\n",(0,t.jsx)(n.li,{children:"\u5c06 from-space \u548c to-space \u8fdb\u884c\u89d2\u8272\u4e92\u6362, \u7b49\u5f85\u4e0b\u4e00\u6b21 GC."}),"\n",(0,t.jsx)(n.li,{children:"\u65b0\u751f\u4ee3\u5bf9\u8c61\u664b\u5347 (\u8ba1\u7b97\u5b58\u6d3b\u5468\u671f, \u521d\u59cb\u4e3a nursery \u5b50\u4ee3):\nallocation -> nursery \u5b50\u4ee3 -> intermediate \u5b50\u4ee3 -> \u8001\u751f\u4ee3."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"v8-mark-sweep-compact-gc-algorithm",children:"V8 Mark-Sweep-Compact GC Algorithm"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u8001\u751f\u4ee3\u7a7a\u95f4\u5927, \u65e0\u6cd5\u4f7f\u7528\u7a7a\u95f4\u6362\u65f6\u95f4 (\u590d\u5236) \u7b97\u6cd5."}),"\n",(0,t.jsx)(n.li,{children:"\u6807\u8bb0\u9636\u6bb5: \u5bf9\u8001\u751f\u4ee3\u5bf9\u8c61\u8fdb\u884c\u7b2c\u4e00\u6b21\u626b\u63cf, \u5bf9\u6d3b\u52a8\u5bf9\u8c61\u8fdb\u884c\u6807\u8bb0."}),"\n",(0,t.jsx)(n.li,{children:"\u6e05\u7406\u9636\u6bb5: \u5bf9\u8001\u751f\u4ee3\u5bf9\u8c61\u8fdb\u884c\u7b2c\u4e8c\u6b21\u626b\u63cf, \u6e05\u9664\u672a\u6807\u8bb0\u7684\u5bf9\u8c61."}),"\n",(0,t.jsx)(n.li,{children:"\u538b\u7f29\u9636\u6bb5: \u6bcf\u6b21\u6e05\u7406\u5b8c\u975e\u6d3b\u52a8\u5bf9\u8c61, \u628a\u5269\u4e0b\u6d3b\u52a8\u5bf9\u8c61\u6574\u7406\u5230\u5185\u5b58\u7684\u4e00\u4fa7, \u56de\u6536\u6389\u8fb9\u754c\u4e0a\u7684\u5185\u5b58 (\u4ee5\u5907\u540e\u7eed\u5927\u5bf9\u8c61\u8001\u751f\u4ee3)."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"v8-gc-stop-the-world",children:"V8 GC Stop-The-World"}),"\n",(0,t.jsx)(n.p,{children:"\u5783\u573e\u56de\u6536\u4f18\u5148\u4e8e\u4ee3\u7801\u6267\u884c, \u4f1a\u5148\u505c\u6b62\u4ee3\u7801\u7684\u6267\u884c,\n\u7b49\u5230\u5783\u573e\u56de\u6536\u5b8c\u6bd5, \u518d\u6267\u884c JS \u4ee3\u7801, \u6210\u4e3a\u5168\u505c\u987f."}),"\n",(0,t.jsx)(n.p,{children:"Orinoco \u4f18\u5316 (\u4f18\u5316\u5168\u505c\u987f\u73b0\u8c61):"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Incremental marking (time slice): ",(0,t.jsx)(n.code,{children:"JS + Mark + JS + Mark ..."}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Lazy sweeping."}),"\n",(0,t.jsx)(n.li,{children:"Concurrent GC."}),"\n",(0,t.jsx)(n.li,{children:"Parallel GC."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"v8-performance-tools",children:"V8 Performance Tools"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/thlorenz/deoptigate",children:"Deoptigate"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/thlorenz/turbolizer",children:"Turbolizer"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/thlorenz/v8-map-processor",children:"v8 map processor"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/thlorenz/v8-perf",children:"v8 perf"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"browser-engine",children:"Browser Engine"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Chrome: Blink (fork of ",(0,t.jsx)(n.code,{children:"WebCore"})," component from ",(0,t.jsx)(n.code,{children:"WebKit"}),") + V8."]}),"\n",(0,t.jsx)(n.li,{children:"Edge: Trident/EdgeHTML + Chakra -> Chromium."}),"\n",(0,t.jsx)(n.li,{children:"Firefox: Gecko + SpiderMonkey."}),"\n",(0,t.jsxs)(n.li,{children:["Safari: Webkit (fork of ",(0,t.jsx)(n.code,{children:"KHTML"})," and ",(0,t.jsx)(n.code,{children:"KJS"})," from ",(0,t.jsx)(n.code,{children:"KDE"}),") + JavaScriptCore (Nitro)."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"browser-process-architecture",children:"Browser Process Architecture"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8fdb\u7a0b:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Singleton."}),"\n",(0,t.jsx)(n.li,{children:"\u6d4f\u89c8\u5668\u754c\u9762\u663e\u793a, \u63d0\u4f9b\u7528\u6237\u4ea4\u4e92, e.g \u524d\u8fdb/\u540e\u9000."}),"\n",(0,t.jsx)(n.li,{children:"\u5b50\u8fdb\u7a0b\u7ba1\u7406."}),"\n",(0,t.jsx)(n.li,{children:"\u7f51\u7edc\u8d44\u6e90\u7ba1\u7406."}),"\n",(0,t.jsx)(n.li,{children:"\u5b58\u50a8\u7ba1\u7406."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u7f51\u7edc\u8fdb\u7a0b:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Singleton."}),"\n",(0,t.jsx)(n.li,{children:"\u4e3b\u8981\u8d1f\u8d23\u9875\u9762\u7684\u7f51\u7edc\u8d44\u6e90\u52a0\u8f7d."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#viz-process",children:[(0,t.jsx)(n.code,{children:"Viz"})," process"]}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Singleton."}),"\n",(0,t.jsx)(n.li,{children:"\u5b9e\u73b0 3D CSS, \u7ed8\u5236 UI \u754c\u9762."}),"\n",(0,t.jsx)(n.li,{children:"GPU main thread:\nrasters display lists and video frames into GPU texture tiles,\ndraws compositor frames to screen using GPU,\nOut-of-Process display compositor, raster and iframes (OOP-D, OOP-R, OOPIFs)."}),"\n",(0,t.jsxs)(n.li,{children:["Display compositor thread:\n",(0,t.jsx)(n.strong,{children:"aggregates and optimizes"})," compositing from render processes and browser process."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u6e32\u67d3\u8fdb\u7a0b:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6838\u5fc3\u4efb\u52a1\u662f\u5c06 HTML/CSS \u548c JavaScript \u8f6c\u6362\u4e3a\u7528\u6237\u53ef\u4ee5\u4e0e\u4e4b\u4ea4\u4e92\u7684\u7f51\u9875 (\u9875\u9762\u6e32\u67d3, \u811a\u672c\u6267\u884c, \u4e8b\u4ef6\u5904\u7406)."}),"\n",(0,t.jsx)(n.li,{children:"\u6392\u7248\u5f15\u64ce Blink \u548c JavaScript \u5f15\u64ce V8 \u90fd\u662f\u8fd0\u884c\u5728\u8be5\u8fdb\u7a0b\u4e2d."}),"\n",(0,t.jsx)(n.li,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b, Chrome \u4f1a\u4e3a\u6bcf\u4e2a Tab \u6807\u7b7e\u521b\u5efa\u4e00\u4e2a\u6e32\u67d3\u8fdb\u7a0b."}),"\n",(0,t.jsxs)(n.li,{children:["Within a single browser tab,\nframes (",(0,t.jsx)(n.code,{children:"<iframe>"}),") from different sites are always in different render processes\n(OOPIFs, ",(0,t.jsx)(n.a,{href:"https://www.chromium.org/developers/design-documents/oop-iframes",children:"Out-of-Process iframes"}),"),\nbut frames (",(0,t.jsx)(n.code,{children:"<iframe>"}),") from same site are always in same render process."]}),"\n",(0,t.jsx)(n.li,{children:"\u51fa\u4e8e\u5b89\u5168\u8003\u8651, \u6e32\u67d3\u8fdb\u7a0b\u90fd\u662f\u8fd0\u884c\u5728\u6c99\u7bb1\u6a21\u5f0f\u4e0b."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u63d2\u4ef6\u8fdb\u7a0b:\n\u4e3b\u8981\u662f\u8d1f\u8d23\u63d2\u4ef6\u7684\u8fd0\u884c, \u56e0\u63d2\u4ef6\u6613\u5d29\u6e83, \u6240\u4ee5\u9700\u8981\u901a\u8fc7\u9694\u79bb\u4ee5\u4fdd\u8bc1\u63d2\u4ef6\u8fdb\u7a0b\u5d29\u6e83\u4e0d\u4f1a\u5bf9\u6d4f\u89c8\u5668\u548c\u9875\u9762\u9020\u6210\u5f71\u54cd."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"chromium-rendering-engine",children:"Chromium Rendering Engine"}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-architecture",children:"RenderingNG Architecture"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng",children:(0,t.jsx)(n.img,{alt:"RenderingNG Architecture",src:r(9425).A+"",width:"1252",height:"1235"})})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"RenderingNG"})," key goals:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng/#reliability",children:"Reliability"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng/#scalable-performance",children:"Scalable Performance"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng/#extensibility-the-right-tools-for-the-job",children:"Extensibility"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"RenderingNG"})," key changes:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Uniform point of entry:\nalways enter the pipeline at the beginning\n(no longer possible to enter the pipeline starting at an intermediate phase)."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Functional"})," stages:\neach stage should have well-defined inputs and outputs,\nand its behavior should be functional."]}),"\n",(0,t.jsx)(n.li,{children:"Constant inputs:\ninputs should be effectively constant while the stage is running."}),"\n",(0,t.jsx)(n.li,{children:"Immutable outputs:\noutputs should be immutable for the remainder of the rendering update."}),"\n",(0,t.jsx)(n.li,{children:"Checkpoint consistency:\nrendering data produced thus far should be in a self-consistent state\nat the end of each stage."}),"\n",(0,t.jsx)(n.li,{children:"De-duplication of work:\nonly compute each thing once."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-pipeline",children:"RenderingNG Pipeline"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture",children:"RenderingNG"}),"\n",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#the-pipeline-stages",children:"pipeline"}),"\n(green ",(0,t.jsx)(n.code,{children:"main"})," thread -> yellow ",(0,t.jsx)(n.code,{children:"compositor"})," thread -> orange ",(0,t.jsx)(n.code,{children:"Viz"})," process):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Animate."}),"\n",(0,t.jsx)(n.li,{children:"Style."}),"\n",(0,t.jsx)(n.li,{children:"Layout."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/blinkng/#the-pre-paint-phase",children:"Pre-paint"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Scroll."}),"\n",(0,t.jsx)(n.li,{children:"Paint."}),"\n",(0,t.jsx)(n.li,{children:"Commit."}),"\n",(0,t.jsx)(n.li,{children:"Layerize."}),"\n",(0,t.jsx)(n.li,{children:"Raster, decode and paint worklet (GPU hardware acceleration)."}),"\n",(0,t.jsx)(n.li,{children:"Activate."}),"\n",(0,t.jsx)(n.li,{children:"Aggregate (GPU hardware acceleration)."}),"\n",(0,t.jsx)(n.li,{children:"Draw (GPU hardware acceleration)."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#rendering-pipeline-structure",children:(0,t.jsx)(n.img,{alt:"RenderingNG Pipeline",src:r(6803).A+"",width:"845",height:"1344"})})}),"\n",(0,t.jsxs)(n.p,{children:["Stages of the rendering pipeline can be skipped if they aren't needed:\nScrolling and visual effects animation can skip ",(0,t.jsx)(n.code,{children:"layout"}),", ",(0,t.jsx)(n.code,{children:"pre-paint"})," and ",(0,t.jsx)(n.code,{children:"paint"}),".\nIf ",(0,t.jsx)(n.code,{children:"layout"}),", ",(0,t.jsx)(n.code,{children:"pre-paint"}),", and ",(0,t.jsx)(n.code,{children:"paint"})," can be skipped for visual effects,\nthey can be run entirely on ",(0,t.jsx)(n.code,{children:"compositor"})," thread and ",(0,t.jsxs)(n.strong,{children:["skip ",(0,t.jsx)(n.code,{children:"main"})," thread"]}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-render-process",children:"RenderingNG Render Process"}),"\n",(0,t.jsx)(n.p,{children:"Render process:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Download HTML."}),"\n",(0,t.jsx)(n.li,{children:"Parser/Script."}),"\n",(0,t.jsx)(n.li,{children:"DOM and CSSOM Construction."}),"\n",(0,t.jsx)(n.li,{children:"Render Tree = DOM Tree + Styled Tree."}),"\n",(0,t.jsx)(n.li,{children:"Layout."}),"\n",(0,t.jsx)(n.li,{children:"Paint."}),"\n",(0,t.jsx)(n.li,{children:"Composite."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#threads",children:(0,t.jsx)(n.img,{alt:"Render Process",src:r(2791).A+"",width:"845",height:"587"})})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["GUI \u6e32\u67d3\u7ebf\u7a0b (",(0,t.jsxs)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#render-process-main-thread-components",children:[(0,t.jsx)(n.code,{children:"main"})," thread"]}),"):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Parse ",(0,t.jsx)(n.code,{children:"HTML"}),"/",(0,t.jsx)(n.code,{children:"CSS"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Construct ",(0,t.jsx)(n.code,{children:"DOM"})," tree, ",(0,t.jsx)(n.code,{children:"CSSOM"})," tree and ",(0,t.jsx)(n.code,{children:"RenderObject"})," tree."]}),"\n",(0,t.jsx)(n.li,{children:"Layout render tree."}),"\n",(0,t.jsx)(n.li,{children:"Paint render tree."}),"\n",(0,t.jsxs)(n.li,{children:["Send information to GPU (Composite render tree):\nseparating\n",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#render-process-main-thread-components",children:(0,t.jsx)(n.code,{children:"main"})}),"\nand\n",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#render-process-compositor-thread-structure",children:(0,t.jsx)(n.code,{children:"compositor"})}),"\nthreads is critically important for\n",(0,t.jsx)(n.code,{children:"performance isolation"})," of animation and scrolling from main thread work."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["JS \u5f15\u64ce\u7ebf\u7a0b:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["JS \u5185\u6838\u8fd0\u884c\u7ebf\u7a0b, \u8d1f\u8d23\u89e3\u6790 ",(0,t.jsx)(n.code,{children:"JavaScript"})," \u811a\u672c, \u8fd0\u884c\u4ee3\u7801."]}),"\n",(0,t.jsx)(n.li,{children:"\u4e00\u4e2a Tab \u9875 (\u6e32\u67d3\u8fdb\u7a0b) \u4e2d\u53ea\u6709\u4e00\u4e2a JS \u5f15\u64ce\u7ebf\u7a0b\u5728\u8fd0\u884c JS \u7a0b\u5e8f."}),"\n",(0,t.jsx)(n.li,{children:"JS \u5f15\u64ce\u4e00\u76f4\u7b49\u5f85\u7740\u4efb\u52a1\u961f\u5217\u4e2d\u4efb\u52a1\u7684\u5230\u6765, \u7136\u540e\u52a0\u4ee5\u5904\u7406."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u4e8b\u4ef6\u89e6\u53d1\u7ebf\u7a0b:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u8d1f\u8d23\u63a7\u5236\u4e8b\u4ef6\u5faa\u73af."}),"\n",(0,t.jsx)(n.li,{children:"JS \u5f15\u64ce\u7ebf\u7a0b\u89e6\u53d1 MacroTask/MicroTask, \u4e8b\u4ef6\u7ebf\u7a0b\u5c06\u4efb\u52a1\u6dfb\u52a0\u5230\u4efb\u52a1\u961f\u5217, \u7b49\u5f85 JS \u5f15\u64ce\u7ebf\u7a0b\u6267\u884c."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5b9a\u65f6\u89e6\u53d1\u5668\u7ebf\u7a0b:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"setInterval"})," \u4e0e ",(0,t.jsx)(n.code,{children:"setTimeout"})," \u6267\u884c\u7ebf\u7a0b."]}),"\n",(0,t.jsx)(n.li,{children:"\u6b64\u7ebf\u7a0b\u8ba1\u65f6\u5e76\u89e6\u53d1\u5b9a\u65f6\u5668\u4efb\u52a1, \u8ba1\u65f6\u5b8c\u6bd5\u540e, \u4e8b\u4ef6\u7ebf\u7a0b\u5c06\u5b9a\u65f6\u5668\u4efb\u52a1\u6dfb\u52a0\u5230\u4efb\u52a1\u961f\u5217, \u7b49\u5f85 JS \u5f15\u64ce\u7ebf\u7a0b\u6267\u884c."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u5f02\u6b65 HTTP \u8bf7\u6c42\u7ebf\u7a0b:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"XMLHttpRequest"})," \u8fde\u63a5\u540e, \u901a\u8fc7\u6d4f\u89c8\u5668\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u5f02\u6b65 HTTP \u8bf7\u6c42\u7ebf\u7a0b."]}),"\n",(0,t.jsx)(n.li,{children:"\u5f53\u68c0\u6d4b\u5230 HTTP \u8bf7\u6c42\u72b6\u6001\u53d8\u66f4\u65f6, \u6b64\u7ebf\u7a0b\u4ea7\u751f\u72b6\u6001\u53d8\u66f4\u4e8b\u4ef6,\n\u5e76\u5c06 HTTP \u54cd\u5e94\u5904\u7406\u51fd\u6570 (\u7528\u6237\u56de\u8c03\u51fd\u6570) \u6dfb\u52a0\u5230\u4efb\u52a1\u961f\u5217, \u7b49\u5f85 JS \u5f15\u64ce\u7ebf\u7a0b\u6267\u884c."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"GUI and JS Thread",type:"danger",children:(0,t.jsx)(n.p,{children:"GUI \u6e32\u67d3\u7ebf\u7a0b\u4e0e JS \u5f15\u64ce\u7ebf\u7a0b\u4e92\u65a5."})}),"\n",(0,t.jsxs)(n.admonition,{title:"Multi-threads Architecture",type:"tip",children:[(0,t.jsx)(n.p,{children:"Threads help achieve:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Performance isolation and responsiveness in spite of slow tasks."}),"\n",(0,t.jsx)(n.li,{children:"Helper threads:\nsending long-running subtasks off to additional threads,\nto keep parent thread responsive to other requests happening simultaneously."}),"\n",(0,t.jsx)(n.li,{children:"Multiple buffering:\nshowing previously rendered content while rendering new content,\nto hide latency of rendering."}),"\n",(0,t.jsx)(n.li,{children:"Pipeline parallelization:\nrunning rendering pipeline in multiple places simultaneously\n(fast scrolling and animation)."}),"\n"]})]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-html-parser",children:"RenderingNG HTML Parser"}),"\n",(0,t.jsx)(n.p,{children:"DTD is context-sensitive grammar.\nUse State Machine pattern to implement a tokenizer:"}),"\n",(0,t.jsx)(n.admonition,{title:"Tokenizer",type:"tip",children:(0,t.jsx)(n.p,{children:"Data -> Tag Open -> Tag Name -> Tag Close -> Data."})}),"\n",(0,t.jsx)(n.p,{children:"tokenizer send tokens to constructor, constructing DOM tree:"}),"\n",(0,t.jsx)(n.admonition,{title:"DOM Tree Constructor",type:"tip",children:(0,t.jsx)(n.p,{children:"initial -> before HTML -> before head -> in head -> after head\n-> in body -> after body -> after after body -> EOF token."})}),"\n",(0,t.jsx)(n.p,{children:"HTML parser performance:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"<= 1500"})," DOM nodes."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"<= 60"})," children nodes."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"<= 32"})," levels."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-css-parser",children:"RenderingNG CSS Parser"}),"\n",(0,t.jsx)(n.p,{children:"CSS is context-free grammar.\nWebkit use flex/bison (bottom-to-up), Gecko use up-to-bottom."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ruleSet\n  : selector [ ',' S* selector ]*\n    '{' S* declaration [ ';' S* declaration ]* '}' S*\n  ;\nselector\n  : simple_selector [ combinator selector | S+ [ combinator? selector ]? ]?\n  ;\nsimple_selector\n  : element_name [ HASH | class | attrib | pseudo ]*\n  | [ HASH | class | attrib | pseudo ]+\n  ;\nclass\n  : '.' IDENT\n  ;\nelement_name\n  : IDENT | '*'\n  ;\nattrib\n  : '[' S* IDENT S* [ [ '=' | INCLUDES | DASHMATCH ] S*\n    [ IDENT | STRING ] S* ] ']'\n  ;\npseudo\n  : ':' [ IDENT | FUNCTION S* [IDENT S*] ')' ]\n  ;\n"})}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-layout-engine",children:"RenderingNG Layout Engine"}),"\n",(0,t.jsxs)(n.p,{children:["\u4e3a\u907f\u514d\u5bf9\u6240\u6709\u7ec6\u5c0f\u66f4\u6539\u90fd\u8fdb\u884c\u6574\u4f53\u5e03\u5c40, \u6d4f\u89c8\u5668\u91c7\u7528\u4e86\u4e00\u79cd ",(0,t.jsx)(n.code,{children:"dirty bit"})," \u7cfb\u7edf.\n\u5982\u679c\u67d0\u4e2a\u5448\u73b0\u5668\u53d1\u751f\u4e86\u66f4\u6539, \u6216\u8005\u5c06\u81ea\u8eab\u53ca\u5176\u5b50\u4ee3\u6807\u6ce8\u4e3a ",(0,t.jsx)(n.code,{children:"dirty"}),", \u5219\u9700\u8981\u8fdb\u884c\u5e03\u5c40:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7236\u5448\u73b0\u5668\u786e\u5b9a\u81ea\u5df1\u7684\u5bbd\u5ea6."}),"\n",(0,t.jsxs)(n.li,{children:["\u7236\u5448\u73b0\u5668\u4f9d\u6b21\u5904\u7406\u5b50\u5448\u73b0\u5668, \u5e76\u4e14:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u653e\u7f6e\u5b50\u5448\u73b0\u5668 (\u8bbe\u7f6e ",(0,t.jsx)(n.code,{children:"(x, y)"})," \u5750\u6807)."]}),"\n",(0,t.jsx)(n.li,{children:"\u5982\u679c\u6709\u5fc5\u8981, \u8c03\u7528\u5b50\u5448\u73b0\u5668\u7684\u5e03\u5c40 (\u5982\u679c\u5b50\u5448\u73b0\u5668\u662f dirty \u7684, \u6216\u8005\u8fd9\u662f\u5168\u5c40\u5e03\u5c40, \u6216\u51fa\u4e8e\u5176\u4ed6\u67d0\u4e9b\u539f\u56e0),\n\u8fd9\u4f1a\u8ba1\u7b97\u5b50\u5448\u73b0\u5668\u7684\u9ad8\u5ea6."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"\u7236\u5448\u73b0\u5668\u6839\u636e\u5b50\u5448\u73b0\u5668\u7684\u7d2f\u52a0\u9ad8\u5ea6\u4ee5\u53ca\u8fb9\u8ddd\u548c\u8865\u767d\u7684\u9ad8\u5ea6\u6765\u8bbe\u7f6e\u81ea\u8eab\u9ad8\u5ea6, \u6b64\u503c\u4e5f\u53ef\u4f9b\u7236\u5448\u73b0\u5668\u7684\u7236\u5448\u73b0\u5668\u4f7f\u7528."}),"\n",(0,t.jsxs)(n.li,{children:["\u5c06\u5176 ",(0,t.jsx)(n.code,{children:"dirty \u4f4d"})," \u8bbe\u7f6e\u4e3a ",(0,t.jsx)(n.code,{children:"false"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"RenderingNG"})," ",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/layoutng",children:"layout engine"}),"\ngenerate\n",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-data-structures/#the-immutable-fragment-tree",children:"immutable fragment tree"}),"\nand\n",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-data-structures/#inline-fragment-items",children:"immutable flat list"}),".\nIt helps mitigate layout bugs including:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/layoutng/#correctness",children:"Correctness"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/layoutng/#under-invalidation",children:"Under-invalidation"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/layoutng/#over-invalidation-and-performance",children:"Over-invalidation"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/layoutng/#hysteresis",children:"Hysteresis"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-paint-engine",children:"RenderingNG Paint Engine"}),"\n",(0,t.jsx)(n.p,{children:"Paint order:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u80cc\u666f\u989c\u8272."}),"\n",(0,t.jsx)(n.li,{children:"\u80cc\u666f\u56fe\u7247."}),"\n",(0,t.jsx)(n.li,{children:"\u8fb9\u6846."}),"\n",(0,t.jsx)(n.li,{children:"\u5b50\u4ee3."}),"\n",(0,t.jsx)(n.li,{children:"\u8f6e\u5ed3."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-data-structures/#property-trees",children:"Property trees"}),"\nare data structures that explain how visual and scrolling effects apply to DOM elements.\nEvery web document has four separate property trees:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Transform tree represents CSS transforms and scrolling."}),"\n",(0,t.jsx)(n.li,{children:"Clip tree represents overflow clips."}),"\n",(0,t.jsx)(n.li,{children:"Effect tree represents all other visual effects:\nopacity, filters, masks, blend modes, and other kinds of clips such as clip-path."}),"\n",(0,t.jsx)(n.li,{children:"Scroll tree represents information about scrolling,.\nsuch as how scrolls chain together"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"JavaScript \u963b\u585e\u6e32\u67d3:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u6e32\u67d3\u8fdb\u7a0b (",(0,t.jsx)(n.code,{children:"Render"})," process) \u4e2d\u4e3b\u7ebf\u7a0b (",(0,t.jsx)(n.code,{children:"main"})," thread) ",(0,t.jsx)(n.code,{children:"Layout"})," \u9636\u6bb5\u4e0e ",(0,t.jsx)(n.code,{children:"Paint"})," \u9636\u6bb5\u4e0d\u8d1f\u8d23\u5b9e\u9645\u7684\u7ed8\u5236\u64cd\u4f5c:\n",(0,t.jsx)(n.code,{children:"Layout"})," \u9636\u6bb5\u6267\u884c ",(0,t.jsx)(n.code,{children:"Update Layer Tree"}),", \u66f4\u65b0\u6bcf\u5c42\u4fe1\u606f,\n",(0,t.jsx)(n.code,{children:"Paint"})," \u9636\u6bb5\u6574\u7406\u6bcf\u5c42\u9875\u9762\u7684\u7ed8\u5236\u4fe1\u606f, \u6784\u5efa\u7ed8\u5236\u5217\u8868."]}),"\n",(0,t.jsxs)(n.li,{children:["\u4ee5\u4e0a\u9636\u6bb5\u7684\u6570\u636e\u6700\u7ec8\u4f1a\u4ea4\u7ed9\n\u6e32\u67d3\u8fdb\u7a0b (",(0,t.jsx)(n.code,{children:"Render"})," process) \u4e2d\u5408\u6210\u7ebf\u7a0b (",(0,t.jsx)(n.code,{children:"compositor"})," thread) \u4e0e ",(0,t.jsx)(n.code,{children:"Viz"})," process \u6267\u884c\u5b9e\u9645\u7684\u7ed8\u5236\u64cd\u4f5c."]}),"\n",(0,t.jsxs)(n.li,{children:["JavaScript \u963b\u585e\u4e86\u540c\u5728\u4e3b\u7ebf\u7a0b\u7684 ",(0,t.jsx)(n.code,{children:"Layout"})," \u9636\u6bb5\u4e0e ",(0,t.jsx)(n.code,{children:"Paint"})," \u9636\u6bb5,\n\u95f4\u63a5\u963b\u585e\u4e86 ",(0,t.jsx)(n.code,{children:"compositor"})," thread \u4e0e ",(0,t.jsx)(n.code,{children:"Viz"})," process \u7684\u7ed8\u5236\u64cd\u4f5c."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-video-engine",children:"RenderingNG Video Engine"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/videong",children:(0,t.jsx)(n.img,{alt:"RenderingNG Video Engine",src:r(8386).A+"",width:"845",height:"474"})})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Each video talks directly to ",(0,t.jsx)(n.code,{children:"Viz"})," process:\nvideo rendering is largely decoupled from ",(0,t.jsx)(n.code,{children:"RenderingNG"})," main rendering pipeline."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-scrolling-performance",children:"RenderingNG Scrolling Performance"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Cached GPU textures and display lists:\nhelp battery life and animation frame rate for scrolling."}),"\n",(0,t.jsx)(n.li,{children:"Every possible scroll is threaded:\ndon't have to depend on the JavaScript and layout thread."}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"renderingng-animation-performance",children:"RenderingNG Animation Performance"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/renderingng-architecture/#an-example-in-practice",children:(0,t.jsx)(n.img,{alt:"RenderingNG Transform Animation",src:r(137).A+"",width:"845",height:"516"})})}),"\n",(0,t.jsxs)(n.p,{children:["CSS transform animation only runs on ",(0,t.jsx)(n.code,{children:"compositor"})," thread and ",(0,t.jsx)(n.code,{children:"Viz"})," process."]}),"\n",(0,t.jsx)(n.h3,{id:"browser-engine-reference",children:"Browser Engine Reference"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Chromium rendering engine: ",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/blog/renderingng",children:"RenderingNG"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Chromium ",(0,t.jsx)(n.code,{children:"RenderingNG"})," ",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/blog/renderingng-architecture",children:"architecture"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Chromium ",(0,t.jsx)(n.code,{children:"RenderingNG"})," ",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/blog/renderingng-data-structures",children:"key data structures"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Chromium ",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/blog/videong",children:"video engine architecture"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Chromium ",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/layoutng",children:"layout engine architecture"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Chromium ",(0,t.jsx)(n.code,{children:"Blink"})," ",(0,t.jsx)(n.a,{href:"https://developer.chrome.com/articles/blinkng",children:"architecture"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Web platform ",(0,t.jsx)(n.a,{href:"https://wpt.fyi",children:"tests"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Google Chrome platform feature ",(0,t.jsx)(n.a,{href:"https://github.com/GoogleChrome/chromium-dashboard",children:"status"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Mozilla Firefox platform feature ",(0,t.jsx)(n.a,{href:"https://github.com/mozilla/standards-positions",children:"status"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1640:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/ContextStackAndScopeChain-1fe54b80b91bd079b55a126e7d2fec4a.png"},7697:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/DataStream-c7ee09b15d0e8d734410199bfdf72101.png"},4971:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/EventLoop-55376b882d25e724423d4dc9883cf416.jpg"},2791:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/RenderProcess-d33647f97a751f3e6601f1209758c41f.webp"},9425:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/RenderingNG-9f126cf8c6b7acb6bbb8fedb207599bb.webp"},137:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/RenderingNGAnimation-ebbf3b677788319cd6f78d7c148ef594.webp"},6803:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/RenderingNGPipeline-fb49aa882cd3041e0db55f2b47c728f7.webp"},8386:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/RenderingNGVideoEngine-7c8d28a5bf1cda6a76d9eebe34c97031.webp"},842:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(8101);const t={},l=s.createContext(t);function i(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);