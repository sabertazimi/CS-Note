<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Web/Security/SecurityBasicNotes" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Security Basic Notes | Awesome Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://sabertazimi.github.io/awesome-notes/Web/Security/SecurityBasicNotes"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Security Basic Notes | Awesome Notes"><meta data-rh="true" name="description" content="Security Programming"><meta data-rh="true" property="og:description" content="Security Programming"><link data-rh="true" rel="icon" href="/awesome-notes/img/logo.svg"><link data-rh="true" rel="canonical" href="https://sabertazimi.github.io/awesome-notes/Web/Security/SecurityBasicNotes"><link data-rh="true" rel="alternate" href="https://sabertazimi.github.io/awesome-notes/Web/Security/SecurityBasicNotes" hreflang="en"><link data-rh="true" rel="alternate" href="https://sabertazimi.github.io/awesome-notes/Web/Security/SecurityBasicNotes" hreflang="x-default"><link rel="stylesheet" href="/awesome-notes/assets/css/styles.66f18fa6.css">
<script src="/awesome-notes/assets/js/runtime~main.84244812.js" defer="defer"></script>
<script src="/awesome-notes/assets/js/main.8162642d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/awesome-notes/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_CdK0" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_tvu8"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/awesome-notes/"><div class="navbar__logo"><img src="/awesome-notes/img/logo.svg" alt="Awesome Notes" class="themedComponent_L0Or themedComponent--light_IsTj"><img src="/awesome-notes/img/logo.svg" alt="Awesome Notes" class="themedComponent_L0Or themedComponent--dark_Q50R"></div><b class="navbar__title text--truncate">Awesome Notes</b></a><a class="navbar__item navbar__link" href="/awesome-notes/intro">Notes</a><a class="navbar__item navbar__link" href="/awesome-notes/ComputerScience/Math/AIBasicNotes">Computer Science</a><a class="navbar__item navbar__link" href="/awesome-notes/Programming/DevOps/CleanCodeBasicNotes">Programming</a><a class="navbar__item navbar__link" href="/awesome-notes/Language/Rust/RustBasicNotes">Language</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/awesome-notes/Web/JavaScript/JavaScriptBasicNotes">Web</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Links</a><ul class="dropdown__menu"><li><a href="https://github.com/sabertazimi" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://twitter.com/sabertazimi" target="_blank" rel="noopener noreferrer" class="dropdown__link">Twitter<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="mailto:sabertazimi@gmail.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">Email<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Repos</a><ul class="dropdown__menu"><li><a href="https://github.com/sabertazimi/blog" target="_blank" rel="noopener noreferrer" class="dropdown__link">Next.js Blog<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/sabertazimi/awesome-web" target="_blank" rel="noopener noreferrer" class="dropdown__link">Awesome Web<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/sabertazimi/bod" target="_blank" rel="noopener noreferrer" class="dropdown__link">Bod CLI<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://github.com/sabertazimi/awesome-notes" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_w6qK colorModeToggle_QzGZ"><button class="clean-btn toggleButton_Le8D toggleButtonDisabled_RyWq" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Oaww"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon___cv"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_uwSV"><div class="navbar__search searchBarContainer_BDPj" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_Cvc4" value=""><div class="loadingRing_FcAo searchBarLoadingRing_GgzC"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_bAZB"><div class="docsWrapper_Vh2N"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_WjrN" type="button"></button><div class="docRoot_ExoU"><aside class="theme-doc-sidebar-container docSidebarContainer_IEY4"><div class="sidebarViewport_CZO9"><div class="sidebar_otTX sidebarWithHideableNavbar_xGag"><a tabindex="-1" class="sidebarLogo_L21f" href="/awesome-notes/"><img src="/awesome-notes/img/logo.svg" alt="Awesome Notes" class="themedComponent_L0Or themedComponent--light_IsTj"><img src="/awesome-notes/img/logo.svg" alt="Awesome Notes" class="themedComponent_L0Or themedComponent--dark_Q50R"><b>Awesome Notes</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_X505"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/awesome-notes/intro">Awesome Notes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/awesome-notes/ComputerScience/Algorithms/AlgorithmsBasicNotes">Computer Science</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/awesome-notes/Programming/Android/AndroidBasicNotes">Programming</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/awesome-notes/Language/Assembly/AssemblyBasicNotes">Language</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/awesome-notes/Web/Angular/AngularBasicNotes">Web</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/Angular/AngularBasicNotes">Angular</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/CSS/BootstrapBasicNotes">CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/Frameworks/ElectronBasicNotes">Frameworks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/HTML/HTMLBasicNotes">HTML</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/JavaScript/JavaScriptAPINotes">JavaScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/Network/NetworkBasicNotes">Network</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/Node/ExpressBasicNotes">Node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/React/ReactAdvancedNotes">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/awesome-notes/Web/Security/SecurityBasicNotes">Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/awesome-notes/Web/Security/SecurityBasicNotes">Security Basic Notes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/awesome-notes/Web/Vue/VueAdvancedNotes">Vue</a></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_GyWp"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_Vw4r"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_ij2O"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_mwJx"><div class="docItemContainer_BJdx"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_y197" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/awesome-notes/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_lbxT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Web</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Security</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Security Basic Notes</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_GT_b theme-doc-toc-mobile tocMobile__a_l"><button type="button" class="clean-btn tocCollapsibleButton_qcCY">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Security Basic Notes</h1></header>
<h2 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="security-programming">Security Programming<a href="#security-programming" class="hash-link" aria-label="Direct link to Security Programming" title="Direct link to Security Programming">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="security-principles">Security Principles<a href="#security-principles" class="hash-link" aria-label="Direct link to Security Principles" title="Direct link to Security Principles">​</a></h3>
<p>安全三要素:</p>
<ul>
<li>机密性 (Confidentiality).</li>
<li>完整性 (Integrity).</li>
<li>可用性 (Availability).</li>
</ul>
<p>安全原则:</p>
<ul>
<li>白名单原则:<!-- -->
<ul>
<li>防火墙白名单: 默认只开放 <code>80</code> 与 <code>443</code> 端口.</li>
<li>XSS 防御白名单: 富文本编辑器只允许 <code>&lt;a&gt;</code> 与 <code>&lt;img&gt;</code> 标签.</li>
</ul>
</li>
<li>最小权限原则.</li>
<li>纵深防御原则:<!-- -->
<ul>
<li>Web 应用安全.</li>
<li>网络环境安全.</li>
<li>数据库安全.</li>
<li>OS 系统安全.</li>
</ul>
</li>
<li>数据与代码分离原则:<!-- -->
<ul>
<li>缓冲区溢出漏洞: 混淆代码与数据边界, 导致安全问题发生.</li>
<li>注入漏洞: 混合应用代码与用户数据, 导致 SQL/XSS/CSRF/XML 漏洞发生.</li>
</ul>
</li>
<li>不可预测性原则:<!-- -->
<ul>
<li>有效地对抗基于篡改与伪造的攻击.</li>
<li>随机栈基址防御缓冲区溢出攻击.</li>
<li>加密哈希 Token 防御 CSRF 攻击.</li>
</ul>
</li>
</ul>
<p>STRIDE 威胁分析模型:</p>
<table><thead><tr><th>Threat</th><th>Definition</th><th>Security</th></tr></thead><tbody><tr><td>Spoofing</td><td>伪装 (他人身份)</td><td>认证</td></tr><tr><td>Tampering</td><td>篡改 (数据或代码)</td><td>完整性</td></tr><tr><td>Repudiation</td><td>抵赖 (做过的事情)</td><td>不可抵赖性</td></tr><tr><td>Information Disclosure</td><td>信息泄露 (机密数据)</td><td>机密性</td></tr><tr><td>Denial of Service</td><td>拒绝服务</td><td>可用性</td></tr><tr><td>Elevation of Privilege</td><td>提升权限 (未经授权获得许可)</td><td>授权</td></tr></tbody></table>
<p>DREAD 风险分析模型:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Risk</mtext><mo>=</mo><mtext>Probability</mtext><mo>∗</mo><mtext>Damage Potential</mtext></mrow><annotation encoding="application/x-tex">\text{Risk} = \text{Probability} * \text{Damage Potential}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em"></span><span class="mord text"><span class="mord">Risk</span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">Probability</span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em"></span><span class="mord text"><span class="mord">Damage Potential</span></span></span></span></span>:<!-- -->
<ul>
<li>高危: 12 ~ 15 分.</li>
<li>中危: 8 ~ 11 分.</li>
<li>低危: 0 ~ 7 分.</li>
</ul>
</li>
<li>Damage Potential:<!-- -->
<ul>
<li>High: 完全验证权限, 执行管理员操作, 非法上传文件.</li>
<li>Medium: 泄露敏感信息.</li>
<li>Low: 泄露其他信息.</li>
</ul>
</li>
<li>Reproducibility:<!-- -->
<ul>
<li>High: 攻击者可以随意重复攻击.</li>
<li>Medium: 攻击者可以重复攻击, 有时间限制.</li>
<li>Low: 攻击者难以重复攻击.</li>
</ul>
</li>
<li>Exploitability:<!-- -->
<ul>
<li>High: 初学者短期能掌握攻击方法.</li>
<li>Medium: 熟练者才能掌握攻击方法.</li>
<li>Low: 漏洞利用条件非常苛刻.</li>
</ul>
</li>
<li>Affected users:<!-- -->
<ul>
<li>High: All user, key user, default configuration.</li>
<li>Medium: Some user, non-default configuration.</li>
<li>Low: Rare user, anonymous user.</li>
</ul>
</li>
<li>Discoverability:<!-- -->
<ul>
<li>High: 漏洞显眼, 攻击条件容易获得.</li>
<li>Medium: 私有区域才可发现漏洞, 需要深入挖掘.</li>
<li>Low: 发现漏洞极其困难.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="software-security-assurance">Software Security Assurance<a href="#software-security-assurance" class="hash-link" aria-label="Direct link to Software Security Assurance" title="Direct link to Software Security Assurance">​</a></h3>
<ul>
<li>逻辑安全.</li>
<li>数据安全:<!-- -->
<ul>
<li>数据访问权限.</li>
<li>数据访问时间.</li>
<li>数据存储格式.</li>
<li>数据存储位置.</li>
<li>数据分解与组合.</li>
</ul>
</li>
<li>UI 安全.</li>
<li>约束安全:<!-- -->
<ul>
<li>数据正确类型.</li>
<li>数据正确范围.</li>
<li>数据长度的最大值和最小值.</li>
<li>数据非法值.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="defensive-programming">Defensive Programming<a href="#defensive-programming" class="hash-link" aria-label="Direct link to Defensive Programming" title="Direct link to Defensive Programming">​</a></h3>
<p><a href="https://mp.weixin.qq.com/s/G4pME9xFHdWnFckgytnofQ" target="_blank" rel="noopener noreferrer">Defensive programming</a>:</p>
<p>保护程序免遭非法数据的破坏:</p>
<ul>
<li>检查所有来源于外部的数据:
当从外部接口中获取数据时, 应检查所获得的数据值, 以确保它在允许的范围内.<!-- -->
<ul>
<li>检查接囗数据字段: <strong>是否存在/数据类型/取值范围/缺省值/正则表达式/特殊字符</strong>.</li>
<li>检查方法的属性参数做必要的转换: <strong>是否存在/数据类型/取值范围/缺省值/正则表达式/特殊字符</strong>.</li>
</ul>
</li>
<li>检查子程序所有输入参数的值.</li>
<li>决定如何处理错误的输入数据:
一旦检测到非法参数, 选择适合的错误处理方处理.</li>
</ul>
<p>断言:</p>
<ul>
<li>用错误处理代码处理预期发生的状况, 用断言去处理那些不该发生的错误！</li>
<li>利用断言来注解前条件和后条件: 对于<code>入参</code>/ <code>外部数据</code>/<code>返回结果</code>进行检查, 是否符合业务逻辑.</li>
<li>避免将需要执行的子程序放到断言中.</li>
<li>通过写断言, 不仅可以提高防御性, 还能提高可读性.</li>
</ul>
<p>程序的健壮性:</p>
<ul>
<li>健壮性具体指的是应用在不正常的输入或不正常的外部环境下仍能表现出正常的程度.</li>
<li>不断尝试采取措施来包容错误的输入以此让程序正常运转 (对自己的代码要保守, 对用户的行为要开放:
主动防御处理是有降级/容错处理, 尽量不要走到 <code>Error Boundary</code>.</li>
<li>考虑各种各样的极端情况:<!-- -->
<ul>
<li>考虑到各种可能的输入修士, 兼容全面.</li>
<li>Mock 各种极端数据进行测试.</li>
</ul>
</li>
<li>即使终止执行, 也要准确/无歧义的向用户展示全面的错误信息.</li>
<li>抛出有助于 Debug 的错误信息: 丰富捕获到的错误信息, 包含更多上下文信息.</li>
</ul>
<p>程序的正确性:</p>
<ul>
<li>返回<code>中立值</code>/<code>默认值</code>: 处理错误的最佳做法就是继续执行操作并简单的返回一个没有危害的值.<!-- -->
<ul>
<li>换用下一个正确的数据: 在轮询中, 如返回数据有误就丢掉, 进行下一轮查询.</li>
<li>返回上一次正确的数据: 同上, 不跳过的也可以返回上一次正确的数据.</li>
<li>选择最接近的合法值.</li>
</ul>
</li>
<li>上报错误日志: 上报的错误日志对还原问题和调试友好.</li>
<li>返回一个错误状态码.</li>
<li>启动错误处理子程序或对象.</li>
<li>显示对用户友好的出错消息: 展示给用户的错误信息需要加工, 用户能看明白, 有建设性.</li>
<li>正确性要求高的话, 就直接退出程序.</li>
</ul>
<p>异常处理:</p>
<ul>
<li>用异常通知程序的其他部分, 发生了不可忽略的错误.</li>
<li>只在真正例外的情况下才抛出异常:
当前有错误就直接抛出去, 会导致线上监控的错误信息质量不高.</li>
<li>不能用异常来推卸责任: 能在局部处理掉就在局部解决掉, 不要简单抛出去.</li>
<li>避免在构造函数和析构函数中抛出异常, 除非你在同一个地方把它们捕获.</li>
<li>在恰当的抽象层次抛出异常: 不要把底层的异常抛给高层的调用方, 暴露具体实现的细节.</li>
<li>异常消息中加入关于导致异常发生的全部信息.</li>
<li>避免使用空 <code>catch</code> 语句.</li>
<li>考虑创建一个集中的异常上报机制.</li>
<li>考虑异常的替换机制.</li>
</ul>
<p>代码隔栏:</p>
<ul>
<li>左侧外部接口数据假定是脏数据 (不可信), 通过中间这些类 (子程序) 构成隔栏, 负责清理与验证数据, 并返回可信的数据.</li>
<li>最右侧的类 (子程序) 全部在假定数据干净 (安全) 的基础上工作, 这样可以让大部分的代码无须再担负检查错误数据的职责.</li>
<li>适配器模式和门面模式用来隔离或适配变化, 是对不可控变化的防御.</li>
</ul>
<p>辅助调试代码 (<code>Debugging Aids</code>):</p>
<ul>
<li>在早期的引入辅助调试代码, 发布时移除调试辅助的代码:<!-- -->
<ul>
<li><code>console.log</code> 算是一种辅助调试代码, 发布时清除.</li>
<li>在复杂的调试场景下, 有必要专门写一些辅助调试代码.</li>
<li>利用 Chrome 插件追踪变量和状态变化辅助调试.</li>
</ul>
</li>
<li>采用进攻式编程:<!-- -->
<ul>
<li>尽量让异常的情况在开发期间暴露出来, 而在产品上线时自我恢复.</li>
<li>在开发阶段考虑到最坏的情况.</li>
<li>写单测是一进攻式编程.</li>
</ul>
</li>
</ul>
<p>UI 的防御性:</p>
<ul>
<li>防白屏:<!-- -->
<ul>
<li>白屏监控.</li>
<li>资源加载失败重试.</li>
<li><code>Service Worker</code>: 资源 fallback 机制.</li>
<li>模块都包装了 <code>Error Boundary</code>.</li>
<li>兼容性探测和提示.</li>
<li>白屏提示信息.</li>
</ul>
</li>
<li>防慢 (网络慢/响应慢/渲染慢/执行慢): 前端性能优化.</li>
<li>防卡 (卡顿/假死): 前端性能优化.</li>
<li>防布局错乱: 前端响应式开发.</li>
<li>防极端内容 (缺失/超长/连续字符/未转义): 前端响应式开发.</li>
<li>UI 一致性问题:<!-- -->
<ul>
<li>发布设计规范 (<code>Design System</code>).</li>
<li>UI 走查工具.</li>
<li>视觉回归测试.</li>
</ul>
</li>
<li>防样式污染:<!-- -->
<ul>
<li>代码审核.</li>
<li>样式隔离.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="security-headers">Security Headers<a href="#security-headers" class="hash-link" aria-label="Direct link to Security Headers" title="Direct link to Security Headers">​</a></h3>
<p>Security headers <a href="https://web.dev/security-headers" target="_blank" rel="noopener noreferrer">list</a>:</p>
<ul>
<li><a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Content-Type-Options" target="_blank" rel="noopener noreferrer">X-Content-Type-Options</a>.</li>
<li><a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Frame-Options" target="_blank" rel="noopener noreferrer">X-Frame-Options</a>:<!-- -->
<ul>
<li><code>DENY</code>: 禁止被加载进任何 frame.</li>
<li><code>SAMEORIGIN</code>: 仅允许被加载进同域内的 frame.</li>
</ul>
</li>
<li><a href="https://developer.mozilla.org/docs/Web/HTTP/Headers/X-XSS-Protection" target="_blank" rel="noopener noreferrer">X-XSS-Protection</a>:<!-- -->
<ul>
<li><code>0</code> :表示禁用这个策略.</li>
<li><code>1</code>: 默认, 对危险脚本做一些标志或修改, 以阻止在浏览器上渲染执行.</li>
<li><code>1; mode=block</code>:, 强制不渲染.</li>
</ul>
</li>
<li>Setting <code>Context-Security-Policy</code> header.</li>
<li>Ensure all connections to be HTTPS.</li>
<li>Avoid Clicking-jacking using <code>X-Frame-Options</code>.</li>
<li>Disable <code>X-Powered-By</code> header.</li>
<li>Not put sensitive data in URL query and <code>Referer</code> header.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="same-origin-policy">Same Origin Policy<a href="#same-origin-policy" class="hash-link" aria-label="Direct link to Same Origin Policy" title="Direct link to Same Origin Policy">​</a></h3>
<p><code>origin</code> = <code>protocol</code> + <code>domain</code> + <code>port</code>:</p>
<table><thead><tr><th><code>http://www.foo.com</code></th><th>Same Origin</th><th></th></tr></thead><tbody><tr><td><code>https://www.foo.com</code></td><td>No</td><td><code>protocol</code></td></tr><tr><td><code>http://app.foo.com</code></td><td>No</td><td><code>domain</code></td></tr><tr><td><code>http://foo.com</code></td><td>No</td><td><code>domain</code></td></tr><tr><td><code>http://www.foo.com:8080</code></td><td>No</td><td><code>port</code></td></tr><tr><td><code>http://www.foo.com/a/</code></td><td>Yes</td><td></td></tr></tbody></table>
<div class="language-json codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-json codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;Access-Control-Allow-Origin&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://api.foo.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>由客户端 HTML 标签等发出的跨域 <code>GET</code> 请求默认合法, 构成开放的 Web 世界:
通过 <code>src</code> 属性加载的资源, 浏览器限制了 JavaScript 的权限, 使其不能读写返回的内容.</li>
<li><code>XMLHttpRequest</code> 受同源策略限制: 默认只能访问同源对象的内容.</li>
<li>Cookie 受同源策略限制.</li>
<li>Web storage 受同源策略限制:<!-- -->
<ul>
<li>Local storage.</li>
<li>Session storage.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="content-security-policy">Content Security Policy<a href="#content-security-policy" class="hash-link" aria-label="Direct link to Content Security Policy" title="Direct link to Content Security Policy">​</a></h3>
<p><a href="https://github.com/foundeo/content-security-policy.com" target="_blank" rel="noopener noreferrer"><code>CSP</code></a>
help prevent from <code>XSS</code>:</p>
<div class="language-bash codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-bash codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;header&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Content-Security-Policy&quot;</span><span class="token builtin class-name">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow </span><span class="token string" style="color:#e3116c">&#x27;self&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      script-src </span><span class="token string" style="color:#e3116c">&#x27;nonce-random123&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;strict-dynamic&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;unsafe-eval&#x27;</span><span class="token plain"> script.example.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      media-src media.example.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      img-src img.example.com</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      object-src </span><span class="token string" style="color:#e3116c">&#x27;none&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      base-uri </span><span class="token string" style="color:#e3116c">&#x27;none&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Basic CSP <a href="https://www.writesoftwarewell.com/content-security-policy" target="_blank" rel="noopener noreferrer">usage</a>:</p>
<div class="language-html codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-html codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Content-Security-Policy</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">  </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">script-src &#x27;self&#x27; https://safe-external-site.com; style-src &#x27;self&#x27;</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f"></span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>upgrade-insecure-requests</code>
指示浏览器在发出网络请求之前升级不安全的 <code>URL</code>:</p>
<div class="language-html codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-html codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Content-Security-Policy</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">upgrade-insecure-requests</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>block-all-mixed-content</code>
指示浏览器永不加载混合内容,
所有混合内容资源请求都会被阻止,
包括主动和被动混合内容:</p>
<div class="language-html codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-html codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">http-equiv</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Content-Security-Policy</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">content</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">block-all-mixed-content</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>nonce</code>-only <code>CSP</code> block 3rd scripts and dynamic scripts generate by trusted users:</p>
<div class="language-html codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-html codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">nonce</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">random123</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript function" style="color:#d73a49">alert</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;this is fine!&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">nonce</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">random123</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">https://cdnjs.com/lib.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- XSS injected by attacker - blocked by CSP --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript function" style="color:#d73a49">alert</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;xss&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>strict-dynamic</code> <code>CSP</code> allow dynamic scripts generate by trusted users:</p>
<div class="language-html codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-html codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Content-Security-Policy: script-src &#x27;nonce-random123&#x27; &#x27;strict-dynamic&#x27; --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">nonce</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">random123</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword" style="color:#00009f">const</span><span class="token script language-javascript"> s </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">createElement</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;script&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  s</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">src</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;/path/to/script.js&#x27;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  s</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">async</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">head</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">appendChild</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">s</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// can execute correctly</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>domain</code>-specific <code>CSP</code> block untrusted domain scripts:</p>
<div class="language-html codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-html codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Given this CSP header --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Content-Security-Policy: script-src https://example.com/ --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- The following third-party script will not be loaded or executed --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">https://not-example.com/js/library.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="trusted-types">Trusted Types<a href="#trusted-types" class="hash-link" aria-label="Direct link to Trusted Types" title="Direct link to Trusted Types">​</a></h3>
<ul>
<li>TrustedURL.</li>
<li>TrustedHTML.</li>
<li>TrustedScript.</li>
<li>TrustedScriptURL.</li>
</ul>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// fallback policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TrustedTypes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createPolicy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;default&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">createHTML</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token builtin">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Please fix! Insecure string assignment detected:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Content-Security-Policy-Report-Only: trusted-types myPolicy; report-uri /cspReport</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> SanitizingPolicy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> TrustedTypes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createPolicy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;myPolicy&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">createHTML</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">myCustomSanitizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> trustedHTML </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SanitizingPolicy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createHTML</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">foo</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">element</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">innerHTML </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> trustedHTML</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="sandbox">Sandbox<a href="#sandbox" class="hash-link" aria-label="Direct link to Sandbox" title="Direct link to Sandbox">​</a></h3>
<p><a href="https://developer.51cto.com/article/710911.html" target="_blank" rel="noopener noreferrer"><code>Sandbox</code></a>:</p>
<ul>
<li><code>eval()</code>:
它能访问执行上下文中的局部变量, 也能访问所有全局变量, 是一个非常危险的函数.</li>
<li><code>new Function()</code>:
在全局作用域中被创建, 不会创建闭包.
当运行函数时, 只能访问本地变量和全局变量,
不能访问 Function 构造器被调用生成的上下文的作用域.</li>
<li><code>with () {}</code>:
它首先会在传入的对象中查找对应的变量,
如果找不到就会往更上层的全局作用域去查找,
导致全局环境污染.</li>
<li>快照沙盒: ES5 沙盒, 备份恢复全局上下文.</li>
<li>代理沙盒: ES6 沙盒, 使用 Proxy 代理全局上下文.</li>
<li><code>&lt;iframe&gt;</code> 沙盒: 使用 <code>&lt;iframe&gt;</code> 隔离全局上下文.</li>
<li><a href="https://2ality.com/2022/04/shadow-realms.html" target="_blank" rel="noopener noreferrer"><code>ShadowRealm</code></a> 沙盒.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="snapshot-sandbox">Snapshot Sandbox<a href="#snapshot-sandbox" class="hash-link" aria-label="Direct link to Snapshot Sandbox" title="Direct link to Snapshot Sandbox">​</a></h4>
<p><code>SnapshotSandbox</code>:</p>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SnapshotSandbox</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">proxy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> window </span><span class="token comment" style="color:#999988;font-style:italic">// window 属性.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">windowSnapshot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 快照.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modifyPropsMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 记录在 window 上的修改.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sandboxRunning </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">active</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">windowSnapshot </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 快照.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prop </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasOwn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">windowSnapshot</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">keys</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modifyPropsMap</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modifyPropsMap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sandboxRunning </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">inactive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modifyPropsMap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 记录在 window 上的修改.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prop </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hasOwn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">windowSnapshot</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modifyPropsMap</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          window</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">windowSnapshot</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">prop</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sandboxRunning </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="proxy-sandbox">Proxy Sandbox<a href="#proxy-sandbox" class="hash-link" aria-label="Direct link to Proxy Sandbox" title="Direct link to Proxy Sandbox">​</a></h4>
<p><code>ProxySandbox</code>:</p>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ProxySandbox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">with (sandbox) {</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">code</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string string" style="color:#e3116c">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// eslint-disable-next-line no-new-func</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> fn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name builtin">Function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;sandbox&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sandbox</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sandboxProxy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Proxy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sandbox</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> Symbol</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unscopables</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">undefined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sandboxProxy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="iframe-sandbox">Iframe Sandbox<a href="#iframe-sandbox" class="hash-link" aria-label="Direct link to Iframe Sandbox" title="Direct link to Iframe Sandbox">​</a></h4>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">SandboxWindow</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> frameWindow</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Proxy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frameWindow</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;function&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex anchor function" style="color:#d73a49">^</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">[</span><span class="token regex regex-source language-regex char-class range" style="color:#36acaa">a</span><span class="token regex regex-source language-regex char-class range range-punctuation operator" style="color:#393A34">-</span><span class="token regex regex-source language-regex char-class range" style="color:#36acaa">z</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">]</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bind </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">bind</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 需要全局共享的变量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  document</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Proxy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">document</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Proxy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">location</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  history</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Proxy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">history</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 创建 iframe</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> userInputUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> iframe </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;iframe&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> userInputUrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;about:blank&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sandbox</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;allow-scripts allow-same-origin allow-popups allow-presentation allow-top-navigation&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  style</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;display: none;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">appendChild</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iframe</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> sandboxGlobal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Proxy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iframe</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contentWindow</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 创建沙箱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> newSandboxWindow </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SandboxWindow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sandboxGlobal</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="crypto">Crypto<a href="#crypto" class="hash-link" aria-label="Direct link to Crypto" title="Direct link to Crypto">​</a></h3>
<p>Web crypto <a href="https://developer.mozilla.org/docs/Web/API/SubtleCrypto" target="_blank" rel="noopener noreferrer">API</a>:</p>
<ul>
<li>公钥加密私钥解密: 只有私钥拥有者可以获取信息, e.g HTTPS 会话密钥传输.</li>
<li>公钥解密私钥加密: 只有私钥拥有者可以发布签名, e.g 数字签名.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="user-privacy">User Privacy<a href="#user-privacy" class="hash-link" aria-label="Direct link to User Privacy" title="Direct link to User Privacy">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="browser-privacy-detection">Browser Privacy Detection<a href="#browser-privacy-detection" class="hash-link" aria-label="Direct link to Browser Privacy Detection" title="Direct link to Browser Privacy Detection">​</a></h4>
<ul>
<li>Browser <a href="https://browserleaks.com" target="_blank" rel="noopener noreferrer">leaks</a>.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="user-fingerprint">User Fingerprint<a href="#user-fingerprint" class="hash-link" aria-label="Direct link to User Fingerprint" title="Direct link to User Fingerprint">​</a></h4>
<ul>
<li>Use Canvas or WebGL to generate user
<a href="https://yinzhicao.org/TrackingFree/crossbrowsertracking_NDSS17.pdf" target="_blank" rel="noopener noreferrer">fingerprint</a>.</li>
<li>Location information:<!-- -->
<ul>
<li>Country.</li>
<li>Region.</li>
<li>City.</li>
<li>Zip code.</li>
<li>Latitude.</li>
<li>Longitude.</li>
<li>Timezone.</li>
</ul>
</li>
<li>Connection information:<!-- -->
<ul>
<li>IP address.</li>
<li>Internet service provider.</li>
<li>Organization.</li>
<li>ASN.</li>
<li>Tor browser detection.</li>
</ul>
</li>
<li>Software information:<!-- -->
<ul>
<li>Browser.</li>
<li>Browser plugins detection.</li>
<li>Operation system.</li>
<li>User agent.</li>
<li>Preferred language.</li>
<li>Cookie enabled detection.</li>
<li>Java enabled detection.</li>
<li>DNT header enabled detection.</li>
<li>Automated browser detection.</li>
<li>Content filters detection: Adblock detection.</li>
</ul>
</li>
<li>Hardware information:<!-- -->
<ul>
<li>Screen resolution.</li>
<li>Color resolution.</li>
<li>Device type.</li>
<li>Device memory.</li>
<li>CPU cores.</li>
<li>Max touch points.</li>
<li>WebGL vendor.</li>
<li>WebGL renderer.</li>
<li>Battery level.</li>
<li>Batter status.</li>
</ul>
</li>
</ul>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getCanvasFingerprint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> canvas </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;canvas&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;2d&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">font </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;18pt Arial&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">textBaseline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;top&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fillText</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Hello, user.&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> canvas</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toDataURL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;image/jpeg&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">getCanvasFingerprint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="security-vulnerability">Security Vulnerability<a href="#security-vulnerability" class="hash-link" aria-label="Direct link to Security Vulnerability" title="Direct link to Security Vulnerability">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="xss">XSS<a href="#xss" class="hash-link" aria-label="Direct link to XSS" title="Direct link to XSS">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="xss-attack">XSS Attack<a href="#xss-attack" class="hash-link" aria-label="Direct link to XSS Attack" title="Direct link to XSS Attack">​</a></h4>
<p>Cross-site scripting (跨站脚本):</p>
<ul>
<li>Reflected XSS:
url input (search pages)
<code>http://localhost:8080/test?name=&lt;script&gt;alert(&#x27;attack&#x27;)&lt;/script&gt;</code>.</li>
<li>Stored XSS:
store script into database.</li>
<li>Inject script in HTML/CSS/JavaScript/JSON/HTTP:<!-- -->
<ul>
<li><code>&lt;a href=javascript:...&gt;</code>.</li>
<li><code>&lt;base href=javascript:...&gt;</code>.</li>
<li><code>&lt;bgsound src=javascript:...&gt;</code>.</li>
<li><code>&lt;body background=javascript:...&gt;</code>.</li>
<li><code>&lt;frameset&gt;&lt;frame src=&quot;javascript:...&quot;&gt;&lt;/frameset&gt;</code>.</li>
<li><code>&lt;iframe src=javascript:...&gt;</code>.</li>
<li><code>&lt;img src=x onerror=...&gt;</code>.</li>
<li><code>&lt;input type=image src=javascript:...&gt;</code>.</li>
<li><code>&lt;layer src=...&gt;</code>.</li>
<li><code>&lt;link href=&quot;javascript:...&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;</code>.</li>
<li><code>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=javascript:...&quot;&gt;</code>.</li>
<li><code>&lt;object type=text/x-scriptlet data=...&gt;</code>.</li>
<li><code>&lt;script&gt;...&lt;/script&gt;</code>.</li>
<li><code>&lt;style type=text/javascript&gt;alert(&#x27;xss&#x27;)&lt;/style&gt;</code>.</li>
<li><code>&lt;table background=javascript:...&gt;</code>.</li>
<li><code>&lt;td background=javascript:...&gt;</code>.</li>
<li><code>&lt;button onmouseover=&quot;alert(/1/)&quot; onclick=&quot;alert(/2/)&quot;&gt;&lt;/button&gt;</code>.</li>
<li><code>&lt;button form=&quot;test&quot; formaction=&quot;javascript:alert(1)&quot;&gt;</code>.</li>
<li><code>&lt;button form=test onformchange=alert(2)&gt;</code>.</li>
<li><code>&lt;input onfocus=write(1) autofocus&gt;</code>.</li>
<li><code>&lt;form id=test onforminput=alert(1)&gt;&lt;input&gt;&lt;/form&gt;</code>.</li>
<li><code>&lt;audio onerror=javascript:alert(1)&gt;</code>.</li>
<li><code>&lt;audio&gt;&lt;source onerror=&quot;javascript:alert(1)&quot;&gt;&lt;/audio&gt;</code>.</li>
<li><code>&lt;video onerror=javascript:alert(1)&gt;</code>.</li>
<li><code>&lt;video&gt;&lt;source onerror=&quot;javascript:alert(1)&quot;&gt;&lt;/video&gt;</code>.</li>
<li><code>@import &quot;&quot;</code>.</li>
<li><code>background: url(&quot;&quot;)</code>.</li>
<li><code>window.name</code>.</li>
<li><code>window.location</code>.</li>
<li><code>document.domain</code>.</li>
<li><code>document.referrer</code>.</li>
<li><code>document.location.assign()</code>.</li>
<li><code>document.location.replace()</code>.</li>
<li><code>document.write()</code>.</li>
<li><code>element.innerHTML</code>.</li>
<li><code>element.outerHTML</code>.</li>
<li><code>cookie</code>.</li>
<li><code>localStorage</code>.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="xss-protection">XSS Protection<a href="#xss-protection" class="hash-link" aria-label="Direct link to XSS Protection" title="Direct link to XSS Protection">​</a></h4>
<p>Don&#x27;t trust user:</p>
<ul>
<li>Escape control characters (输入校验):<!-- -->
<ul>
<li><code>&quot;</code> -&gt; <code>&amp;quot;</code>, <code>&amp;</code> -&gt; <code>&amp;amp;</code>, <code>&#x27;</code> -&gt; <code>&amp;apos;</code>, <code>&lt;</code> -&gt; <code>&amp;lt;</code>, <code>&gt;</code> -&gt; <code>&amp;gt;</code>.</li>
<li><code>input.replace(/&lt;script&gt;|&lt;script/&gt;/g, &#x27;&#x27;)</code>.</li>
<li><code>input.trim()</code>.</li>
<li>React DOM escapes any values embedded in JSX before rendering them.</li>
</ul>
</li>
<li>Secure encode output result (输出编码):
保证<strong>编码方式一致</strong>, e.g 混用单字节编码与多字节编码, 导致攻击者绕过 <code>\</code> 系统转义符.</li>
<li>任何用户提供的 URL 在进一步处理前 (e.g 保存到数据库),
应先做无害化处理 (<code>SanitizeUrl</code>).</li>
<li>Check HTTP <code>Content-Type</code> header.</li>
<li>Content security policy: <code>script-src &#x27;self&#x27; https://apis.google.com</code>.</li>
<li>Use mature template engine: built-in XSS protection feature.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="csrf">CSRF<a href="#csrf" class="hash-link" aria-label="Direct link to CSRF" title="Direct link to CSRF">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="csrf-attack">CSRF Attack<a href="#csrf-attack" class="hash-link" aria-label="Direct link to CSRF Attack" title="Direct link to CSRF Attack">​</a></h4>
<p>Cross-site request forgery (跨站请求伪造)
挟制用户在当前已登录的 Web 应用程序上执行<strong>非本意</strong>的操作,
利用已认证用户 (长期本地 <code>Cookie</code>), 访问攻击者网站, 并被强制执行脚本,
在用户不知情的情况下提交 <code>GET</code>/<code>POST</code> request (长期本地 <code>Cookie</code>):</p>
<ul>
<li><code>&lt;link href=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;a href=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;img src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;img lowsrc=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;img dynsrc=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;iframe src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;frame src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0; url=&quot;&gt;</code>.</li>
<li><code>&lt;script src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;bgsound src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;embed src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;video src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;audio src=&quot;&quot;&gt;</code>.</li>
<li><code>&lt;table background=&quot;&quot;&gt;</code>.</li>
<li><code>@import &quot;&quot;</code>.</li>
<li><code>background: url(&quot;&quot;)</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_fLid alert alert--success"><div class="admonitionHeading_yHXa"><span class="admonitionIcon_qYLe"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>XSS vs CSRF</div><div class="admonitionContent_iXM1"><ul>
<li>XSS 利用的是网站对用户 (输入) 的信任.</li>
<li>CSRF 利用的是网站对用户网页浏览器的信任.</li>
</ul></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="csrf-protection">CSRF Protection<a href="#csrf-protection" class="hash-link" aria-label="Direct link to CSRF Protection" title="Direct link to CSRF Protection">​</a></h4>
<ul>
<li><code>REST</code> (representational state transfer) 原则:<!-- -->
<ul>
<li><code>GET</code> request: only read objects, 确保无副作用.</li>
<li><code>PUT</code> request: only create new objects.</li>
<li><code>POST</code> request: only modify objects.</li>
<li><code>DELETE</code> request: only delete objects.</li>
</ul>
</li>
<li>确保 <code>request</code> 正常发起渠道:<!-- -->
<ul>
<li>Anti-CSRF cookie:<!-- -->
<ul>
<li>不可预测 salt token: <code>Set-Cookie: _xsrf=5978e29d4ef434a1</code>.</li>
<li>Hidden token check in <code>&lt;form&gt;</code>.</li>
</ul>
</li>
<li>开启同源策略: <code>Set-Cookie: _xsrf=5978e29d4ef434a1; SameSite=Strict;</code>.</li>
<li>检查 HTTP <code>Referer</code> 请求头.</li>
<li>检查第三方网站 <code>URL</code>, 显示第三方地址跳转警告页面:<!-- -->
<ul>
<li>Remove sensitive data in URL query and <code>Referer</code> header.</li>
<li><code>&lt;a href=&quot;https://3rd.com&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer nofollow&quot;&gt;</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Require re-authentication for sensitive action:
支付账单, 修改邮箱, 删除账号.</li>
<li>Use mature <code>CSRF</code> protection library:
express.js <code>csurf</code> library.</li>
</ul>
<div class="language-python codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-python codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Reject cross-origin requests to protect from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># CSRF, XSSI &amp; other bugs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">allow_request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Allow requests from browsers which don&#x27;t send Fetch Metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;sec-fetch-site&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Allow same-site and browser-initiated requests</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;sec-fetch-site&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;same-origin&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;same-site&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;none&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Allow simple top-level navigation from anywhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;sec-fetch-mode&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;navigate&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">method </span><span class="token operator" style="color:#393A34">==</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GET&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="click-jacking">Click Jacking<a href="#click-jacking" class="hash-link" aria-label="Direct link to Click Jacking" title="Direct link to Click Jacking">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="click-jacking-attack">Click Jacking Attack<a href="#click-jacking-attack" class="hash-link" aria-label="Direct link to Click Jacking Attack" title="Direct link to Click Jacking Attack">​</a></h4>
<p>Hover transparent malicious link upon trusted true button:</p>
<ul>
<li><code>click</code>.</li>
<li><code>drag</code> and <code>drop</code>.</li>
<li><code>touch</code>.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="click-jacking-protection">Click Jacking Protection<a href="#click-jacking-protection" class="hash-link" aria-label="Direct link to Click Jacking Protection" title="Direct link to Click Jacking Protection">​</a></h4>
<p><code>X-Frame-Options</code>:</p>
<ul>
<li><code>DENY</code>.</li>
<li><code>SAMEORIGIN</code>.</li>
<li><code>ALLOW-FROM origin</code>.</li>
</ul>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// nodejs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;X-Frame-Options&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;DENY&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Content security policy:</p>
<div class="language-bash codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-bash codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token plain">Content-Security-Policy: frame-ancestors </span><span class="token string" style="color:#e3116c">&#x27;none&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Security-Policy: frame-ancestors </span><span class="token string" style="color:#e3116c">&#x27;self&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Security-Policy: frame-ancestors example.com google.com</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Prevent load self in frame (<code>Frame Busting</code>):</p>
<div class="language-html codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-html codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">style</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#393A34"><span class="token style language-css">  </span><span class="token style language-css comment" style="color:#999988;font-style:italic">/* Hide page by default */</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#393A34"><span class="token style language-css">  </span><span class="token style language-css selector" style="color:#00009f">html</span><span class="token style language-css"> </span><span class="token style language-css punctuation" style="color:#393A34">{</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#393A34"><span class="token style language-css">    </span><span class="token style language-css property" style="color:#36acaa">display</span><span class="token style language-css punctuation" style="color:#393A34">:</span><span class="token style language-css"> none</span><span class="token style language-css punctuation" style="color:#393A34">;</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#393A34"><span class="token style language-css">  </span><span class="token style language-css punctuation" style="color:#393A34">}</span><span class="token style language-css"></span><br></span><span class="token-line" style="color:#393A34"><span class="token style language-css"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">style</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top </span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript"> self </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript"> self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    parent</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">frames</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">length</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript number" style="color:#36acaa">0</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript"> top </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">self</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">top</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">top</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">!==</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">self</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">parent </span><span class="token script language-javascript operator" style="color:#393A34">&amp;&amp;</span><span class="token script language-javascript"> parent </span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">parent </span><span class="token script language-javascript operator" style="color:#393A34">&amp;&amp;</span><span class="token script language-javascript"> parent</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">frames</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">&amp;&amp;</span><span class="token script language-javascript"> parent</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">frames</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">length</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript number" style="color:#36acaa">0</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">parent</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">&amp;&amp;</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">!</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">parent</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">===</span><span class="token script language-javascript"> self</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">&amp;&amp;</span><span class="token script language-javascript"> self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">parent</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">frames</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">length</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">!=</span><span class="token script language-javascript"> </span><span class="token script language-javascript number" style="color:#36acaa">0</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// Break out of the frame.</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">replace</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">replace</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;URL&#x27;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">write</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">location</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">replace</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">replace</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;URL&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">replace</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">window</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    top</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">parent</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    parent</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">href</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    parent</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> self</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">location</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">else</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// Everything checks out, show the page.</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">documentElement</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">style</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">display</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&#x27;block&#x27;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_fLid alert alert--warning"><div class="admonitionHeading_yHXa"><span class="admonitionIcon_qYLe"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Frame Busting Attack</div><div class="admonitionContent_iXM1"><p><code>&lt;iframe&gt;</code> <code>sandbox</code> 属性与 <code>security</code>,
可以限制 <code>&lt;iframe&gt;</code> 页面中的 JavaScript 脚本执行,
从而使得 <a href="https://seclab.stanford.edu/websec/framebusting/framebust.pdf" target="_blank" rel="noopener noreferrer"><code>Frame Busting</code> 失效</a>.</p></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="sql-injection">SQL Injection<a href="#sql-injection" class="hash-link" aria-label="Direct link to SQL Injection" title="Direct link to SQL Injection">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="sql-injection-attack">SQL Injection Attack<a href="#sql-injection-attack" class="hash-link" aria-label="Direct link to SQL Injection Attack" title="Direct link to SQL Injection Attack">​</a></h4>
<p>User input <code>&#x27; OR 1=1--</code>:</p>
<div class="language-sql codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-sql codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;user@email.com&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> pass  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">OR</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token comment" style="color:#999988;font-style:italic">--&#x27; LIMIT 1</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="sql-injection-protection">SQL Injection Protection<a href="#sql-injection-protection" class="hash-link" aria-label="Direct link to SQL Injection Protection" title="Direct link to SQL Injection Protection">​</a></h4>
<ul>
<li>Don&#x27;t allow multiple statements.</li>
<li>Validate user input: <strong>是否存在/数据类型/取值范围/缺省值/正则表达式/特殊字符</strong>.</li>
<li>Allowlist user input.</li>
<li>Least privilege principle:
allow <code>SELECT</code>/<code>INSERT</code>/<code>UPDATE</code>/<code>DELETE</code> on certain data,
forbidden <code>CREATE</code>/<code>DROP</code>/<code>MODIFY</code>.</li>
<li>Use mature object-relational mapping (ORM) library:
built-in SQL injection protection feature,
<code>users.findBy({ email: &quot;billy@gmail.com&quot; })</code>.</li>
<li>Parameterized statements: use placeholders instead of variable interpolation.</li>
</ul>
<div class="language-sql codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-sql codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- Construct the SQL statement we want to run, specifying the parameter.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection connection </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DriverManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">getConnection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DB_URL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DB_USER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> DB_PASSWORD</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Statement statement </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> connection</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">createStatement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">String </span><span class="token keyword" style="color:#00009f">sql</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SELECT * FROM users WHERE email = ? and encrypted_password = ?&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statement</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">executeQuery</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">sql</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="command-injection">Command Injection<a href="#command-injection" class="hash-link" aria-label="Direct link to Command Injection" title="Direct link to Command Injection">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="command-injection-attack">Command Injection Attack<a href="#command-injection-attack" class="hash-link" aria-label="Direct link to Command Injection Attack" title="Direct link to Command Injection Attack">​</a></h4>
<div class="language-json codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-json codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;query&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;?domain=google.com%3BEcho%20%22Hacked%22&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="command-injection-protection">Command Injection Protection<a href="#command-injection-protection" class="hash-link" aria-label="Direct link to Command Injection Protection" title="Direct link to Command Injection Protection">​</a></h4>
<ul>
<li>Escape control characters: <code>&lt;</code>/<code>&gt;</code>/<code>?</code>/<code>=</code>/<code>&amp;&amp;</code>.</li>
<li>Disable code execution during deserialization.</li>
<li>尽量不使用系统执行命令.</li>
<li>保证动态函数为受信任函数, 防止被攻击者替换.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="http-injection">HTTP Injection<a href="#http-injection" class="hash-link" aria-label="Direct link to HTTP Injection" title="Direct link to HTTP Injection">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="malicious-redirect-attack">Malicious Redirect Attack<a href="#malicious-redirect-attack" class="hash-link" aria-label="Direct link to Malicious Redirect Attack" title="Direct link to Malicious Redirect Attack">​</a></h4>
<div class="language-json codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-json codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;query&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;?redirect=google.com%3BEcho%20%22Hacked%22&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="malicious-redirect-protection">Malicious Redirect Protection<a href="#malicious-redirect-protection" class="hash-link" aria-label="Direct link to Malicious Redirect Protection" title="Direct link to Malicious Redirect Protection">​</a></h4>
<ul>
<li>检查第三方网站 <code>URL</code>, 显示第三方地址跳转警告页面:<!-- -->
<ul>
<li>Remove sensitive data in URL query and <code>Referer</code> header.</li>
<li><code>&lt;a href=&quot;https://3rd.com&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer nofollow&quot;&gt;</code>.</li>
</ul>
</li>
<li>Check <code>?url=</code>/<code>?redirect</code> data:<!-- -->
<ul>
<li>Escape control character.</li>
<li>Limit redirect range.</li>
</ul>
</li>
<li>Check <code>Referrer</code> header when doing redirect.</li>
</ul>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">isRelative</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">match</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex anchor function" style="color:#d73a49">^</span><span class="token regex regex-source language-regex escape" style="color:#36acaa">\/</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">[</span><span class="token regex regex-source language-regex char-class char-class-negation operator" style="color:#393A34">^</span><span class="token regex regex-source language-regex char-class" style="color:#36acaa">/</span><span class="token regex regex-source language-regex char-class special-escape escape" style="color:#36acaa">\\</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">]</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="http-header-injection-attack">HTTP Header Injection Attack<a href="#http-header-injection-attack" class="hash-link" aria-label="Direct link to HTTP Header Injection Attack" title="Direct link to HTTP Header Injection Attack">​</a></h4>
<p>通过截断 HTTP 响应头 (换行符/空字符),
覆盖 <code>Location</code>/<code>Referer</code> 响应头,
注入攻击者设置的 HTTP 响应头.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="http-header-injection-protection">HTTP Header Injection Protection<a href="#http-header-injection-protection" class="hash-link" aria-label="Direct link to HTTP Header Injection Protection" title="Direct link to HTTP Header Injection Protection">​</a></h4>
<ul>
<li>不将外部输入作为 HTTP 响应头.</li>
<li>检验 HTTP 响应头特殊字符: e.g 换行符.</li>
<li>使用成熟的库生成 HTTP 响应头, 禁止简单字符拼接.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="object-injection">Object Injection<a href="#object-injection" class="hash-link" aria-label="Direct link to Object Injection" title="Direct link to Object Injection">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="object-injection-attack">Object Injection Attack<a href="#object-injection-attack" class="hash-link" aria-label="Direct link to Object Injection Attack" title="Direct link to Object Injection Attack">​</a></h4>
<ul>
<li><code>__proto__.XX</code>.</li>
<li><code>constructor</code>.</li>
<li><code>hasOwnProperty</code>.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="insecure-object-comparison">Insecure Object Comparison<a href="#insecure-object-comparison" class="hash-link" aria-label="Direct link to Insecure Object Comparison" title="Direct link to Insecure Object Comparison">​</a></h4>
<p>Injection:</p>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> token </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cookie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Vulnerability:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// SESSIONS[constructor] =&gt; `true`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SESSIONS</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Solutions:</p>
<ul>
<li><code>crypto.timingSafeEqual</code>.</li>
<li><code>object.hasOwnProperty(token)</code>.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="file-upload-injection">File Upload Injection<a href="#file-upload-injection" class="hash-link" aria-label="Direct link to File Upload Injection" title="Direct link to File Upload Injection">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="file-upload-attack">File Upload Attack<a href="#file-upload-attack" class="hash-link" aria-label="Direct link to File Upload Attack" title="Direct link to File Upload Attack">​</a></h4>
<p>当使用 JS 代码限制上传文件类型时,
攻击者 disable JS in browser,
并上传 malicious code file:</p>
<div class="language-php codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-php codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Malicious `web shell` code file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">?</span><span class="token plain">php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">isset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_REQUEST</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;cmd&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token variable" style="color:#36acaa">$cmd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$_REQUEST</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;cmd&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">system</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">$cmd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">echo</span><span class="token plain"> </span><span class="token string single-quoted-string" style="color:#e3116c">&#x27;What is your bidding?&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token delimiter important">?&gt;</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>一旦攻击者成功将 <code>webShell.php</code> 当成头像上传成功,
便可以在头像处执行 <code>web shell</code> 远程攻击.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="file-upload-protection">File Upload Protection<a href="#file-upload-protection" class="hash-link" aria-label="Direct link to File Upload Protection" title="Direct link to File Upload Protection">​</a></h4>
<p>对于用户上传文件:</p>
<ul>
<li>隔离文件: host files on secure system.</li>
<li>禁止文件执行: <code>-x</code>.</li>
<li>重命名/哈希化文件: 防止攻击者找到此文件.</li>
<li>检查文件格式 (extension/<code>MIME</code> type/<code>Content-Type</code>).</li>
<li>检查文件内容.</li>
<li>检查 <code>Content-Type</code> header.</li>
<li>扫描文件: virus scanner.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="authentication-vulnerability">Authentication Vulnerability<a href="#authentication-vulnerability" class="hash-link" aria-label="Direct link to Authentication Vulnerability" title="Direct link to Authentication Vulnerability">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="password-attack">Password Attack<a href="#password-attack" class="hash-link" aria-label="Direct link to Password Attack" title="Direct link to Password Attack">​</a></h4>
<p>Password <a href="https://www.hacksplaining.com/prevention/password-mismanagement" target="_blank" rel="noopener noreferrer">mis-management</a>:</p>
<ul>
<li>Reused key attack: 使用同一个密钥进行多次加/解密, 将使得破解流密码变得非常简单.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="password-protection">Password Protection<a href="#password-protection" class="hash-link" aria-label="Direct link to Password Protection" title="Direct link to Password Protection">​</a></h4>
<ul>
<li>Require complex password.</li>
<li>Require multi-factor authentication.</li>
<li>Secure and robust password hashing: <code>bcrypt</code>.</li>
<li>Secure and robust password salting.</li>
<li>Secure password resets.</li>
<li>Validate email address.</li>
<li>Ban disposable email account.</li>
<li>密钥管理:<!-- -->
<ul>
<li>防止密钥从非正常的渠道泄露.</li>
<li>定期更换密钥.</li>
<li>采用安全的密钥管理系统: Web 应用通过 service API 动态获取密钥, 只加载到内存中, 不写入本地文件.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="user-enumeration-attack">User Enumeration Attack<a href="#user-enumeration-attack" class="hash-link" aria-label="Direct link to User Enumeration Attack" title="Direct link to User Enumeration Attack">​</a></h4>
<p>通过暴力工具得到被攻击网站的用户名单, 并利用社工得到密码:</p>
<p>REST API 无法抵抗此种攻击,
e.g GitHub <a href="https://github.com" target="_blank" rel="noopener noreferrer">user profile</a>.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="user-enumeration-protection">User Enumeration Protection<a href="#user-enumeration-protection" class="hash-link" aria-label="Direct link to User Enumeration Protection" title="Direct link to User Enumeration Protection">​</a></h4>
<h5 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="user-api-protection">User API Protection<a href="#user-api-protection" class="hash-link" aria-label="Direct link to User API Protection" title="Direct link to User API Protection">​</a></h5>
<ul>
<li>限制 API 访问频率与次数.</li>
<li>设置 IP 黑名单.</li>
<li>记录登陆日志.</li>
<li><a href="https://www.google.com/recaptcha/about" target="_blank" rel="noopener noreferrer">CAPTCHA</a>:
completely automated public turing test to tell computers and humans apart.</li>
<li>隐藏用户 ID, 只显示昵称.</li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="login-protection">Login Protection<a href="#login-protection" class="hash-link" aria-label="Direct link to Login Protection" title="Direct link to Login Protection">​</a></h5>
<p>使攻击者无法枚举用户名, 他无法确定是用户不存在还是密码错误:</p>
<ul>
<li>Login error message: Unknown User <strong>or</strong> Password.</li>
<li>All login code-paths take <strong>same time</strong> on average: time consuming operations.</li>
<li>All login code-paths take <strong>same context</strong>: session ID, cookie.</li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="sign-up-and-reset-protection">Sign Up and Reset Protection<a href="#sign-up-and-reset-protection" class="hash-link" aria-label="Direct link to Sign Up and Reset Protection" title="Direct link to Sign Up and Reset Protection">​</a></h5>
<p>Not with name, should with email:</p>
<ul>
<li>使攻击者无法枚举用户名, 他无法确定是用户不存在还是用户已存在.</li>
<li>Not Exist: Sending sign-up email.</li>
<li>Exist: Sending pwd-reset email.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="session-vulnerability">Session Vulnerability<a href="#session-vulnerability" class="hash-link" aria-label="Direct link to Session Vulnerability" title="Direct link to Session Vulnerability">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="session-hijacking-protection">Session Hijacking Protection<a href="#session-hijacking-protection" class="hash-link" aria-label="Direct link to Session Hijacking Protection" title="Direct link to Session Hijacking Protection">​</a></h4>
<p>Same site cookie <a href="https://web.dev/first-party-cookie-recipes" target="_blank" rel="noopener noreferrer">recipe</a>,
<code>Set-Cookie: session_id=278283910977381992837; HttpOnly; Secure; SameSite=Lax</code>:</p>
<ul>
<li>Prevent XSS cookie theft,
disable JavaScript access to cookie:
<code>Set-Cookie: session_id=278283910977381992837; HttpOnly</code>.</li>
<li>Prevent CSRF cookie theft,
enable same-origin policy, only allow cookie on <code>GET</code> request (social media sharing):
<code>Set-Cookie: session_id=278283910977381992837; SameSite=Lax</code>.</li>
<li>Prevent man-in-the-middle attack,
use HTTPS connection:
<code>Set-Cookie: session_id=278283910977381992837; Secure</code>.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="session-fixation-protection">Session Fixation Protection<a href="#session-fixation-protection" class="hash-link" aria-label="Direct link to Session Fixation Protection" title="Direct link to Session Fixation Protection">​</a></h4>
<p>在 <strong>HTTP Cookie</strong> 中传输<strong>复杂</strong>的 session ID, 并在<strong>成功连接</strong>/<strong>恶意篡改</strong>后重置 session ID:</p>
<ul>
<li>Not passing session ID in <code>queryString</code>/<code>requestBody</code>:
跳转至第三方链接时, 会在 <code>Referer</code> header 处泄露 session ID,
passing them in <strong>HTTP Cookie</strong>.
同样地, 不允许在 URL query 处放置任何其他敏感数据 (如 token).</li>
<li>Generate complex session ID.</li>
<li>认证成功前不在会话变量中存储敏感信息.</li>
<li>Reset session ID after set up session successfully.</li>
<li>Reset session ID after it&#x27;s been changed manually on client (<code>Set-Cookie</code>):<!-- -->
<ul>
<li>IP.</li>
<li>Device.</li>
<li>User agent.</li>
</ul>
</li>
</ul>
<div class="language-ts codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-ts codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token plain">req</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">regenerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">generateSessionId</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> session </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">uid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="directory-traversal">Directory Traversal<a href="#directory-traversal" class="hash-link" aria-label="Direct link to Directory Traversal" title="Direct link to Directory Traversal">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="directory-traversal-attack">Directory Traversal Attack<a href="#directory-traversal-attack" class="hash-link" aria-label="Direct link to Directory Traversal Attack" title="Direct link to Directory Traversal Attack">​</a></h4>
<div class="language-bash codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-bash codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token plain">GET /</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/passwd.key HTTP/1.1</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="directory-traversal-protection">Directory Traversal Protection<a href="#directory-traversal-protection" class="hash-link" aria-label="Direct link to Directory Traversal Protection" title="Direct link to Directory Traversal Protection">​</a></h4>
<ul>
<li>检查请求路径是否安全, 否则不返回响应.</li>
<li>Use mature hosting service.</li>
<li>Use indirect file reference.</li>
<li>Sanitize file reference.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="information-leakage">Information Leakage<a href="#information-leakage" class="hash-link" aria-label="Direct link to Information Leakage" title="Direct link to Information Leakage">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="information-leakage-attack">Information Leakage Attack<a href="#information-leakage-attack" class="hash-link" aria-label="Direct link to Information Leakage Attack" title="Direct link to Information Leakage Attack">​</a></h4>
<ul>
<li>Server in response headers.</li>
<li>Cookie: J_SESSION_ID -&gt; Java.</li>
<li>URL: <code>.jsp</code>, <code>.php</code>, <code>.asp</code>.</li>
<li>Error message.</li>
<li>AJAX responses.</li>
<li>JSON/XML responses.</li>
<li>Code information.</li>
</ul>
<div class="language-json codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-json codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Server&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Apache/1.3.23&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Accept-Ranges&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bytes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Content-length&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">196</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Connection&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;close&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Content-Type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text/html&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Cookie&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SESSION_ID=XXXXX&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Server&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Microsoft-IIS/5.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Content-Type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text/html&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Accept-Ranges&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bytes&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ETag&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;b0aac0542e25c31&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Content-Length&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7369</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="information-leakage-protection">Information Leakage Protection<a href="#information-leakage-protection" class="hash-link" aria-label="Direct link to Information Leakage Protection" title="Direct link to Information Leakage Protection">​</a></h4>
<ul>
<li><code>NODE_ENV=production</code>.</li>
<li>处理/混淆/加密原始数据 (raw data).</li>
<li>处理/混淆客户端代码.</li>
<li>去除工具库的版本信息.</li>
<li>Disable <code>Server</code> HTTP header and similar headers.</li>
<li>Use clean URLs without extensions.</li>
<li>Use generic cookie parameters.</li>
<li>Disable client-side error reporting.</li>
<li>Sanitize data passed to client.</li>
<li>Obfuscate JavaScript.</li>
<li>Sanitize template files.</li>
<li>Ensure correct configuration of Web root directory.</li>
<li>配置边界路由器和防火墙: 阻止从敏感来源发起的信息请求.</li>
<li>限制对所有敏感信息源的访问.</li>
<li>永远不要硬编码密码, 且不放在易暴露位置.</li>
<li>对任何敏感信息源使用双因素认证.</li>
<li>执行审核来查找潜在的漏洞.</li>
<li>使用评估工具来确定是否存在从指定位置外的任何位置访问敏感信息源的可能.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="supply-chain-vulnerability">Supply Chain Vulnerability<a href="#supply-chain-vulnerability" class="hash-link" aria-label="Direct link to Supply Chain Vulnerability" title="Direct link to Supply Chain Vulnerability">​</a></h3>
<p><a href="https://slsa.dev/spec" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" alt="Supply Chain Threats" src="/awesome-notes/assets/images/supply-chain-threats-6e982c331773a09b6d8ea764c145d176.svg" width="784" height="441" class="img_uuUz"></a></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="supply-chain-attack">Supply Chain Attack<a href="#supply-chain-attack" class="hash-link" aria-label="Direct link to Supply Chain Attack" title="Direct link to Supply Chain Attack">​</a></h4>
<ul>
<li><a href="https://dev.to/devdevcharlie/running-a-ransomware-attack-in-a-nodejs-module-4hgb" target="_blank" rel="noopener noreferrer">Running file encryption attack in Node.js module</a>.</li>
<li><a href="https://blog.npmjs.org/post/141577284765/kik-left-pad-and-npm" target="_blank" rel="noopener noreferrer">left-pad</a>.</li>
<li><a href="https://eslint.org/blog/2018/07/postmortem-for-malicious-package-publishes" target="_blank" rel="noopener noreferrer">eslint</a>.</li>
<li><a href="https://github.com/ant-design/ant-design/issues/13098" target="_blank" rel="noopener noreferrer">antd</a>.</li>
<li><a href="https://github.com/marak/Faker.js" target="_blank" rel="noopener noreferrer">faker.js</a>.</li>
<li><a href="https://github.com/Marak/colors.js/issues/285" target="_blank" rel="noopener noreferrer">colors.js</a>.</li>
<li><a href="https://github.com/RIAEvangelist/node-ipc" target="_blank" rel="noopener noreferrer">node-ipc</a>.</li>
<li><a href="https://github.com/medikoo/es5-ext/commit/28de285ed433b45113f01e4ce7c74e9a356b2af2" target="_blank" rel="noopener noreferrer">es5-ext</a>.</li>
<li><a href="https://github.com/Yaffle/EventSource/commit/de137927e13d8afac153d2485152ccec48948a7a" target="_blank" rel="noopener noreferrer">event-source-polyfill</a>.</li>
<li><a href="https://github.com/styled-components/styled-components/commit/ba9d732ca7da53f2a095e35450ecffd592c6f5ba" target="_blank" rel="noopener noreferrer">styled-components</a>.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="supply-chain-protection">Supply Chain Protection<a href="#supply-chain-protection" class="hash-link" aria-label="Direct link to Supply Chain Protection" title="Direct link to Supply Chain Protection">​</a></h4>
<p>评估 NPM package 质量:</p>
<ul>
<li>代码质量.</li>
<li>测试完备性.</li>
<li>文档完备性.</li>
<li>工程完备性 (DevOps).</li>
<li>开发人员构成.</li>
<li>兼容性:</li>
<li>流行度.</li>
<li>历史遗留 Bug.</li>
<li>重复实现复杂度.</li>
<li>使用时长.</li>
<li>后续依赖版本更新策略.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="malicious-package-attack">Malicious Package Attack<a href="#malicious-package-attack" class="hash-link" aria-label="Direct link to Malicious Package Attack" title="Direct link to Malicious Package Attack">​</a></h4>
<p>名字与流行包相近, 通过 <code>postinstall</code> 脚本执行病毒脚本, 获取系统环境变量信息 e.g <code>crossenv</code>.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="malicious-package-protection">Malicious Package Protection<a href="#malicious-package-protection" class="hash-link" aria-label="Direct link to Malicious Package Protection" title="Direct link to Malicious Package Protection">​</a></h4>
<ul>
<li>No typo in <code>package.json</code>:<!-- -->
<ul>
<li>NPM package <a href="https://openbase.com" target="_blank" rel="noopener noreferrer">database</a>.</li>
<li>NPM package <a href="https://snyk.io/advisor" target="_blank" rel="noopener noreferrer">advisor</a>.</li>
</ul>
</li>
<li>禁止执行 <code>postinstall</code> 脚本.</li>
<li>Use mature dependency management tools: <code>renovate</code>.</li>
<li>Stay alert to security issues:<!-- -->
<ul>
<li>Apply operating system patches.</li>
<li>Security tools: <code>npm audit</code>, <code>socket.security</code>.</li>
<li>Official advisories.</li>
<li>Mailing lists and blogs.</li>
<li>Social media.</li>
</ul>
</li>
<li>Package integrity check.</li>
</ul>
<div class="language-bash codeBlockContainer_E0Jp theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_nWqd"><pre tabindex="0" class="prism-code language-bash codeBlock_MSAy thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_djir"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> FILENAME.js </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> openssl dgst </span><span class="token parameter variable" style="color:#36acaa">-sha384</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-binary</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> openssl base64 </span><span class="token parameter variable" style="color:#36acaa">-A</span><br></span></code></pre><div class="buttonGroup_Ij1p"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_npNj" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_YSoL"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_mE3M"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="xml-vulnerability">XML Vulnerability<a href="#xml-vulnerability" class="hash-link" aria-label="Direct link to XML Vulnerability" title="Direct link to XML Vulnerability">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="xml-attack">XML Attack<a href="#xml-attack" class="hash-link" aria-label="Direct link to XML Attack" title="Direct link to XML Attack">​</a></h4>
<p>Inline document type definition in XML
led to dangerous macros:</p>
<ul>
<li>XML bombs.</li>
<li>XML external entities.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="xml-protection">XML Protection<a href="#xml-protection" class="hash-link" aria-label="Direct link to XML Protection" title="Direct link to XML Protection">​</a></h4>
<ul>
<li>Disable DTD (Document Type Definitions) parse in XML parser:
<code>xml2js</code>, <code>parse-xml</code>, <code>node-xml</code>.</li>
<li>Least privilege principle.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="denial-of-service">Denial of Service<a href="#denial-of-service" class="hash-link" aria-label="Direct link to Denial of Service" title="Direct link to Denial of Service">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="dos-attack">DoS Attack<a href="#dos-attack" class="hash-link" aria-label="Direct link to DoS Attack" title="Direct link to DoS Attack">​</a></h4>
<p>DoS 攻击, 攻击者不断地提出服务请求, 让合法用户的请求无法及时处理:</p>
<ul>
<li>DNS 服务.</li>
<li>Email 服务.</li>
<li>FTP 服务.</li>
<li>ICMP 服务.</li>
<li>TCP 服务.</li>
<li>Telnet 服务.</li>
<li>Web 服务.</li>
<li>即时通讯服务.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="dos-protection">DoS Protection<a href="#dos-protection" class="hash-link" aria-label="Direct link to DoS Protection" title="Direct link to DoS Protection">​</a></h4>
<ul>
<li>Application firewall.</li>
<li>Intrusion prevention system.</li>
<li>购买专门设计用来对抗 DoS 攻击的设备.</li>
<li>依靠网络服务提供商 (ISP) 来检测并消除 DoS 攻击.</li>
<li>获取云缓存提供商的服务: mature CDN service support DDoS protection.</li>
<li>Scalable job queue.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="ddos-attack">DDoS Attack<a href="#ddos-attack" class="hash-link" aria-label="Direct link to DDoS Attack" title="Direct link to DDoS Attack">​</a></h4>
<p>Distributed denial of service attack:</p>
<ul>
<li>SYN flood:
伪造 IP 不应答服务器 <code>SYN/ACK</code> 报文, 导致服务器消耗资源 (retry time) 处理这种半连接.</li>
<li>UDP flood.</li>
<li>ICMP flood.</li>
<li>Slow connection attack: 构造 <code>Content-Length</code> 大值, 低速度发包 (10s ~ 100s 发送一个字节), 占用服务器资源.</li>
<li>Redirect attack: 入侵了一个大网站后, 通过篡改页面, 将巨大的用户流量分流到目标网站.</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="ddos-protection">DDoS Protection<a href="#ddos-protection" class="hash-link" aria-label="Direct link to DDoS Protection" title="Direct link to DDoS Protection">​</a></h4>
<ul>
<li>SYN cookie: 每个 IP 地址分配一个 cookie, 限制访问频率, 超过一定频率后不响应 IP.</li>
<li>限制请求频率与请求力度:<!-- -->
<ul>
<li>客户端:
CAPTCHA (Completely Automated Pub-lic Turing Test to Tell Computers and HumansApart).</li>
<li>服务端:
建立应用防火墙与服务器安全模块, e.g 过滤网关防护.</li>
</ul>
</li>
<li>提升带宽最大负荷.<!-- -->
<ul>
<li>缩短超时 (SYN Timeout) 时间.</li>
<li>增加最大半连接数.</li>
</ul>
</li>
<li>提升服务器性能:<!-- -->
<ul>
<li>Use mature memory cache library, e.g <code>Redis</code>.</li>
<li>负载均衡.</li>
<li>CDN.</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="redos-attack">ReDoS Attack<a href="#redos-attack" class="hash-link" aria-label="Direct link to ReDoS Attack" title="Direct link to ReDoS Attack">​</a></h4>
<p>正则表达式 DoS 攻击:</p>
<p>正则表达式引擎采用回溯的方式匹配所有可能性, 导致性能问题.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="redos-protection">ReDoS Protection<a href="#redos-protection" class="hash-link" aria-label="Direct link to ReDoS Protection" title="Direct link to ReDoS Protection">​</a></h4>
<ul>
<li>不使用 NFA 实现的正则表达式引擎, 使用 DFA 实现的正则表达式引擎.</li>
<li>不定义性能消耗过大的正则表达式.</li>
<li>不动态构造正则表达式 <code>new RegExp()</code>.</li>
<li>禁止用户输入影响正则表达式构建/匹配.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="zero-trust-access-control">Zero Trust Access Control<a href="#zero-trust-access-control" class="hash-link" aria-label="Direct link to Zero Trust Access Control" title="Direct link to Zero Trust Access Control">​</a></h2>
<p>从防御的角度来讲, 内部风险是外部风险的超集:
当攻击者攻陷任何一个内部人员 (合法用户或员工) 的设备后,
攻击者便成了内部人员.
<a href="https://zchn.github.io/j/ztcn" target="_blank" rel="noopener noreferrer">零信任</a>
从这个角度看就是假设任何一台主机都有可能被攻陷.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="chain-of-trust">Chain of Trust<a href="#chain-of-trust" class="hash-link" aria-label="Direct link to Chain of Trust" title="Direct link to Chain of Trust">​</a></h3>
<p>零信任并不是完全没有信任,
而是几个基本的最小化的信任根 (Root of Trust),
重构信任链 (Chain of Trust).
通过一系列的标准化流程 (Standard Process) 建立的一个完整的信任链
(信任树 Tree of Trust 或者信任网 Web of Trust).</p>
<p>几个典型的例子包括:</p>
<ul>
<li>多因子认证 (MFA, Multi-Factor Authentication):
人的身份的信任根.</li>
<li>可信平台模块 (TPM, Trusted Platform Module)和可信启动 (Trusted Boot):
机器的身份的信任根.</li>
<li>源代码和可信编译 (Trusted Build):
软件的信任根.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="identity-20">Identity 2.0<a href="#identity-20" class="hash-link" aria-label="Direct link to Identity 2.0" title="Direct link to Identity 2.0">​</a></h3>
<p>身份 2.0 是对于以上的信任链的标准化,
以便于在安全访问策略中使用这些在建立信任过程中收集到的信息.</p>
<p>在身份 2.0 中, 一切本体 (Entity) 都有身份.
用户有用户身份, 员工有员工身份, 机器有机器身份, 软件有软件身份.</p>
<p>在身份 2.0 中, 一切访问 (Access) 都带有访问背景 (Access Context):</p>
<ul>
<li>目的: 为了帮助用户解决一个技术问题</li>
<li>访问者: 员工 A</li>
<li>授权者: 用户 B</li>
<li>访问方式: 软件 C</li>
<li>访问地点: 机器 D</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="continuous-access-control">Continuous Access Control<a href="#continuous-access-control" class="hash-link" aria-label="Direct link to Continuous Access Control" title="Direct link to Continuous Access Control">​</a></h3>
<p>持续访问控制会在软件开发和运行的各个环节持续地进行访问控制:</p>
<ul>
<li>在员工登录时要求提供多因子认证.</li>
<li>在部署软件时要求软件是从信任的源码库在安全的环境中编译而来,
并经过代码评估 (Code Review).</li>
<li>在主机之间建立连接时要求双方提供主机完整性证明.</li>
<li>在微服务获取特定用户数据时要求提供该用户的授权令牌 (Authorization Token).</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="zero-trust-basement">Zero Trust Basement<a href="#zero-trust-basement" class="hash-link" aria-label="Direct link to Zero Trust Basement" title="Direct link to Zero Trust Basement">​</a></h3>
<p>零信任的实施依赖于扎实的基础安全架构, 没有基础就没有上层建筑.
谷歌零信任依赖于以下基础设施提供的基本安全保障:</p>
<ul>
<li>数据加密和密钥管理 (Encryption and Key Management)</li>
<li>身份和访问管理 (Identity and Access Management)</li>
<li>数字化人力资源管理 (Digital Human Resource)</li>
<li>数字化设备管理 (Digital Device Management)</li>
<li>数据中心安全 (Data Center Security)</li>
<li>网络安全 (Network Security)</li>
<li>主机安全 (Host Security)</li>
<li>容器隔离 (Container Isolation, gVisor)</li>
<li>可信启动 (Trusted Boot)</li>
<li>可验证编译 (Verifiable Build)</li>
<li>软件完整性验证 (Software Integrity Verification)</li>
<li>双向 TLS (mTLS)</li>
<li>基于服务的访问策略 (Service Access Policy)</li>
<li>终端用户令牌 (End User Context Tokens)</li>
<li>配置即代码 (Configuration as Code)</li>
<li>标准化开发和部署 (Standard Development and Deployment)</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="security-checklist">Security Checklist<a href="#security-checklist" class="hash-link" aria-label="Direct link to Security Checklist" title="Direct link to Security Checklist">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="access-control-system-checklist">Access Control System Checklist<a href="#access-control-system-checklist" class="hash-link" aria-label="Direct link to Access Control System Checklist" title="Direct link to Access Control System Checklist">​</a></h3>
<p>注册/二次验证/密码重置:</p>
<ul class="contains-task-list containsTaskList_BYnl">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->任何地方都使用 HTTPS.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用 <code>bcrypt</code> 存储密码哈希.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>登出</code>之后销毁会话 ID .</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->密码重置后销毁所有活跃的会话.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->OAuth2 验证必须包含 <code>state</code> 参数.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->登陆成功之后不能直接重定向到开放的路径 (需要校验, 否则容易存在钓鱼攻击).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->当解析用户注册/登陆的输入时, 过滤 <code>javascript://</code>, <code>data://</code> 以及其他 CRLF 字符.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用 <code>secure</code>/<code>httpOnly</code> <code>Cookie</code>.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->移动端使用 <code>OTP</code> 验证时, 当调用 <code>generate OTP</code> 或者 <code>Resend OTP</code> API 时不能把 OTP
(One Time Password) 直接返回
(一般是通过发送手机验证短信, 邮箱随机 code 等方式, 而不是直接 response).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->限制单个用户 <code>Login</code>/<code>Verify OTP</code>/ <code>Resend OTP</code>/<code>generate OTP</code> 等 API 的调用次数,
使用 Captcha 等手段防止暴力破解.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->检查邮件或短信里的重置密码的 token, 确保随机性 (无法猜测).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->给重置密码的 token 设置过期时间.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->重置密码成功后, 将重置使用的 token 失效.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->Nodejs 等不使用 sudo 运行.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="authentication-checklist">Authentication Checklist<a href="#authentication-checklist" class="hash-link" aria-label="Direct link to Authentication Checklist" title="Direct link to Authentication Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_BYnl">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->诸如<code>我的购物车</code>/<code>我的浏览历史</code>之类的资源访问, 必须检查当前登录的用户是否有这些资源的访问权限.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->避免资源 ID 被连续遍历访问, 使用 <code>/me/orders</code> 代替 <code>/user/37153/orders</code> 以防忘记检查权限, 导致数据泄露.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>修改邮箱/手机号码</code>功能必须首先确认用户已经验证过邮箱/手机 (本人).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->任何上传功能应过滤用户上传的文件名, 并存储在云存储上防止代码执行.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>个人头像上传</code> 功能应过滤所有的 <code>EXIF</code> 标签.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->用户 ID 或者其他的 ID,
应使用 <a href="http://www.ietf.org/rfc/rfc4122.txt" target="_blank" rel="noopener noreferrer">RFC compliant</a> 的 <code>UUID</code> 而不是整数.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <a href="https://jwt.io" target="_blank" rel="noopener noreferrer"><code>JWT</code></a> (JSON Web Token): 当构建一个 <code>SPA</code>/<code>API</code> 时使用 <code>JWT</code>.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="mobile-application-checklist">Mobile Application Checklist<a href="#mobile-application-checklist" class="hash-link" aria-label="Direct link to Mobile Application Checklist" title="Direct link to Mobile Application Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_BYnl">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->支付网关的 <code>salt</code> (盐) 不应被硬编码.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->来自第三方的 <code>secret</code> 和 <code>auth token</code> 不应被硬编码.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->在服务器之间调用的 API 不应在 app 里面调用.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->在安卓系统下, 要小心评估所有申请的 <a href="https://developer.android.com/guide/topics/security/permissions.html" target="_blank" rel="noopener noreferrer">权限</a>.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->在 iOS 系统下, 使用系统的钥匙串来存储敏感信息 (auth token/API key) <strong>不要</strong> 把这类信息存储在用户配置里面.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->强烈推荐证书绑定 (<a href="https://en.wikipedia.org/wiki/HTTP_Public_Key_Pinning" target="_blank" rel="noopener noreferrer">certificate pinning</a>).</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="server-configuration-checklist">Server Configuration Checklist<a href="#server-configuration-checklist" class="hash-link" aria-label="Direct link to Server Configuration Checklist" title="Direct link to Server Configuration Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_BYnl">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>添加</code> <a href="https://en.wikipedia.org/wiki/Content_Security_Policy" target="_blank" rel="noopener noreferrer">CSP</a> 头信息,
减缓 XSS 和数据注入攻击. 这很重要.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>添加</code> <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank" rel="noopener noreferrer">CSRF</a> 头信息
防止跨站请求伪造 (CSRF) 攻击.
同时<code>添加</code> <a href="https://tools.ietf.org/html/draft-ietf-httpbis-cookie-same-site-00" target="_blank" rel="noopener noreferrer">SameSite</a>
属性到 cookie 里面.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>添加</code> <a href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security" target="_blank" rel="noopener noreferrer">HSTS</a>
头信息防止 SSL stripping 攻击.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>添加</code> 你的域名到 <a href="https://hstspreload.appspot.com" target="_blank" rel="noopener noreferrer">HSTS 预加载列表</a>.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>添加</code> <a href="https://en.wikipedia.org/wiki/Clickjacking#X-Frame-Options" target="_blank" rel="noopener noreferrer">X-Frame-Options</a>
防止点击劫持.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>添加</code> <a href="https://www.owasp.org/index.php/OWASP_Secure_Headers_Project#X-XSS-Protection" target="_blank" rel="noopener noreferrer">X-XSS-Protection</a>
缓解 XSS 攻击.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>更新</code> DNS 记录, 增加 <a href="https://en.wikipedia.org/wiki/Sender_Policy_Framework" target="_blank" rel="noopener noreferrer">SPF</a>
记录防止垃圾邮件和钓鱼攻击.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->如果你的 Javascript 托管在第三方的 CDN 上面,
需要<code>添加</code> <a href="https://en.wikipedia.org/wiki/Subresource_Integrity" target="_blank" rel="noopener noreferrer">内部资源集成检查</a>.
为了更加安全, 添加 <a href="https://w3c.github.io/webappsec-subresource-integrity/#parse-require-sri-for" target="_blank" rel="noopener noreferrer">require-sri-for</a>
CSP-directive 就不会加载到没有 SRI 的资源.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用随机的 CSRF token, 业务逻辑 API 可以暴露为 POST 请求.
不要把 CSRF token 通过 HTTP 接口暴露出来, 比如第一次请求更新的时候.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->在 <code>GET</code> 请求参数里面, 不要使用临界数据和 token: 暴露服务器日志的同时也会暴露用户数据.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="client-input-checklist">Client Input Checklist<a href="#client-input-checklist" class="hash-link" aria-label="Direct link to Client Input Checklist" title="Direct link to Client Input Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_BYnl">
<li class="task-list-item"><input type="checkbox" disabled=""> <code>过滤</code>所有暴露给用户的参数输入,
防止 <a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank" rel="noopener noreferrer">XSS</a> 攻击.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用参数化的查询防止 <a href="https://en.wikipedia.org/wiki/SQL_injection" target="_blank" rel="noopener noreferrer">SQL 注入</a>.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>过滤</code>所有具有功能性的用户输入, 比如 <code>CSV</code> 导入.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>过滤</code>一些特殊的用户输入,
例如将 <code>robots.txt</code> 作为用户名,
提供 <code>coolCorp.io/username</code> 之类的 <code>URL</code> 来提供用户信息访问页面:
此时变成 <code>coolCorp.io/robots.txt</code>, 造成安全漏洞.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->禁止手动拼装 JSON 字符串, 不管这个对象有多么小: 使用所用的语言相应的库或者框架来编写.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <code>过滤</code> 类似 <code>URL</code> 的输入,
防止 <a href="https://docs.google.com/document/d/1v1TkWZtrhzRLy0bYXBcdLUedXGb9njTNIJXa3u9akHM/edit#heading=h.t4tsk5ixehdd" target="_blank" rel="noopener noreferrer">SSRF</a>
攻击.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->在输出显示给用户之前, <code>过滤</code>输出信息.</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="operation-checklist">Operation Checklist<a href="#operation-checklist" class="hash-link" aria-label="Direct link to Operation Checklist" title="Direct link to Operation Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_BYnl">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->如果你的业务很小或者你缺乏经验, 可以评估一下使用 AWS 或者一个 PaaS 平台来运行代码.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->在云上使用正规的脚本创建虚拟机.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->检查所有机器没有必要开放的 <code>端口</code>.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->检查数据库是否没有设置密码或者使用默认密码, 特别是 MongoDB 和 Redis.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用 SSH 登录你的机器, 不要使用密码, 而是通过 SSH key 验证来登录.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->及时更新系统, 防止出现 0day 漏洞, 比如 HeartBleed, ShellShock 等.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->修改服务器配置, HTTPS 使用 TLS1.2, 禁用其他的模式.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->不要在线上开启 DEBUG 模式, 有些框架, DEBUG 模式会开启很多权限以及后门, 或者是暴露一些敏感数据到错误栈信息里面.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->对坏人和 DDOS 攻击要有所准备, 使用那些提供 DDOS 清洗的主机服务.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->监控你的系统, 同时记录到日志里面 (例如使用 <a href="https://newrelic.com" target="_blank" rel="noopener noreferrer">New Relic</a> 或者其他).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->如果是 2B 的业务, 坚持顺从需求.
如果使用 AWS S3, 可以考虑使用
<a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html" target="_blank" rel="noopener noreferrer">数据加密</a>
功能.
如果使用 AWS EC2, 考虑使用磁盘加密功能 (系统启动盘也可加密).</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="teamwork-checklist">Teamwork Checklist<a href="#teamwork-checklist" class="hash-link" aria-label="Direct link to Teamwork Checklist" title="Direct link to Teamwork Checklist">​</a></h3>
<ul class="contains-task-list containsTaskList_BYnl">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->开一个邮件组 (例如: <code>security@coolcorp.io</code>) 和搜集页面, 方便安全研究人员提交漏洞.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->取决于你的业务, 限制用户数据库的访问.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->对报告 BUG 与 漏洞的人有礼貌.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->把你的代码给那些有安全编码观念的同伴进行 review (More eyes).</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->被黑或者数据泄露时, 检查数据访问前的日志, 通知用户更改密码, 可能需要外部的机构来帮助审计.</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->使用 <a href="https://github.com/Netflix/Scumblr" target="_blank" rel="noopener noreferrer">Netflix Scumblr</a> 及时了解
你的组织 (公司) 在社交网络或者搜索引擎上的一些讨论信息, 比如黑客攻击/漏洞等等.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_XDPE" id="security-reference">Security Reference<a href="#security-reference" class="hash-link" aria-label="Direct link to Security Reference" title="Direct link to Security Reference">​</a></h2>
<ul>
<li>Open web application security project <a href="https://github.com/OWASP/CheatSheetSeries" target="_blank" rel="noopener noreferrer">cheat sheet</a>.</li>
<li>Open source security state of <a href="https://snyk.io/reports/open-source-security" target="_blank" rel="noopener noreferrer">2022</a>.</li>
<li>Web security <a href="https://eggjs.org/zh-cn/core/security.html" target="_blank" rel="noopener noreferrer">checklist</a>.</li>
<li>Security search <a href="https://github.com/edoardottt/awesome-hacker-search-engines" target="_blank" rel="noopener noreferrer">engines</a>.</li>
<li>ESLint node security <a href="https://github.com/nodesecurity/eslint-plugin-security" target="_blank" rel="noopener noreferrer">plugin</a>.</li>
<li>MetaSploit: penetration testing <a href="https://github.com/rapid7/metasploit-framework" target="_blank" rel="noopener noreferrer">framework</a>.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_TBJm padding--none margin-left--sm"><li class="tag_USTg"><a class="tag_P2MX tagRegular_DnEZ" href="/awesome-notes/tags/web">Web</a></li><li class="tag_USTg"><a class="tag_P2MX tagRegular_DnEZ" href="/awesome-notes/tags/dev-ops">DevOps</a></li><li class="tag_USTg"><a class="tag_P2MX tagRegular_DnEZ" href="/awesome-notes/tags/security">Security</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/sabertazimi/awesome-notes/edit/main/notes/Web/Security/SecurityBasicNotes.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_sBYE" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Jpru"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-11-20T18:28:55.000Z" itemprop="dateModified">Nov 20, 2024</time></b> by <b>renovate[bot]</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/awesome-notes/Web/React/ReduxBasicNotes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Redux Basic Notes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/awesome-notes/Web/Vue/VueAdvancedNotes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Vue Advanced Notes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_oQTr thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#security-programming" class="table-of-contents__link toc-highlight">Security Programming</a><ul><li><a href="#security-principles" class="table-of-contents__link toc-highlight">Security Principles</a></li><li><a href="#software-security-assurance" class="table-of-contents__link toc-highlight">Software Security Assurance</a></li><li><a href="#defensive-programming" class="table-of-contents__link toc-highlight">Defensive Programming</a></li><li><a href="#security-headers" class="table-of-contents__link toc-highlight">Security Headers</a></li><li><a href="#same-origin-policy" class="table-of-contents__link toc-highlight">Same Origin Policy</a></li><li><a href="#content-security-policy" class="table-of-contents__link toc-highlight">Content Security Policy</a></li><li><a href="#trusted-types" class="table-of-contents__link toc-highlight">Trusted Types</a></li><li><a href="#sandbox" class="table-of-contents__link toc-highlight">Sandbox</a></li><li><a href="#crypto" class="table-of-contents__link toc-highlight">Crypto</a></li><li><a href="#user-privacy" class="table-of-contents__link toc-highlight">User Privacy</a></li></ul></li><li><a href="#security-vulnerability" class="table-of-contents__link toc-highlight">Security Vulnerability</a><ul><li><a href="#xss" class="table-of-contents__link toc-highlight">XSS</a></li><li><a href="#csrf" class="table-of-contents__link toc-highlight">CSRF</a></li><li><a href="#click-jacking" class="table-of-contents__link toc-highlight">Click Jacking</a></li><li><a href="#sql-injection" class="table-of-contents__link toc-highlight">SQL Injection</a></li><li><a href="#command-injection" class="table-of-contents__link toc-highlight">Command Injection</a></li><li><a href="#http-injection" class="table-of-contents__link toc-highlight">HTTP Injection</a></li><li><a href="#object-injection" class="table-of-contents__link toc-highlight">Object Injection</a></li><li><a href="#file-upload-injection" class="table-of-contents__link toc-highlight">File Upload Injection</a></li><li><a href="#authentication-vulnerability" class="table-of-contents__link toc-highlight">Authentication Vulnerability</a></li><li><a href="#session-vulnerability" class="table-of-contents__link toc-highlight">Session Vulnerability</a></li><li><a href="#directory-traversal" class="table-of-contents__link toc-highlight">Directory Traversal</a></li><li><a href="#information-leakage" class="table-of-contents__link toc-highlight">Information Leakage</a></li><li><a href="#supply-chain-vulnerability" class="table-of-contents__link toc-highlight">Supply Chain Vulnerability</a></li><li><a href="#xml-vulnerability" class="table-of-contents__link toc-highlight">XML Vulnerability</a></li><li><a href="#denial-of-service" class="table-of-contents__link toc-highlight">Denial of Service</a></li></ul></li><li><a href="#zero-trust-access-control" class="table-of-contents__link toc-highlight">Zero Trust Access Control</a><ul><li><a href="#chain-of-trust" class="table-of-contents__link toc-highlight">Chain of Trust</a></li><li><a href="#identity-20" class="table-of-contents__link toc-highlight">Identity 2.0</a></li><li><a href="#continuous-access-control" class="table-of-contents__link toc-highlight">Continuous Access Control</a></li><li><a href="#zero-trust-basement" class="table-of-contents__link toc-highlight">Zero Trust Basement</a></li></ul></li><li><a href="#security-checklist" class="table-of-contents__link toc-highlight">Security Checklist</a><ul><li><a href="#access-control-system-checklist" class="table-of-contents__link toc-highlight">Access Control System Checklist</a></li><li><a href="#authentication-checklist" class="table-of-contents__link toc-highlight">Authentication Checklist</a></li><li><a href="#mobile-application-checklist" class="table-of-contents__link toc-highlight">Mobile Application Checklist</a></li><li><a href="#server-configuration-checklist" class="table-of-contents__link toc-highlight">Server Configuration Checklist</a></li><li><a href="#client-input-checklist" class="table-of-contents__link toc-highlight">Client Input Checklist</a></li><li><a href="#operation-checklist" class="table-of-contents__link toc-highlight">Operation Checklist</a></li><li><a href="#teamwork-checklist" class="table-of-contents__link toc-highlight">Teamwork Checklist</a></li></ul></li><li><a href="#security-reference" class="table-of-contents__link toc-highlight">Security Reference</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Notes</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/awesome-notes/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/awesome-notes/ComputerScience/Math/AIBasicNotes">Computer Science</a></li><li class="footer__item"><a class="footer__link-item" href="/awesome-notes/Programming/DevOps/CleanCodeBasicNotes">Programming</a></li><li class="footer__item"><a class="footer__link-item" href="/awesome-notes/Language/Rust/RustBasicNotes">Language</a></li><li class="footer__item"><a class="footer__link-item" href="/awesome-notes/Web/JavaScript/JavaScriptBasicNotes">Web</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sabertazimi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/sabertazimi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://facebook.com/sabertazimi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://weibo.com/sabertazimi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Weibo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="mailto:sabertazimi@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Find More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sabertazimi/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Next.js Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/sabertazimi/awesome-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">Awesome Web<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/sabertazimi/bod" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bod CLI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/sabertazimi/dragon-zsh-theme" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dragon ZSH Theme<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/sabertazimi/boilerplate" target="_blank" rel="noopener noreferrer" class="footer__link-item">Minimal Boilerplate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_xkyu"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Sabertazimi.</div></div></div></footer></div>
</body>
</html>